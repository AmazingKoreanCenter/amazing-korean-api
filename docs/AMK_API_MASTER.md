---
title: AMK_API_MASTER â€” Amazing Korean API  Master Spec
updated: 2026-02-05
owner: HYMN Co., Ltd. (Amazing Korean)
audience: server / database / backend / frontend / lead / LLM assistant
---

## â€» AMK_API_MASTER â€” Amazing Korean API Master Spec â€»

> ì´ ë¬¸ì„œëŠ” **Amazing Korean server / database / backend / frontend / web&app ì „ì²´ ìŠ¤í™Â·ê·œì¹™Â·ë¡œë“œë§µì˜ ë‹¨ì¼ ê¸°ì¤€(Single Source of Truth)** ì´ë‹¤.

> ê³¼ê±° ë¬¸ì„œë“¤(`AMK_Feature_Roadmap.md`, `AMK_PROJECT_JOURNAL.md`, `AMK_ENGINEERING_GUIDE.md`, `AMK_API_OVERVIEW_FULL.md`, `README_for_assistant.md`)ì— í©ì–´ì ¸ ìˆë˜ ë‚´ìš©ì„ í†µí•©Â·ì •ë¦¬í•œ ë²„ì „

> **ì´ ë¬¸ì„œì™€ ë‹¤ë¥¸ ë¬¸ì„œê°€ ì¶©ëŒí•  ê²½ìš° ì´ ë¬¸ì„œë¥¼ ì •ë‹µìœ¼ë¡œ ê°„ì£¼í•œë‹¤.**

---

## ğŸ“‘ ëª©ì°¨ (Table of Contents)

- [0. ë¬¸ì„œ ë©”íƒ€ & ì‚¬ìš© ë°©ë²•](#0-ë¬¸ì„œ-ë©”íƒ€--ì‚¬ìš©-ë°©ë²•)
  - [0.1 ëª©ì ](#01-ëª©ì )
  - [0.2 ì‚¬ìš© ì›ì¹™](#02-ì‚¬ìš©-ì›ì¹™)
  - [0.3 ê´€ë ¨ íŒŒì¼](#03-ê´€ë ¨-íŒŒì¼)
  - [0.4 LLM í˜‘ì—… ê°€ì´ë“œ](#04-llm-í˜‘ì—…-ê°€ì´ë“œ)

- [1. í”„ë¡œì íŠ¸ ê°œìš” & ëª©í‘œ](#1-í”„ë¡œì íŠ¸-ê°œìš”--ëª©í‘œ)
  - [1.1 ì„œë¹„ìŠ¤ ê°œìš”](#11-ì„œë¹„ìŠ¤-ê°œìš”)
  - [1.2 ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ (Business Logic)](#12-ë¹„ì¦ˆë‹ˆìŠ¤-íë¦„-business-logic)

- [2. ì‹œìŠ¤í…œ & ê°œë°œ í™˜ê²½ ê°œìš”](#2-ì‹œìŠ¤í…œ--ê°œë°œ-í™˜ê²½-ê°œìš”)
  - [2.1 ëŸ°íƒ€ì„ / ìŠ¤íƒ](#21-ëŸ°íƒ€ì„--ìŠ¤íƒ)
  - [2.2 ë¼ìš°íŒ… & OpenAPI](#22-ë¼ìš°íŒ…--openapi)
  - [2.3 ë¡œì»¬ ê°œë°œ & ì‹¤í–‰](#23-ë¡œì»¬-ê°œë°œ--ì‹¤í–‰)
  - [2.4 ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™](#24-ì™¸ë¶€-ì„œë¹„ìŠ¤-ì—°ë™)

- [3. ê³µí†µ ê·œì¹™ (ì „ì—­ ì»¨ë²¤ì…˜)](#3-ê³µí†µ-ê·œì¹™-ì „ì—­-ì»¨ë²¤ì…˜)
  - [3.1 ì‹œê°„/íƒ€ì„ì¡´](#31-ì‹œê°„íƒ€ì„ì¡´)
  - [3.2 ë„¤ì´ë° & ìŠ¤í‚¤ë§ˆ ê·œì¹™ (ìš”ì•½)](#32-ë„¤ì´ë°--ìŠ¤í‚¤ë§ˆ-ê·œì¹™-ìš”ì•½)
  - [3.3 ê³µí†µ í—¤ë” & ì¸ì¦](#33-ê³µí†µ-í—¤ë”--ì¸ì¦)
  - [3.4 ì—ëŸ¬ ì‘ë‹µ í‘œì¤€](#34-ì—ëŸ¬-ì‘ë‹µ-í‘œì¤€)
  - [3.5 í˜ì´ì§• & ê²€ìƒ‰ í‘œì¤€](#35-í˜ì´ì§•--ê²€ìƒ‰-í‘œì¤€)
  - [3.6 ì‘ë‹µ ë˜í¼ ì •ì±…](#36-ì‘ë‹µ-ë˜í¼-ì •ì±…)
  - [3.7 ì¸ì¦ & ì„¸ì…˜ ê´€ë¦¬ (í†µí•©)](#37-ì¸ì¦--ì„¸ì…˜-ê´€ë¦¬-í†µí•©)

- [4. ë°ì´í„° ëª¨ë¸ ê°œìš” (ìš”ì•½)](#4-ë°ì´í„°-ëª¨ë¸-ê°œìš”-ìš”ì•½)
  - [4.1 ì‚¬ìš©ì ë„ë©”ì¸ (USERS)](#41-ì‚¬ìš©ì-ë„ë©”ì¸-users)
  - [4.2 ì¸ì¦ ë¡œê·¸ì¸ ë„ë©”ì¸ (AUTH LOGIN)](#42-ì¸ì¦-ë¡œê·¸ì¸-ë„ë©”ì¸-auth-login)
  - [4.3 ë¹„ë””ì˜¤ ë„ë©”ì¸ (VIDEOS)](#43-ë¹„ë””ì˜¤-ë„ë©”ì¸-videos)
  - [4.4 í•™ìŠµ ë„ë©”ì¸ (STUDY)](#44-í•™ìŠµ-ë„ë©”ì¸-study)
  - [4.5 ìˆ˜ì—… êµ¬ì„± ë„ë©”ì¸ (LESSON)](#45-ìˆ˜ì—…-êµ¬ì„±-ë„ë©”ì¸-lesson)
  - [4.6 í–¥í›„ ì—…ë°ì´íŠ¸ ë„ë©”ì¸](#46-í–¥í›„-ì—…ë°ì´íŠ¸-ë„ë©”ì¸)

- [5. ê¸°ëŠ¥ & API ë¡œë“œë§µ (Phase / í™”ë©´ / ì—”ë“œí¬ì¸íŠ¸ / ìƒíƒœ / DoD)](#5-ê¸°ëŠ¥--api-ë¡œë“œë§µ-phase--í™”ë©´--ì—”ë“œí¬ì¸íŠ¸--ìƒíƒœ--dod)
  - [5.0 Phase ë¡œë“œë§µ ì²´í¬ë°•ìŠ¤ ë²”ë¡€](#50-phase-ë¡œë“œë§µ-ì²´í¬ë°•ìŠ¤-ë²”ë¡€)
  - [5.1 Phase 1 â€” health](#51-phase-1--health-)
  - [5.2 Phase 2 â€” user](#52-phase-2--user-)
  - [5.3 Phase 3 â€” auth](#53-phase-3--auth-)
  - [5.4 Phase 4 â€” video](#54-phase-4--video-)
  - [5.5 Phase 5 â€” study](#55-phase-5--study-)
  - [5.6 Phase 6 â€” lesson](#56-phase-6--lesson-)
  - [5.7 Phase 7 â€” admin](#57-phase-7--admin-)
  - [5.8 Phase 8 â€” scripts](#58-phase-8--scripts)

- [6. í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡° & ê·œì¹™](#6-í”„ë¡ íŠ¸ì—”ë“œ-êµ¬ì¡°--ê·œì¹™)
  - [6.1 í”„ë¡ íŠ¸ì—”ë“œ ìŠ¤íƒ & ê¸°ë³¸ ì›ì¹™](#61-í”„ë¡ íŠ¸ì—”ë“œ-ìŠ¤íƒ--ê¸°ë³¸-ì›ì¹™)
  - [6.2 í”„ë¡ íŠ¸ ë””ë ‰í„°ë¦¬ êµ¬ì¡° & ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ](#62-í”„ë¡ íŠ¸-ë””ë ‰í„°ë¦¬-êµ¬ì¡°--ì»´í¬ë„ŒíŠ¸-ê³„ì¸µ)
    - [6.2.4 ë‹¤êµ­ì–´(i18n) ì•„í‚¤í…ì²˜](#624-ë‹¤êµ­ì–´i18n-ì•„í‚¤í…ì²˜)
  - [6.3 ë¼ìš°íŒ… & ì ‘ê·¼ ì œì–´](#63-ë¼ìš°íŒ…--ì ‘ê·¼-ì œì–´)
  - [6.4 ìƒíƒœ ê´€ë¦¬ & API ì—°ë™ íŒ¨í„´](#64-ìƒíƒœ-ê´€ë¦¬--api-ì—°ë™-íŒ¨í„´)
  - [6.5 UI/UX & Tailwind ê·œì¹™ (shadcn/ui System)](#65-uiux--tailwind-ê·œì¹™-shadcnui-system)
  - [6.6 í”„ë¡ íŠ¸ í…ŒìŠ¤íŠ¸ & ë¹Œë“œ/ë°°í¬ (ìš”ì•½)](#66-í”„ë¡ íŠ¸-í…ŒìŠ¤íŠ¸--ë¹Œë“œë°°í¬-ìš”ì•½)
    - [6.6.2-1 Cloudflare Pages ë°°í¬ (í”„ë¡ íŠ¸ì—”ë“œ)](#6621-cloudflare-pages-ë°°í¬-í”„ë¡ íŠ¸ì—”ë“œ)
    - [6.6.2-2 AWS EC2 ë°°í¬ (ë°±ì—”ë“œ)](#6622-aws-ec2-ë°°í¬-ë°±ì—”ë“œ)
    - [6.6.2-3 GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸](#6623-github-actions-cicd-íŒŒì´í”„ë¼ì¸)
    - [6.6.2-4 EC2 ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ](#6624-ec2-ìœ ì§€ë³´ìˆ˜-ê°€ì´ë“œ)

- [7. ì‘ì—… ë°©ì‹ / ì—”ì§€ë‹ˆì–´ë§ ê°€ì´ë“œ (ìš”ì•½)](#7-ì‘ì—…-ë°©ì‹--ì—”ì§€ë‹ˆì–´ë§-ê°€ì´ë“œ-ìš”ì•½)
  - [7.1 ì‘ì—… ì›ì¹™](#71-ì‘ì—…-ì›ì¹™)
  - [7.2 ê°œë°œ í”Œë¡œìš°](#72-ê°œë°œ-í”Œë¡œìš°)
  - [7.3 DTO/ê²€ì¦ ê·œì¹™ (ìš”ì•½)](#73-dtoê²€ì¦-ê·œì¹™-ìš”ì•½)
  - [7.4 ì„œë¹„ìŠ¤ ê³„ì¸µ ë° íŒŒì¼ êµ¬ì¡°](#74-ì„œë¹„ìŠ¤-ê³„ì¸µ-ë°-íŒŒì¼-êµ¬ì¡°)
  - [7.5 íŠ¸ëœì­ì…˜ íŒ¨í„´](#75-íŠ¸ëœì­ì…˜-íŒ¨í„´)
  - [7.6 í…ŒìŠ¤íŠ¸ & ìë™í™”](#76-í…ŒìŠ¤íŠ¸--ìë™í™”)
  - [7.7 ì½”ë“œ ì˜ˆì‹œ (Best Practices)](#77-ì½”ë“œ-ì˜ˆì‹œ-best-practices)
    - [7.7.1 ë°±ì—”ë“œ íŒ¨í„´ (Rust/Axum)](#771-ë°±ì—”ë“œ-íŒ¨í„´-rustaxum)
      - [7.7.1-0. ê³µìš© ì½”ë“œ (Common Code)](#771-0-ê³µìš©-ì½”ë“œ-common-code)
      - [7.7.1-1. dto.rs](#771-1-dtors)
      - [7.7.1-2. repo.rs](#771-2-repors)
      - [7.7.1-3. service.rs](#771-3-servicers)
      - [7.7.1-4. handler.rs](#771-4-handlerrs)
      - [7.7.1-5. router.rs](#771-5-routerrs)
      - [7.7.1-6. ê¸°íƒ€ íŒŒì¼ë“¤](#771-6-ê¸°íƒ€-íŒŒì¼ë“¤-auth-ìœ í‹¸ë¦¬í‹°)
    - [7.7.2 í”„ë¡ íŠ¸ì—”ë“œ íŒ¨í„´ (React/TypeScript)](#772-í”„ë¡ íŠ¸ì—”ë“œ-íŒ¨í„´-reacttypescript)
      - [7.7.2-1. types.ts (Zod ìŠ¤í‚¤ë§ˆ & íƒ€ì… ì •ì˜)](#772-1-typests-zod-ìŠ¤í‚¤ë§ˆ--íƒ€ì…-ì •ì˜)
      - [7.7.2-2. *_api.ts (API í•¨ìˆ˜)](#772-2-_apits-api-í•¨ìˆ˜)
      - [7.7.2-3. hook/*.ts (TanStack Query í›…)](#772-3-hookts-tanstack-query-í›…)
      - [7.7.2-4. page/*.tsx (í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸)](#772-4-pagetsx-í˜ì´ì§€-ì»´í¬ë„ŒíŠ¸)
      - [7.7.2-5. ê³µìš© ì¸í”„ë¼ (Shared Infrastructure)](#772-5-ê³µìš©-ì¸í”„ë¼-shared-infrastructure)
      - [7.7.2-6. í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° íë¦„ (Data Flow)](#772-6-í”„ë¡ íŠ¸ì—”ë“œ-ë°ì´í„°-íë¦„-data-flow)

- [8. LLM í˜‘ì—… ê·œì¹™ (ë‚˜ì™€ ì¼í•˜ëŠ” ë²•)](#8-llm-í˜‘ì—…-ê·œì¹™-ë‚˜ì™€-ì¼í•˜ëŠ”-ë²•)
  - [8.1 ì§ˆë¬¸/ìš”ì²­ ë°©ì‹](#81-ì§ˆë¬¸ìš”ì²­-ë°©ì‹)
  - [8.2 LLM ì‘ë‹µ ê¸°ëŒ€ í˜•ì‹](#82-llm-ì‘ë‹µ-ê¸°ëŒ€-í˜•ì‹)
  - [8.3 LLM_PATCH_TEMPLATE ì—°ë™](#83-llm_patch_template-ì—°ë™)
  - [8.4 í‘œì¤€ ì‘ì—… ì ˆì°¨ (SOP)](#84-í‘œì¤€-ì‘ì—…-ì ˆì°¨-sop-standard-operating-procedure)

- [9. Open Questions & ì„¤ê³„ TODO](#9-open-questions--ì„¤ê³„-todo)
  - [9.1 RBAC / ê´€ë¦¬ì ê¶Œí•œ](#91-rbac--ê´€ë¦¬ì-ê¶Œí•œ)
  - [9.2 Admin action log actor ì—°ê²°](#92-admin-action-log-actor-ì—°ê²°)
  - [9.3 í˜ì´ì§• ê³ ë„í™” (Keyset vs Page)](#93-í˜ì´ì§•-ê³ ë„í™”-keyset-vs-page)
  - [9.4 í…ŒìŠ¤íŠ¸ ì „ëµ](#94-í…ŒìŠ¤íŠ¸-ì „ëµ)
  - [9.5 ë³´ì•ˆ/ìš´ì˜ (í›„ìˆœìœ„ ê³„íš)](#95-ë³´ì•ˆìš´ì˜-í›„ìˆœìœ„-ê³„íš)
  - [9.6 ì½”ë“œ ì¼ê´€ì„± (Technical Debt)](#96-ì½”ë“œ-ì¼ê´€ì„±-technical-debt)
  - [9.7 ì¶”í›„ ì‘ì—… í•­ëª© (ë¬¸ì„œ ë‚´ TODO í†µí•©)](#97-ì¶”í›„-ì‘ì—…-í•­ëª©-ë¬¸ì„œ-ë‚´-todo-í†µí•©)
  - [9.8 LLM í˜‘ì—… ë„êµ¬ ì „í™˜](#98-llm-í˜‘ì—…-ë„êµ¬-ì „í™˜)
  - [9.9 ì¸í”„ë¼ ë¡œë“œë§µ (RDS ì´ì „)](#99-ì¸í”„ë¼-ë¡œë“œë§µ-rds-ì´ì „)
  - [9.10 ë°ì´í„° ëª¨ë‹ˆí„°ë§ & ì ‘ê·¼](#910-ë°ì´í„°-ëª¨ë‹ˆí„°ë§--ì ‘ê·¼)
  - [9.11 ë””ìì¸ & UI](#911-ë””ìì¸--ui)

- [10. ë³€ê²½ ì´ë ¥ (ìš”ì•½)](#10-ë³€ê²½-ì´ë ¥-ìš”ì•½)

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 0. ë¬¸ì„œ ë©”íƒ€ & ì‚¬ìš© ë°©ë²•

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

### 0.1 ëª©ì 

- Amazing Korean server / database / backend / frontend / web&app ëŒ€í•œ:
  - **ê¸°ëŠ¥ & API ë¡œë“œë§µ (Phase / í™”ë©´ / ì—”ë“œí¬ì¸íŠ¸ / ì™„ë£Œ ìƒíƒœ)**
  - **ê³µí†µ ê·œì¹™ (ì—ëŸ¬ / ì‹œê°„ / ì¸ì¦ / í˜ì´ì§• / ì‘ë‹µ ë˜í¼ ë“±)**
  - **ê°œë°œ / ì‘ì—… ë°©ì‹ (ì—”ì§€ë‹ˆì–´ë§ ê°€ì´ë“œ)**
  - **LLM í˜‘ì—… ê·œì¹™ (íŒ¨ì¹˜ ë°©ì‹, í…œí”Œë¦¿ ì‚¬ìš©ë²•)**
  - **Open Questions & ì„¤ê³„ TODO**
- ì„ í•œ íŒŒì¼ì—ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨.

### 0.2 ì‚¬ìš© ì›ì¹™

- **ìŠ¤í™ / ê¸°ëŠ¥ / ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë³€ê²½í•  ë•ŒëŠ” í•­ìƒ ì´ íŒŒì¼ì„ ë¨¼ì € ìˆ˜ì •**í•œë‹¤.
- ì½”ë“œ/ë§ˆì´ê·¸ë ˆì´ì…˜/í…ŒìŠ¤íŠ¸ë¥¼ ë³€ê²½í•œ ë’¤ì—ëŠ”, ì—¬ê¸°ì˜ ê´€ë ¨ ì„¹ì…˜(Phase í‘œ, ê·œì¹™, TODO)ì„ ë°˜ë“œì‹œ ê°±ì‹ í•œë‹¤.
- ê³¼ê±° md ë¬¸ì„œë“¤ì€ ëª¨ë‘ **ì°¸ê³ ìš© ì•„ì¹´ì´ë¸Œ**ì´ë©°, ìƒˆë¡œìš´ ì •ë³´ëŠ” **ì—¬ê¸°ì—ë§Œ ì ëŠ”ë‹¤**.

### 0.3 ê´€ë ¨ íŒŒì¼

- **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: [`docs/AMK_SCHEMA_PATCHED.md`](./AMK_SCHEMA_PATCHED.md) - ì „ì²´ DDL ì •ì˜
- **LLM í˜‘ì—… í…œí”Œë¦¿**:
  - ë°±ì—”ë“œ: [`docs/patchs/LLM_PATCHS_TEMPLATE_BACKEND.md`](./patchs/LLM_PATCHS_TEMPLATE_BACKEND.md)
  - í”„ë¡ íŠ¸ì—”ë“œ: [`frontend/docs/LLM_PATCHS_TEMPLATE_FRONTEND.md`](../frontend/docs/LLM_PATCHS_TEMPLATE_FRONTEND.md)
- (ì„ íƒ) ì´ ë¬¸ì„œëŠ” ë ˆí¬ ë‚´ `docs/AMK_API_MASTER.md` ê²½ë¡œì— ìœ„ì¹˜í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤.

### 0.4 LLM í˜‘ì—… ê°€ì´ë“œ

> ì´ ë¬¸ì„œë¥¼ LLM(Gemini, Claude, Codex ë“±)ê³¼ í˜‘ì—… ì‹œ í™œìš©í•˜ëŠ” ë°©ë²•

#### ì „ì²´ ì»¨í…ìŠ¤íŠ¸ ë¡œë”©

- **í”„ë¡¬í”„íŠ¸ ì‹œì‘**: "ì²¨ë¶€ëœ `AMK_API_MASTER.md`ë¥¼ ì°¸ì¡°í•˜ì—¬..."
- ì´ ë¬¸ì„œ í•˜ë‚˜ë¡œ ì „ì²´ í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜, ê·œì¹™, API ëª…ì„¸ë¥¼ íŒŒì•… ê°€ëŠ¥
- ë¬¸ì„œ í¬ê¸°: ì•½ 2,300ì¤„ (Gemini 2.0, Claude Sonnet ë“± ìµœì‹  LLMì€ ì¶©ë¶„íˆ ì²˜ë¦¬ ê°€ëŠ¥)

#### ì„¹ì…˜ë³„ ì°¸ì¡° ë°©ë²•

**ë°±ì—”ë“œ ì‘ì—… ì‹œ**:
- **Section 2**: ì‹œìŠ¤í…œ & ê°œë°œ í™˜ê²½ (ìŠ¤íƒ, ë¼ìš°íŒ…, OpenAPI)
- **Section 3**: ê³µí†µ ê·œì¹™ (ë„¤ì´ë°, ì—ëŸ¬, ì¸ì¦, í˜ì´ì§•)
- **Section 4**: ë°ì´í„° ëª¨ë¸ ê°œìš”
- **Section 5**: ê¸°ëŠ¥ & API ë¡œë“œë§µ (Phaseë³„ ì—”ë“œí¬ì¸íŠ¸ ëª…ì„¸)
- **Section 7**: ì—”ì§€ë‹ˆì–´ë§ ê°€ì´ë“œ (íŒŒì¼ êµ¬ì¡°, ì‘ì—… ì›ì¹™, íŠ¸ëœì­ì…˜)

**í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ì‹œ**:
- **Section 2**: ì‹œìŠ¤í…œ & ê°œë°œ í™˜ê²½ (í”„ë¡ íŠ¸ ìŠ¤íƒ)
- **Section 3**: ê³µí†µ ê·œì¹™ (ìƒíƒœì¶•, ì—ëŸ¬ ì²˜ë¦¬)
- **Section 6**: í”„ë¡ íŠ¸ì—”ë“œ ê·œì¹™ (ë””ë ‰í† ë¦¬, ë¼ìš°íŒ…, ìƒíƒœ ê´€ë¦¬, UI íŒ¨í„´)

**ì‹ ê·œ API ì¶”ê°€ ì‹œ**:
- **Section 3.2**: ë„¤ì´ë° ê·œì¹™ (í…Œì´ë¸”, ì»¬ëŸ¼, ì—”ë“œí¬ì¸íŠ¸, DTO)
- **Section 5.x**: Phase ë¡œë“œë§µì— ì¶”ê°€
- **Section 7.4**: íŒŒì¼ êµ¬ì¡° (ì–´ë””ì— ì½”ë“œë¥¼ ì¶”ê°€í• ì§€)

#### ì™¸ë¶€ ìƒì„¸ íŒŒì¼ (êµ¬í˜„ ì‹œ ì¶”ê°€ ì°¸ì¡°)

- **ë°±ì—”ë“œ íŒ¨ì¹˜ ì‘ì—…**: [`docs/patchs/LLM_PATCHS_TEMPLATE_BACKEND.md`](./patchs/LLM_PATCHS_TEMPLATE_BACKEND.md)
  - MCP ì•¡ì…˜, êµ¬í˜„ ë‹¨ê³„, íŒ¨ì¹˜ ê·œì¹™, SOP(Standard Operating Procedure)
  - Full File Replacement ì›ì¹™, Compile-Ready ìš”êµ¬ì‚¬í•­
- **í”„ë¡ íŠ¸ì—”ë“œ íŒ¨ì¹˜ ì‘ì—…**: [`frontend/docs/LLM_PATCHS_TEMPLATE_FRONTEND.md`](../frontend/docs/LLM_PATCHS_TEMPLATE_FRONTEND.md)
  - types.ts ReadOnly ì›ì¹™, 5-Step í”„ë¡œì„¸ìŠ¤, Iron Rules
  - No Type Hallucinations, DTO 1:1 ë§¤í•‘, No Silent Failures
- **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: [`docs/AMK_SCHEMA_PATCHED.md`](./AMK_SCHEMA_PATCHED.md)
  - ì „ì²´ í…Œì´ë¸” DDL, ENUM íƒ€ì…, ì¸ë±ìŠ¤, ì œì•½ì¡°ê±´

#### LLM í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì˜ˆì‹œ

**ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€**:
```
ì²¨ë¶€ëœ AMK_API_MASTER.mdë¥¼ ì°¸ì¡°í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•´ì¤˜:

1. Section 3.2 ë„¤ì´ë° ê·œì¹™ ì¤€ìˆ˜
2. Section 7.7ì˜ "ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ + íŠ¸ëœì­ì…˜ íŒ¨í„´" ì‚¬ìš©
3. Section 3.4 ì—ëŸ¬ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì¤€ìˆ˜
4. docs/patchs/LLM_PATCHS_TEMPLATE_BACKEND.mdì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸

ì‘ì—…: GET /courses/{id}/lessons ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
- Phase: 5.6 (ì‹ ê·œ)
- ì¸ì¦: í•„ìš” (Claims ì‚¬ìš©)
- ì‘ë‹µ: LessonListDto (í˜ì´ì§€ë„¤ì´ì…˜)
```

**í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ìƒì„±**:
```
ì²¨ë¶€ëœ AMK_API_MASTER.mdë¥¼ ì°¸ì¡°í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•´ì¤˜:

1. Section 6.2 ë””ë ‰í† ë¦¬ êµ¬ì¡° ì¤€ìˆ˜
2. Section 6.4 ìƒíƒœ ê´€ë¦¬ (6ê°œ ì¶•) ì ìš©
3. Section 7.7ì˜ "ë³´í˜¸ëœ í˜ì´ì§€ + ìƒíƒœì¶• ì²´í¬ íŒ¨í„´" ì‚¬ìš©
4. frontend/docs/LLM_PATCHS_TEMPLATE_FRONTEND.mdì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸

ì‘ì—…: /courses/[id] í˜ì´ì§€ ìƒì„±
- ìš”êµ¬ì‚¬í•­: ê°•ì¢Œ ìƒì„¸ + ê°•ì˜ ëª©ë¡ í‘œì‹œ
- ìƒíƒœì¶•: auth=pass, course=buy ì²´í¬ í•„ìš”
- API: GET /courses/{id}, GET /courses/{id}/lessons
```

#### LLM í˜‘ì—… ì‹œ ì£¼ì˜ì‚¬í•­

1. **Full File Replacement ì›ì¹™**: LLMì—ê²Œ ì½”ë“œ ìˆ˜ì •ì„ ìš”ì²­í•  ë•ŒëŠ” í•­ìƒ "ì „ì²´ íŒŒì¼ ë‚´ìš©ì„ ì¶œë ¥"í•˜ë„ë¡ ëª…ì‹œ
   - âŒ `// ... existing code` ì£¼ì„ìœ¼ë¡œ ìƒëµ
   - âœ… íŒŒì¼ ì „ì²´ë¥¼ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì¶œë ¥

2. **SSOT ìš°ì„ ìˆœìœ„**: ì´ ë¬¸ì„œ(`AMK_API_MASTER.md`)ê°€ í•­ìƒ ìµœìš°ì„  ì°¸ì¡°
   - ë‹¤ë¥¸ ë¬¸ì„œì™€ ì¶©ëŒ ì‹œ ì´ ë¬¸ì„œë¥¼ ì •ë‹µìœ¼ë¡œ ê°„ì£¼
   - ì½”ë“œì™€ ë¬¸ì„œê°€ ë‹¤ë¥¼ ê²½ìš° ì´ ë¬¸ì„œ ê¸°ì¤€ìœ¼ë¡œ ì½”ë“œ ìˆ˜ì •

3. **íƒ€ì… ì¼ê´€ì„±**:
   - í”„ë¡ íŠ¸ì—”ë“œ: `types.ts`ì— ì •ì˜ëœ íƒ€ì…ë§Œ ì‚¬ìš© (ìƒˆë¡œ ë§Œë“¤ì§€ ë§ ê²ƒ)
   - ë°±ì—”ë“œ: `amk_schema_patched.sql`ì˜ ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜

4. **ì—ëŸ¬ ì²˜ë¦¬ í•„ìˆ˜**:
   - Silent Failure ê¸ˆì§€
   - ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ í”¼ë“œë°± ì œê³µ (toast, ì—ëŸ¬ í˜ì´ì§€ ë“±)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš” & ëª©í‘œ

### 1.1 ì„œë¹„ìŠ¤ ê°œìš”

- **Brand Identity**: **Amazing Korean** (Global Korean Language LMS)
- **Target Audience**:
  - **EPS-TOPIK & TOPIK ì¤€ë¹„ìƒ**: í•œêµ­ ì·¨ì—… ë° ìœ í•™ì„ ëª©í‘œë¡œ í•˜ëŠ” í•´ì™¸ í•™ìŠµì
  - **ìˆ˜ì¤€ë³„ í•™ìŠµ**:
    - **ê¸°ì´ˆ(Foundation)**: 900ë¬¸ì¥ íŒ¨í„´ ìŠµë“ì„ í†µí•œ ë¬¸ë²•/íšŒí™” ê¸°ì´ˆ ì™„ì„±
    - **ê¸‰ìˆ˜ë³„ ê³¼ì •**: ì´ˆê¸‰(TOPIK 1~2), ì¤‘ê¸‰(TOPIK 3~4), ê³ ê¸‰(TOPIK 5~6) ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼
- **Core Value (ì°¨ë³„ì )**:
  - **ìŠµë“(Acquisition) ì¤‘ì‹¬**: ì•”ê¸°ê°€ ì•„ë‹Œ, ì‹¤ì œ í•œêµ­ì¸ì˜ ì–¸ì–´ ì‚¬ìš© íŒ¨í„´(Context) ê¸°ë°˜ ìì—°ì  ìŠµë“ ìœ ë„
  - **ì••ë„ì  íš¨ìœ¨ì„±**: ë°ì´í„° ê¸°ë°˜ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ê¸°ì¡´ ëŒ€ë¹„ **1/3 í•™ìŠµ ì‹œê°„**ìœ¼ë¡œ ëª©í‘œ ë“±ê¸‰ ë‹¬ì„±
  - **ì´ì¤‘ ì–¸ì–´ í•™ìŠµ(Bilingual)**: í•™ìŠµìì˜ ëª¨êµ­ì–´ì™€ í•œêµ­ì–´ë¥¼ ë§¤í•‘í•˜ì—¬ ì´í•´ë„ ê·¹ëŒ€í™” (DB ë‹¤êµ­ì–´ ì§€ì› ì„¤ê³„)
- **Platform Channels**:
  - **Web/App**: `https://amazingkorean.net` (ë°˜ì‘í˜• ì›¹ ë° í•˜ì´ë¸Œë¦¬ë“œ ì•±, ì¤€ë¹„ì¤‘)
  - **Core Features**: LMS(í•™ìŠµ ê´€ë¦¬), VOD ìŠ¤íŠ¸ë¦¬ë°, CBT(Computer Based Test), ê²°ì œ ë° ë©¤ë²„ì‹­

### 1.2 ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ (Business Logic)

- **í•™ìŠµì (User Journey)**
  1. **ì ‘ê·¼ ë° ê°€ì…**: ì†Œì…œ/ì´ë©”ì¼ íšŒì›ê°€ì… (User/Auth)
  2. **ê³¼ì • íƒìƒ‰**: ë ˆë²¨/ëª©ì ì— ë§ëŠ” ê°•ì¢Œ(Course) ë° ë¬´ë£Œ ìƒ˜í”Œ ê°•ì˜(Lesson) ì²´í—˜
  3. **ê²°ì œ ë° ê¶Œí•œ íšë“**:
     - PG ê²°ì œ ë˜ëŠ” B2B ë°”ìš°ì²˜ ë“±ë¡ (Payment/Ticket)
     - ë©¤ë²„ì‹­ ê¸°ê°„ ë™ì•ˆ í•´ë‹¹ ì½˜í…ì¸  ì ‘ê·¼ ê¶Œí•œ(Access Control) íšë“
  4. **í•™ìŠµ ì§„í–‰ (Learning Loop)**:
     - **VOD í•™ìŠµ**: Vimeo ì—°ë™ ì˜ìƒ ì‹œì²­ ë° ì§„ë„ìœ¨ ìë™ ì €ì¥ (Video Log)
     - **Practice**: ë¬¸ì¥/ë‹¨ì–´ í€´ì¦ˆ ë° ë”°ë¼ í•˜ê¸° (Study Log)
     - **Test**: ë‹¨ì› í‰ê°€ ë° ëª¨ì˜ê³ ì‚¬ ì‘ì‹œ (Exam Result)
  5. **ì„±ê³¼ ê´€ë¦¬**: ë‚˜ì˜ ì§„ë„ìœ¨ í™•ì¸, ìˆ˜ë£Œì¦ ë°œê¸‰, ì˜¤ë‹µ ë…¸íŠ¸ ë³µìŠµ

- **ê´€ë¦¬ì (Admin & Operation)**
  - **ì½˜í…ì¸  ê´€ë¦¬**: ë¹„ë””ì˜¤/íƒœê·¸ ë©”íƒ€ë°ì´í„° ë“±ë¡, ê°•ì¢Œ/ê°•ì˜ ì»¤ë¦¬í˜ëŸ¼ êµ¬ì„± (CMS)
  - **í•™ìŠµì ê´€ë¦¬**: íšŒì› ì •ë³´ ì¡°íšŒ, ìˆ˜ê°• ì´ë ¥ ëª¨ë‹ˆí„°ë§, ì•…ì„± ìœ ì € ì œì¬
  - **ë§¤ì¶œ/í†µê³„**: ê¸°ê°„ë³„ ê²°ì œ ë‚´ì—­ í™•ì¸, ì¸ê¸° ê°•ì¢Œ ë° ì´íƒˆë¥  ë¶„ì„

- **Business Model (BM)**
  - **B2C (ê°œì¸)**: ì›”/ë…„ ë‹¨ìœ„ êµ¬ë… ë˜ëŠ” ë‹¨ê³¼ ê°•ì¢Œ êµ¬ë§¤
  - **B2B (ê¸°ê´€/ëŒ€í•™)**:
    - ê¸°ì—…/í•™êµ ëŒ€ìƒ ëŒ€ëŸ‰ ìˆ˜ê°•ê¶Œ(Voucher) ë°œê¸‰ ë° ê´€ë¦¬
    - ê¸°ê´€ ì „ìš© ëŒ€ì‹œë³´ë“œ ë° í•™ìŠµì ë¦¬í¬íŠ¸ ì œê³µ (ì»¨ì„¤íŒ…)

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 2. ì‹œìŠ¤í…œ & ê°œë°œ í™˜ê²½ ê°œìš”

### 2.1 ëŸ°íƒ€ì„ / ìŠ¤íƒ

#### **Frontend**
  - **Core & Build**
    - **Vite**: ë¹ ë¥¸ ê°œë°œ ì„œë²„ ë° ë²ˆë“¤ë§
    - **React (v18)**: UI ë¼ì´ë¸ŒëŸ¬ë¦¬
    - **TypeScript**: ì •ì  íƒ€ì… ì–¸ì–´

  - **UI & Styling**
    - **Tailwind CSS**: ìœ í‹¸ë¦¬í‹° í¼ìŠ¤íŠ¸ CSS í”„ë ˆì„ì›Œí¬
    - **Shadcn/ui**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ (Radix UI ê¸°ë°˜)
    - **Lucide React**: ì•„ì´ì½˜ íŒ©
    - **class-variance-authority (cva)**: ì»´í¬ë„ŒíŠ¸ ë³€í˜•(Variant) ê´€ë¦¬

  - **State Management**
    - **TanStack Query (React Query)**: ì„œë²„ ìƒíƒœ ê´€ë¦¬ (Caching, Fetching, Synchronization)
    - **Zustand**: í´ë¼ì´ì–¸íŠ¸ ì „ì—­ ìƒíƒœ ê´€ë¦¬ (Auth, Session ë“±)

  - **Routing & Network**
    - **React Router DOM**: SPA ë¼ìš°íŒ…
    - **Axios**: HTTP í´ë¼ì´ì–¸íŠ¸ (Interceptorë¥¼ í†µí•œ í† í°/ì—ëŸ¬ ì²˜ë¦¬)

  - **Form & Validation**
    - **React Hook Form**: í¼ ìƒíƒœ ê´€ë¦¬ ë° ì„±ëŠ¥ ìµœì í™”
    - **Zod**: ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ ë°ì´í„° ê²€ì¦ (TypeScript íƒ€ì… ì¶”ë¡  ì—°ë™)

  - **Media & Features**
    - **@vimeo/player**: Vimeo ì˜ìƒ ì œì–´ ë° ì´ë²¤íŠ¸ í•¸ë“¤ë§ (SDK)

#### **Backend**
  - **Language & Framework**
    - **Rust**: ë©”ëª¨ë¦¬ ì•ˆì „ì„± ë° ê³ ì„±ëŠ¥ ë³´ì¥
    - **Axum (0.8)**: Tokio ê¸°ë°˜ ë¹„ë™ê¸° ì›¹ í”„ë ˆì„ì›Œí¬
  - **Data & API**
    - **SQLx**: ì»´íŒŒì¼ íƒ€ì„ ì¿¼ë¦¬ ê²€ì¦ ë° ë¹„ë™ê¸° PostgreSQL ë“œë¼ì´ë²„
    - **utoipa (v5)**: ì½”ë“œ ê¸°ë°˜ OpenAPI(Swagger) ë¬¸ì„œ ìë™í™” (`/docs`)
  - **Auth & Security**
    - **JWT**: HS256 ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ Stateless Access Token
    - **Argon2**: ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
    - **Redis**: Refresh Token ì €ì¥ ë° ì„¸ì…˜ ê´€ë¦¬

#### **Database**
  - **PostgreSQL**
    - ë„ì»¤ ì»¨í…Œì´ë„ˆëª…: `amk-pg`
    - ê¸°ë³¸ í¬íŠ¸: `5432`
    - í‘œì¤€: ëª¨ë“  ì‹œê°„ ì»¬ëŸ¼ `TIMESTAMPTZ` (UTC ê¸°ì¤€), Default `now()`
  - **Redis**
    - ë„ì»¤ ì»¨í…Œì´ë„ˆëª…: `amk-redis`
    - ìš©ë„: ì¸ì¦ í† í° ê´€ë¦¬ ë° ì„ì‹œ ë°ì´í„° ìºì‹±

#### **Infrastructure & Environment**
  - **Development (Local)**
    - **OS**: Windows (Host) + **WSL2** (Ubuntu Subsystem)
    - **Runtime**: Docker Desktop / Docker Compose (WSL Integration)
  - **Dev Tools & AI**
    - **IDE**: VS Code (Remote - WSL)
    - **AI Agent**: Codex CLI
    - **MCP (Model Context Protocol)**:
      - `filesystem`: í”„ë¡œì íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ë° ì œì–´
      - `sequential-thinking`: ë‹¨ê³„ì  ì‚¬ê³  ë° ë¬¸ì œ í•´ê²°
      - `brave-search`: ì‹¤ì‹œê°„ ì›¹ ì •ë³´ ê²€ìƒ‰ ë° ê²€ì¦
  - **Production (Hybrid Architecture)**
    - **Frontend**: Cloudflare Pages
      - ê¸€ë¡œë²Œ CDNìœ¼ë¡œ ì •ì  ìì› ë°°í¬
      - ìë™ SSL, DDoS ë°©ì–´
      - Git ì—°ë™ ìë™ ë°°í¬
    - **Backend**: AWS EC2 (Ubuntu 24.04 LTS)
      - Nginx (Reverse Proxy: 80/443 â†’ App Server)
      - Docker Compose: ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
    - **Database/Cache**: AWS EC2 ë‚´ Docker ë˜ëŠ” ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ (RDS/ElastiCache)

### 2.2 ë¼ìš°íŒ… & OpenAPI

- `Router<AppState>` + `.with_state(state)` íŒ¨í„´
- ì¸ì¦ ì¶”ì¶œ:
  - Axum 0.8 `FromRequestParts<S>` ê¸°ë°˜ `Claims` ì¶”ì¶œ
  - `Claims.sub` = `user_id` (i64)
- OpenAPI ë£¨íŠ¸:
  - `src/api/docs.rs` (ì˜ˆ: `ApiDoc`)
  - Swagger UI: `GET /docs`
  - íƒœê·¸/í‘œì‹œ ìˆœì„œ **ê³ ì •**: `health â†’ auth â†’ user â†’ videos â†’ study â†’ lesson â†’ admin` (í•„ìš” ì‹œ ì¶”ê°€ ë¦¬ì†ŒìŠ¤ëŠ” ë’¤ì—)

### 2.3 ë¡œì»¬ ê°œë°œ & ì‹¤í–‰

- DB ë§ˆì´ê·¸ë ˆì´ì…˜:
  - `sqlx migrate run`
- ê¸°ë³¸ ë¹Œë“œ/ì‹¤í–‰:
  - `cargo check`
  - `cargo fmt -- --check`
  - `cargo clippy -- -D warnings`
  - `cargo run`
- Swagger ë¬¸ì„œ í™•ì¸:
  - ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000/docs`

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

### 2.4 ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™

#### 2.4.1 AWS SES (ì´ë©”ì¼ ë°œì†¡)

> Transactional Email ì „ìš©. ë§ˆì¼€íŒ… ì´ë©”ì¼ ë¯¸ì‚¬ìš©.

**ì„¤ì • ì •ë³´**
| í•­ëª© | ê°’ |
|------|-----|
| Region | `ap-northeast-2` (ì„œìš¸) |
| ì¸ì¦ëœ ë„ë©”ì¸ | `amazingkorean.net` |
| ë°œì‹  ì£¼ì†Œ | `noreply@amazingkorean.net` |

**í™˜ê²½ë³€ìˆ˜**
```env
AWS_ACCESS_KEY_ID=xxx
AWS_SECRET_ACCESS_KEY=xxx
AWS_REGION=ap-northeast-2
AWS_SES_FROM_EMAIL=noreply@amazingkorean.net
```

**ì½”ë“œ êµ¬ì¡°**
- `src/external/email.rs`: EmailClient, EmailTemplate ì •ì˜
- `src/state.rs`: AppStateì— EmailClient í¬í•¨

**EmailTemplate ì¢…ë¥˜**
| í…œí”Œë¦¿ | ìš©ë„ | ì‚¬ìš©ì²˜ |
|--------|------|--------|
| `PasswordReset` | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì¸ì¦ì½”ë“œ (6ìë¦¬) | Phase 3 - `POST /auth/request-reset` |
| `AdminInvite` | ê´€ë¦¬ì ì´ˆëŒ€ ì½”ë“œ | Phase 7 - `POST /admin/upgrade` |

**ì´ë©”ì¼ ë°œì†¡ ì œí•œ**
- Rate Limit: ì´ë©”ì¼ë‹¹ 5íšŒ/ì‹œê°„ (ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •)
- TTL: ì¸ì¦ì½”ë“œ 10ë¶„ ë§Œë£Œ

#### 2.4.2 Google OAuth

> Google OAuth 2.0 Authorization Code Flow

**í™˜ê²½ë³€ìˆ˜**
```env
GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=xxx
GOOGLE_REDIRECT_URI=http://localhost:3000/auth/google/callback
```

**ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸**: Phase 3 - `GET /auth/google`, `GET /auth/google/callback`

**ID Token ì„œëª… ê²€ì¦ (JWKS)**
- Google JWKS ì—”ë“œí¬ì¸íŠ¸(`https://www.googleapis.com/oauth2/v3/certs`)ì—ì„œ RSA ê³µê°œí‚¤ ì¡°íšŒ
- JWT í—¤ë”ì˜ `kid`ë¡œ ë§¤ì¹­ë˜ëŠ” í‚¤ ì„ íƒ â†’ `DecodingKey::from_rsa_components(n, e)` ìƒì„±
- ê²€ì¦ í•­ëª©: RS256 ì„œëª…, Issuer (`accounts.google.com`), Audience (`client_id`), ë§Œë£Œì‹œê°„

#### 2.4.3 Vimeo (ë™ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë°)

> ë™ì˜ìƒ í˜¸ìŠ¤íŒ… ë° ìŠ¤íŠ¸ë¦¬ë°

**í™˜ê²½ë³€ìˆ˜**
```env
VIMEO_ACCESS_TOKEN=xxx
```

**ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸**: Phase 7 - `GET /admin/videos/vimeo/preview`, `POST /admin/videos/vimeo/upload-ticket`

#### 2.4.4 IP Geolocation (ip-api.com)

> ë¡œê·¸ì¸ ì‹œ IP ê¸°ë°˜ ì§€ë¦¬ì •ë³´ ìë™ ì¡°íšŒ

**ì„œë¹„ìŠ¤**: [ip-api.com](http://ip-api.com) (ë¬´ë£Œ í‹°ì–´: 45 req/min)

**ì½”ë“œ êµ¬ì¡°**
- `src/external/ipgeo.rs`: IpGeoClient êµ¬í˜„
- `src/state.rs`: AppStateì— `Arc<IpGeoClient>` í¬í•¨

**ì¡°íšŒ ë°ì´í„°**
| í•„ë“œ | DB ì»¬ëŸ¼ | ì„¤ëª… | ì˜ˆì‹œ |
|------|---------|------|------|
| `countryCode` | `login_country` | ISO 3166-1 alpha-2 êµ­ê°€ ì½”ë“œ | "KR", "US" |
| `as` | `login_asn` | AS ë²ˆí˜¸ (Autonomous System Number) | 4766 |
| `org` | `login_org` | ISP/ì¡°ì§ëª… | "Korea Telecom" |

**ì ìš© ë²”ìœ„**
- `login` í…Œì´ë¸”: í™œì„± ì„¸ì…˜ ì •ë³´
- `login_log` í…Œì´ë¸”: ë¡œê·¸ì¸ ì´ë ¥ (ê°ì‚¬ ë¡œê·¸)

**Private IP ì²˜ë¦¬**
- `std::net::IpAddr` íŒŒì‹± í›„ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë©”ì„œë“œë¡œ íŒë³„
  - IPv4: `is_private()` || `is_loopback()` (127.x, 10.x, 192.168.x, 172.16-31.x)
  - IPv6: `is_loopback()`
  - íŒŒì‹± ì‹¤íŒ¨ ì‹œ: `"localhost"` ë¬¸ìì—´ ë§¤ì¹­
- ì‚¬ì„¤ IPëŠ” ì™¸ë¶€ API ì¡°íšŒ skip, ê¸°ë³¸ê°’: `country='LC'` (Local), `asn=0`, `org='local'`

### 2.8.2 User-Agent ì„œë²„ì‚¬ì´ë“œ íŒŒì‹± (woothee)

ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ HTTP `User-Agent` í—¤ë”ë¥¼ ì„œë²„ì—ì„œ íŒŒì‹±í•˜ì—¬ `login_os`, `login_browser`, `login_device`ë¥¼ ìë™ìœ¼ë¡œ ì±„ìš´ë‹¤.

**ë¼ì´ë¸ŒëŸ¬ë¦¬**: `woothee` (Cargo.toml)

**íŒŒì‹± ë§¤í•‘**
| woothee í•„ë“œ | DB ì»¬ëŸ¼ | ì„¤ëª… | ì˜ˆì‹œ |
|-------------|---------|------|------|
| `os` | `login_os` | ìš´ì˜ì²´ì œ | "Windows 10", "Mac OS X", "Linux" |
| `name` | `login_browser` | ë¸Œë¼ìš°ì € | "Chrome", "Firefox", "Safari" |
| `category` | `login_device` | ê¸°ê¸° ìœ í˜• ë§¤í•‘ | "pc"â†’desktop, "smartphone"â†’mobile |

**ê¸°ê¸° ìœ í˜• ë§¤í•‘ ê·œì¹™**
- `pc` â†’ `desktop`
- `smartphone`, `mobilephone` â†’ `mobile`
- ê·¸ ì™¸ (`crawler`, `appliance`, `misc`, `UNKNOWN`) â†’ `other`

**ì ìš© ë²”ìœ„**: ë¡œê·¸ì¸, íšŒì›ê°€ì…, OAuth ì½œë°± (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ device/browser/osë¥¼ ì „ì†¡í•˜ì§€ ì•ŠìŒ)

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 3. ê³µí†µ ê·œì¹™ (ì „ì—­ ì»¨ë²¤ì…˜)

### 3.1 ì‹œê°„/íƒ€ì„ì¡´

- DBì˜ ì‹œê°„ ì»¬ëŸ¼(íŠ¹íˆ ë¡œê·¸/ì´ë ¥)ì€:
  - íƒ€ì…: `TIMESTAMPTZ`
  - ê¸°ë³¸ê°’: `DEFAULT now()` (UTC)
- í´ë¼ì´ì–¸íŠ¸(ì›¹/ì•±)ì—ì„  KST or ë¡œì»¬ íƒ€ì„ì¡´ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ.

#### ì‚¬ìš©ì íƒ€ì„ì¡´ (`user_set_timezone`) ì •ì±…

> ëª©ì : ì•ŒëŒ, í•™ìŠµ ë¦¬ë§ˆì¸ë”, ì½˜í…ì¸  ì˜ˆê³  ë“± ì‹œê°„ ê¸°ë°˜ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ ì‚¬ìš©ìë³„ ì‹œê°„ëŒ€ ê´€ë¦¬

- **ìë™ ê°ì§€**: íšŒì›ê°€ì… ë˜ëŠ” ë¡œê·¸ì¸ ì‹œ ë¸Œë¼ìš°ì €/ê¸°ê¸°ì—ì„œ `Intl.DateTimeFormat().resolvedOptions().timeZone`ìœ¼ë¡œ ìë™ ê°ì§€í•˜ì—¬ DBì— ì €ì¥
- **ìˆ˜ë™ ë³€ê²½ í—ˆìš©**: ì‚¬ìš©ìê°€ ì„¤ì • í˜ì´ì§€ì—ì„œ ì§ì ‘ íƒ€ì„ì¡´ì„ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì§€ì› (VPN/ì—¬í–‰ ë“±ìœ¼ë¡œ ê°ì§€ê°’ì´ ì‹¤ì œ ìƒí™œ ì‹œê°„ëŒ€ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
- **ìë™ ê°±ì‹  ì•ˆ í•¨**: ë¡œê·¸ì¸ ì‹œ ê°ì§€ëœ ê°’ìœ¼ë¡œ ìë™ ë®ì–´ì“°ì§€ ì•ŠìŒ (ì‚¬ìš©ìê°€ ì„¤ì •í•œ ê°’ì„ ì¡´ì¤‘)
  - ìµœì´ˆ ê°€ì… ì‹œì—ë§Œ ìë™ ì €ì¥, ì´í›„ì—ëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ë³€ê²½í•´ì•¼ í•¨
- **í™œìš© ì˜ˆì •**: ì•ŒëŒ/í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡ ì‹œê°„, í•™ìŠµ ë¦¬ë§ˆì¸ë”, ì½˜í…ì¸  ê³µê°œ ì‹œê° í‘œì‹œ ë“±

### 3.2 ë„¤ì´ë° & ìŠ¤í‚¤ë§ˆ ê·œì¹™ (ìš”ì•½)

> ìµœìƒìœ„ ì›ì¹™

- **ì™¸ë¶€ ì¸í„°í˜ì´ìŠ¤(DB ìŠ¤í‚¤ë§ˆ, API ê²½ë¡œ, JSON í•„ë“œ ì´ë¦„)** ì€ **snake_case**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.
- **ê° ë ˆì´ì–´ì˜ ì½”ë“œ ë ˆë²¨ ë„¤ì´ë°**ì€ í•´ë‹¹ ì–¸ì–´/í”„ë ˆì„ì›Œí¬ì˜ ê´€ìŠµì„ ë”°ë¥¸ë‹¤.
  - ë°±ì—”ë“œ: Rust ê´€ë¡€
  - í”„ë¡ íŠ¸ì—”ë“œ: TypeScript/React ê´€ë¡€

---

#### 3.2.1 Database

> Naming Convention : snake_case  
> ë…¼ë¦¬ëª…(ë¬¸ì„œ/ERD)ì€ **ëŒ€ë¬¸ì SNAKE_CASE**, ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆ/ì»¬ëŸ¼ì€ **ì†Œë¬¸ì snake_case**ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤.

- **table ëª…**
  - í˜•ì‹: `<ë„ë©”ì¸(ë‹¨ìˆ˜í˜•, ëŒ€ë¬¸ì)>_<ì˜ë¯¸ 1(ì¡´ì¬ ì‹œ ëŒ€ë¬¸ì)>_<ì˜ë¯¸ 2(ì¡´ì¬ ì‹œ ëŒ€ë¬¸ì)>...`
  - ì˜ˆì‹œ:
    - `USERS` (PostgreSQLì— `USER` ì˜ˆì•½ì–´ê°€ ìˆì–´ ë³µìˆ˜í˜• ì‚¬ìš©)
    - `VIDEO_TAG`, `VIDEO_TAG_MAP`
    - `USERS_LOG`, `ADMIN_USERS_LOG`, `STUDY_TASK_LOG`

- **enum ëª…**
  - í˜•ì‹: `<ë„ë©”ì¸(ë‹¨ìˆ˜í˜•, ì†Œë¬¸ì)>_<ì˜ë¯¸ 1(ì†Œë¬¸ì)>_<ì˜ë¯¸ 2(ì†Œë¬¸ì)>..._enum`
  - ì˜ˆì‹œ:
    - `user_auth_enum`, `user_set_language_enum`
    - `study_task_kind_enum`, `lesson_item_kind_enum`

- **log í…Œì´ë¸”/ì»¬ëŸ¼**
  - í…Œì´ë¸”:
    - í˜•ì‹: `<ë„ë©”ì¸(ë³µìˆ˜í˜•, ëŒ€ë¬¸ì)>_<ì˜ë¯¸ 1(ëŒ€ë¬¸ì)>_<ì˜ë¯¸ 2(ëŒ€ë¬¸ì)>..._LOG`
    - ì˜ˆì‹œ: `STUDY_TASK_LOG`, `LOGIN_LOG`, `USERS_LOG`
  - ë¡œê·¸ìš© ì»¬ëŸ¼:
    - í˜•ì‹: `<ë„ë©”ì¸(ë‹¨ìˆ˜í˜•, ì†Œë¬¸ì)>_<ì˜ë¯¸ 1(ì†Œë¬¸ì)>_<ì˜ë¯¸ 2(ì†Œë¬¸ì)>..._log`
    - ì˜ˆì‹œ: `user_nickname_log`, `video_last_user_agent_log`, `study_task_score_log`

- **admin ê³„ì—´**
  - í…Œì´ë¸”:
    - í˜•ì‹: `ADMIN_<ë„ë©”ì¸(ë³µìˆ˜í˜•, ëŒ€ë¬¸ì)>_<ì˜ë¯¸ 1(ëŒ€ë¬¸ì)>_<ì˜ë¯¸ 2(ëŒ€ë¬¸ì)>...`
    - ì˜ˆì‹œ: `ADMIN_USERS_LOG`, `ADMIN_VIDEO_LOG`, `ADMIN_STUDY_LOG`
  - ì»¬ëŸ¼:
    - í˜•ì‹: `admin_<ë„ë©”ì¸(ë‹¨ìˆ˜í˜•, ì†Œë¬¸ì)>_<ì˜ë¯¸ 1(ì†Œë¬¸ì)>_<ì˜ë¯¸ 2(ì†Œë¬¸ì)>...`
    - ì˜ˆì‹œ: `admin_pick_study_id`, `admin_user_action`, `admin_study_log_id`

---

#### 3.2.2 API ê²½ë¡œ & JSON í•„ë“œ

- **API ê²½ë¡œ**
  - ê²½ë¡œ í‘œê¸°: **ì†Œë¬¸ì + ì¼€ë°¥ì¼€ì´ìŠ¤**  
    - ì˜ˆì‹œ: `/users`, `/auth/login`, `/admin/videos`
  - ë¦¬ì†ŒìŠ¤ ì´ë¦„:
    - ê¸°ë³¸: **ëª…ì‚¬(ë³µìˆ˜í˜•)** ì‚¬ìš© (`/users`, `/videos`, `/studies` ë“±)
    - ì˜ˆì™¸: `/auth` ê³„ì—´ì€ ê¸°ëŠ¥ ì¤‘ì‹¬ (`/auth/login`, `/auth/refresh` ë“±)
  - ì•¡ì…˜ í‘œí˜„:
    - **HTTP ë©”ì„œë“œ**ë¡œ í‘œí˜„  
      - ì˜ˆì‹œ: `GET /users`, `POST /users`, `POST /users/me`, `PATCH /admin/users/{id}`

- **ë¦¬ì†ŒìŠ¤ / ID ê²½ë¡œ íŒ¨í„´**
  - ë‹¨ì¼ ë¦¬ì†ŒìŠ¤:
    - `/users/{user_id}`, `/videos/{video_id}`
  - í•˜ìœ„ ë¦¬ì†ŒìŠ¤:
    - `/videos/{video_id}/captions`
    - `/videos/{video_id}/progress`
    - `/studies/tasks/{task_id}/explain`

- **ì‚¬ìš© ì˜ˆì‹œ**
  - ì¡°íšŒ:
    - `GET /users/me/settings`, `GET /videos`
  - ìƒì„±/ì—…ë°ì´íŠ¸:
    - `POST /videos/{video_id}/progress`
    - `POST /studies/tasks/{task_id}/answer`
    - `POST /users/me`, `POST /users/me/settings`

- **JSON í•„ë“œ**
  - API ìš”ì²­/ì‘ë‹µì˜ í•„ë“œ ì´ë¦„ì€ **DB ì»¬ëŸ¼ê³¼ ë™ì¼í•œ snake_case**ë¥¼ ì‚¬ìš©í•œë‹¤.
    - ì˜ˆì‹œ: `user_id`, `video_title`, `created_at`, `user_state`

---

#### 3.2.3 ë°±ì—”ë“œ(Rust) ë„¤ì´ë° & ì—­í• 

> ê¸°ë³¸ ì›ì¹™  
> - DB ìŠ¤í‚¤ë§ˆÂ·APIÂ·JSON í•„ë“œ = **snake_case**  
> - ì½”ë“œ ë ˆë²¨ ë„¤ì´ë°ì€ **Rust ê´€ë¡€**ë¥¼ ë”°ë¥¸ë‹¤.

- **ëª¨ë“ˆ/íŒŒì¼ëª…**
  - ë„ë©”ì¸ë³„ ë””ë ‰í„°ë¦¬ êµ¬ì¡°(ì˜ˆ: `src/api/user/`):
    - `dto.rs`, `handler.rs`, `repo.rs`, `router.rs`, `service.rs`, `mod.rs` ê³ ì •
    - ì˜ˆ: `src/api/user/dto.rs`, `src/api/user/service.rs`, `src/api/user/repo.rs`
  - ê·¸ ì™¸ ë³´ì¡° íŒŒì¼ì€ í•„ìš” ì‹œ **ì†Œë¬¸ì + snake_case**ë¡œ ì¶”ê°€
    - ì˜ˆ: `token_utils.rs`, `validator.rs` ë“±

- **í•¨ìˆ˜/ë³€ìˆ˜ëª… (Naming Convention)**
  - **ê¸°ë³¸ ê·œì¹™**: `snake_case` (ì†Œë¬¸ì + ì–¸ë”ìŠ¤ì½”ì–´)
  - **ê³„ì¸µ ê°„ í†µì¼ (Feature Parity)**:
    - í•˜ë‚˜ì˜ ê¸°ëŠ¥(Feature)ì— ëŒ€í•´ Handler, Service, Repo ê³„ì¸µì˜ **ë©”ì¸ í•¨ìˆ˜ëª…ì€ ë°˜ë“œì‹œ í†µì¼**í•œë‹¤.
    - ì½”ë“œ ì¶”ì ì„±(Traceability) í–¥ìƒì„ ìœ„í•¨.
    - **íŒ¨í„´**: `[ë„ë©”ì¸]_[í–‰ìœ„]_[ëŒ€ìƒ]` (í•„ìš” ì‹œ ë„ë©”ì¸ ìƒëµ ê°€ëŠ¥)
    - **ì˜ˆì‹œ (ê´€ë¦¬ì ìœ ì € ìƒì„±)**:
      - Handler: `admin_create_user(...)`
      - Service: `admin_create_user(...)`
      - Repo: `admin_create_user(...)`
  - **Repo ë³´ì¡° í•¨ìˆ˜ (Helpers)**:
    - ë©”ì¸ ë¡œì§ ì™¸ì˜ ë‹¨ìˆœ ì¡°íšŒ, ê²€ì¦, ë¡œê·¸ ê¸°ë¡ ë“±ì€ ê¸°ëŠ¥ì— ë§ëŠ” ì´ë¦„ ì‚¬ìš© ê°€ëŠ¥.
    - ì˜ˆ: `exists_email`, `create_audit_log`, `find_by_id`
  - **íƒ€ì…(Struct/Enum/DTO)**: **PascalCase** (ëŒ€ë¬¸ì ì¹´ë©œ í‘œê¸°)
    - ì˜ˆ: `SignupReq`, `AdminUserRes`, `VideoProgressLog`, `UserAuth`

- **DTO/í•„ë“œëª…**
  - DB/JSONê³¼ ë§¤í•‘ë˜ëŠ” í•„ë“œ ì´ë¦„ì€ **snake_case**ë¡œ ì‘ì„±
    - ì˜ˆ:
      ```rust
      pub struct UserMeRes {
          pub user_id: i64,
          pub user_email: String,
          pub user_state: String,
      }
      ```
  - í•„ìš” ì‹œ `#[serde(rename = "...")]`, `#[sqlx(rename = "...")]` ë¡œ DB/JSON í•„ë“œì™€ì˜ ì •ë ¬ì„±ì„ ëª…ì‹œì ìœ¼ë¡œ ìœ ì§€

- **ë„ë©”ì¸ë³„ repo ì—­í• **
  - ê° ë„ë©”ì¸(`user`, `video`, `study`, `lesson`, `admin` ë“±)ì˜ `repo.rs`ëŠ”  
    **ê·¸ ë„ë©”ì¸ì˜ ë‹¨ì¼ DB ì§„ì…ì (single entry point)** ì—­í• ì„ í•œë‹¤.
  - ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ í•´ë‹¹ ë„ë©”ì¸ì˜ ë°ì´í„°ë¥¼ ë‹¤ë¤„ì•¼ í•  ë•Œ,
    - ê°€ëŠ¥í•œ í•œ **ê·¸ ë„ë©”ì¸ì˜ service ë ˆì´ì–´**ë¥¼ ê²½ìœ í•´ì„œ ì ‘ê·¼í•œë‹¤.
    - ì˜ˆ: adminì´ ìœ ì €ë¥¼ ìƒì„±í•  ë•Œ â†’ `user::service::create_by_admin(...)` í˜¸ì¶œ

- **ìœ ì¦ˆì¼€ì´ìŠ¤ ë‹¨ìœ„ í•¨ìˆ˜ ì´ë¦„ ê·œì¹™**
  - í•˜ë‚˜ì˜ ìœ ì¦ˆì¼€ì´ìŠ¤(ì˜ˆ: `/users` íšŒì›ê°€ì…, `/auth/login`, `/users/me/settings` ìˆ˜ì • ë“±)ì— ëŒ€í•´ì„œëŠ”  
    ë„ë©”ì¸ë³„ `handler.rs` / `service.rs` / `repo.rs`ì—ì„œ **ê°€ëŠ¥í•˜ë©´ ë™ì¼í•œ í•¨ìˆ˜ëª…**ì„ ì‚¬ìš©í•œë‹¤.
    - ì˜ˆ:
      - `handler::signup`
      - `service::signup`
      - `repo::signup`
  - Rust ëª¨ë“ˆ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í™œìš©í•´,
    - `handler::signup` â†’ `service::signup` â†’ `repo::signup` íë¦„ì´ í•œëˆˆì— ë³´ì´ë„ë¡ ë§ì¶˜ë‹¤.
  - ì˜ˆì‹œ:
    ```rust
    // handler.rs
    pub async fn signup(...) -> AppResult<Json<SignupRes>> {
        let res = service::signup(...).await?;
        Ok(Json(res))
    }

    // service.rs
    pub async fn signup(...) -> AppResult<SignupRes> {
        let user = repo::signup(...).await?;
        Ok(SignupRes::from(user))
    }

    // repo.rs
    pub async fn signup(...) -> AppResult<UserRow> {
        // INSERT INTO users ...
    }
    ```

- **ê³µí†µ repo í•¨ìˆ˜ (ì—¬ëŸ¬ ìœ ì¦ˆì¼€ì´ìŠ¤ì—ì„œ ê³µìœ í•  ë•Œ)**
  - ì—¬ëŸ¬ ìœ ì¦ˆì¼€ì´ìŠ¤ì—ì„œ ë™ì¼í•œ DB ë™ì‘ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°,
    - repo ë‚´ë¶€ì—ì„œ **ì¢€ ë” ì¼ë°˜ì ì¸ ì´ë¦„**ìœ¼ë¡œ ê³µí†µ í•¨ìˆ˜ë¥¼ ë¶„ë¦¬í•œë‹¤.
    - ì˜ˆ:
      - `insert_user`, `get_user_by_email`, `update_user_state` ë“±
  - service ê³„ì¸µì—ì„œëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤ ì´ë¦„ì„ ìœ ì§€í•œë‹¤.
    - ì˜ˆ:
      ```rust
      // repo.rs
      pub async fn insert_user(...) -> AppResult<UserRow> { ... }
      pub async fn get_user_by_email(...) -> AppResult<Option<UserRow>> { ... }

      // service.rs
      pub async fn signup(...) -> AppResult<SignupRes> {
          if repo::get_user_by_email(&req.email).await?.is_some() {
              return Err(AppError::Conflict(...));
          }
          let user = repo::insert_user(...).await?;
          Ok(SignupRes::from(user))
      }

      pub async fn admin_create_user(...) -> AppResult<AdminUserRes> {
          let user = repo::insert_user(...).await?;
          Ok(AdminUserRes::from(user))
      }
      ```
  - ì´ë•Œ **ì¿¼ë¦¬ ìì²´ë¥¼ ë³„ë„ â€œì¿¼ë¦¬ ì „ìš© ëª¨ë“ˆâ€ë¡œ ë¹¼ì§€ ì•Šê³ **,  
    ê° ë„ë©”ì¸ repo(`user::repo`, `video::repo` ë“±)ê°€ ê·¸ ë„ë©”ì¸ì˜ ì¿¼ë¦¬ ë‹¨ì¼ ì†ŒìŠ¤ ì—­í• ì„ ë§¡ëŠ”ë‹¤.
  - ì •ë§ cross-domainìœ¼ë¡œ ê³µìœ í•´ì•¼ í•˜ëŠ” ë³µì¡í•œ íŒ¨í„´(ì˜ˆ: í†µí•© í†µê³„ ë·° ë“±)ì€  
    PostgreSQLì˜ **VIEW/FUNCTION**ìœ¼ë¡œ ì¶”ìƒí™”í•˜ëŠ” ê²ƒì„ ìš°ì„  ê²€í† í•œë‹¤.

> ì •ë¦¬:  
> - **ìœ ì¦ˆì¼€ì´ìŠ¤ ì´ë¦„ì€ handler/service/repoì—ì„œ ìµœëŒ€í•œ ë™ì¼í•˜ê²Œ**,  
> - **ì¿¼ë¦¬ ì¤‘ë³µ ì œê±°ì™€ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ëŒ€ì‘ì€ ë„ë©”ì¸ë³„ repoì—ì„œ ì±…ì„**,  
> - DB ë ˆë²¨ ê³µí†µí™”ê°€ í•„ìš”í•˜ë©´ VIEW/FUNCTIONìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ ì „ëµìœ¼ë¡œ í•œë‹¤.

---

#### 3.2.4 í”„ë¡ íŠ¸ì—”ë“œ(TypeScript + React) ë„¤ì´ë°

- **React ì»´í¬ë„ŒíŠ¸**
  - íŒŒì¼ëª…: PascalCase
    - ì˜ˆì‹œ: `LoginPage.tsx`, `VideoListPage.tsx`, `UserSettingsForm.tsx`
  - ì»´í¬ë„ŒíŠ¸ ì´ë¦„ & JSX:
    - ì˜ˆì‹œ: `function LoginPage() { ... }`, `<LoginPage />`

- **ê¸°íƒ€ TS íŒŒì¼ (hook / api / lib / util ë“±)**
  - íŒŒì¼ëª…: ì†Œë¬¸ì + snake_case
    - ì˜ˆì‹œ: `video_api.ts`, `auth_api.ts`, `use_auth.ts`, `date_format.ts`
  - í•¨ìˆ˜/ë³€ìˆ˜ëª…: camelCase
    - ì˜ˆì‹œ: `fetchVideos`, `loginUser`, `formatDate`

- **API DTO ì¸í„°í˜ì´ìŠ¤**
  - ì¸í„°í˜ì´ìŠ¤ ì´ë¦„: PascalCase
    - ì˜ˆì‹œ: `interface VideoRes { ... }`
  - í•„ë“œ ì´ë¦„: **snake_case** (ë°±ì—”ë“œ/DBì™€ ë™ì¼)
    - ì˜ˆì‹œ:
      ```ts
      export interface VideoRes {
        video_id: number;
        video_title: string;
        created_at: string;
      }
      ```

---

> ìì„¸í•œ ì»¬ëŸ¼ êµ¬ì¡°ì™€ ì‹¤ì œ íƒ€ì… ì •ì˜ëŠ” `amk_schema_patched.sql` ë° ê° ë„ë©”ì¸ë³„ Rust/TS DTOë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë©°, ì´ ë¬¸ì„œì—ëŠ” **ì±…ì„ê³¼ ì—­í• , ê·œì¹™ ìœ„ì£¼ë¡œ ìš”ì•½**í•œë‹¤.

### 3.3 ê³µí†µ í—¤ë” & ì¸ì¦

- HTTP í—¤ë”:
  - `Authorization: Bearer <ACCESS_TOKEN>`
    - ì¸ì¦ í•„ìš”í•œ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— í•„ìˆ˜
  - `Content-Type: application/json`
    - ìš”ì²­ ë³¸ë¬¸ì´ JSONì¼ ë•Œ
  - `Accept: application/json`
- ì¸ì¦ í”Œë¡œìš°(ê¸°ë³¸):
  - `POST /auth/login` â†’ ì•¡ì„¸ìŠ¤ í† í°(í—¤ë”), ë¦¬í”„ë ˆì‹œ í† í°(ì¿ í‚¤) ë°œê¸‰
  - ë§Œë£Œ ì‹œ `POST /auth/refresh`ë¡œ ì¬ë°œê¸‰ (ë¦¬í”„ë ˆì‹œ íšŒì „/ê²€ì¦/ë¡œê·¸ ê¸°ë¡)
- ë¦¬í”„ë ˆì‹œ ì¿ í‚¤:
  - SameSite/Domain/Secure ì„¤ì •ì€ ì„œë²„ í™˜ê²½ì„¤ì •ì— ë”°ë¥´ë˜,
    ë°°í¬ í™˜ê²½ì—ì„œ **HTTPS + Secure**ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ê°€ì •.

### 3.4 ì—ëŸ¬ ì‘ë‹µ í‘œì¤€

- ê³µí†µ ì—ëŸ¬ ë°”ë”” ì˜ˆì‹œ:

```json
{
  "error": {
    "code": "invalid_argument",
    "http_status": 400,
    "message": "video_state must be one of: ready,open,close",
    "details": null,
    "trace_id": "..."
  }
}
```

- í•„ë“œ ì˜ë¯¸:
  - `code`: ë‚´ë¶€/í´ë¼ì´ì–¸íŠ¸ ê³µí†µìœ¼ë¡œ ì‹ë³„ ê°€ëŠ¥í•œ ì—ëŸ¬ ì½”ë“œ ë¬¸ìì—´
  - `http_status`: ì‹¤ì œ HTTP status ì½”ë“œ (ì˜ˆ: 400, 401, 403, 404, 409, 500â€¦)
  - `message`: ì‚¬ìš©ìê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ë©”ì‹œì§€(ì˜ë¬¸/ë‹¤êµ­ì–´ëŠ” ì´í›„ í™•ì¥)
  - `details`: í•„ë“œë³„ ê²€ì¦ ì—ëŸ¬ ë“± êµ¬ì¡°í™”ëœ ì •ë³´ (ì—†ìœ¼ë©´ `null`)
  - `trace_id`: ë¡œê¹…/íŠ¸ë ˆì´ì‹±ìš© ID

- ëŒ€í‘œ ë§¤í•‘ ì˜ˆ:
  - 400: ê²€ì¦ ì‹¤íŒ¨, ì˜ëª»ëœ ìš”ì²­ íŒŒë¼ë¯¸í„°
  - 401: ì¸ì¦ ì‹¤íŒ¨(í† í° ì—†ìŒ/ë§Œë£Œ/ìœ„ì¡°)
  - 403: ê¶Œí•œ ë¶€ì¡± (`user_state != on`, RBAC ë¶ˆì¼ì¹˜ ë“±)
  - 404: ë¦¬ì†ŒìŠ¤ ì—†ìŒ
  - 409: ë¬´ê²°ì„± ìœ„ë°˜ (ì˜ˆ: ì´ë©”ì¼ ì¤‘ë³µ, UNIQUE ì œì•½)
  - 500/503: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜, ì¼ì‹œì ì¸ ì™¸ë¶€ ì˜ì¡´ì„± ì¥ì• 

### 3.5 í˜ì´ì§• & ê²€ìƒ‰ í‘œì¤€

- ê¸°ë³¸ ê·œì¹™:
  - **í˜ì´ì§€ ê¸°ë°˜(page/size) í˜ì´ì§•**ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©
  - ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°:
    - `page`: 1 ê¸°ë°˜ í˜ì´ì§€ ë²ˆí˜¸
    - `size`: í˜ì´ì§€ ë‹¹ ê°œìˆ˜(ê¸°ë³¸ê°’/ìƒí•œì€ ì—”ë“œí¬ì¸íŠ¸ë³„ ì •ì˜)
    - `sort`: ì •ë ¬ ì»¬ëŸ¼ (ì˜ˆ: `created_at`, `video_title`)
    - `order`: ì •ë ¬ ë°©í–¥ (`asc` / `desc`)
- í˜ì´ì§• ì‘ë‹µ ë˜í¼ ì˜ˆì‹œ:

```json
{
  "items": [ /* ê²°ê³¼ ë°°ì—´ */ ],
  "page": 1,
  "size": 20,
  "total": 57
}
```

- ê¸°ì¡´ì— ì»¤ì„œ ê¸°ë°˜ ë“±ì˜ ë‹¤ë¥¸ ë°©ì‹ì´ ìˆë‹¤ë©´:
  - ìƒˆë¡œ ì¶”ê°€ë˜ëŠ” ëª©ë¡í˜• APIëŠ” ìœ„ í‘œì¤€ì„ ìš°ì„  ì ìš©
  - ë‹¨ê±´ ì¡°íšŒ/ì†Œê·œëª¨ ëª©ë¡ì€ êµ³ì´ ë˜í¼ ì—†ì´ ë°°ì—´/ê°ì²´ ë°˜í™˜ í—ˆìš©

### 3.6 ì‘ë‹µ ë˜í¼ ì •ì±…

- ì„±ê³µ ì‘ë‹µ:
  - ë³„ë„ ìƒìœ„ ë˜í¼ ì—†ì´ **ì§ì ‘ JSON ê°ì²´/ë°°ì—´** ë°˜í™˜ì„ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤.
  - í˜ì´ì§•ì´ í•„ìš”í•œ ê²½ìš°ì—ë§Œ `items/page/size/total` ë˜í¼ ì‚¬ìš©.
- ì‹¤íŒ¨ ì‘ë‹µ:
  - ìœ„ì˜ **ê³µí†µ ì—ëŸ¬ ë°”ë””**ë¥¼ ì‚¬ìš©í•œë‹¤.
- PUT/DELETE:
  - ì¼ë°˜ì ìœ¼ë¡œ `200` ë˜ëŠ” `204 No Content` ì‚¬ìš©
  - í•„ìš”í•œ ê²½ìš° `200 + ìˆ˜ì • ê²°ê³¼ ê°ì²´` í—ˆìš©

### 3.7 ì¸ì¦ & ì„¸ì…˜ ê´€ë¦¬ (í†µí•©)

> ì´ ì„¹ì…˜ì€ ì¸ì¦ ê´€ë ¨ ì‚°ì¬ëœ ë‚´ìš©ì„ í†µí•©í•˜ì—¬ ì •ë¦¬í•¨
> - ê¸°ì¡´ Section 3.3 (ê³µí†µ í—¤ë” & ì¸ì¦)
> - Phase 5.2-3 (POST /auth/refresh)
> - Section 6.4.1 (í”„ë¡ íŠ¸ ì¸ì¦ ìƒíƒœ ê´€ë¦¬)
> - Section 7.1 (ë³´ì•ˆ ì‘ì—… ì›ì¹™)

#### í† í° ì¢…ë¥˜ & ìˆ˜ëª…

- **ì•¡ì„¸ìŠ¤ í† í° (Access Token)**:
  - í˜•ì‹: JWT (HS256 ì•Œê³ ë¦¬ì¦˜)
  - ìˆ˜ëª…: **1ì‹œê°„** (3600ì´ˆ)
  - ì „ì†¡ ë°©ì‹: `Authorization: Bearer <ACCESS_TOKEN>` í—¤ë”
  - í˜ì´ë¡œë“œ êµ¬ì¡°:
    ```json
    {
      "sub": "<user_id>",       // i64 - ì‚¬ìš©ì ID
      "role": "<user_auth>",    // "HYMN" | "admin" | "manager" | "learner"
      "session_id": "<uuid>",   // ì„¸ì…˜ ì‹ë³„ì (ë¡œê·¸ì•„ì›ƒ ì‹œ ë¬´íš¨í™”ìš©)
      "iss": "amazing-korean",  // ë°œê¸‰ì ì‹ë³„
      "exp": 1234567890,        // Unix timestamp (1ì‹œê°„ í›„)
      "iat": 1234564290         // ë°œê¸‰ ì‹œê°
    }
    ```

- **ë¦¬í”„ë ˆì‹œ í† í° (Refresh Token)**:
  - í˜•ì‹: Opaque Token (UUID ê¸°ë°˜ í•´ì‹œ)
  - ìˆ˜ëª…: **ì—­í• ë³„ TTL ì ìš©** (Role-based TTL):
    | ì—­í•  | TTL | ì„¤ëª… |
    |------|-----|------|
    | HYMN | 1ì¼ (86400ì´ˆ) | ìµœê³  ê¶Œí•œ - ë³´ì•ˆìƒ ì§§ì€ ì„¸ì…˜ |
    | admin | 7ì¼ (604800ì´ˆ) | ê´€ë¦¬ì - ì¼ë°˜ ë³´ì•ˆ ìˆ˜ì¤€ |
    | manager | 7ì¼ (604800ì´ˆ) | ë§¤ë‹ˆì € - ì¼ë°˜ ë³´ì•ˆ ìˆ˜ì¤€ |
    | learner | 30ì¼ (2592000ì´ˆ) | í•™ìŠµì - í¸ì˜ì„± ìš°ì„  |
  - ì „ì†¡ ë°©ì‹: **httpOnly ì¿ í‚¤** (`ak_refresh`)
  - ì €ì¥ì†Œ: **Redis** (`ak:refresh:<hash>` â†’ `<session_id>`)
  - ì¿ í‚¤ ì˜µì…˜:
    - `HttpOnly`: true (JavaScript ì ‘ê·¼ ì°¨ë‹¨)
    - `SameSite`: Lax (CSRF ë³´í˜¸)
    - `Secure`: true (HTTPS í™˜ê²½ì—ì„œë§Œ ì „ì†¡, í”„ë¡œë•ì…˜ í•„ìˆ˜)
    - `Domain`: í™˜ê²½ë³„ ì„¤ì • (ì˜ˆ: `.amazingkorean.net`)

#### ì¸ì¦ í”Œë¡œìš°

**1. ë¡œê·¸ì¸ (`POST /auth/login`)**:
- ìš”ì²­:
  ```json
  {
    "user_email": "user@example.com",
    "user_password": "password123"
  }
  ```
- ì„±ê³µ ì‘ë‹µ (200 OK):
  ```json
  {
    "access_token": "eyJhbGc...",
    "token_type": "Bearer",
    "expires_in": 3600,
    "user": {
      "user_id": 123,
      "user_email": "user@example.com",
      "user_auth": "learner"
    }
  }
  ```
  - **+ Set-Cookie í—¤ë”**: `ak_refresh=<refresh_token>; HttpOnly; SameSite=Lax; Secure; Max-Age=604800`
- ë™ì‘:
  1. ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (Argon2 í•´ì‹±)
  2. ì•¡ì„¸ìŠ¤ í† í° ìƒì„± (JWT, 1ì‹œê°„)
  3. ë¦¬í”„ë ˆì‹œ í† í° ìƒì„± (UUID í•´ì‹œ)
  4. Redisì— ì„¸ì…˜ ì €ì¥: `ak:refresh:<hash>` â†’ `<session_id>` (TTL 7ì¼)
  5. `users_login_log` í…Œì´ë¸”ì— ë¡œê·¸ì¸ ê¸°ë¡

**2. í† í° ì¬ë°œê¸‰ (`POST /auth/refresh`)**:
- ìš”ì²­:
  - **ì¿ í‚¤**: `ak_refresh=<refresh_token>` (ìë™ ì „ì†¡)
  - **ë°”ë””**: ì—†ìŒ (ì¿ í‚¤ì—ì„œ ìë™ ì¶”ì¶œ)
- ì„±ê³µ ì‘ë‹µ (200 OK):
  ```json
  {
    "access_token": "eyJhbGc...",
    "token_type": "Bearer",
    "expires_in": 3600
  }
  ```
  - **+ Set-Cookie í—¤ë”**: `ak_refresh=<new_refresh_token>; HttpOnly; SameSite=Lax; Secure; Max-Age=604800`
- ë™ì‘ (Rotate-on-Use ì „ëµ):
  1. ì¿ í‚¤ì—ì„œ ë¦¬í”„ë ˆì‹œ í† í° ì¶”ì¶œ
  2. Redisì—ì„œ ì„¸ì…˜ ê²€ì¦ (`ak:refresh:<hash>` ì¡´ì¬ ì—¬ë¶€)
  3. **ìƒˆ ì•¡ì„¸ìŠ¤ í† í° ìƒì„±** (JWT, 1ì‹œê°„)
  4. **ìƒˆ ë¦¬í”„ë ˆì‹œ í† í° ìƒì„±** (UUID í•´ì‹œ)
  5. Redisì—ì„œ **ê¸°ì¡´ ë¦¬í”„ë ˆì‹œ í† í° ì‚­ì œ**
  6. Redisì— **ìƒˆ ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥**: `ak:refresh:<new_hash>` â†’ `<session_id>` (TTL 7ì¼)
  7. `users_login_log` í…Œì´ë¸”ì— rotate ë¡œê·¸ ê¸°ë¡

**3. ë¡œê·¸ì•„ì›ƒ (`POST /auth/logout`)**:
- ìš”ì²­:
  - **í—¤ë”**: `Authorization: Bearer <ACCESS_TOKEN>`
  - **ì¿ í‚¤**: `ak_refresh=<refresh_token>`
- ì„±ê³µ ì‘ë‹µ (204 No Content)
- ë™ì‘:
  1. Claimsì—ì„œ `user_id` ì¶”ì¶œ
  2. Redisì—ì„œ ë¦¬í”„ë ˆì‹œ í† í° ì‚­ì œ (`DEL ak:refresh:<hash>`)
  3. `users_login_log` í…Œì´ë¸”ì— ë¡œê·¸ì•„ì›ƒ ê¸°ë¡
  4. ì¿ í‚¤ ì‚­ì œ: `Set-Cookie: ak_refresh=; Max-Age=0`

#### Redis í‚¤ íŒ¨í„´ & TTL

| í‚¤ íŒ¨í„´ | ê°’ | TTL | ìš©ë„ |
|---------|-----|-----|------|
| `ak:session:{session_id}` | user_id (i64) | 15ë¶„ | ì•¡ì„¸ìŠ¤ í† í° ìœ íš¨ì„± ë¹ ë¥¸ í™•ì¸ |
| `ak:refresh:{refresh_hash}` | session_id (UUID) | ì—­í• ë³„ (1/7/30ì¼) | ë¦¬í”„ë ˆì‹œ í† í° ê²€ì¦ |
| `ak:user_sessions:{user_id}` | Set\<session_id\> | - | ì „ì²´ ë¡œê·¸ì•„ì›ƒ ì‹œ ì„¸ì…˜ ëª©ë¡ |
| `rl:login:{email}:{ip}` | ì‹œë„ íšŸìˆ˜ (i64) | 15ë¶„ | ë¡œê·¸ì¸ Rate Limiting (10íšŒ/15ë¶„) |
| `rl:find_id:{ip}` | ì‹œë„ íšŸìˆ˜ (i64) | 15ë¶„ | ì•„ì´ë”” ì°¾ê¸° Rate Limiting |
| `rl:reset_pw:{ip}` | ì‹œë„ íšŸìˆ˜ (i64) | 15ë¶„ | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • Rate Limiting |

> **ì°¸ê³ **: `ak:session`, `ak:refresh` TTLì€ `config.rs`ì˜ `jwt_access_ttl_min`, ì—­í• ë³„ `refresh_ttl_secs` ê°’ ê¸°ì¤€

#### ì—ëŸ¬ ì¼€ì´ìŠ¤ & HTTP ìƒíƒœ ì½”ë“œ

| ì‹œë‚˜ë¦¬ì˜¤ | HTTP ìƒíƒœ | ì„¤ëª… |
|---------|----------|------|
| ë¡œê·¸ì¸ ì„±ê³µ | 200 OK | ì•¡ì„¸ìŠ¤ + ë¦¬í”„ë ˆì‹œ í† í° ë°œê¸‰ |
| ë¡œê·¸ì¸ ì‹¤íŒ¨ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜) | 401 Unauthorized | `{ "code": "invalid_credentials", "message": "..." }` |
| ë¡œê·¸ì¸ ì‹¤íŒ¨ (ê³„ì • ë¹„í™œì„±í™”) | 403 Forbidden | `{ "code": "account_disabled", "message": "..." }` |
| ë¦¬í”„ë ˆì‹œ ì„±ê³µ | 200 OK | ìƒˆ ì•¡ì„¸ìŠ¤ + ë¦¬í”„ë ˆì‹œ í† í° ë°œê¸‰ |
| ë¦¬í”„ë ˆì‹œ ì‹¤íŒ¨ (í† í° ë§Œë£Œ/ì—†ìŒ) | 401 Unauthorized | ì¬ë¡œê·¸ì¸ í•„ìš” |
| ë¦¬í”„ë ˆì‹œ ì‹¤íŒ¨ (í† í° ìœ„ì¡°/Redis ì—†ìŒ) | 401 Unauthorized | ì¬ë¡œê·¸ì¸ í•„ìš” |
| ë¡œê·¸ì•„ì›ƒ ì„±ê³µ | 204 No Content | ì„¸ì…˜ ì‚­ì œ ì™„ë£Œ |
| ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ (ë¯¸ì¸ì¦) | 401 Unauthorized | ì„¸ì…˜ ì—†ìŒ |
| ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ (í† í° ì—†ìŒ) | 401 Unauthorized | `Authorization` í—¤ë” ëˆ„ë½ |
| ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ (í† í° ë§Œë£Œ) | 401 Unauthorized | ë¦¬í”„ë ˆì‹œ í•„ìš” |
| ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ (ê¶Œí•œ ë¶€ì¡±) | 403 Forbidden | RBAC ë¶ˆì¼ì¹˜ (ì˜ˆ: learnerê°€ admin ê²½ë¡œ ì ‘ê·¼) |

#### í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ (Section 6.4.1 ì°¸ì¡°)

**ì¸ì¦ ìƒíƒœ ê´€ë¦¬ (Zustand + TanStack Query)**:
- **ì „ì—­ ìƒíƒœ (Zustand)**:
  ```typescript
  interface AuthState {
    authStatus: "pass" | "stop" | "forbid";
    user: UserDto | null;
    setAuth: (status: "pass" | "stop" | "forbid", user?: UserDto) => void;
  }
  ```

- **TanStack Query í›… ì˜ˆì‹œ**:
  ```typescript
  // ë¡œê·¸ì¸
  const loginMutation = useMutation({
    mutationFn: (dto: LoginDto) => apiClient.post('/auth/login', dto),
    onSuccess: (data) => {
      setAuth("pass", data.user);
      // ì•¡ì„¸ìŠ¤ í† í°ì€ Axios Interceptorì—ì„œ ìë™ ê´€ë¦¬
      // ë¦¬í”„ë ˆì‹œ í† í°ì€ ì¿ í‚¤ë¡œ ìë™ ì „ì†¡
    },
    onError: (error) => {
      if (error.status === 401) toast.error("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤");
      if (error.status === 403) toast.error("ê³„ì •ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤");
    }
  });

  // ë¦¬í”„ë ˆì‹œ
  const refreshMutation = useMutation({
    mutationFn: () => apiClient.post('/auth/refresh'),
    onSuccess: (data) => {
      // ìƒˆ ì•¡ì„¸ìŠ¤ í† í°ì€ Interceptorì—ì„œ ìë™ ì €ì¥
      // ìƒˆ ë¦¬í”„ë ˆì‹œ í† í°ì€ ì¿ í‚¤ë¡œ ìë™ ìˆ˜ì‹ 
    },
    onError: () => {
      setAuth("stop");
      router.push("/login");
    }
  });

  // ë¡œê·¸ì•„ì›ƒ
  const logoutMutation = useMutation({
    mutationFn: () => apiClient.post('/auth/logout'),
    onSuccess: () => {
      setAuth("stop", null);
      router.push("/login");
    }
  });
  ```

- **Axios Interceptor (ìë™ í† í° ê´€ë¦¬)**:
  ```typescript
  // Request Interceptor: ì•¡ì„¸ìŠ¤ í† í° ìë™ ì¶”ê°€
  apiClient.interceptors.request.use((config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  });

  // Response Interceptor: 401 ì—ëŸ¬ ì‹œ ìë™ ë¦¬í”„ë ˆì‹œ
  apiClient.interceptors.response.use(
    (response) => response,
    async (error) => {
      if (error.response?.status === 401 && !error.config._retry) {
        error.config._retry = true;
        try {
          const { data } = await apiClient.post('/auth/refresh');
          localStorage.setItem('access_token', data.access_token);
          error.config.headers.Authorization = `Bearer ${data.access_token}`;
          return apiClient(error.config);
        } catch (refreshError) {
          // ë¦¬í”„ë ˆì‹œ ì‹¤íŒ¨ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
          setAuth("stop");
          router.push("/login");
          return Promise.reject(refreshError);
        }
      }
      return Promise.reject(error);
    }
  );
  ```

#### ë³´ì•ˆ ì›ì¹™ (Section 7.1 ì°¸ì¡°)

1. **ë¦¬í”„ë ˆì‹œ í† í° Rotate-on-Use**:
   - ë§¤ë²ˆ ë¦¬í”„ë ˆì‹œ ì‹œ ìƒˆ í† í° ë°œê¸‰ + ê¸°ì¡´ í† í° ì¦‰ì‹œ ë¬´íš¨í™”
   - í† í° ì¬ì‚¬ìš© ê³µê²© ë°©ì–´

2. **Redis ì„¸ì…˜ TTL ê´€ë¦¬**:
   - ë¦¬í”„ë ˆì‹œ í† í°: 7ì¼ TTL
   - ë¡œê·¸ì•„ì›ƒ ì‹œ ì¦‰ì‹œ ì‚­ì œ

3. **ì¿ í‚¤ ë³´ì•ˆ ì˜µì…˜**:
   - `HttpOnly`: XSS ê³µê²© ë°©ì–´
   - `SameSite=Lax`: CSRF ê³µê²© ë°©ì–´
   - `Secure`: HTTPS ì „ì†¡ ê°•ì œ (í”„ë¡œë•ì…˜)

4. **ì•¡ì„¸ìŠ¤ í† í° ì €ì¥ ìœ„ì¹˜**:
   - í”„ë¡ íŠ¸ì—”ë“œ: `localStorage` (ë¹ ë¥¸ ì ‘ê·¼, XSS ë¦¬ìŠ¤í¬ ìˆìœ¼ë‚˜ httpOnly ì¿ í‚¤ë¡œ ë¦¬í”„ë ˆì‹œ ë³´í˜¸)
   - ëŒ€ì•ˆ: `sessionStorage` (íƒ­ ë‹«ìœ¼ë©´ ìë™ ì‚­ì œ)

5. **JWT ì„œëª… ê²€ì¦**:
   - ë°±ì—”ë“œì—ì„œ HS256 ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ê²€ì¦
   - ìœ„ì¡° í† í° ìë™ ê±°ë¶€ (401 ì‘ë‹µ)

#### ë°±ì—”ë“œ êµ¬í˜„ ì°¸ì¡°

- **ì½”ë“œ ìœ„ì¹˜**:
  - ë°±ì—”ë“œ: `src/api/auth/` (handler, service, repo)
    - `handler.rs`: ì—”ë“œí¬ì¸íŠ¸ ì •ì˜ (login, refresh, logout)
    - `service.rs`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (í† í° ìƒì„±, ê²€ì¦, rotate)
    - `repo.rs`: DB/Redis ì ‘ê·¼ (ì„¸ì…˜ ì €ì¥, ë¡œê·¸ ê¸°ë¡)
    - `jwt.rs`: JWT ì¸ì½”ë”©/ë””ì½”ë”©
    - `token_utils.rs`: ë¦¬í”„ë ˆì‹œ í† í° ìƒì„±/ê²€ì¦
  - í”„ë¡ íŠ¸ì—”ë“œ: `frontend/src/category/auth/` (api, hooks, types)
    - `api.ts`: API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜
    - `hooks/useAuth.ts`: TanStack Query í›…
    - `types.ts`: DTO íƒ€ì… ì •ì˜ (ReadOnly)

#### ìƒíƒœì¶• ë§¤í•‘ (í”„ë¡ íŠ¸ì—”ë“œ â†” ë°±ì—”ë“œ)

| ë°±ì—”ë“œ ìƒíƒœ | í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ (`authStatus`) | UI ë™ì‘ |
|------------|------------------------------|---------|
| ì¸ì¦ ì„±ê³µ (Claims ì¶”ì¶œ ì„±ê³µ) | `"pass"` | ë³´í˜¸ëœ ì½˜í…ì¸  í‘œì‹œ |
| ì¸ì¦ ì‹¤íŒ¨ (í† í° ì—†ìŒ/ë§Œë£Œ) | `"stop"` | `/login` ë¦¬ë””ë ‰ì…˜ + "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤" ë©”ì‹œì§€ |
| ê¶Œí•œ ë¶€ì¡± (RBAC ë¶ˆì¼ì¹˜) | `"forbid"` | 403 ì—ëŸ¬ í˜ì´ì§€ + "ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ |
| ê³„ì • ë¹„í™œì„±í™” (`user_state=false`) | `"forbid"` | "ê³„ì •ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ |

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 4. ë°ì´í„° ëª¨ë¸ ê°œìš” (ìš”ì•½)

> ì „ì²´ DDL/ì»¬ëŸ¼ì€ `amk_schema_patched.sql` ê¸°ì¤€.
> ì—¬ê¸°ì„œëŠ” **ì£¼ìš” ë„ë©”ì¸ê³¼ í…Œì´ë¸” ì—­í• **ë§Œ ìš”ì•½í•œë‹¤.

### 4.1 ì‚¬ìš©ì ë„ë©”ì¸ (USERS)

- `users`
  - íšŒì› ì •ë³´ (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ, ì´ë¦„, êµ­ê°€, ì–¸ì–´, ìƒë…„ì›”ì¼, ì„±ë³„ ë“±)
  - `user_auth_enum` ('HYMN', 'admin', 'manager', 'learner') ì‚¬ìš©ì ê¶Œí•œ
  - `user_state` : boolean íƒ€ì… (true = on, false = off) ì‚¬ìš©ì ê³„ì • í™œì„± ì—¬ë¶€
  - `user_language_enum` ('ko', 'en') ì‚¬ìš©ì êµ¬ì‚¬ ì–¸ì–´
  - `user_gender_enum` ('none', 'male', 'female', 'other') ì‚¬ìš©ì ì„±ë³„
- `users_log`
  - íšŒì› ì •ë³´ í™œë™ ê¸°ë¡
  - `user_action_log_enum` ('signup', 'find_id', 'reset_pw', 'update') ì‚¬ìš©ì í™œë™ ì´ë ¥
  - `user_auth_enum` ('HYMN', 'admin', 'manager', 'learner') ì‚¬ìš©ì ê¶Œí•œ ì´ë ¥
  - `user_language_enum` ('ko', 'en') ì‚¬ìš©ì êµ¬ì‚¬ ì–¸ì–´ ì´ë ¥
  - `user_gender_enum` ('none', 'male', 'female', 'other') ì‚¬ìš©ì ì„±ë³„ ì´ë ¥
- `users_setting`
  - ì‚¬ìš©ì ê´€ë ¨ UI ì–¸ì–´, íƒ€ì„ì¡´, ì•Œë¦¼ ë“± ê°œì¸ ì„¤ì •
  - `user_set_language_enum` ('ko', 'en') ì‚¬ìš©ì ì„¤ì • ì–¸ì–´
  - `user_set_timezone` (VARCHAR) ì‚¬ìš©ì íƒ€ì„ì¡´ (ì˜ˆ: "Asia/Seoul", "America/New_York") â€” ìµœì´ˆ ê°€ì… ì‹œ ìë™ ê°ì§€, ì´í›„ ìˆ˜ë™ ë³€ê²½ë§Œ í—ˆìš© (â†’ 3.1 ì°¸ê³ )
- `admin_users_log`
  - ì‚¬ìš©ì ê´€ë ¨ ê´€ë¦¬ì í™œë™ ê¸°ë¡
  - `admin_action_enum` ('create', 'update', 'banned', 'reorder', 'publish', 'unpublish') ê´€ë¦¬ì í™œë™ ì´ë ¥
- `user_export_data`
  - ê°œì¸ì •ë³´ ë‚´ë³´ë‚´ê¸°/ë°±ì—… ìš”ì²­ ìƒíƒœ ë° ê²°ê³¼ ê´€ë¦¬(ë¹„ë™ê¸° ì²˜ë¦¬ìš©)

### 4.2 ì¸ì¦ ë¡œê·¸ì¸ ë„ë©”ì¸ (AUTH LOGIN)

- `login`
  - ë¡œê·¸ì¸ ì •ë³´(ì§€ì—­, ë°©ì‹, ì‹œê°„, ìƒíƒœ)
  - `login_device_enum` ('mobile', 'tablet', 'desktop', 'other') ë¡œê·¸ì¸ ê¸°ê¸°
  - `login_method_enum` ('email', 'google', 'apple') ë¡œê·¸ì¸ ë°©ë²•
  - `login_state_enum` ('active', 'revoked', 'expired', 'logged_out', 'compromised') ë¡œê·¸ì¸ ìƒíƒœ
  - `login_os`, `login_browser`, `login_device`: ì„œë²„ì‚¬ì´ë“œ User-Agent íŒŒì‹±(`woothee`)ìœ¼ë¡œ ìë™ ì±„ì›€
  - `login_expire_at`: ë¡œê·¸ì¸ ì‹œ `NOW() + refresh_ttl` ê¸°ë¡, í† í° ê°±ì‹  ì‹œ ê°±ì‹ 
  - `login_active_at`: í† í° ê°±ì‹ (refresh) ì‹œ `NOW()` ì—…ë°ì´íŠ¸
  - `login_revoked_reason`: ì„¸ì…˜ ìƒíƒœ ë³€ê²½ ì‚¬ìœ  ê¸°ë¡ (ê¸°ë³¸ê°’ `none`, revoke ì‹œ: `password_changed`, `security_concern`, `admin_action`, `account_disabled`)
- `login_log`
  - ë¡œê·¸ì¸ ì •ë³´ í™œë™ ì´ë ¥(ë¡œê·¸ì¸ ì´ë²¤íŠ¸, ì„¸ë¶€ ì§€ì—­, ì„¸ë¶€ ë°©ì‹)
  - `login_event_enum` ('login', 'logout', 'refresh', 'rotate', 'fail', 'reuse_detected') ë¡œê·¸ì¸ í™œë™ ì´ë ¥
  - `login_device_enum` ('mobile', 'tablet', 'desktop', 'other') ë¡œê·¸ì¸ ê¸°ê¸° ì´ë ¥
  - `login_method_enum` ('email', 'google', 'apple') ë¡œê·¸ì¸ ë°©ë²• ì´ë ¥
  - `login_access_log` (char(64)): access token SHA-256 í•´ì‹œ (ê°ì‚¬ ì¶”ì ìš©)
  - `login_token_id_log` (varchar): JWT `jti` claim ê°’ (í† í° ì‹ë³„ìš©)
  - `login_fail_reason_log` (text): ì‹¤íŒ¨ ì‚¬ìœ  (ê¸°ë³¸ê°’ `none`, ì‹¤íŒ¨ ì‹œ: `invalid_credentials`, `account_disabled`, `token_reuse`)
- `redis_session`
  - Key: ak:session:< sid >
  - TTLì€ expire_at ê¸°ì¤€. ì„¸ì…˜ ë³¸ë¬¸ì€ ì§ë ¬í™”(JSON ë“±)í•˜ë˜, ìš´ì˜ ìƒ ì¡°íšŒ í•„ë“œëŠ” ì»¬ëŸ¼ìœ¼ë¡œ ë¬¸ì„œí™”.
  - `login_state_enum` ('active', 'revoked', 'expired', 'logged_out', 'compromised') ë¡œê·¸ì¸ ìƒíƒœ
- `redis_refresh`
  - Key: ak:refresh:< hash > -> < sid >
  - ë¡œí…Œì´ì…˜(rotate-on-use) ì‹œ refresh_hash êµì²´. ì¬ì‚¬ìš© íƒì§€ ì‹œ ì„¸ì…˜ ì¼ê´„ íê¸° ì •ì±…ê³¼ ì—°ë™.
- `redis_user_sessions`
  - Key: ak:user_sessions:< uid > (set/list ëª¨ë¸ì„ í–‰ ë‹¨ìœ„ë¡œ ì „ê°œ)
  - ì‹¤ì œ Redisì—ì„œëŠ” set/listë¡œ ë³´ê´€. dbdiagram ë¬¸ì„œí™”ë¥¼ ìœ„í•´ í–‰ í˜•íƒœë¡œ í‘œí˜„.
- `user_oauth`
  - OAuth ì†Œì…œ ë¡œê·¸ì¸ ì—°ë™ ì •ë³´ (Google, Apple ë“±)
  - `login_method_enum` ('email', 'google', 'apple') OAuth ì œê³µì
  - `oauth_subject` â€” OAuth ì œê³µìì˜ ê³ ìœ  ì‚¬ìš©ì ID (sub claim)
  - `oauth_email`, `oauth_name`, `oauth_picture_url` â€” ì œê³µìë¡œë¶€í„° ë°›ì€ í”„ë¡œí•„ ì •ë³´
  - ë™ì¼ ì´ë©”ì¼ ê¸°ì¡´ ê³„ì • ìë™ ì—°ê²°, ì‹ ê·œ ì´ë©”ì¼ì€ ìë™ íšŒì›ê°€ì…

### 4.3 ë¹„ë””ì˜¤ ë„ë©”ì¸ (VIDEOS)

- `video`
  - ë™ì˜ìƒ ê°•ì˜ ì •ë³´(vimeo ë§í¬, ìƒíƒœ, ì ‘ê·¼)
  - `video_state_enum` ('ready', 'open', 'close') ê°•ì˜ ìƒíƒœ
  - `video_access_enum` ('public', 'paid', 'private', 'promote') ê°•ì˜ ì ‘ê·¼
  - `video_duration` (INT, nullable) â€” ì˜ìƒ ê¸¸ì´ (ì´ˆ, Vimeo API ë™ê¸°í™”)
  - `video_thumbnail` (TEXT, nullable) â€” ì¸ë„¤ì¼ URL (Vimeo API ë™ê¸°í™”)
- `video_log`
  - ë™ì˜ìƒ ê°•ì˜ ì‹œì²­ ì •ë³´(ì§„í–‰, ì™„ë£Œ, íšŸìˆ˜, ì ‘ì†ì •ë³´)
- `video_tag`
  - ë™ì˜ìƒ ê°•ì˜ ë©”íƒ€ ì •ë³´(ì œëª©, ë¶€ì œëª©)
- `video_tag_map`
  - ë™ì˜ìƒ ê°•ì˜ ë§µí•‘ : `video_tag` - `video`
- `video_stat_daily`
  - ë™ì˜ìƒ ì¼ë³„ í†µê³„ : UTC ê¸°ì¤€
- `admin_video_log`
  - ë™ì˜ìƒ ê°•ì˜ ê´€ë ¨ ê´€ë¦¬ì í™œë™ ê¸°ë¡
  - `admin_action_enum` ('create', 'update', 'banned', 'reorder', 'publish', 'unpublish') ê´€ë¦¬ì í™œë™ ì´ë ¥

### 4.4 í•™ìŠµ ë„ë©”ì¸ (STUDY)

- `study`
  - í•™ìŠµ ë¬¸ì œ ì •ë³´(ìƒíƒœ, í”„ë¡œê·¸ë¨, ë¬¸ì œ ì •ë³´)
  - `study_state_enum` ('ready', 'open', 'close') í•™ìŠµ ë¬¸ì œ ìƒíƒœ
  - `study_program_enum` ('basic_pronunciation', 'basic_word', 'basic_900', 'topik_read', 'topik_listen', 'topik_write', 'tbc') í•™ìŠµ í”„ë¡œê·¸ë¨ ë¶„ë¥˜
- `study_task`
  - í•™ìŠµ ë¬¸ì œ ì„¸ë¶€ ì •ë³´(ì¢…ë¥˜, ìˆœì„œ)
  - `study_task_kind_enum` ('choice', 'typing', 'voice') í•™ìŠµ ë¬¸ì œ ìœ í˜•
- `study_task_choice`
  - í•™ìŠµ ë¬¸ì œ : 4ì§€ ì„ ë‹¤ (ì •ë‹µ 1~4)
- `study_task_typing`
  - í•™ìŠµ ë¬¸ì œ : ì“°ê¸° / íƒ€ì´í•‘
- `study_task_voice`
  - í•™ìŠµ ë¬¸ì œ : ë°œìŒ
- `study_task_explain`
  - í•™ìŠµ ë¬¸ì œ í•´ì„¤(í•´ì„¤ ì–¸ì–´, í•´ì„¤ ë‚´ìš©)
  - `user_set_language_enum` ('ko', 'en') í•´ì„¤ ì œê³µ ì–¸ì–´
- `study_task_status`
  - í•™ìŠµ ìƒíƒœ(ì‹œë„ íšŸìˆ˜, ìµœê³ ì , ì™„ë£Œì—¬ë¶€)
- `study_task_log`
  - í•™ìŠµ ë¬¸ì œ í’€ì´ ê¸°ë¡(ì‹œë„ íšŸìˆ˜, ìµœê³ ì , ì™„ë£Œì—¬ë¶€, í’€ì´ë‚´ìš©, ì ‘ì†ì •ë³´)
  - `study_task_log_action_enum` ('view', 'start', 'answer', 'finish', 'explain', 'status') í•™ìŠµ í–‰ë™ ì´ë ¥
- `admin_study_log`
  - í•™ìŠµ ë¬¸ì œ ê´€ë ¨ ê´€ë¦¬ì í™œë™ ê¸°ë¡
  - `admin_action_enum` ('create', 'update', 'banned', 'reorder', 'publish', 'unpublish') ê´€ë¦¬ì í™œë™ ì´ë ¥

### 4.5 ìˆ˜ì—… êµ¬ì„± ë„ë©”ì¸ (LESSON)

- `lesson`
  - ìˆ˜ì—… êµ¬ì„± : ë™ì˜ìƒ ê°•ì˜ + í•™ìŠµ ë¬¸ì œ(ë‚´ìš© ì„¤ëª…)
- `lesson_item`
  - ìˆ˜ì—… êµ¬ì„± ì•„ì´í…œ : ìˆœì„œ ì§€ì •(ìˆœì„œ, ì¢…ë¥˜)
  - `lesson_item_kind_enum` ('video', 'task') ìˆ˜ì—… êµ¬ì„± ì¢…ë¥˜
- `lesson_progress`
  - ìˆ˜ì—… êµ¬ì„± : í•™ìŠµ ì§„ë„ ì‚¬í•­(ì§„ë„ìœ¨, ë§ˆì§€ë§‰ ì•„ì´í…œ)
- `admin_lesson_log`
  - ìˆ˜ì—… êµ¬ì„± ê´€ë ¨ ê´€ë¦¬ì ì„¸ë¶€ ì •ë³´
  - `admin_action_enum` ('create', 'update', 'banned', 'reorder', 'publish', 'unpublish') ê´€ë¦¬ì í™œë™ ì´ë ¥

> ìƒì„¸ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ í•„ìš”í•˜ë©´, í•­ìƒ ì´ ë¬¸ì„œì™€ `amk_schema_patched.sql`ì„ í•¨ê»˜ ì—…ë°ì´íŠ¸í•œë‹¤.

### 4.6 í–¥í›„ ì—…ë°ì´íŠ¸ ë„ë©”ì¸

- `pay`
  - ê²°ì œ : ì‚¬ìš©ì ê²°ì œ ê´€ë ¨ í…Œì´ë¸”, ê²°ì œ í›„ ì½˜í…ì¸  ì´ìš© ê°€ëŠ¥
  - `pay_state` ('ready', 'done', 'cancel')
- `course`
  - ê²°ì œ ë§µí•‘ : ê²°ì œ í›„ `course`ì™€ `lesson`ë¥¼ ë§µí•‘í•´ ì½˜í…ì¸  ì´ìš© ì§„í–‰
  - `course_type` ('video', 'study', 'live', 'package')
  - `course_state` ('active', 'inactive', 'deleted')
- `course_video` / `course_live`
  - ì½”ìŠ¤ êµ¬ì„± ë§µí•‘ í…Œì´ë¸”
- `live`
  - ì‹¤ì‹œê°„ ê°•ì˜ : ZOOM API ì—°ë™ì„ í†µí•œ ì‹¤ì‹œê°„ ê°•ì˜ ì„œë¹„ìŠ¤ ê´€ë ¨ í…Œì´ë¸”
  - `live_state` ('ready', 'open', 'close')
- `live_zoom`
  - ì¤Œ ì—°ë™ ì •ë³´
  - `live_zoom_state` ('pending', 'registered', 'failed')
- `live_log`
  - ë¼ì´ë¸Œ ê°•ì˜ ì°¸ì—¬ ë¡œê·¸

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 5. ê¸°ëŠ¥ & API ë¡œë“œë§µ (Phase / í™”ë©´ / ì—”ë“œí¬ì¸íŠ¸ / ìƒíƒœ / DoD)

> ì´ ì„¹ì…˜ì€ **ê¸°ì¡´ `AMK_Feature_Roadmap.md`ì˜ ë‚´ìš©ì„ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.**
> ì•„ë˜ í‘œë“¤ì€ _Phase / ì—”ë“œí¬ì¸íŠ¸ / í™”ë©´ ê²½ë¡œ / ê¸°ëŠ¥ ëª…ì¹­ / ì ê²€ì‚¬í•­ / UX ê·œì¹™ / ê¸°ëŠ¥ ì™„ë£Œ_ ë¥¼ ë‚˜íƒ€ë‚´ë©°,
> ë§ˆì§€ë§‰ ì—´ì˜ ì²´í¬ë°•ìŠ¤ëŠ” êµ¬í˜„ ì™„ë£Œ ì—¬ë¶€ë¥¼ ì˜ë¯¸í•œë‹¤.


### 5.0 Phase ë¡œë“œë§µ ì²´í¬ë°•ìŠ¤ ë²”ë¡€

| ê¸°í˜¸ | ì˜ë¯¸ | ì„¤ëª… |
|------|------|------|
| âœ… | ë°±ì—”ë“œ ì™„ë£Œ | API ì—”ë“œí¬ì¸íŠ¸, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ |
| ğŸ†— | í”„ë¡ íŠ¸ì—”ë“œ ì™„ë£Œ | í™”ë©´ êµ¬í˜„, API ì—°ë™, ìƒíƒœ ê´€ë¦¬ ì™„ë£Œ |
| âš ï¸ | ë¶€ë¶„ ì™„ë£Œ | ê¸°ë³¸ ê¸°ëŠ¥ì€ ë™ì‘í•˜ë‚˜ ë¦¬íŒ©í† ë§/ìµœì í™” í•„ìš” |
| âŒ | ë¯¸ì°©ìˆ˜ | ì•„ì§ êµ¬í˜„ ì‹œì‘ ì•ˆ í•¨ |
| ğŸ”„ | ì§„í–‰ ì¤‘ | í˜„ì¬ ì‘ì—… ì¤‘ |

**í‘œê¸° ì˜ˆì‹œ**:
- `[âœ…]` â†’ ë°±ì—”ë“œë§Œ ì™„ë£Œ
- `[âœ…ğŸ†—]` â†’ ë°±ì—”ë“œ + í”„ë¡ íŠ¸ì—”ë“œ ëª¨ë‘ ì™„ë£Œ
- `[âœ…âš ï¸]` â†’ ë°±ì—”ë“œ ì™„ë£Œ, í”„ë¡ íŠ¸ì—”ë“œ ë¶€ë¶„ ì™„ë£Œ
- `[ğŸ”„]` â†’ ë°±ì—”ë“œ ë˜ëŠ” í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ì§„í–‰ ì¤‘
- `[âŒ]` â†’ ë¯¸ì°©ìˆ˜

---

### ìƒíƒœì¶• (State Axis) ì •ì˜

| ì¶• | ìƒíƒœ ê°’ | ìƒíƒœ ì„¤ëª… |
|---|---|---|
| **Auth** | `pass` | ì¸ì¦ ì™„ë£Œ(ì ‘ê·¼ í—ˆìš©) |
|  | `stop` | ì¸ì¦ ë¶ˆê°€(ë¡œê·¸ì¸ í•„ìš”/í† í° ì—†ìŒÂ·ë§Œë£Œ) |
|  | `forbid` | ì ‘ê·¼ ë¶ˆê°€(ê¶Œí•œ ë¶€ì¡±Â·ì°¨ë‹¨ ìƒíƒœ) |
| **Session** | `active` | ì„¸ì…˜ ë°œê¸‰ |
|  | `expiring` | ì„¸ì…˜ ì¬ë°œê¸‰ í•„ìš” ì„ë°• |
|  | `rotating` | ì„¸ì…˜ ë¦¬í”„ë ˆì‹œ ì¤‘ |
|  | `expired` | ì„¸ì…˜ ë§Œë£Œ |
| **Page** | `init` | í˜ì´ì§€ ë¡œë”© ì¤‘(ì´ˆê¸° ì§„ì…Â·í”„ë¦¬í˜ì¹˜) |
|  | `ready` | í˜ì´ì§€ ë¡œë”© ì™„ë£Œ(ì…ë ¥/ìƒí˜¸ì‘ìš© ê°€ëŠ¥) |
| **Data** | `empty` | ë°ì´í„° ì—†ìŒ(ì˜¤ë¥˜ ì•„ë‹˜, 0ê°œ ê²°ê³¼) |
|  | `present` | ë°ì´í„° ì¡´ì¬(ì •ìƒ ë°”ì¸ë”©) |
|  | `error` | ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨(404/500 ë“±) |
| **Form** | `pristine` | í™”ë©´ êµ¬ì„± ì§í›„, ì…ë ¥ ì „ ìƒíƒœ |
|  | `dirty` | ì‚¬ìš©ì ì…ë ¥ ë°œìƒ(ë³€ê²½ë¨) |
|  | `validating` | í´ë¼ì´ì–¸íŠ¸ ê²€ì¦ ì¤‘(í˜•ì‹Â·ë²”ìœ„ í™•ì¸) |
|  | `submitting` | ì„œë²„ë¡œ ì œì¶œ ì¤‘(ì¤‘ë³µ ì œì¶œ ì°¨ë‹¨) |
|  | `success` | ì„œë²„ ì €ì¥ ì„±ê³µ(í›„ì† ì´ë™/í† ìŠ¤íŠ¸) |
|  | `error.client` | í´ë¼ì´ì–¸íŠ¸ ê²€ì¦ ì‹¤íŒ¨(í˜•ì‹/ë²”ìœ„ ì˜¤ë¥˜) |
|  | `error.conflict` | ì„œë²„ ì¶©ëŒ(ì˜ˆ: 409 ì´ë©”ì¼ ì¤‘ë³µ) |
| **Request** | `pending` | ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì§„í–‰ ì¤‘ |
|  | `success` | ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì„±ê³µ |
|  | `error` | ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹¤íŒ¨ |
|  | `retryable` | ì¼ì‹œ ì¥ì• ë¡œ ì¬ì‹œë„ ê°€ëŠ¥(ì˜ˆ: 503/ë„¤íŠ¸ì›Œí¬) |
| **Course** | `buy` | êµ¬ë§¤ ì™„ë£Œ, êµ¬ë§¤ ê¶Œí•œ ì¡´ì¬ |
|  | `taster` | ì²´í—˜íŒ, ì²´í—˜ ê¶Œí•œ ì¡´ì¬ |
|  | `buy-not` | ë¹„êµ¬ë§¤, êµ¬ë§¤ ê¶Œí•œ ì—†ìŒ |
|  | `checking` | êµ¬ë§¤ ì—¬ë¶€ ë° êµ¬ë§¤ ê¶Œí•œ ì ê²€ |


---

### 5.1 Phase 1 â€” health âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ | 
|---|---|---|---|---|---|
| 1-1 | `GET /healthz` | `/health` | ë¼ì´ë¸Œ í—¬ìŠ¤ | ***ì„œë²„ ì‘ë™ ì—¬ë¶€ í™•ì¸***<br>**ì„±ê³µ:** Auth pass / Page : healthz initâ†’ready / Request : healthz pendingâ†’success / Data : healthz present â†’ **200**<br>**ì‹¤íŒ¨:** Auth pass / Page : healthz initâ†’ready / Request : healthz pendingâ†’error / Data : healthz error â†’ **500** | [âœ…ğŸ†—] |
| 1-2 | `GET /docs` | `/docs` | API ë¬¸ì„œ | ***Swagger íƒœê·¸ ìˆœì„œ ê³ ì •(health â†’ auth â†’ user â†’ videos â†’ study â†’ lesson â†’ admin)***<br>**ì„±ê³µ:** Auth pass / Page : docs initâ†’ready / Request : docs pendingâ†’success / Data : docs present â†’ **200**<br>**ì‹¤íŒ¨(ìŠ¤í‚¤ë§ˆ ì§‘ê³„ ì‹¤íŒ¨):** Auth pass / Page : docs initâ†’ready / Request : docs pendingâ†’error / Data : docs error â†’ **500**<br>**ì‹¤íŒ¨(ì •ì  ê²½ë¡œ ëˆ„ë½):** Auth pass / Page : docs initâ†’ready / Request : docs pendingâ†’error / Data : docs error â†’ **404** | [âœ…] |

---

<details>
  <summary>Phase 1 â€” health ì‹œë‚˜ë¦¬ì˜¤</summary>
  
#### 5.1-1 : `GET /healthz` ì‹œë‚˜ë¦¬ì˜¤
- **ì„±ê³µ**
  - When: í´ë¼ì´ì–¸íŠ¸ê°€ `GET /healthz` í˜¸ì¶œ, Swaggerì—ì„œë§Œ ì‹¤í–‰
  - Then: `200 OK`, JSON ë°”ë”” `{"status":"live","uptime_ms":..., "version":"v0.1.0"}`
  - ìƒíƒœì¶•: Auth=pass / Page=initâ†’ready / Request=pendingâ†’success / Data=present
- **ì‹¤íŒ¨**
  - When: í—¬ìŠ¤ í•¸ë“¤ëŸ¬ ë‚´ë¶€ ì˜ˆì™¸
  - Then: `500 Internal Server Error`, ì—ëŸ¬ ë°”ë”” `{"error":{"http_status":500,"code":"HEALTH_INTERNAL"}}`
  - ìƒíƒœì¶•: Auth=pass / Page=initâ†’ready / Request=pendingâ†’error / Data=error

---

#### 5.1-2 : `GET /docs` ì‹œë‚˜ë¦¬ì˜¤
- **ì„±ê³µ**
  - When: í´ë¼ì´ì–¸íŠ¸ê°€ `GET /docs` í˜¸ì¶œ, Swaggerì—ì„œë§Œ ì‹¤í–‰
  - Then: `200 OK`, Swagger UI ë Œë”ë§, **íƒœê·¸ ìˆœì„œê°€ userâ†’authâ†’videosâ†’lessonâ†’adminâ†’health**ë¡œ ë³´ì„
  - ìƒíƒœì¶•: Auth=pass / Page=initâ†’ready / Request=pendingâ†’success / Data=present
- **ì‹¤íŒ¨(ìŠ¤í‚¤ë§ˆ ì§‘ê³„ ì‹¤íŒ¨)**
  - When: OpenAPI ì§‘ê³„/ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì˜¤ë¥˜
  - Then: `500 Internal Server Error`, `{"error":{"http_status":500,"code":"DOCS_BUILD_FAIL"}}`
  - ìƒíƒœì¶•: Auth=pass / Page=initâ†’ready / Request=pendingâ†’error / Data=error
- **ì‹¤íŒ¨(ì •ì  ê²½ë¡œ ëˆ„ë½)**
  - When: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ/ì •ì  ê²½ë¡œ ë¯¸ì„¤ì •
  - Then: `404 Not Found`
  - ìƒíƒœì¶•: Auth=pass / Page=initâ†’ready / Request=pendingâ†’error / Data=error
</details>

---

### 5.2 Phase 2 â€” user âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ | 
|---|---|---|---|---|---|
| 2-1 | `POST /users` | `/signup` | íšŒì›ê°€ì… | ***USERS, USERS_LOG ì €ì¥ + ì„¸ì…˜/í† í° ë°œê¸‰***<br>ì„±ê³µ: Auth pass / Page signup initâ†’ready / Form signup pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request signup pendingâ†’success / Data signup present â†’ **201**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page signup initâ†’ready / Form signup pristineâ†’dirtyâ†’validatingâ†’error.client / Request signup pendingâ†’error / Data signup empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page signup initâ†’ready / Form signup pristineâ†’dirtyâ†’validatingâ†’error.client / Request signup pendingâ†’error / Data signup error â†’ **422**<br>ì‹¤íŒ¨(ì¤‘ë³µ/ì¶©ëŒ): Auth pass / Page signup initâ†’ready / Form signup pristineâ†’dirtyâ†’validatingâ†’error.conflict / Request signup pendingâ†’error / Data signup error â†’ **409**<br>ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹): Auth pass / Page signup ready / Form signup error.client / Request signup pendingâ†’error / Data signup error â†’ **429** | [âœ…ğŸ†—] |
| 2-2 | `GET /users/me` | `/me` | ë‚´ ì •ë³´ ì¡°íšŒ | ***USERS ì•ˆì „ í•„ë“œ(ë¹„ë°€ë²ˆí˜¸ ì œì™¸)***<br>ì„±ê³µ: Auth pass / Page me initâ†’ready / Request me pendingâ†’success / Data me present â†’ **200**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page me initâ†’ready / Request me pendingâ†’error / Data me error â†’ **401**<br>ì‹¤íŒ¨(ë¯¸ì¡´ì¬/ë¹„í™œì„±): Auth pass / Page me initâ†’ready / Request me pendingâ†’error / Data me error â†’ **404** | [âœ…ğŸ†—] |
| 2-3 | `POST /users/me` | `/me/edit` | ë‚´ ì •ë³´ ìˆ˜ì • | ***USERS ì¼ë¶€ ì—…ë°ì´íŠ¸ â†’ USERS_LOG ì €ì¥***<br>ì„±ê³µ: Auth pass / Page me_edit initâ†’ready / Form me_edit pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request me_edit pendingâ†’success / Data me_edit present â†’ **200**(ë˜ëŠ” **204**)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page me_edit initâ†’ready / Form me_edit pristineâ†’dirtyâ†’validatingâ†’error.client / Request me_edit pendingâ†’error / Data me_edit empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page me_edit initâ†’ready / Form me_edit pristineâ†’dirtyâ†’validatingâ†’error.client / Request me_edit pendingâ†’error / Data me_edit error â†’ **422**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page me_edit initâ†’ready / Request me_edit pendingâ†’error / Data me_edit error â†’ **401**<br>ì‹¤íŒ¨(ì¶©ëŒÂ·ê³ ìœ ì œì•½): Auth pass / Page me_edit initâ†’ready / Form me_edit pristineâ†’dirtyâ†’validatingâ†’error.conflict / Request me_edit pendingâ†’error / Data me_edit error â†’ **409** | [âœ…ğŸ†—] |
| 2-4 | `GET /users/me/settings` | `/settings` | ë‚´ ì„¤ì • ì¡°íšŒ | ***USERS_SETTING ì¡°íšŒ***<br>ì„±ê³µ: Auth pass / Page settings initâ†’ready / Request settings pendingâ†’success / Data settings present â†’ **200**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page settings initâ†’ready / Request settings pendingâ†’error / Data settings error â†’ **401** | [âœ…ğŸ†—] |
| 2-5 | `POST /users/me/settings` | `/settings` | ë‚´ ì„¤ì • ìˆ˜ì • | ***USERS_SETTING ìˆ˜ì • â†’ USERS_LOG ì €ì¥***<br>ì„±ê³µ: Auth pass / Page settings initâ†’ready / Form settings pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request settings pendingâ†’success / Data settings present â†’ **200**(ë˜ëŠ” **204**)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page settings initâ†’ready / Form settings pristineâ†’dirtyâ†’validatingâ†’error.client / Request settings pendingâ†’error / Data settings empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page settings initâ†’ready / Form settings pristineâ†’dirtyâ†’validatingâ†’error.client / Request settings pendingâ†’error / Data settings error â†’ **422**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page settings initâ†’ready / Request settings pendingâ†’error / Data settings error â†’ **401** | [âœ…ğŸ†—] |

---

<details>
  <summary>5.2 Phase 2 â€” user ì‹œë‚˜ë¦¬ì˜¤</summary>

#### ê³µí†µ ì •ì±…(1-1 ~ 1-5)
- **ì‘ë‹µ ì—ëŸ¬ ìŠ¤í‚¤ë§ˆ(ê³ ì •)**  
  `{ "error": { "http_status": 400|401|404|409|422|429|500, "code": "...", "message": "...", "details": { }, "trace_id": "..." } }`
- **ë¡œê·¸ ì •ì±…**: **ì„±ê³µ/ì‹¤íŒ¨ ëª¨ë‘ USERS_LOG ê¸°ë¡**(ë¯¼ê°ì •ë³´ ì œì™¸, ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ì½”ë“œ/ì‚¬ìœ  í¬í•¨)
- **ê²€ì¦ ê¸°ì¤€**: **400**=í˜•ì‹/ëˆ„ë½/íŒŒì‹±, **422**=ë„ë©”ì¸ ì œì•½ ìœ„ë°˜
- **ì¤‘ë³µ ì œì¶œ ë°©ì§€**: Form=`submitting` ë™ì•ˆ UI ì°¨ë‹¨ + ì„œë²„ ì‹œê°„/ì¡°ê±´ ê¸°ë°˜ ë°©ì§€
- **ë ˆì´íŠ¸ë¦¬ë°‹(ìš°ì„  ëŒ€ìƒ: 1-1)**: ê³¼ë„ ì‹œ **429** + `Retry-After`
- **ì„±ê³µ í›„ í˜ì´ì§€ ì „í™˜**: ì„±ê³µ ì‹œ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì—¬ **Form ìˆ˜ëª…ì£¼ê¸° ì¢…ë£Œ**

#### 5.2-1 : `POST /users` (íšŒì›ê°€ì…)
- **ì„±ê³µ â†’ 201 Created**
  - When: `/signup` í¼ ì…ë ¥ í›„ ì œì¶œì´ ì„œë²„ ê²€ì¦ì„ í†µê³¼í•œë‹¤
  - Then: **201**, `Location: /users/{id}`(ê¶Œì¥)
    - **Body**: `SignupRes` (ì•ˆì „í•œ ìœ ì € ì •ë³´ + **Access Token**, `session_id`)
    - **Cookie**: `ak_refresh` (**Refresh Token**, HttpOnly, Secure)
  - ìƒíƒœì¶•: Auth=pass / Page=`signup` initâ†’ready / **Form=`signup` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success** / Request=`signup` pendingâ†’success / Data=`signup` present
  - ë¡œê·¸: USERS insert í›„ **USERS_LOG(ì„±ê³µ ìŠ¤ëƒ…ìƒ·)** ê¸°ë¡(ë¯¼ê°ì •ë³´ ì œì™¸)
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400 Bad Request**
  - ì˜ˆ: ì´ë©”ì¼ í˜•ì‹ ë¶ˆì¼ì¹˜, í•„ìˆ˜ í•­ëª© ëˆ„ë½, JSON íŒŒì‹± ì˜¤ë¥˜
  - ìƒíƒœì¶•: Auth=pass / Page=`signup` initâ†’ready / **Form=`signup` â€¦ â†’ error.client** / Request=`signup` pendingâ†’error / **Data=`signup` empty**
  - ì—ëŸ¬ ë°”ë””: `{ "error": { "http_status": 400, "code": "BAD_REQUEST", "message": "...", "trace_id": "..." } }`
  - ë¡œê·¸: **USERS_LOG(ì‹¤íŒ¨ ì´ë²¤íŠ¸)** ê¸°ë¡(ì—ëŸ¬ì½”ë“œ/ì‚¬ìœ , ë¯¼ê°ê°’ ë§ˆìŠ¤í‚¹)
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422 Unprocessable Entity**
  - ì˜ˆ: birthday ë²”ìœ„ ìœ„ë°˜, ê¸ˆì§€ê°’, ì •ì±… ê·œì¹™ ìœ„ë°˜
  - ìƒíƒœì¶•: Auth=pass / Page=`signup` initâ†’ready / **Form=`signup` â€¦ â†’ error.client** / Request=`signup` pendingâ†’error / **Data=`signup` error**
  - ì—ëŸ¬ ë°”ë””: `http_status:422, code:"UNPROCESSABLE_ENTITY"`
  - ë¡œê·¸: ì‹¤íŒ¨ ì´ë²¤íŠ¸ ê¸°ë¡
- **ì‹¤íŒ¨(ì¤‘ë³µ/ì¶©ëŒ) â†’ 409 Conflict**
  - ì˜ˆ: ì´ë©”ì¼ UNIQUE ì¶©ëŒ
  - ìƒíƒœì¶•: Auth=pass / Page=`signup` initâ†’ready / **Form=`signup` â€¦ â†’ error.conflict** / Request=`signup` pendingâ†’error / **Data=`signup` error**
  - ì—ëŸ¬ ë°”ë””: `http_status:409, code:"CONFLICT"`
  - ë¡œê·¸: ì‹¤íŒ¨ ì´ë²¤íŠ¸ ê¸°ë¡
- **ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹) â†’ 429 Too Many Requests**
  - ì¡°ê±´: ê³¼ë„í•œ ê°€ì… ì‹œë„
  - ìƒíƒœì¶•: Auth=pass / Page=`signup` ready / **Form=`signup` error.client** / Request=`signup` pendingâ†’error / **Data=`signup` error**
  - í—¤ë”: `Retry-After: <seconds>`
  - ë¡œê·¸: ì‹¤íŒ¨ ì´ë²¤íŠ¸ + ì°¨ë‹¨ ì§€í‘œ
- **ì¤‘ë³µ ì œì¶œ ë°©ì§€(ì •ì±…)**
  - í”„ë¡ íŠ¸: **Form=submitting** ë™ì•ˆ ë²„íŠ¼/Enter ë¹„í™œì„±
  - ë°±ì—”ë“œ: ì‹œê°„/ì¡°ê±´ ê¸°ë°˜ ì¤‘ë³µ ìƒì„± ë°©ì§€(ìµœê·¼ Në¶„ ë™ì¼ ì´ë©”ì¼ ì¬ì‹œë„ ì‹œ 409 ë˜ëŠ” 200 ì¬ì‘ë‹µ ì •ì±… ì¤‘ íƒ1)

---

#### 5.2-2 : `GET /users/me` (ë‚´ ì •ë³´ ì¡°íšŒ)
- **ì„±ê³µ â†’ 200 OK**
  - When: ì¸ì¦ëœ ì‚¬ìš©ìê°€ `/me` í™”ë©´ì—ì„œ ìê¸° ì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤
  - Then: **200**, ì•ˆì „ í•„ë“œë§Œ ë°˜í™˜(ë¹„ë°€ë²ˆí˜¸Â·í•´ì‹œÂ·í† í° ì œì™¸)
  - ìƒíƒœì¶•: Auth=pass / Page=`me` initâ†’ready / Request=`me` pendingâ†’success / **Data=`me` present**
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ 401 Unauthorized**
  - When: í† í° ì—†ìŒ/ë§Œë£Œ/ì„œëª… ì˜¤ë¥˜
  - Then: **401**, `WWW-Authenticate: Bearer ...`
  - ìƒíƒœì¶•: **Auth=stop** / Page=`me` initâ†’ready / Request=`me` pendingâ†’error / **Data=`me` error**
- **ì‹¤íŒ¨(ë¯¸ì¡´ì¬/ë¹„í™œì„±) â†’ 404 Not Found**
  - When: í† í°ì€ ìœ íš¨í•˜ë‚˜ ì‚¬ìš©ì ê³„ì •ì´ ë¹„í™œì„±/ì‚­ì œ ì²˜ë¦¬ë˜ì–´ ì¡°íšŒ ë¶ˆê°€
  - Then: **404**
  - ìƒíƒœì¶•: Auth=pass / Page=`me` initâ†’ready / Request=`me` pendingâ†’error / **Data=`me` error**

---

#### 5.2-3 : `POST /users/me` (ë‚´ ì •ë³´ ìˆ˜ì •)
- **ì„±ê³µ â†’ 200 OK(ë˜ëŠ” 204)**
  - When: `/me/edit` í¼ ì…ë ¥ í›„ ì œì¶œì´ ì„œë²„ ê²€ì¦ì„ í†µê³¼í•œë‹¤
  - Then: **200**(ë³€ê²½ í›„ ìŠ¤ëƒ…ìƒ· ë°”ë””) **ë˜ëŠ” 204**, USERS ì—…ë°ì´íŠ¸ í›„ **USERS_LOG(ì„±ê³µ ìŠ¤ëƒ…ìƒ·)** ê¸°ë¡
  - ìƒíƒœì¶•: Auth=pass / Page=`me_edit` initâ†’ready / **Form=`me_edit` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success** / Request=`me_edit` pendingâ†’success / **Data=`me_edit` present**
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400 Bad Request**
  - ì˜ˆ: ì´ë©”ì¼ í¬ë§· ì˜¤ë¥˜, í•„ìˆ˜ í•„ë“œ ëˆ„ë½, JSON íŒŒì‹± ì‹¤íŒ¨
  - ìƒíƒœì¶•: Auth=pass / Page=`me_edit` initâ†’ready / **Form=`me_edit` â€¦ â†’ error.client** / Request=`me_edit` pendingâ†’error / **Data=`me_edit` empty**
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422 Unprocessable Entity**
  - ì˜ˆ: birthday ë²”ìœ„ ìœ„ë°˜, í—ˆìš©ë˜ì§€ ì•Šì€ locale ê°’ ë“±
  - ìƒíƒœì¶•: Auth=pass / Page=`me_edit` initâ†’ready / **Form=`me_edit` â€¦ â†’ error.client** / Request=`me_edit` pendingâ†’error / **Data=`me_edit` error**
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ 401 Unauthorized**
  - When: í† í° ì—†ìŒ/ë§Œë£Œ
  - ìƒíƒœì¶•: **Auth=stop** / Page=`me_edit` initâ†’ready / Request=`me_edit` pendingâ†’error / **Data=`me_edit` error**
- **ì‹¤íŒ¨(ì¶©ëŒ/ê³ ìœ ì œì•½) â†’ 409 Conflict**
  - ì˜ˆ: ë‹‰ë„¤ì„/ì´ë©”ì¼ ê³ ìœ  ì œì•½ ì¶©ëŒ ì •ì±…ì„ í—ˆìš©í•˜ëŠ” ê²½ìš°
  - ìƒíƒœì¶•: Auth=pass / Page=`me_edit` initâ†’ready / **Form=`me_edit` â€¦ â†’ error.conflict** / Request=`me_edit` pendingâ†’error / **Data=`me_edit` error**

---

#### 5.2-4 : `GET /users/me/settings` (ë‚´ ì„¤ì • ì¡°íšŒ)
- **ì„±ê³µ â†’ 200 OK**
  - When: ì¸ì¦ëœ ì‚¬ìš©ìê°€ `/settings`ì—ì„œ ì„¤ì •ì„ ì¡°íšŒí•œë‹¤
  - Then: **200**, USERS_SETTING ë°˜í™˜
  - ìƒíƒœì¶•: Auth=pass / Page=`settings` initâ†’ready / Request=`settings` pendingâ†’success / **Data=`settings` present**
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ 401 Unauthorized**
  - When: í† í° ì—†ìŒ/ë§Œë£Œ
  - Then: **401**
  - ìƒíƒœì¶•: **Auth=stop** / Page=`settings` initâ†’ready / Request=`settings` pendingâ†’error / **Data=`settings` error**

---

#### 5.2-5 : `POST /users/me/settings` (ë‚´ ì„¤ì • ìˆ˜ì •)
- **ì„±ê³µ â†’ 200 OK(ë˜ëŠ” 204)**
  - When: `/settings` í¼ ì…ë ¥ í›„ ì œì¶œì´ ì„œë²„ ê²€ì¦ì„ í†µê³¼í•œë‹¤
  - Then: **200**(ìµœì‹  ì„¤ì • ë°˜í™˜) **ë˜ëŠ” 204**, USERS_SETTING ìˆ˜ì • í›„ **USERS_LOG(ì„±ê³µ ìŠ¤ëƒ…ìƒ·)** ê¸°ë¡
  - ìƒíƒœì¶•: Auth=pass / Page=`settings` initâ†’ready / **Form=`settings` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success** / Request=`settings` pendingâ†’success / **Data=`settings` present**
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400 Bad Request**
  - ì˜ˆ: í•„ìˆ˜ ì„¤ì • ëˆ„ë½, JSON íŒŒì‹± ì‹¤íŒ¨
  - ìƒíƒœì¶•: Auth=pass / Page=`settings` initâ†’ready / **Form=`settings` â€¦ â†’ error.client** / Request=`settings` pendingâ†’error / **Data=`settings` empty**
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422 Unprocessable Entity**
  - ì˜ˆ: ì–¸ì–´ ì½”ë“œ ë²”ìœ„/ìš°ì„ ìˆœìœ„ ê·œì¹™ ìœ„ë°˜(ì„ í˜¸ ì–¸ì–´ ë°°ì—´ ìœ íš¨ì„±)
  - ìƒíƒœì¶•: Auth=pass / Page=`settings` initâ†’ready / **Form=`settings` â€¦ â†’ error.client** / Request=`settings` pendingâ†’error / **Data=`settings` error**
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ 401 Unauthorized**
  - When: í† í° ì—†ìŒ/ë§Œë£Œ
  - Then: **401**
  - ìƒíƒœì¶•: **Auth=stop** / Page=`settings` initâ†’ready / Request=`settings` pendingâ†’error / **Data=`settings` error**
</details>

---

### 5.3 Phase 3 â€” auth âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ | 
|---|---|---|---|---|---|
| 3-1 | `POST /auth/login` | `/login` | ë¡œê·¸ì¸ | ***LOGIN/LOGIN_LOG ì €ì¥ + Redis ì„¸ì…˜/ë¦¬í”„ë ˆì‹œ ë°œê¸‰***<br>ì„±ê³µ: Auth pass / Page login initâ†’ready / Form login pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request login pendingâ†’success / Data login present â†’ **200**(ë˜ëŠ” **204**)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page login initâ†’ready / Form login pristineâ†’dirtyâ†’validatingâ†’error.client / Request login pendingâ†’error / Data login empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page login initâ†’ready / Form login pristineâ†’dirtyâ†’validatingâ†’error.client / Request login pendingâ†’error / Data login error â†’ **422**<br>ì‹¤íŒ¨(ìê²©ì¦ëª… ë¶ˆì¼ì¹˜): Auth stop / Page login ready / Form login error.client / Request login pendingâ†’error / Data login error â†’ **401**<br>ì‹¤íŒ¨(ê³„ì • ìƒíƒœ/ì°¨ë‹¨): Auth forbid / Page login ready / Form login error.client / Request login pendingâ†’error / Data login error â†’ **403**(ë˜ëŠ” **423**)<br>ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹): Auth pass / Page login ready / Form login error.client / Request login pendingâ†’error / Data login error â†’ **429** | [âœ…ğŸ†—] | 
| 3-2 | `POST /auth/logout` | `/logout` | ë¡œê·¸ì•„ì›ƒ | ***ì„¸ì…˜/ë¦¬í”„ë ˆì‹œ í‚¤ ì œê±°, LOGIN_LOG ì €ì¥***<br>ì„±ê³µ: Auth pass / Page logout ready / Request logout pendingâ†’success / Data logout present â†’ **204**(ë˜ëŠ” **200**)<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦/ì„¸ì…˜ ì—†ìŒ): Auth stop / Page logout ready / Request logout pendingâ†’error / Data logout error â†’ **401** | [âœ…ğŸ†—] |
| 3-3 | `POST /auth/refresh` | (ì „ì—­ì²˜ë¦¬) | í† í° ì¬ë°œê¸‰ | ***ë¦¬í”„ë ˆì‹œ ë¡œí…Œì´ì…˜/ê²€ì¦/ì¬ì‚¬ìš©íƒì§€ + ë¡œê·¸(rotate)***<br>ì„±ê³µ: Auth pass / Page app ready / Request refresh pendingâ†’success / Data refresh present â†’ **200**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page app ready / Request refresh pendingâ†’error / Data refresh empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page app ready / Request refresh pendingâ†’error / Data refresh error â†’ **422**<br>ì‹¤íŒ¨(ë¦¬í”„ë ˆì‹œ ë¬´íš¨/ë§Œë£Œ): Auth stop / Page app ready / Request refresh pendingâ†’error / Data refresh error â†’ **401**<br>ì‹¤íŒ¨(ì¬ì‚¬ìš©íƒì§€/ìœ„ì¡°): Auth forbid / Page app ready / Request refresh pendingâ†’error / Data refresh error â†’ **409**(ë˜ëŠ” **403**) | [âœ…ğŸ†—] |
| 3-4 | `POST /auth/find-id` | `/find-id` | íšŒì› ì•„ì´ë”” ì°¾ê¸° | ***ê°œì¸ì •ë³´ ë³´í˜¸: ê²°ê³¼ í­ë¡œ ê¸ˆì§€(Enumeration Safe), USERS_LOG ì €ì¥***<br>ì„±ê³µ(ìš”ì²­ ìˆ˜ë½/ì¡´ì¬ ì—¬ë¶€ì™€ ë¬´ê´€):<br> Auth pass / Page find_id initâ†’ready / Form find_id pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request find_id pendingâ†’success / Data find_id present â†’ **200**(í•­ìƒ ë™ì¼ ë©”ì‹œì§€)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page find_id initâ†’ready / Form find_id pristineâ†’dirtyâ†’validatingâ†’error.client / Request find_id pendingâ†’error / Data find_id empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page find_id initâ†’ready / Form find_id pristineâ†’dirtyâ†’validatingâ†’error.client / Request find_id pendingâ†’error / Data find_id error â†’ **422**<br>ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹): Auth pass / Page find_id ready / Form find_id error.client / Request find_id pendingâ†’error / Data find_id error â†’ **429** | [âœ…ğŸ†—] |
| 3-5 | `POST /auth/reset-pw` | `/reset-password` | íšŒì› ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • | ***ìš”ì²­â†’ê²€ì¦â†’ì¬ì„¤ì •ì˜ ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸(í† í°/ì½”ë“œ í¬í•¨), USERS_LOG ì €ì¥***<br>ì„±ê³µ(ì¬ì„¤ì • ì™„ë£Œ):<br> Auth pass / Page reset_pw initâ†’ready / Form reset_pw pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request reset_pw pendingâ†’success / Data reset_pw present â†’ **200**(ë˜ëŠ” **204**)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass / Page reset_pw initâ†’ready / Form reset_pw pristineâ†’dirtyâ†’validatingâ†’error.client / Request reset_pw pendingâ†’error / Data reset_pw empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass / Page reset_pw initâ†’ready / Form reset_pw pristineâ†’dirtyâ†’validatingâ†’error.client / Request reset_pw pendingâ†’error / Data reset_pw error â†’ **422**<br>ì‹¤íŒ¨(í† í°/ì½”ë“œ ë¬´íš¨Â·ë§Œë£Œ): Auth stop / Page reset_pw ready / Form reset_pw error.client / Request reset_pw pendingâ†’error / Data reset_pw error â†’ **401**<br>ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹): Auth pass / Page reset_pw ready / Form reset_pw error.client / Request reset_pw pendingâ†’error / Data reset_pw error â†’ **429** | [âœ…ğŸ†—] |
| 3-6 | `GET /auth/google`<br>`GET /auth/google/callback` | `/login` | Google OAuth ë¡œê·¸ì¸ | ***Google OAuth 2.0 Authorization Code Flow, ìë™ ê³„ì • ì—°ê²°/ìƒì„±, USER_OAUTH/LOGIN/LOGIN_LOG ì €ì¥***<br>ì„±ê³µ(OAuth ì‹œì‘): Auth pass / Page login ready / Request google pendingâ†’success / Data google_auth_url present â†’ **200**<br>ì„±ê³µ(OAuth ì½œë°±): Auth pass / Page login redirectâ†’ready / Request callback pendingâ†’success / Data login present â†’ **302**(í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸)<br>ì‹¤íŒ¨(OAuth ì„¤ì • ëˆ„ë½): Auth pass / Page login ready / Request google pendingâ†’error / Data google error â†’ **500**<br>ì‹¤íŒ¨(State ê²€ì¦ ì‹¤íŒ¨/CSRF): Auth stop / Page login ready / Request callback pendingâ†’error / Data callback error â†’ **401**<br>ì‹¤íŒ¨(ì‚¬ìš©ì ì·¨ì†Œ): Auth pass / Page login ready / Request callback pendingâ†’error / Data callback error â†’ **302**(ì—ëŸ¬ ì •ë³´ì™€ í•¨ê»˜ ë¦¬ë‹¤ì´ë ‰íŠ¸) | [âœ…ğŸ†—] |

---

<details>
  <summary>5.3 Phase 3 â€” auth ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ (5.3-1 ~ 5.3-6)</summary>

#### ê³µí†µ ì •ì±…(5.3-1 ~ 5.3-6)
- **ì—ëŸ¬ ë°”ë””(ê³ ì •)**  
  `{ "error": { "http_status": 400|401|403|409|422|429|500, "code": "...", "message": "...", "details": { }, "trace_id": "..." } }`
- **ë¡œê·¸**: ì„±ê³µ/ì‹¤íŒ¨ ëª¨ë‘ ì´ë²¤íŠ¸ ê¸°ë¡  
  - `LOGIN`(ì„±ê³µ ìƒíƒœ), `LOGIN_LOG`(ì„±ê³µ/ì‹¤íŒ¨, ì›ì¸, IP/UA ë“±), ì‚¬ìš©ì ê´€ë ¨ ë³€ê²½ì€ `USERS_LOG`  
- **ê²€ì¦ ê¸°ì¤€**: **400**=í˜•ì‹Â·ëˆ„ë½Â·íŒŒì‹±, **422**=ë„ë©”ì¸ ì œì•½(ê¸¸ì´Â·íŒ¨í„´Â·ì •ì±… ìœ„ë°˜)  
- **ë ˆì´íŠ¸ë¦¬ë°‹**: ë¡œê·¸ì¸/ë¹„ë²ˆì¬ì„¤ì •/ì•„ì´ë””ì°¾ê¸°ì—” **429 + Retry-After**  
- **ë³´ì•ˆ**: Enumeration Safe(ì•„ì´ë”” ì°¾ê¸°/ì¬ì„¤ì •ì€ ê²°ê³¼ ë…¸ì¶œ ì—†ì´ ë™ì¼ ì‘ë‹µ ë¬¸êµ¬)

---

#### 5.3-1 : `POST /auth/login` (ë¡œê·¸ì¸)
- **ì„±ê³µ â†’ 200 OK(ë˜ëŠ” 204)**  
  - When: `/login`ì—ì„œ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì œì¶œ(ê²€ì¦ í†µê³¼)  
  - Then: **200**(ë˜ëŠ” **204**), ì•¡ì„¸ìŠ¤ í† í°Â·ë¦¬í”„ë ˆì‹œ í† í° ë°œê¸‰(ì¿ í‚¤/í—¤ë”), Redis ì„¸ì…˜ ë° ë¦¬í”„ë ˆì‹œ í‚¤ ì €ì¥, `LOGIN`/`LOGIN_LOG` ê¸°ë¡  
  - ìƒíƒœì¶•: Auth=pass / Page=`login` initâ†’ready / **Form=`login` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success** / Request=`login` pendingâ†’success / Data=`login` present / Session=active
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400**  
  - ì˜ˆ: ì´ë©”ì¼ í¬ë§· ë¶ˆì¼ì¹˜, í•„ìˆ˜ í•„ë“œ ëˆ„ë½, JSON íŒŒì‹± ì‹¤íŒ¨  
  - ìƒíƒœì¶•: Form=`login` â€¦ â†’ error.client / Request â€¦ â†’ error / Data=empty
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422**  
  - ì˜ˆ: í—ˆìš©ë˜ì§€ ì•Šì€ ë¡œê·¸ì¸ ë°©ì‹, ë¹„ë°€ë²ˆí˜¸ ì •ì±… ìœ„ë°˜(í´ë¼ì´ì–¸íŠ¸ ê°•í™” ê²€ì¦)  
- **ì‹¤íŒ¨(ìê²©ì¦ëª… ë¶ˆì¼ì¹˜) â†’ 401**  
  - ì˜ˆ: ì´ë©”ì¼ ì¡´ì¬í•˜ì§€ë§Œ ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜, ê³„ì • ì—†ìŒ  
  - ìƒíƒœì¶•: Auth=stop / Form error.client / Data error  
- **ì‹¤íŒ¨(ê³„ì • ìƒíƒœ/ì°¨ë‹¨) â†’ 403(ë˜ëŠ” 423)**  
  - ì˜ˆ: user_stateâ‰ 'on', ì„ì‹œ ì ê¸ˆ(ì—¬ëŸ¬ ì‹¤íŒ¨ ì‹œë„ í›„)  
- **ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹) â†’ 429**
  - í—¤ë”: `Retry-After: <seconds>`
- **ì‹¤íŒ¨(ì†Œì…œ ì „ìš© ê³„ì •) â†’ 401** (ë³„ë„ ì—ëŸ¬ ì½”ë“œ)
  - When: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ ì‹œë„, í•´ë‹¹ ì´ë©”ì¼ì´ ì†Œì…œ ë¡œê·¸ì¸ ì „ìš© ê³„ì •ì¸ ê²½ìš°
  - Then: **401**, `{ "error": { "code": "UNAUTHORIZED", "message": "AUTH_401_SOCIAL_ONLY_ACCOUNT:google" } }`
  - í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬: ì†Œì…œ ë¡œê·¸ì¸ ìœ ë„ UI í‘œì‹œ (amber ìƒ‰ìƒ ì•ˆë‚´ ë°•ìŠ¤ + Google ë¡œê·¸ì¸ ë²„íŠ¼)
  - ìƒíƒœì¶•: Auth=stop / Form error.client / Data error (socialOnlyError)

---

#### 5.3-2 : `POST /auth/logout` (ë¡œê·¸ì•„ì›ƒ)
- **ì„±ê³µ â†’ 204 No Content(ë˜ëŠ” 200)**  
  - When: ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒ íŠ¸ë¦¬ê±°  
  - Then: **204**, Redisì˜ ì„¸ì…˜/ë¦¬í”„ë ˆì‹œ í‚¤ ì œê±°, `LOGIN_LOG`(logout ì´ë²¤íŠ¸) ê¸°ë¡  
  - ìƒíƒœì¶•: Auth=pass / Page=`logout` ready / Request=`logout` pendingâ†’success / Data=`logout` present / Session=expired
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦/ì„¸ì…˜ ì—†ìŒ) â†’ 401**  
  - ì˜ˆ: ìœ íš¨í•œ ì„¸ì…˜/í† í° ì—†ì´ í˜¸ì¶œ

---

#### 5.3-3 : `POST /auth/refresh` (í† í° ì¬ë°œê¸‰)
- **ì„±ê³µ â†’ 200 OK**  
  - When: ë°±ê·¸ë¼ìš´ë“œ í† í° ë§Œë£Œ ì„ë°•/ë§Œë£Œ í›„ ë¦¬í”„ë ˆì‹œ ì œì¶œ  
  - Then: **200**, ìƒˆ ì•¡ì„¸ìŠ¤/ë¦¬í”„ë ˆì‹œ ë°œê¸‰(ë¡œí…Œì´ì…˜), Redis: `ak:refresh:<hash> -> <new_session_id>` ê°±ì‹ , rotate ë¡œê·¸ ê¸°ë¡  
  - ìƒíƒœì¶•: Auth=pass / Page=app ready / Request=`refresh` pendingâ†’success / Data=`refresh` present / Session=active
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400**  
  - ì˜ˆ: ë¦¬í”„ë ˆì‹œ í† í° í—¤ë”/ì¿ í‚¤ ëˆ„ë½  
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422**  
  - ì˜ˆ: í—ˆìš©ë˜ì§€ ì•Šì€ í´ë¼ì´ì–¸íŠ¸/ë””ë°”ì´ìŠ¤ ì¡°í•©  
- **ì‹¤íŒ¨(ë¬´íš¨/ë§Œë£Œ) â†’ 401**  
  - ì˜ˆ: ë§Œë£ŒÂ·íê¸°ëœ ë¦¬í”„ë ˆì‹œ, ì„œëª… ê²€ì¦ ì‹¤íŒ¨  
- **ì‹¤íŒ¨(ì¬ì‚¬ìš©íƒì§€/ìœ„ì¡°) â†’ 409(ë˜ëŠ” 403)**  
  - ì •ì±…: ì¬ì‚¬ìš© íƒì§€ ì‹œ ê¸°ì¡´ ì„¸ì…˜ ë¬´íš¨í™” + ì•Œë¦¼/ë¡œê·¸ì¸ ê°•ì œ

---

#### 5.3-4 : `POST /auth/find_id` (íšŒì› ì•„ì´ë”” ì°¾ê¸°)
- ì„±ê³µ â†’ **200**
  - When: `/find-id`ì—ì„œ ì‹ë³„ ì •ë³´(ì´ë¦„ + ì´ë©”ì¼)ë¥¼ ì…ë ¥í•˜ê³  ì œì¶œí•œë‹¤
  - Then: **200**, â€œì¼ì¹˜ ì‹œ ë“±ë¡ëœ ì´ë©”ì¼ë¡œ ì•ˆë‚´ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤â€ **ê°™ì€ ë¬¸êµ¬**ë¡œ í•­ìƒ ì‘ë‹µ(Enumeration Safe), `USERS_LOG` ê¸°ë¡
  - ìƒíƒœì¶•: Auth=pass / Page=`find_id` initâ†’ready / Form=`find_id` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request=`find_id` pendingâ†’success / Data=`find_id` present
- ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ **400**
  - ì˜ˆ: í•„ìˆ˜ ì…ë ¥ ëˆ„ë½, í˜•ì‹ ë¶ˆì¼ì¹˜(ê¸€ì/ìˆ«ì/ì´ë©”ì¼ íŒ¨í„´ ë“±), JSON íŒŒì‹± ì˜¤ë¥˜
  - ìƒíƒœì¶•: Auth=pass / Page=`find_id` initâ†’ready / Form=`find_id` â€¦ â†’ error.client / Request=`find_id` pendingâ†’error / Data=`find_id` empty
- ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹) â†’ **429**
  - ì¡°ê±´: ê³¼ë„í•œ ì‹œë„ ê°ì§€ ì‹œ
  - í—¤ë”: `Retry-After: <seconds>`
  - ìƒíƒœì¶•: Auth=pass / Page=`find_id` ready / Form=`find_id` error.client / Request=`find_id` pendingâ†’error / Data=`find_id` error

---

#### 5.3-5 : `POST /auth/reset_pw` (íšŒì› ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •)
- **ì„±ê³µ(ì¬ì„¤ì • ì™„ë£Œ) â†’ 200 OK(ë˜ëŠ” 204)**
  - When: `/reset-password`ì—ì„œ í† í°/ì½”ë“œ + ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì œì¶œ
  - Then: **200**(ë˜ëŠ” **204**), ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ê°±ì‹ , ê´€ë ¨ ì„¸ì…˜ ì „ë¶€ ë¬´íš¨í™”(ë³´ì•ˆ), `USERS_LOG` ê¸°ë¡
  - ìƒíƒœì¶•: Auth=pass / Page=`reset_pw` initâ†’ready / **Form=`reset_pw` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success** / Request=`reset_pw` pendingâ†’success / Data=`reset_pw` present / Session=rotatingâ†’active
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400**, **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422**
  - ì˜ˆ: ë¹„ë°€ë²ˆí˜¸ ê·œì¹™ ìœ„ë°˜(ê¸¸ì´/ë³µì¡ì„±), í•„ìˆ˜ ëˆ„ë½
- **ì‹¤íŒ¨(í† í°/ì½”ë“œ ë¬´íš¨Â·ë§Œë£Œ) â†’ 401**
  - ì˜ˆ: ë§Œë£Œ ì½”ë“œ, ìœ„ì¡° í† í°
- **ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹) â†’ 429**

---

#### 5.3-6 : `GET /auth/google` & `GET /auth/google/callback` (Google OAuth ë¡œê·¸ì¸)

> **ê°œìš”**: Google OAuth 2.0 Authorization Code Flowë¥¼ í†µí•œ ì†Œì…œ ë¡œê·¸ì¸. ê¸°ì¡´ ì´ë©”ì¼ ê³„ì • ìë™ ì—°ê²°, ì‹ ê·œ ì‚¬ìš©ì ìë™ ê°€ì… ì§€ì›.

**ì—”ë“œí¬ì¸íŠ¸ êµ¬ì„±**:
| ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… |
|-----------|------|
| `GET /auth/google` | OAuth ì¸ì¦ URL ë°˜í™˜ (state/nonce í¬í•¨) |
| `GET /auth/google/callback` | Google ì½œë°± ì²˜ë¦¬ â†’ í† í° ë°œê¸‰ â†’ í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

**DB í…Œì´ë¸”**:
- `USER_OAUTH`: OAuth Provider ì—°ê²° ì •ë³´ (user_id, provider, subject, email, name, picture)
- `LOGIN` / `LOGIN_LOG`: ë¡œê·¸ì¸ ì„¸ì…˜ ë° ì´ë ¥ ê¸°ë¡ (login_method = 'google')

**ë³´ì•ˆ ì •ì±…**:
- **State íŒŒë¼ë¯¸í„°**: Redisì— ì €ì¥, ì¼íšŒìš© (CSRF ë°©ì§€)
- **Nonce**: ID Tokenì— í¬í•¨, Replay Attack ë°©ì§€
- **JWKS ì„œëª… ê²€ì¦**: Google JWKS ê³µê°œí‚¤ë¡œ RS256 ì„œëª… ê²€ì¦ (kid ë§¤ì¹­)
- **Audience ê²€ì¦**: ID Tokenì˜ audê°€ client_idì™€ ì¼ì¹˜í•´ì•¼ í•¨
- **Issuer ê²€ì¦**: `accounts.google.com` í™•ì¸

---

##### OAuth ì‹œì‘ (`GET /auth/google`)
- **ì„±ê³µ â†’ 200 OK**
  - When: í”„ë¡ íŠ¸ì—”ë“œê°€ "Googleë¡œ ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œ
  - Then: **200**, `{ auth_url: "https://accounts.google.com/o/oauth2/v2/auth?..." }` ë°˜í™˜
  - ì²˜ë¦¬: State/Nonce ìƒì„± â†’ Redis ì €ì¥ (TTL: 300ì´ˆ) â†’ auth_url êµ¬ì„±
  - ìƒíƒœì¶•: Auth=pass / Page=`login` ready / Request=`google` pendingâ†’success / Data=`google_auth_url` present

- **ì‹¤íŒ¨(OAuth ì„¤ì • ëˆ„ë½) â†’ 500**
  - ì˜ˆ: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_REDIRECT_URI í™˜ê²½ë³€ìˆ˜ ë¯¸ì„¤ì •
  - ìƒíƒœì¶•: Request=`google` pendingâ†’error / Data=`google` error

##### OAuth ì½œë°± (`GET /auth/google/callback`)
- **ì„±ê³µ(ë¡œê·¸ì¸/ê°€ì… ì™„ë£Œ) â†’ 302 Redirect**
  - When: Google ì¸ì¦ ì™„ë£Œ í›„ ì½œë°± ë„ì°© (`?code=xxx&state=xxx`)
  - Then: **302**, í”„ë¡ íŠ¸ì—”ë“œ `/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (`?login=success&user_id=xxx&is_new_user=true|false`)
  - ì²˜ë¦¬ ìˆœì„œ:
    1. State ê²€ì¦ (Redis ì¡°íšŒ â†’ ì‚­ì œ)
    2. Authorization Code â†’ Token êµí™˜ (Google API)
    3. ID Token ë””ì½”ë”© ë° ê²€ì¦ (JWKS RS256 ì„œëª…, nonce, aud, iss, exp)
    4. ì‚¬ìš©ì ì¡°íšŒ/ìƒì„±:
       - OAuth subjectë¡œ ê¸°ì¡´ ì—°ê²° ì¡°íšŒ â†’ ìˆìœ¼ë©´ ë¡œê·¸ì¸ (`is_new_user=false`)
       - ì—†ìœ¼ë©´ ì´ë©”ì¼ë¡œ ê¸°ì¡´ ê³„ì • ì¡°íšŒ â†’ ìˆìœ¼ë©´ ìë™ ì—°ê²° (`is_new_user=false`)
       - ì—†ìœ¼ë©´ ì‹ ê·œ ê³„ì • ìƒì„± (`is_new_user=true`)
    5. ì„¸ì…˜ ìƒì„± (JWT + Refresh Cookie)
    6. `LOGIN`, `LOGIN_LOG` ê¸°ë¡
  - **ì‹ ê·œ OAuth ì‚¬ìš©ì ê¸°ë³¸ê°’**:
    | í•„ë“œ | ê¸°ë³¸ê°’ | ë¹„ê³  |
    |------|--------|------|
    | `user_birthday` | `CURRENT_DATE` | ê°€ì…ì¼ (ë¯¸ì„¤ì • í‘œì‹œìš©) |
    | `user_gender` | `none` | ë¯¸ì„¤ì • |
    | `user_country` | `Unknown` | ë¯¸ì„¤ì • |
    | `user_language` | `ko` | í•œêµ­ì–´ (ì„œë¹„ìŠ¤ ê¸°ë³¸) |
    | `user_check_email` | `true` | Google ì´ë©”ì¼ ì¸ì¦ë¨ |
    | `user_password` | `NULL` | ì†Œì…œ ì „ìš© ê³„ì • |
  - ìƒíƒœì¶•: Auth=pass / Page=`login` redirectâ†’ready / Request=`callback` pendingâ†’success / Data=`login` present / Session=active

- **ì‹¤íŒ¨(State ê²€ì¦ ì‹¤íŒ¨) â†’ 302 Redirect (ì—ëŸ¬)**
  - ì˜ˆ: ë§Œë£Œëœ state, ìœ„ì¡°ëœ state (CSRF ì‹œë„)
  - Then: í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (`?error=oauth_failed&error_description=AUTH_401_INVALID_OAUTH_STATE`)
  - ìƒíƒœì¶•: Auth=stop / Request=`callback` pendingâ†’error

- **ì‹¤íŒ¨(Nonce ê²€ì¦ ì‹¤íŒ¨) â†’ 302 Redirect (ì—ëŸ¬)**
  - ì˜ˆ: ID Tokenì˜ nonceê°€ ì €ì¥ëœ ê°’ê³¼ ë¶ˆì¼ì¹˜ (Replay Attack)
  - Then: í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (`?error=oauth_failed&error_description=AUTH_401_INVALID_NONCE`)

- **ì‹¤íŒ¨(ì‚¬ìš©ì ì·¨ì†Œ) â†’ 302 Redirect (ì—ëŸ¬)**
  - When: Google ë™ì˜ í™”ë©´ì—ì„œ ì‚¬ìš©ìê°€ ì·¨ì†Œ
  - Then: í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (`?error=oauth_error&error_description=access_denied: ...`)

##### ì‘ë‹µ ìŠ¤í‚¤ë§ˆ

**GoogleAuthUrlRes (OAuth ì‹œì‘ ì‘ë‹µ)**
```json
{
  "auth_url": "https://accounts.google.com/o/oauth2/v2/auth?client_id=...&redirect_uri=...&response_type=code&scope=openid+email+profile&state=...&nonce=...&access_type=offline&prompt=consent"
}
```

**OAuth ì½œë°± ì„±ê³µ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸**
```
302 Found
Location: http://localhost:5173/login?login=success&user_id=123&is_new_user=true
Set-Cookie: ak_refresh=...; Path=/; HttpOnly; ...
```

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|----------|-----|------|
| `login` | `success` | ë¡œê·¸ì¸/ê°€ì… ì„±ê³µ |
| `user_id` | `123` | ì‚¬ìš©ì ID |
| `is_new_user` | `true` / `false` | ì‹ ê·œ ê°€ì… ì—¬ë¶€ |

**í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¶„ê¸°**:
- `is_new_user=true` â†’ `/user/me?welcome=true` (ë§ˆì´í˜ì´ì§€ + í™˜ì˜ ë©”ì‹œì§€)
- `is_new_user=false` â†’ `/about` (ì†Œê°œ í˜ì´ì§€)

**OAuth ì½œë°± ì‹¤íŒ¨ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸**
```
302 Found
Location: http://localhost:5173/login?error=oauth_failed&error_description=...
```

---

##### í”„ë¡ íŠ¸ì—”ë“œ OAuth ì½œë°± ì²˜ë¦¬

**Hook**: `useOAuthCallback` (`frontend/src/category/auth/hook/use_oauth_callback.ts`)

**ì²˜ë¦¬ íë¦„**:
1. LoginPage ë§ˆìš´íŠ¸ ì‹œ URL íŒŒë¼ë¯¸í„° í™•ì¸ (`login`, `is_new_user`, `error`)
2. ì—ëŸ¬ íŒŒë¼ë¯¸í„° ìˆìœ¼ë©´ â†’ í† ìŠ¤íŠ¸ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
3. ì„±ê³µ íŒŒë¼ë¯¸í„° ìˆìœ¼ë©´:
   - `refreshToken()` í˜¸ì¶œí•˜ì—¬ access_token íšë“
   - `useAuthStore.login()` í˜¸ì¶œí•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœ ì €ì¥
   - `is_new_user` ê°’ì— ë”°ë¼ ì ì ˆí•œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

**ê²½ìŸ ì¡°ê±´(Race Condition) ì²˜ë¦¬**:
- axios interceptorì™€ OAuth ì½œë°± ì²˜ë¦¬ê°€ ë™ì‹œì— `refreshToken()`ì„ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ
- Refresh Token Rotationìœ¼ë¡œ ì¸í•´ í›„ìê°€ 409 Conflict ë°œìƒ ê°€ëŠ¥
- í•´ê²°: `refreshToken()` ì‹¤íŒ¨ ì‹œ `isLoggedIn` ìƒíƒœ í™•ì¸ â†’ trueë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì§„í–‰

</details>

---

### 5.4 Phase 4 â€” video âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ |
|---|---|---|---|---|---|
| 4-1 | `GET /videos` | `/videos` | ë¹„ë””ì˜¤ ëª©ë¡ | ***`video_url_vimeo` ë¶ˆëŸ¬ì˜¤ê¸°, í˜ì´ì§€ë„¤ì´ì…˜***<br>ì„±ê³µ(ë°ì´í„° ìˆìŒ): Auth pass ë˜ëŠ” stop / Page videos initâ†’ready / Request videos pendingâ†’success / Data videos present â†’ **200**<br>ì„±ê³µ(ë°ì´í„° ì—†ìŒ): Auth pass ë˜ëŠ” stop / Page videos initâ†’ready / Request videos pendingâ†’success / Data videos empty â†’ **200**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass ë˜ëŠ” stop / Page videos initâ†’ready / Request videos pendingâ†’error / Data videos error â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass ë˜ëŠ” stop / Page videos initâ†’ready / Request videos pendingâ†’error / Data videos error â†’ **422** | [âœ…ğŸ†—] |
| 4-2 | `GET /videos/{id}` | `/videos/{videos_id}` | ë¹„ë””ì˜¤ ìƒì„¸ | ***VIDEO_TAG ì¡°íšŒ, ì‹œì²­ ë¡œê·¸ íŠ¸ë¦¬ê±°(í´ë¼ì´ì–¸íŠ¸ ì¬ìƒ ì‹œ)***<br>ì„±ê³µ: Auth pass ë˜ëŠ” stop / Page video initâ†’ready / Request video pendingâ†’success / Data video present â†’ **200**<br>ì‹¤íŒ¨(ì—†ëŠ” ì˜ìƒ): Auth pass ë˜ëŠ” stop / Page video initâ†’ready / Request video pendingâ†’error / Data video error â†’ **404** | [âœ…ğŸ†—] |
| 4-3 | `GET /videos/{id}/progress` | `/videos/{videos_id}` | ì§„í–‰ë„ ì¡°íšŒ | ***VIDEO_LOG: `progress_percent`, `last_watched_at` ì¡°íšŒ***<br>ì„±ê³µ: Auth pass / Page video initâ†’ready / Request progress pendingâ†’success / Data progress present(ë˜ëŠ” empty=ê¸°ë¡ì—†ìŒ, 0%) â†’ **200**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page video initâ†’ready / Request progress pendingâ†’error / Data progress error â†’ **401**<br>ì‹¤íŒ¨(ì—†ëŠ” ì˜ìƒ): Auth pass / Page video initâ†’ready / Request progress pendingâ†’error / Data progress error â†’ **404** | [âœ…ğŸ†—] |
| 4-4 | `POST /videos/{id}/progress` | `/videos/{videos_id}` | ì§„í–‰ë„ ê°±ì‹  | ***0~100 ê³ ì •(ë©±ë“±ì—°ì‚°) â†’ VIDEO_LOG ì €ì¥(`progress_percent`, `last_watched_at`)***<br>ì„±ê³µ:<br> Auth pass / Page video initâ†’ready / Form progress pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success /<br> Request progress pendingâ†’success / Data progress present â†’ **200**(ë˜ëŠ” **204**)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½):<br> Auth pass / Page video initâ†’ready / Form progress pristineâ†’dirtyâ†’validatingâ†’error.client / Request progress pendingâ†’error / Data progress empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½: ë²”ìœ„/ì¦ê° ê·œì¹™):<br> Auth pass / Page video initâ†’ready / Form progress pristineâ†’dirtyâ†’validatingâ†’error.client / Request progress pendingâ†’error / Data progress error â†’ **422**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page video initâ†’ready / Request progress pendingâ†’error / Data progress error â†’ **401**<br>ì‹¤íŒ¨(ì—†ëŠ” ì˜ìƒ): Auth pass / Page video initâ†’ready / Request progress pendingâ†’error / Data progress error â†’ **404** | [âœ…ğŸ†—] |

---

<details>
  <summary>5.4 Phase 4 â€” video ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ (5.4-1 ~ 5.4-4)</summary>

#### ê³µí†µ ì •ì±…(5.4-1 ~ 5.4-4)
- **ì—ëŸ¬ ë°”ë””(ê³ ì •)**
  `{ "error": { "http_status": 400|401|404|422|429|500, "code": "...", "message": "...", "details": { }, "trace_id": "..." } }`
- **ê²€ì¦ ê¸°ì¤€**
  - **400** = í˜•ì‹ ì˜¤ë¥˜/í•„ìˆ˜ ëˆ„ë½/íŒŒì‹± ì‹¤íŒ¨(ì˜ˆ: page, per_page ìˆ«ì ì•„ë‹˜)
  - **422** = ë„ë©”ì¸ ì œì•½ ìœ„ë°˜(ì˜ˆ: progress 0~100 ë²”ìœ„ ìœ„ë°˜, ì¦ê°€/ê°ì†Œ ê·œì¹™ ìœ„ë°˜ì„ ë‘˜ ê²½ìš°)
- **ì§„í–‰ë„ ê·œì¹™**
  - ë©±ë“±: ë™ì¼ ê°’ ì¬ì „ì†¡ì€ ìƒíƒœ ë³€í™” ì—†ì´ ì„±ê³µ
  - `last_watched_at`ëŠ” ì„œë²„ ì‹œê°ìœ¼ë¡œ ê°±ì‹ 
  - ê¸°ë¡ ì—†ìŒ(progress ë¯¸ìƒì„±)ì€ **200 + empty(0%)**ë¡œ ì‘ë‹µ(ì˜¤ë¥˜ ì•„ë‹˜)

---

#### ì‘ë‹µ ìŠ¤í‚¤ë§ˆ

**VideoListRes (ëª©ë¡ ì‘ë‹µ)**
```json
{
  "meta": {
    "total_count": 100,
    "total_pages": 5,
    "current_page": 1,
    "per_page": 20
  },
  "data": [VideoListItem, ...]
}
```

**VideoListItem (ëª©ë¡ ì•„ì´í…œ)**
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `video_id` | `i64` | ë¹„ë””ì˜¤ ê³ ìœ  ID |
| `video_idx` | `string` | ë¹„ì¦ˆë‹ˆìŠ¤ ì‹ë³„ ì½”ë“œ (ì˜ˆ: VID-001) |
| `title` | `string?` | ì˜ìƒ ì œëª© (video_tagì—ì„œ ê°€ì ¸ì˜´) |
| `subtitle` | `string?` | ì˜ìƒ ì„¤ëª… (video_tagì—ì„œ ê°€ì ¸ì˜´) |
| `duration_seconds` | `i32?` | ì˜ìƒ ê¸¸ì´ (ì´ˆ, Vimeo ë™ê¸°í™”) |
| `language` | `string?` | ì–¸ì–´ ì½”ë“œ |
| `thumbnail_url` | `string?` | ì¸ë„¤ì¼ URL (Vimeo ë™ê¸°í™”) |
| `state` | `string` | ìƒíƒœ (draft, published, archived) |
| `access` | `string` | ì ‘ê·¼ê¶Œí•œ (public, private, restricted) |
| `tags` | `string[]` | íƒœê·¸ ë¬¸ìì—´ ë°°ì—´ |
| `has_captions` | `bool` | ìë§‰ ìœ ë¬´ |
| `created_at` | `datetime` | ìƒì„±ì¼ì‹œ |

**VideoDetailRes (ìƒì„¸ ì‘ë‹µ)**
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `video_id` | `i64` | ë¹„ë””ì˜¤ ê³ ìœ  ID |
| `video_url_vimeo` | `string` | Vimeo ì˜ìƒ URL |
| `video_state` | `string` | ìƒíƒœ (draft, published, archived) |
| `tags` | `VideoTagDetail[]` | íƒœê·¸ ìƒì„¸ ë°°ì—´ |
| `created_at` | `datetime` | ìƒì„±ì¼ì‹œ |

**VideoTagDetail (íƒœê·¸ ìƒì„¸)**
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `key` | `string?` | íƒœê·¸ í‚¤ |
| `title` | `string?` | íƒœê·¸ ì œëª© |
| `subtitle` | `string?` | íƒœê·¸ ì„¤ëª… |

**VideoProgressRes (ì§„í–‰ë„ ì‘ë‹µ)**
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `video_id` | `i64` | ë¹„ë””ì˜¤ ê³ ìœ  ID |
| `progress_rate` | `i32` | ì§„í–‰ë¥  (0~100) |
| `is_completed` | `bool` | ì™„ë£Œ ì—¬ë¶€ |
| `last_watched_at` | `datetime?` | ë§ˆì§€ë§‰ ì‹œì²­ ì‹œê° |

---

#### 5.4-1 : `GET /videos` (ë¹„ë””ì˜¤ ëª©ë¡)
- **ë¡œê·¸ì¸ ì•ˆí•´ë„ ì ‘ê·¼ ê°€ëŠ¥**
- **ì„±ê³µ(ë°ì´í„° ìˆìŒ) â†’ 200**
  - When: `/videos` ì§„ì…, `page/per_page/sort`ê°€ ìœ íš¨
  - Then: **200**, ëª©ë¡ + í˜ì´ì§€ ë©”íƒ€, ê° í•­ëª©ì— `video_url_vimeo` í¬í•¨
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`videos` initâ†’ready / Request=`videos` pendingâ†’success / Data=`videos` present

- **ì„±ê³µ(ë°ì´í„° ì—†ìŒ) â†’ 200**
  - Then: **200**, ë¹ˆ ë°°ì—´ + í˜ì´ì§€ ë©”íƒ€
  - ìƒíƒœì¶•: Data=`videos` empty

- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400**
  - ì˜ˆ: `page=abc`(ìˆ«ì ì•„ë‹˜), `per_page=foo`(ìˆ«ì ì•„ë‹˜), `sort=` ê°’ íŒŒì‹± ë¶ˆê°€(ì‰¼í‘œ/í˜•ì‹ ì˜¤ë¥˜)
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`videos` initâ†’ready / Request=`videos` pendingâ†’error / Data=`videos` error

- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422**
  - ì˜ˆ: `page<1`, `per_page<1` ë˜ëŠ” í—ˆìš© ìƒí•œ ì´ˆê³¼(ì˜ˆ: `per_page>100`), `sort` ê°’ì´ í—ˆìš© ëª©ë¡ ì™¸, `lang` í•„í„°ê°€ í—ˆìš©ë˜ì§€ ì•Šì€ ì–¸ì–´ì½”ë“œ
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`videos` initâ†’ready / Request=`videos` pendingâ†’error / Data=`videos` error


---

#### 5.4-2 : `GET /videos/{id}` (ë¹„ë””ì˜¤ ìƒì„¸)
- **ì„±ê³µ â†’ 200 OK**  
  - When: ìƒì„¸ ì§„ì…, ì¡´ì¬í•˜ëŠ” ì˜ìƒ id  
  - Then: **200**, ë³¸ë¬¸ì— ë©”íƒ€(ì œëª©, ì„¤ëª…, ê¸¸ì´, `video_url_vimeo`, **VIDEO_TAG ë°°ì—´**)  
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`video` initâ†’ready / Request=`video` pendingâ†’success / **Data=`video` present**
- **ì‹¤íŒ¨(ì—†ëŠ” ì˜ìƒ) â†’ 404 Not Found**  
  - When: ì˜ëª»ëœ id  
  - ìƒíƒœì¶•: Request â€¦ â†’ error / **Data=`video` error**

> ë©”ëª¨: ì‹¤ì œ ì‹œì²­(ì¬ìƒ ì‹œì‘/ì™„ë£Œ ë“±)ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¹„ë©”ì˜¤ í”Œë ˆì´ì–´ ì´ë²¤íŠ¸ë¡œ ì¡ê³ , ë³„ë„ **progress API**(3-4)ë¥¼ í˜¸ì¶œí•´ **VIDEO_LOG**ë¥¼ ì ì¬.

---

#### 5.4-3 : `GET /videos/{id}/progress` (ì§„í–‰ë„ ì¡°íšŒ)
- **ì„±ê³µ(ê¸°ë¡ ìˆìŒ) â†’ 200 OK**  
  - When: ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìì‹ ì˜ ì§„í–‰ë„ ì¡°íšŒ  
  - Then: **200**, `{ progress_percent, last_watched_at }`  
  - ìƒíƒœì¶•: Auth=pass / Page=`video` initâ†’ready / Request=`progress` pendingâ†’success / **Data=`progress` present**
- **ì„±ê³µ(ê¸°ë¡ ì—†ìŒ) â†’ 200 OK**  
  - Then: **200**, `{ progress_percent: 0, last_watched_at: null }`  
  - ìƒíƒœì¶•: Data=`progress` **empty**
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ 401 Unauthorized**  
  - When: í† í° ì—†ìŒ/ë§Œë£Œ  
  - ìƒíƒœì¶•: Auth=stop / Request â€¦ â†’ error / Data=`progress` error
- **ì‹¤íŒ¨(ì—†ëŠ” ì˜ìƒ) â†’ 404 Not Found**

---

#### 5.4-4 : `POST /videos/{id}/progress` (ì§„í–‰ë„ ê°±ì‹ )
- **ì„±ê³µ â†’ 200 OK(ë˜ëŠ” 204 No Content)**  
  - When: í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ìƒ ì´ë²¤íŠ¸ ë™ì•ˆ ì§„í–‰ë„(0~100)ë¥¼ ì „ì†¡  
  - Then: **200**(ì—…ë°ì´íŠ¸ í›„ ìŠ¤ëƒ…ìƒ· ë°˜í™˜) **í˜¹ì€ 204**, ì„œë²„ëŠ” `progress_percent`(í´ë¨í”„ 0~100)ì™€ `last_watched_at` ê°±ì‹ , **VIDEO_LOG upsert**  
  - ìƒíƒœì¶•: Auth=pass / Page=`video` initâ†’ready / **Form=`progress` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success** / Request=`progress` pendingâ†’success / **Data=`progress` present**
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400 Bad Request**  
  - ì˜ˆ: `progress_percent`ê°€ ìˆ«ì ì•„ë‹˜, ë°”ë”” ëˆ„ë½  
  - ìƒíƒœì¶•: **Form=`progress` â€¦ â†’ error.client** / Request â€¦ â†’ error / **Data=`progress` empty**
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422 Unprocessable Entity**  
  - ì˜ˆ: ë²”ìœ„(0~100) ìœ„ë°˜, (ì •ì±… ì„ íƒ ì‹œ) ì§€ë‚˜ì¹œ ê°ì†Œ ë“± ê·œì¹™ ìœ„ë°˜  
  - ìƒíƒœì¶•: **Form=`progress` â€¦ â†’ error.client** / Request â€¦ â†’ error / **Data=`progress` error**
- **ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ 401 Unauthorized**  
  - When: í† í° ì—†ìŒ/ë§Œë£Œ  
- **ì‹¤íŒ¨(ì—†ëŠ” ì˜ìƒ) â†’ 404 Not Found**
</details>

---

### 5.5 Phase 5 â€” study âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ |
|---|---|---|---|---|---|
| 5-1 | `GET /studies` | `/studies` | í•™ìŠµ ë¬¸ì œ ëª©ë¡ | ***`study_program_enum` ê¸°ì¤€ ì¡°íšŒ, í˜ì´ì§€ë„¤ì´ì…˜***<br>ì„±ê³µ(ë°ì´í„° ìˆìŒ): Auth pass ë˜ëŠ” stop / Page studies initâ†’ready / Request studies pendingâ†’success / Data studies present â†’ **200**<br>ì„±ê³µ(ë°ì´í„° ì—†ìŒ): Auth pass ë˜ëŠ” stop / Page studies initâ†’ready / Request studies pendingâ†’success / Data studies empty â†’ **200**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass ë˜ëŠ” stop / Page studies initâ†’ready / Request studies pendingâ†’error / Data studies error â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass ë˜ëŠ” stop / Page studies initâ†’ready / Request studies pendingâ†’error / Data studies error â†’ **422** | [âœ…ğŸ†—] |
| 5-2 | `GET /studies/{id}` | `/studies/{study_id}` | Study ìƒì„¸ (Task ëª©ë¡) | ***STUDY ìƒì„¸ + í•´ë‹¹ Studyì˜ STUDY_TASK ëª©ë¡ ì¡°íšŒ, í˜ì´ì§€ë„¤ì´ì…˜***<br>ì„±ê³µ(ë°ì´í„° ìˆìŒ): Auth pass ë˜ëŠ” stop / Page study initâ†’ready / Request study pendingâ†’success / Data study present â†’ **200**<br>ì„±ê³µ(ë°ì´í„° ì—†ìŒ): Auth pass ë˜ëŠ” stop / Page study initâ†’ready / Request study pendingâ†’success / Data study empty â†’ **200** (Task ì—†ìŒ)<br>ì‹¤íŒ¨(ì—†ëŠ” Study): Auth pass ë˜ëŠ” stop / Page study initâ†’ready / Request study pendingâ†’error / Data study error â†’ **404** | [âœ…ğŸ†—] |
| 5-3 | `GET /studies/tasks/{id}` | `/studies/tasks/{task_id}` | í•™ìŠµ ë¬¸ì œ ìƒì„¸ | ***STUDY_TASK ì¡°íšŒ, ë³´ê¸°(í’€ì´ ì „)â†’ STUDY_TASK_LOG ì €ì¥(view)***<br>ì„±ê³µ: Auth pass ë˜ëŠ” stop / Page task initâ†’ready / Request task pendingâ†’success / Data task present â†’ **200**<br>ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­): Auth pass ë˜ëŠ” stop / Page task initâ†’ready / Request task pendingâ†’error / Data task error â†’ **404** | [âœ…ğŸ†—] |
| 5-4 | `POST /studies/tasks/{id}/answer` | `/studies/tasks/{task_id}` | ì •ë‹µ ì œì¶œ/ì±„ì  | ***STUDY_TASK_STATUS ì—…ë°ì´íŠ¸ â†’ STUDY_TASK_LOG ì €ì¥(ì±„ì  í¬í•¨)***<br>ì„±ê³µ:<br> Auth pass / Page task initâ†’ready / Form answer pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success /<br> Request answer pendingâ†’success / Data answer present â†’ **200**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½):<br> Auth pass / Page task initâ†’ready / Form answer pristineâ†’dirtyâ†’validatingâ†’error.client / Request answer pendingâ†’error / Data answer empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½: ì„ íƒì§€ ë²”ìœ„/ì¤‘ë³µ í—ˆìš© ê·œì¹™ ë“±):<br> Auth pass / Page task initâ†’ready / Form answer pristineâ†’dirtyâ†’validatingâ†’error.client / Request answer pendingâ†’error / Data answer error â†’ **422**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page task initâ†’ready / Request answer pendingâ†’error / Data answer error â†’ **401**<br>ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­): Auth pass / Page task initâ†’ready / Request answer pendingâ†’error / Data answer error â†’ **404** | [âœ…ğŸ†—] |
| 5-5 | `GET /studies/tasks/{id}/status` | `/studies/tasks/{task_id}` | ë‚´ ì‹œë„/ê¸°ë¡ | ***ë‚´ ìµœì‹  STATUS(progress/score/attempts) ì¡°íšŒ***<br>ì„±ê³µ: Auth pass / Page task initâ†’ready / Request status pendingâ†’success / Data status present(ë˜ëŠ” empty=ê¸°ë¡ì—†ìŒ) â†’ **200**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page task initâ†’ready / Request status pendingâ†’error / Data status error â†’ **401**<br>ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­): Auth pass / Page task initâ†’ready / Request status pendingâ†’error / Data status error â†’ **404** | [âœ…ğŸ†—] |
| 5-6 | `GET /studies/tasks/{id}/explain` | `/studies/tasks/{task_id}/explain` | í•´ì„¤ ë³´ê¸° | ***STUDY_EXPLAIN ë¬¸í•­ë³„ í•´ì„¤/ë¯¸ë””ì–´***<br>ì„±ê³µ: Auth pass ë˜ëŠ” stop / Page explain initâ†’ready / Request explain pendingâ†’success / Data explain present â†’ **200**<br>ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­/í•´ì„¤ ì—†ìŒ): Auth pass ë˜ëŠ” stop / Page explain initâ†’ready / Request explain pendingâ†’error / Data explain error â†’ **404**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì •ì±…: ì‹œë„ ì „ ì—´ëŒ ê¸ˆì§€ ì„¤ì • ì‹œ): Auth pass ë˜ëŠ” stop / Page explain ready / Request explain pendingâ†’error / Data explain error â†’ **403** | [âœ…ğŸ†—] |

---

<details>
  <summary>5.5 Phase 5 â€” study ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ (5.5-1 ~ 5.5-5)</summary>

#### ê³µí†µ ì •ì±…(5.5-1 ~ 5.5-5)
- **ì—ëŸ¬ ë°”ë””(ê³ ì •)**  
  `{ "error": { "http_status": 400|401|403|404|422|429|500, "code": "...", "message": "...", "details": { }, "trace_id": "..." } }`
- **ê²€ì¦ ê¸°ì¤€**  
  - **400** = í˜•ì‹/ëˆ„ë½/íŒŒì‹± ì‹¤íŒ¨(ì˜ˆ: `page=abc`, `program=` ë¹ˆê°’)
  - **422** = ë„ë©”ì¸ ì œì•½ ìœ„ë°˜(ì˜ˆ: `study_program_enum`ì— ì—†ëŠ” ê°’, `per_page` ìƒí•œ ì´ˆê³¼, ë³´ê¸° ê·œì¹™ ìœ„ë°˜)
- **ë¡œê·¸**
  - ë¬¸ì œ ì¡°íšŒ(4-2): **STUDY_TASK_LOG**ì— study_task_action_log ì»¬ëŸ¼ study_task_log_action_enum ë°”íƒ•ìœ¼ë¡œ `view` ì—…ë°ì´íŠ¸
  - ì •ë‹µ ì œì¶œ(4-3)
    1. **STUDY_TASK_STATUS**ì— ì—…ë°ì´íŠ¸ : ì‹œë„íšŸìˆ˜(`study_task_status_try`), ìµœê³ ì (`study_task_status_best`), ì™„ë£Œì—¬ë¶€(`study_task_status_completed`)
    2. **STUDY_TASK_LOG**ì— ì—…ë°ì´íŠ¸ : í•™ìŠµí–‰ë™(`study_task_action_log`), ì‹œë„íšŸìˆ˜(`study_task_try_no_log`), ì ìˆ˜ê¸°ë¡(`study_task_score_log`), ì™„ë£Œì—¬ë¶€(`study_task_is_correct_log`), í’€ì´ê¸°ë¡(`study_task_payload_log`), 
  - ìƒíƒœ ì¡°íšŒ(4-4): **STUDY_TASK_LOG**ì— study_task_action_log ì»¬ëŸ¼ study_task_log_action_enum ë°”íƒ•ìœ¼ë¡œ `status` ì—…ë°ì´íŠ¸
- **ë ˆì´íŠ¸ë¦¬ë°‹(ì„ íƒ)**  
  - ê³¼ë„í•œ ì±„ì /ìƒˆë¡œê³ ì¹¨ ë°©ì§€ â†’ **429 + Retry-After**
- **ê¶Œí•œ/ê³µê°œ ì •ì±…**  
  - ëª©ë¡/ìƒì„¸/í•´ì„¤ì€ ì„œë¹„ìŠ¤ ì •ì±…ì— ë”°ë¼ ê³µê°œ/ë¹„ê³µê°œë¥¼ ì¡°ì ˆ ê°€ëŠ¥(ê¸°ë³¸: ê³µê°œ ì—´ëŒ ê°€ëŠ¥, ì •ë‹µ ì œì¶œÂ·ë‚´ ê¸°ë¡ ì¡°íšŒëŠ” ì¸ì¦ í•„ìš”)

---

#### 5.5-1 : `GET /studies` (í•™ìŠµ ë¬¸ì œ ëª©ë¡)
- **ë¡œê·¸ì¸ ì•ˆí•´ë„ ì ‘ê·¼ ê°€ëŠ¥**
- **ì„±ê³µ(ë°ì´í„° ìˆìŒ) â†’ 200**  
  - When: `/studies` ì§„ì…, `program/page/per_page/sort` ìœ íš¨
  - Then: **200**, ëª©ë¡ + í˜ì´ì§€ ë©”íƒ€, `study_program_enum` í•„í„° ë°˜ì˜
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`studies` initâ†’ready / Request=`studies` pendingâ†’success / Data=`studies` present
- **ì„±ê³µ(ë°ì´í„° ì—†ìŒ) â†’ 200**  
  - ë¹ˆ ë°°ì—´ + í˜ì´ì§€ ë©”íƒ€ / Data=`studies` empty
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400**  
  - ì˜ˆ: `page`/`per_page` ìˆ«ì ì•„ë‹˜, `program` íŒŒë¼ë¯¸í„° í˜•ì‹ ì˜¤ë¥˜
- **ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ 422**  
  - ì˜ˆ: `program`ì´ enumì— ì—†ìŒ, `per_page` ìƒí•œ ì´ˆê³¼, í—ˆìš©ë˜ì§€ ì•Šì€ `sort` í•„ë“œ

---

#### 5.5-2 : `GET /studies/{id}` (Study ìƒì„¸ + Task ëª©ë¡)
- **ë¡œê·¸ì¸ ì•ˆí•´ë„ ì ‘ê·¼ ê°€ëŠ¥**
- **ì„±ê³µ(ë°ì´í„° ìˆìŒ) â†’ 200**
  - When: `/studies/{study_id}` ì§„ì…, `page/per_page` ìœ íš¨
  - Then: **200**, Study ì •ë³´ + í•´ë‹¹ Studyì˜ Task ëª©ë¡ + í˜ì´ì§€ ë©”íƒ€
  - ì‘ë‹µ ì˜ˆì‹œ:
    ```json
    {
      "study_id": 1,
      "study_idx": "test-1",
      "program": "basic_word",
      "title": "í•œê¸€ ììŒ ì—°ìŠµ",
      "subtitle": "\"ã…\"ë¡œ ììŒ ì—°ìŠµ í•˜ê¸°",
      "state": "open",
      "tasks": [
        { "task_id": 1, "kind": "choice", "seq": 1 },
        { "task_id": 2, "kind": "typing", "seq": 2 }
      ],
      "meta": { "total_count": 2, "total_pages": 1, "page": 1, "per_page": 10 }
    }
    ```
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`study` initâ†’ready / Request=`study` pendingâ†’success / Data=`study` present
- **ì„±ê³µ(Task ì—†ìŒ) â†’ 200**
  - StudyëŠ” ì¡´ì¬í•˜ì§€ë§Œ Taskê°€ ì—†ëŠ” ê²½ìš° ë¹ˆ ë°°ì—´ ë°˜í™˜
  - Data=`study` present, `tasks` empty
- **ì‹¤íŒ¨(ì—†ëŠ” Study) â†’ 404**
  - ì˜ëª»ëœ `{id}`
- **ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ 400**
  - ì˜ˆ: `page`/`per_page` ìˆ«ì ì•„ë‹˜

---

#### 5.5-3 : `GET /studies/tasks/{id}` (í•™ìŠµ ë¬¸ì œ ìƒì„¸)
- ì„±ê³µ â†’ **200**  
  - Then: **200**, ë¬¸ì œ ë³¸ë¬¸/ë³´ê¸°/ë©”íƒ€(ë‚œì´ë„/ë¶„ë¥˜) â†’ **STUDY_TASK_LOG** `view` ì—…ë°ì´íŠ¸
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`task` initâ†’ready / Request=`task` pendingâ†’success / Data=`task` present
- ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­) â†’ **404**  
  - ì˜ëª»ëœ `{id}`

---

#### 5.5-4 : `POST /studies/tasks/{id}/answer` (ì •ë‹µ ì œì¶œ/ì±„ì )
- ì„±ê³µ â†’ **200**  
  - When: ì¸ì¦ ì‚¬ìš©ì,
    1. study_task_typing : íƒ€ì´í•‘ ì‹œë„ â†’ **STUDY_TASK_LOG** `start` ì—…ë°ì´íŠ¸ â†’ íƒ€ì´í•‘ ì™„ë£Œ â†’ **STUDY_TASK_LOG** `answer` ì—…ë°ì´íŠ¸
    2. study_task_choice : ì„ íƒì§€ í´ë¦­ â†’ **STUDY_TASK_LOG** `answer` ì—…ë°ì´íŠ¸
    3. study_task_voice : ë…¹ìŒ ë²„íŠ¼ í´ë¦­ â†’ **STUDY_TASK_LOG** `start` ì—…ë°ì´íŠ¸ â†’ ë…¹ìŒ ë²„íŠ¼ ì¬í´ë¦­ â†’ **STUDY_TASK_LOG** `answer` ì—…ë°ì´íŠ¸
  - Then: **200**, 
    1. study_task_typing : ì±„ì  â†’ **STUDY_TASK_TYPING** `study_task_typing_answer` ëŒ€ì¡° â†’ **STUDY_TASK_STATUS** ê²°ê³¼ ì—…ë°ì´íŠ¸ â†’ **STUDY_TASK_LOG** `finish` ì—…ë°ì´íŠ¸
    2. study_task_choice : ì±„ì  â†’ **STUDY_TASK_CHOICE** `study_task_choice_answer` ëŒ€ì¡° â†’ **STUDY_TASK_STATUS** ê²°ê³¼ ì—…ë°ì´íŠ¸ â†’ **STUDY_TASK_LOG** `finish` ì—…ë°ì´íŠ¸
    3. study_task_voice : ì±„ì  â†’  **STUDY_TASK_VOICE** `study_task_voice_answer` ëŒ€ì¡° â†’ **STUDY_TASK_STATUS** ê²°ê³¼ ì—…ë°ì´íŠ¸ â†’ **STUDY_TASK_LOG** `finish` ì—…ë°ì´íŠ¸
  - ìƒíƒœì¶•: Auth=pass / Page=`task` initâ†’ready / Form=`answer` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request=`answer` pendingâ†’success / Data=`answer` present
- ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ **400**  
  - ì˜ˆ: ë°”ë”” ì—†ìŒ, ì„ íƒì§€ ë°°ì—´ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜, ì„œìˆ í˜• ë¹ˆ ë¬¸ìì—´ ê¸ˆì§€ ë“±
  - ìƒíƒœì¶•: Form=`answer` â€¦ â†’ error.client / Request=`answer` pendingâ†’error / Data=`answer` empty
- ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ **422**  
  - ì˜ˆ: ë‹¨ì¼ì„ íƒ ë¬¸í•­ì— ë‹¤ì¤‘ ì„ íƒ ì œì¶œ, ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ë³´ê¸° ì¸ë±ìŠ¤, ì´ë¯¸ ì¢…ë£Œëœ ì‹œë„ì— ì¬ì œì¶œ ê¸ˆì§€ ì •ì±… ë“±
  - ìƒíƒœì¶•: Form=`answer` â€¦ â†’ error.client / Request=`answer` pendingâ†’error / Data=`answer` error
- ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ **401**
  - í† í° ì—†ìŒ/ë§Œë£Œ
- ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­) â†’ **404**  
  - ì˜ëª»ëœ `{id}`
- ì‹¤íŒ¨(ë ˆì´íŠ¸ë¦¬ë°‹, ì„ íƒ) â†’ **429**
  - ê³¼ë„í•œ ì œì¶œ/ì±„ì  ìš”ì²­

---

#### 5.5-5 : `GET /studies/tasks/{id}/status` (ë‚´ ì‹œë„/ê¸°ë¡)
- ì„±ê³µ â†’ **200**  
  - Then: **200**, `{ study_task_status_try_count, study_task_status_is_solved, study_task_status_last_attempt_at }` â†’ **STUDY_TASK_LOG** `status` ì—…ë°ì´íŠ¸
  - ìƒíƒœì¶•: Auth=pass / Page=`task` initâ†’ready / Request=`status` pendingâ†’success / Data=`status` present(ë˜ëŠ” empty)
- ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ **401**
  - í† í° ì—†ìŒ/ë§Œë£Œ
- ì‹¤íŒ¨(ì—†ëŠ” ë¬¸í•­) â†’ **404**

---

#### 5.5-6 : `GET /studies/tasks/{id}/explain` (í•´ì„¤ ë³´ê¸°)
- ì„±ê³µ â†’ **200**  
  - Then: **200**,`{ explain_title, explain_text, explain_media_url }` â†’ **STUDY_TASK_LOG** `explain` ì—…ë°ì´íŠ¸
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`explain` initâ†’ready / Request=`explain` pendingâ†’success / Data=`explain` present
- ì‹¤íŒ¨(í•´ì„¤ ì—†ìŒ/ì—†ëŠ” ë¬¸í•­) â†’ **404**
  - ìë£Œ ë¯¸ì œê³µ ë˜ëŠ” ì˜ëª»ëœ `{id}`
- ì‹¤íŒ¨(ì •ì±…ìƒ ì œí•œ) â†’ **403**
  - ì˜ˆ: â€œìµœì†Œ 1íšŒ ì‹œë„ í›„ ì—´ëŒâ€ ì •ì±…ì„ ì¼  ê²½ìš°, ì‹œë„ ì „ ì ‘ê·¼ ì°¨ë‹¨

</details>

---

### 5.6 Phase 6 â€” lesson âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ |
|---|---|---|---|---|---|
| 6-1 | `GET /lessons` | `/lessons` | ìˆ˜ì—… ì „ì²´ ëª©ë¡ | ***`lesson_idx` ê¸°ì¤€ ì¡°íšŒ, í˜ì´ì§€ë„¤ì´ì…˜***<br>ì„±ê³µ(ë°ì´í„° ìˆìŒ): Auth pass ë˜ëŠ” stop / Page lessons initâ†’ready / Request lessons pendingâ†’success / Data lessons present â†’ **200**<br>ì„±ê³µ(ë°ì´í„° ì—†ìŒ): Auth pass ë˜ëŠ” stop / Page lessons initâ†’ready / Request lessons pendingâ†’success / Data lessons empty â†’ **200**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½): Auth pass ë˜ëŠ” stop / Page lessons initâ†’ready / Request lessons pendingâ†’error / Data lessons error â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½): Auth pass ë˜ëŠ” stop / Page lessons initâ†’ready / Request lessons pendingâ†’error / Data lessons error â†’ **422** | [âœ…ğŸ†—] |
| 6-2 | `GET /lessons/{id}` | `/lessons/{lesson_id}` | ìˆ˜ì—… ìƒì„¸ | ***`video_tag_id` + `study_task_id` ê¸°ë°˜ ëª©ë¡ ì¡°íšŒ, í˜ì´ì§€ë„¤ì´ì…˜***<br>ì„±ê³µ: Auth pass ë˜ëŠ” stop / Page lesson initâ†’ready / Request lesson pendingâ†’success / Data lesson present â†’ **200**<br>ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…): Auth pass ë˜ëŠ” stop / Page lesson initâ†’ready / Request lesson pendingâ†’error / Data lesson error â†’ **404** | [âœ…ğŸ†—] |
| 6-3 | `GET /lessons/{id}/items` | `/lessons/{lesson_id}/items` | ìˆ˜ì—… í•™ìŠµ | ***`lesson_item_seq` ê¸°ì¤€ ì¡°íšŒ, í•™ìŠµ í™”ë©´ ë¡œë“œ(í’€ì´/ì§„í–‰ì€ ë³„ë„ API)***<br>ì„±ê³µ: Auth pass ë˜ëŠ” stop / Page lesson_items initâ†’ready / Request lesson_items pendingâ†’success / Data lesson_items present â†’ **200**<br>ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…/í•­ëª©): Auth pass ë˜ëŠ” stop / Page lesson_items initâ†’ready / Request lesson_items pendingâ†’error / Data lesson_items error â†’ **404**<br>ì‹¤íŒ¨(ì •ì±…ìƒ ì œí•œ: ìˆ˜ê°•ê¶Œ í•„ìš”): Auth forbid / Page lesson_items ready / Request lesson_items pendingâ†’error / Data lesson_items error â†’ **403**<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½Â·ë„ë©”ì¸): Auth pass ë˜ëŠ” stop / Page lesson_items initâ†’ready / Request lesson_items pendingâ†’error / Data lesson_items error â†’ **400**/**422** | [âœ…ğŸ†—] |
| 6-4 | `GET /lessons/{id}/progress` | `/lessons/{lesson_id}` | ìˆ˜ì—… ì§„í–‰ ì¡°íšŒ | ***LESSON_PROGRESS ìµœì‹  ê°’ ì¡°íšŒ(ì—†ìœ¼ë©´ 0%)***<br>ì„±ê³µ: Auth pass / Page lesson initâ†’ready / Request lesson_progress pendingâ†’success / Data lesson_progress present(ë˜ëŠ” empty=0%) â†’ **200**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page lesson initâ†’ready / Request lesson_progress pendingâ†’error / Data lesson_progress error â†’ **401**<br>ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…): Auth pass / Page lesson initâ†’ready / Request lesson_progress pendingâ†’error / Data lesson_progress error â†’ **404** | [âœ…ğŸ†—] |
| 6-5 | `POST /lessons/{id}/progress` | `/lessons/{lesson_id}` | ìˆ˜ì—… ì§„í–‰ ê°±ì‹  | ***LESSON_PROGRESS ì»¬ëŸ¼ ì—…ë°ì´íŠ¸(0~100 ê³ ì •, ë©±ë“±)***<br>ì„±ê³µ:<br> Auth pass / Page lesson initâ†’ready / Form lesson_progress pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success /<br> Request lesson_progress pendingâ†’success / Data lesson_progress present â†’ **200**(ë˜ëŠ” **204**)<br>ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½):<br> Auth pass / Page lesson initâ†’ready / Form lesson_progress pristineâ†’dirtyâ†’validatingâ†’error.client /<br> Request lesson_progress pendingâ†’error / Data lesson_progress empty â†’ **400**<br>ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½: ë²”ìœ„/ì¦ê° ê·œì¹™):<br> Auth pass / Page lesson initâ†’ready / Form lesson_progress pristineâ†’dirtyâ†’validatingâ†’error.client /<br> Request lesson_progress pendingâ†’error / Data lesson_progress error â†’ **422**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): Auth stop / Page lesson initâ†’ready / Request lesson_progress pendingâ†’error / Data lesson_progress error â†’ **401**<br>ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…): Auth pass / Page lesson initâ†’ready / Request lesson_progress pendingâ†’error / Data lesson_progress error â†’ **404**<br>ì‹¤íŒ¨(ì •ì±…ìƒ ì œí•œ: ìˆ˜ê°•ê¶Œ í•„ìš”): Auth forbid / Page lesson ready / Request lesson_progress pendingâ†’error / Data lesson_progress error â†’ **403** | [âœ…ğŸ†—] |

---

<details>
  <summary>5.6 Phase 6 â€” lesson ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ (5.6-1 ~ 5.6-5)</summary>

#### ê³µí†µ ì •ì±…(5.6-1 ~ 5.6-5)
- **ì—ëŸ¬ ë°”ë””(ê³ ì •)**  
  `{ "error": { "http_status": 400|401|403|404|422|429|500, "code": "...", "message": "...", "details": { }, "trace_id": "..." } }`
- **ê²€ì¦ ê¸°ì¤€**  
  - **400** = í˜•ì‹/ëˆ„ë½/íŒŒì‹± ì‹¤íŒ¨(ì˜ˆ: `page=abc`, `per_page=foo`)  
  - **422** = ë„ë©”ì¸ ì œì•½ ìœ„ë°˜(ì˜ˆ: `per_page` ìƒí•œ, í—ˆìš©ë˜ì§€ ì•Šì€ `sort`, ì§„í–‰ë„ 0~100 ë²”ìœ„ ìœ„ë°˜ ë“±)
- **ê¶Œí•œ/ìˆ˜ê°•ê¶Œ**  
  - ìˆ˜ì—… ëª©ë¡/ìƒì„¸/ì•„ì´í…œì€ ì„œë¹„ìŠ¤ ì •ì±…ì— ë”°ë¼ ê³µê°œ ê°€ëŠ¥í•˜ë˜, **ìˆ˜ê°•ê¶Œ í•„ìˆ˜ ì •ì±…ì„ ì¼œë©´ 403** ì ìš©  
  - ì§„í–‰ë„ ì¡°íšŒ/ê°±ì‹ ì€ **ì¸ì¦ í•„ìˆ˜**
- **ì§„í–‰ë„ ê·œì¹™**  
  - ë©±ë“±: ë™ì¼ ê°’ ì¬ì „ì†¡ì€ ìƒíƒœ ë³€í™” ì—†ì´ ì„±ê³µ  
  - ê¸°ë¡ ì—†ìŒì€ **200 + empty(0%)**ë¡œ ì‘ë‹µ(ì˜¤ë¥˜ ì•„ë‹˜)
- **ë¡œê·¸**  
  - ì§„í–‰ë„ ê°±ì‹ (5-5): LESSON_PROGRESS ì—…ë°ì´íŠ¸ ì‹œ ì„œë²„ì‹œê°ìœ¼ë¡œ ê°±ì‹ , í•„ìš” ì‹œ LESSON_PROGRESS_LOG(ì„ íƒ)

---

#### 5.6-1 : `GET /lessons` (ìˆ˜ì—… ì „ì²´ ëª©ë¡)
- **ë¡œê·¸ì¸ ì•ˆí•´ë„ ì ‘ê·¼ ê°€ëŠ¥**
- ì„±ê³µ(ë°ì´í„° ìˆìŒ) â†’ **200**  
  - When: `/lessons` ì§„ì…, `page/per_page/sort` ìœ íš¨  
  - Then: **200**, ëª©ë¡ + í˜ì´ì§€ ë©”íƒ€(`lesson_idx` ê¸°ì¤€ ì •ë ¬)
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`lessons` initâ†’ready / Request=`lessons` pendingâ†’success / Data=`lessons` present
- ì„±ê³µ(ë°ì´í„° ì—†ìŒ) â†’ **200**  
  - ë¹ˆ ë°°ì—´ + í˜ì´ì§€ ë©”íƒ€ / Data=`lessons` empty
- ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ **400**  
  - ì˜ˆ: ìˆ«ì ì•„ë‹˜, ìŒìˆ˜/0 í˜ì´ì§€
- ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ **422**  
  - ì˜ˆ: `per_page` ìƒí•œ ì´ˆê³¼, í—ˆìš© ì™¸ ì •ë ¬ í‚¤

---

#### 5.6-2 : `GET /lessons/{id}` (ìˆ˜ì—… ìƒì„¸)
- ì„±ê³µ â†’ **200**  
  - Then: **200**, ìˆ˜ì—… ë©”íƒ€ + ì—°ê³„ ëª©ë¡(ì˜ìƒ íƒœê·¸/í•™ìŠµ ê³¼ì œ id ì§‘í•©) í˜ì´ì§€ë„¤ì´ì…˜
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`lesson` initâ†’ready / Request=`lesson` pendingâ†’success / Data=`lesson` present
- ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…) â†’ **404**

---

#### 5.6-3 : `GET /lessons/{id}/items` (ìˆ˜ì—… í•™ìŠµ)
- ì„±ê³µ â†’ **200**  
  - Then: **200**, `lesson_item_seq` ê¸°ì¤€ ì•„ì´í…œ ëª©ë¡(ë¬¸í•­/ë¹„ë””ì˜¤/ìë£Œ ë“±), í•™ìŠµ í™”ë©´ ë¡œë“œ
  - ìƒíƒœì¶•: Auth=pass ë˜ëŠ” stop / Page=`lesson_items` initâ†’ready / Request=`lesson_items` pendingâ†’success / Data=`lesson_items` present
- ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…/í•­ëª©) â†’ **404**
- ì‹¤íŒ¨(ì •ì±…ìƒ ì œí•œ: ìˆ˜ê°•ê¶Œ í•„ìš”) â†’ **403**
- ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½ â†’ 400 / ë„ë©”ì¸ ì œì•½ â†’ 422)**

---

#### 5.6-4 : `GET /lessons/{id}/progress` (ìˆ˜ì—… ì§„í–‰ ì¡°íšŒ)
- ì„±ê³µ â†’ **200**  
  - Then: **200**, `{ progress_percent, last_updated_at }` (ì—†ìœ¼ë©´ `{0, null}`)
  - ìƒíƒœì¶•: Auth=pass / Page=`lesson` initâ†’ready / Request=`lesson_progress` pendingâ†’success / Data=`lesson_progress` present(ë˜ëŠ” empty)
- ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ **401**
- ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…) â†’ **404**

---

#### 5.6-5 : `POST /lessons/{id}/progress` (ìˆ˜ì—… ì§„í–‰ ê°±ì‹ )
- ì„±ê³µ â†’ **200**(ë˜ëŠ” **204**)  
  - When: í•™ìŠµ ì¤‘ê°„/ì™„ë£Œ ì‹œ ì§„í–‰ë„ë¥¼ ì œì¶œ(0~100), ë©±ë“± ì—…ë°ì´íŠ¸
  - Then: **200**(ì—…ë°ì´íŠ¸ í›„ ìŠ¤ëƒ…ìƒ·) ë˜ëŠ” **204**, ì„œë²„ëŠ” LESSON_PROGRESS ê°±ì‹ 
  - ìƒíƒœì¶•: Auth=pass / Page=`lesson` initâ†’ready / Form=`lesson_progress` pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request=`lesson_progress` pendingâ†’success / Data=`lesson_progress` present
- ì‹¤íŒ¨(í˜•ì‹/ëˆ„ë½) â†’ **400**
  - ì˜ˆ: ë°”ë”” ëˆ„ë½, ìˆ«ì ì•„ë‹˜
- ì‹¤íŒ¨(ë„ë©”ì¸ ì œì•½) â†’ **422**
  - ì˜ˆ: 0~100 ë²”ìœ„ ìœ„ë°˜, (ì •ì±… ì„ íƒ ì‹œ) ì—­ì§„í–‰ ê¸ˆì§€
- ì‹¤íŒ¨(ë¯¸ì¸ì¦) â†’ **401**
- ì‹¤íŒ¨(ì—†ëŠ” ìˆ˜ì—…) â†’ **404**
- ì‹¤íŒ¨(ì •ì±…ìƒ ì œí•œ: ìˆ˜ê°•ê¶Œ í•„ìš”) â†’ **403**

</details>

---

### 5.7 Phase 7 â€” admin âœ…ğŸ†—
| ë²ˆí˜¸ | ì—”ë“œí¬ì¸íŠ¸ | í™”ë©´ ê²½ë¡œ | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ |
|---|---|---|---|---|---|
| 7-1 | `GET /admin/users` | `/admin/users?page=&size=&q=&sort=&order=` | ì‚¬ìš©ì ì¡°íšŒ | ***ê²€ìƒ‰/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜, RBAC(admin)***<br>ì„±ê³µ(ë°ì´í„° ìˆìŒ/ì—†ìŒ): â†’ **200**<br>ì‹¤íŒ¨(ë¯¸ì¸ì¦): **401** / RBAC: **403** / í˜•ì‹: **400** / ë„ë©”ì¸: **422** | [âœ…ğŸ†—] |
| 7-2 | `GET /admin/users/{id}/admin-logs` | `/admin/users/{user_id}?tab=admin-logs&page=&size=` | ê´€ë¦¬ì ì‚¬ìš©ì ë³€ê²½ ë¡œê·¸ ì¡°íšŒ | ***í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: â†’ **200**<br>ì‹¤íŒ¨: **401/403/404/400/422** | [âœ…ğŸ†—] |
| 7-3 | `GET /admin/users/{id}/user-logs` | `/admin/users/{user_id}?tab=user-logs&page=&size=` | ì‚¬ìš©ì ìì²´ ë³€ê²½ ë¡œê·¸ ì¡°íšŒ | ***í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: â†’ **200**<br>ì‹¤íŒ¨: **401/403/404/400/422** | [âœ…ğŸ†—] |
| 7-4 | `POST /admin/users` | `/admin/users/new` | ì‚¬ìš©ì ë‹¨ê±´ ìƒì„± | ***ADMIN_USERS_LOG ì €ì¥, RBAC***<br>ì„±ê³µ: â†’ **201**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-5 | `POST /admin/users/bulk` | `/admin/users/bulk` | ì‚¬ìš©ì ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_USERS_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-6 | `PATCH /admin/users/{id}` | `/admin/users/{user_id}/edit` | ì‚¬ìš©ì ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_USERS_LOG ì €ì¥, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-7 | `PATCH /admin/users/bulk` | `/admin/users/bulk` | ì‚¬ìš©ì ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_USERS_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |

| 7-8 | `GET /admin/videos` | `/admin/videos?page=&size=&q=&sort=&order=` | ë¹„ë””ì˜¤ ì¡°íšŒ | ***ê²€ìƒ‰/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-9 | `GET /admin/videos/{id}` | `/admin/videos/{video_id}` | ë¹„ë””ì˜¤ ìƒì„¸ ì¡°íšŒ | ***RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-10 | `GET /admin/videos/vimeo/preview` | `/admin/videos/new` | Vimeo ë©”íƒ€ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° | ***Vimeo API ì—°ë™, RBAC***<br>query: `url`<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400** | [âœ…ğŸ†—] |
| 7-11 | `POST /admin/videos/vimeo/upload-ticket` | `/admin/videos/new` | Vimeo ì—…ë¡œë“œ í‹°ì¼“ ìƒì„± | ***Vimeo tus upload, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400** | [âœ…ğŸ†—] |
| 7-12 | `POST /admin/videos` | `/admin/videos/new` | ë¹„ë””ì˜¤ ë‹¨ê±´ ìƒì„± | ***ADMIN_VIDEO_LOG, RBAC***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-13 | `POST /admin/videos/bulk` | `/admin/videos/bulk` | ë¹„ë””ì˜¤ ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_VIDEO_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-14 | `PATCH /admin/videos/{id}` | `/admin/videos/{video_id}/edit` | ë¹„ë””ì˜¤ ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_VIDEO_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-15 | `PATCH /admin/videos/bulk` | `/admin/videos/bulk` | ë¹„ë””ì˜¤ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_VIDEO_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-16 | `PATCH /admin/videos/{id}/tags` | `/admin/videos/{video_id}/tags` | ë¹„ë””ì˜¤ íƒœê·¸ ë‹¨ê±´ ìˆ˜ì • | ***íƒœê·¸ ê²€ì¦, ADMIN_VIDEO_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-17 | `PATCH /admin/videos/bulk/tags` | `/admin/videos/bulk/tags` | ë¹„ë””ì˜¤ íƒœê·¸ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_VIDEO_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-18 | `GET /admin/videos/stats/summary` | `/admin/videos/stats?from=&to=` | ë¹„ë””ì˜¤ í†µê³„ ìš”ì•½ | ***ì´ ì¡°íšŒìˆ˜/ì™„ë£Œìˆ˜/í™œì„±ë¹„ë””ì˜¤ìˆ˜, ê¸°ê°„ ê²€ì¦(max 366ì¼), RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-19 | `GET /admin/videos/stats/top` | `/admin/videos/stats?from=&to=&limit=&sort_by=` | TOP ë¹„ë””ì˜¤ ì¡°íšŒ | ***ì¡°íšŒìˆ˜/ì™„ë£Œìˆ˜ ì •ë ¬, limit 1-50, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-20 | `GET /admin/videos/stats/daily` | `/admin/videos/stats?from=&to=` | ë¹„ë””ì˜¤ ì¼ë³„ í†µê³„ | ***ì „ì²´ ì§‘ê³„, ì œë¡œí•„, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-21 | `GET /admin/videos/{id}/stats/daily` | `/admin/videos/{video_id}/stats?from=&to=` | ë¹„ë””ì˜¤ë³„ ì¼ë³„ í†µê³„ | ***VIDEO_STAT_DAILY ì¡°íšŒ, ì œë¡œí•„, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422** | [âœ…ğŸ†—] |

| 7-22 | `GET /admin/studies` | `/admin/studies?page=&size=&q=&sort=&order=` | í•™ìŠµ ë¬¸ì œ ì¡°íšŒ | ***ê²€ìƒ‰/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-23 | `GET /admin/studies/{id}` | `/admin/studies/{study_id}` | í•™ìŠµ ë¬¸ì œ ìƒì„¸ ì¡°íšŒ | ***tasks í¬í•¨, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-24 | `POST /admin/studies` | `/admin/studies/new` | í•™ìŠµ ë¬¸ì œ ë‹¨ê±´ ìƒì„± | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-25 | `POST /admin/studies/bulk` | `/admin/studies/bulk` | í•™ìŠµ ë¬¸ì œ ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-26 | `PATCH /admin/studies/{id}` | `/admin/studies/{study_id}/edit` | í•™ìŠµ ë¬¸ì œ ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-27 | `PATCH /admin/studies/bulk` | `/admin/studies/bulk` | í•™ìŠµ ë¬¸ì œ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-28 | `GET /admin/studies/tasks` | `/admin/studies/tasks?study_id=&page=&size=` | í•™ìŠµ Task ì¡°íšŒ | ***study_id í•„ìˆ˜, í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422/404** | [âœ…ğŸ†—] |
| 7-29 | `GET /admin/studies/tasks/{id}` | `/admin/studies/tasks/{task_id}` | í•™ìŠµ Task ìƒì„¸ ì¡°íšŒ | ***RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-30 | `POST /admin/studies/tasks` | `/admin/studies/tasks/new` | í•™ìŠµ Task ë‹¨ê±´ ìƒì„± | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **401/403/400/422/404/409** | [âœ…ğŸ†—] |
| 7-31 | `POST /admin/studies/tasks/bulk` | `/admin/studies/tasks/bulk` | í•™ìŠµ Task ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/404/409** | [âœ…ğŸ†—] |
| 7-32 | `PATCH /admin/studies/tasks/{id}` | `/admin/studies/tasks/{task_id}/edit` | í•™ìŠµ Task ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-33 | `PATCH /admin/studies/tasks/bulk` | `/admin/studies/tasks/bulk` | í•™ìŠµ Task ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-34 | `GET /admin/studies/tasks/explain` | `/admin/studies/tasks/explain?task_id=&page=&size=` | í•™ìŠµ í•´ì„¤ ì¡°íšŒ | ***task_id ê²€ì¦, í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422/404** | [âœ…ğŸ†—] |
| 7-35 | `POST /admin/studies/tasks/{id}/explain` | `/admin/studies/tasks/{task_id}/explain/new` | í•™ìŠµ í•´ì„¤ ë‹¨ê±´ ìƒì„± | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **401/403/400/422/404/409** | [âœ…ğŸ†—] |
| 7-36 | `POST /admin/studies/tasks/bulk/explain` | `/admin/studies/tasks/bulk/explain` | í•™ìŠµ í•´ì„¤ ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/404/409** | [âœ…ğŸ†—] |
| 7-37 | `PATCH /admin/studies/tasks/{id}/explain` | `/admin/studies/tasks/{task_id}/explain/edit` | í•™ìŠµ í•´ì„¤ ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-38 | `PATCH /admin/studies/tasks/bulk/explain` | `/admin/studies/tasks/bulk/explain` | í•™ìŠµ í•´ì„¤ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409/404** | [âœ…ğŸ†—] |
| 7-39 | `GET /admin/studies/tasks/status` | `/admin/studies/tasks/status?task_id=&page=&size=` | í•™ìŠµ ìƒíƒœ ì¡°íšŒ | ***task_id ê²€ì¦, í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422/404** | [âœ…ğŸ†—] |
| 7-40 | `PATCH /admin/studies/tasks/{id}/status` | `/admin/studies/tasks/{task_id}/status/edit` | í•™ìŠµ ìƒíƒœ ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-41 | `PATCH /admin/studies/tasks/bulk/status` | `/admin/studies/tasks/bulk/status` | í•™ìŠµ ìƒíƒœ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_STUDY_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409/404** | [âœ…ğŸ†—] |
| 7-42 | `GET /admin/studies/stats/summary` | `/admin/studies/stats?from=&to=` | í•™ìŠµ í†µê³„ ìš”ì•½ | ***ì´ í•™ìŠµìˆ˜/Taskìˆ˜/ì‹œë„ìˆ˜/í•´ê²°ìˆ˜/í•´ê²°ë¥ , Programë³„/Stateë³„ ë¶„í¬, ê¸°ê°„ ê²€ì¦(max 366ì¼), RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-43 | `GET /admin/studies/stats/top` | `/admin/studies/stats?from=&to=&limit=&sort_by=` | TOP í•™ìŠµ ì¡°íšŒ | ***ì‹œë„ìˆ˜/í•´ê²°ìˆ˜/í•´ê²°ë¥  ì •ë ¬, limit 1-50, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-44 | `GET /admin/studies/stats/daily` | `/admin/studies/stats?from=&to=` | í•™ìŠµ ì¼ë³„ í†µê³„ | ***ì¼ë³„ ì‹œë„ìˆ˜/í•´ê²°ìˆ˜/í™œì„±ì‚¬ìš©ì, ì œë¡œí•„, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |

| 7-45 | `GET /admin/lessons` | `/admin/lessons?page=&size=&q=&sort=&order=` | ìˆ˜ì—… ì¡°íšŒ | ***ê²€ìƒ‰/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-46 | `GET /admin/lessons/{id}` | `/admin/lessons/{lesson_id}` | ìˆ˜ì—… ìƒì„¸ ì¡°íšŒ | ***lesson_idë¡œ ë‹¨ê±´ ì¡°íšŒ, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-47 | `POST /admin/lessons` | `/admin/lessons/new` | ìˆ˜ì—… ë‹¨ê±´ ìƒì„± | ***ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-48 | `POST /admin/lessons/bulk` | `/admin/lessons/bulk-create` | ìˆ˜ì—… ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-49 | `PATCH /admin/lessons/{id}` | `/admin/lessons/{lesson_id}` | ìˆ˜ì—… ë‹¨ê±´ ìˆ˜ì • | ***ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-50 | `PATCH /admin/lessons/bulk` | `/admin/lessons` | ìˆ˜ì—… ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-51 | `GET /admin/lessons/items` | `/admin/lessons/items?page=&size=&lesson_id=` | ìˆ˜ì—… ì•„ì´í…œ ì¡°íšŒ | ***lesson_id í•„í„°, í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-52 | `GET /admin/lessons/items/{id}` | `/admin/lessons/{lesson_id}` (Items íƒ­) | ìˆ˜ì—… ì•„ì´í…œ ìƒì„¸ ì¡°íšŒ | ***lesson_idë¡œ ì•„ì´í…œ ëª©ë¡+ìƒì„¸ ì¡°íšŒ (video/task ì •ë³´ í¬í•¨), RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-53 | `POST /admin/lessons/{id}/items` | `/admin/lessons/{lesson_id}` (Items íƒ­) | ìˆ˜ì—… ì•„ì´í…œ ìƒì„± | ***insert_mode(error/shift), ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-54 | `POST /admin/lessons/bulk/items` | `/admin/lessons/bulk-create` | ìˆ˜ì—… ì•„ì´í…œ ë‹¤ì¤‘ ìƒì„± | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **201** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409** | [âœ…ğŸ†—] |
| 7-55 | `PATCH /admin/lessons/{id}/items/{seq}` | `/admin/lessons/{lesson_id}` (Items íƒ­) | ìˆ˜ì—… ì•„ì´í…œ ë‹¨ê±´ ìˆ˜ì • | ***seqë¡œ ì•„ì´í…œ ì§€ì •, ìˆœì„œ ê·œì¹™ ê²€ì¦, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-56 | `PATCH /admin/lessons/bulk/items` | `/admin/lessons/{lesson_id}` (Items íƒ­) | ìˆ˜ì—… ì•„ì´í…œ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409/404** | [âœ…ğŸ†—] |
| 7-57 | `DELETE /admin/lessons/{id}/items/{seq}` | `/admin/lessons/{lesson_id}` (Items íƒ­) | ìˆ˜ì—… ì•„ì´í…œ ë‹¨ê±´ ì‚­ì œ | ***seqë¡œ ì•„ì´í…œ ì§€ì •, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-58 | `DELETE /admin/lessons/bulk/items` | `/admin/lessons/{lesson_id}` (Items íƒ­) | ìˆ˜ì—… ì•„ì´í…œ ë‹¤ì¤‘ ì‚­ì œ | ***ë¶€ë¶„ ì„±ê³µ, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/404** | [âœ…ğŸ†—] |
| 7-59 | `GET /admin/lessons/progress` | `/admin/lessons/progress?page=&size=&lesson_id=&user_id=` | ìˆ˜ì—… ì§„í–‰ ì¡°íšŒ | ***lesson_id/user_id í•„í„°, í˜ì´ì§€ë„¤ì´ì…˜, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-60 | `GET /admin/lessons/progress/{id}` | `/admin/lessons/{lesson_id}` (Progress íƒ­) | ìˆ˜ì—… ì§„í–‰ ìƒì„¸ ì¡°íšŒ | ***lesson_idë¡œ ì‚¬ìš©ìë³„ ì§„í–‰í˜„í™© ëª©ë¡ ì¡°íšŒ (current_item í¬í•¨), RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404** | [âœ…ğŸ†—] |
| 7-61 | `PATCH /admin/lessons/{id}/progress` | `/admin/lessons/{lesson_id}` (Progress íƒ­) | ìˆ˜ì—… ì§„í–‰ ë‹¨ê±´ ìˆ˜ì • | ***user_id ì§€ì •, percent/last_item_seq ìˆ˜ì •, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/404/400/422/409** | [âœ…ğŸ†—] |
| 7-62 | `PATCH /admin/lessons/bulk/progress` | `/admin/lessons/{lesson_id}` (Progress íƒ­) | ìˆ˜ì—… ì§„í–‰ ë‹¤ì¤‘ ìˆ˜ì • | ***ë¶€ë¶„ ì„±ê³µ, ë‹¤ì¤‘ ì‚¬ìš©ì ì§„í–‰ ìˆ˜ì •, ADMIN_LESSON_LOG, RBAC***<br>ì„±ê³µ: **200** / ë¶€ë¶„: **207**<br>ì‹¤íŒ¨: **401/403/400/422/409/404** | [âœ…ğŸ†—] |

| 7-63 | `GET /admin/users/stats/summary` | `/admin/users/stats?from=&to=` | ì‚¬ìš©ì ìš”ì•½ í†µê³„ | ***ì´ ì‚¬ìš©ììˆ˜/ì‹ ê·œ/í™œì„±/ë¹„í™œì„±, ì—­í• ë³„ ì§‘ê³„, ê¸°ê°„ ê²€ì¦(max 366ì¼), RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-64 | `GET /admin/users/stats/signups` | `/admin/users/stats?from=&to=` | ì¼ë³„ ê°€ì… í†µê³„ | ***ì¼ë³„ ê°€ì…ìˆ˜, ì—­í• ë³„ ì§‘ê³„, ì œë¡œí•„, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-65 | `GET /admin/logins/stats/summary` | `/admin/logins/stats?from=&to=` | ë¡œê·¸ì¸ ìš”ì•½ í†µê³„ | ***ì´ ë¡œê·¸ì¸/ì„±ê³µ/ì‹¤íŒ¨/ê³ ìœ ì‚¬ìš©ì/í™œì„±ì„¸ì…˜, ê¸°ê°„ ê²€ì¦(max 366ì¼), RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-66 | `GET /admin/logins/stats/daily` | `/admin/logins/stats?from=&to=` | ì¼ë³„ ë¡œê·¸ì¸ í†µê³„ | ***ì¼ë³„ ì„±ê³µ/ì‹¤íŒ¨/ê³ ìœ ì‚¬ìš©ì, ì œë¡œí•„, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |
| 7-67 | `GET /admin/logins/stats/devices` | `/admin/logins/stats?from=&to=` | ë””ë°”ì´ìŠ¤ë³„ ë¡œê·¸ì¸ í†µê³„ | ***ë””ë°”ì´ìŠ¤ë³„ ì„±ê³µíšŸìˆ˜/ë¹„ìœ¨, RBAC***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422** | [âœ…ğŸ†—] |

| 7-68 | `POST /admin/upgrade` | `/admin/upgrade` | ê´€ë¦¬ì ì´ˆëŒ€ | ***ì´ˆëŒ€ ì½”ë“œ ìƒì„± + ì´ë©”ì¼ ë°œì†¡, RBAC(HYMNâ†’Admin/Manager, Adminâ†’Manager), Redis TTL 10ë¶„***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **401/403/400/422/409**(ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼) | [âœ…ğŸ†—] |
| 7-69 | `GET /admin/upgrade/verify` | `/admin/upgrade/join?code=xxx` | ì´ˆëŒ€ ì½”ë“œ ê²€ì¦ | ***Public, ì½”ë“œ ìœ íš¨ì„± ê²€ì¦, ì´ë©”ì¼/ì—­í•  ì •ë³´ ë°˜í™˜***<br>ì„±ê³µ: **200**<br>ì‹¤íŒ¨: **400/401**(ë§Œë£Œ/ë¬´íš¨ ì½”ë“œ) | [âœ…ğŸ†—] |
| 7-70 | `POST /admin/upgrade/accept` | `/admin/upgrade/join?code=xxx` | ê´€ë¦¬ì ê³„ì • ìƒì„± | ***Public(ì½”ë“œ í•„ìˆ˜), ê´€ë¦¬ì ê³„ì • ìƒì„±(OAuth ë¶ˆê°€), ì½”ë“œ ì‚­ì œ***<br>ì„±ê³µ: **201**<br>ì‹¤íŒ¨: **400/401/409/422** | [âœ…ğŸ†—] |

---

<details>
  <summary>5.7 Phase 7 â€” admin ê´€ë¦¬ì ì´ˆëŒ€ ì‹œë‚˜ë¦¬ì˜¤ (7-68 ~ 7-70)</summary>

#### ê´€ë¦¬ì ì´ˆëŒ€ ì‹œìŠ¤í…œ ê°œìš”

> ê´€ë¦¬ì ê³„ì •ì€ **ì˜¤ì§ ì´ˆëŒ€ë¥¼ í†µí•´ì„œë§Œ** ìƒì„± ê°€ëŠ¥. ì¼ë°˜ íšŒì›ê°€ì… í›„ ìŠ¹ê²© ë¶ˆê°€.

**ë³´ì•ˆ ì •ì±…**
- ê´€ë¦¬ì ê³„ì •: OAuth ë¡œê·¸ì¸ ë¹„í—ˆìš© (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë§Œ)
- ì´ˆëŒ€ ì½”ë“œ: Redis ì €ì¥, TTL 10ë¶„, ì¼íšŒìš©
- ê¸°ì¡´ ì´ë©”ì¼ë¡œ ì´ˆëŒ€ ì‹œ: ê±°ë¶€ (ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼)
- ê¶Œí•œë³„ ì´ˆëŒ€ ê°€ëŠ¥ ë²”ìœ„:
  | ìš”ì²­ì | ì´ˆëŒ€ ê°€ëŠ¥ ê¶Œí•œ |
  |--------|---------------|
  | HYMN | Admin, Manager |
  | Admin | Manager |
  | Manager | ë¶ˆê°€ (403) |

---

#### 7-68: `POST /admin/upgrade` (ê´€ë¦¬ì ì´ˆëŒ€)

**ìš”ì²­**
```json
{
  "email": "new-admin@example.com",
  "role": "admin"  // admin | manager
}
```

**ì‘ë‹µ (ì„±ê³µ 200)**
```json
{
  "message": "Invitation sent successfully",
  "expires_at": "2026-02-04T12:10:00Z"
}
```

**ì²˜ë¦¬ íë¦„**
1. ìš”ì²­ì ê¶Œí•œ ê²€ì¦ (HYMN/Adminë§Œ)
2. ì´ˆëŒ€ ê°€ëŠ¥ role ê²€ì¦ (HYMNâ†’Admin/Manager, Adminâ†’Manager)
3. ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (ê¸°ì¡´ ê°€ì…ìë©´ 409)
4. ì´ˆëŒ€ ì½”ë“œ ìƒì„±: `ak_upgrade_{uuid}`
5. Redis ì €ì¥: `ak:upgrade:{code}` â†’ `{email, role, invited_by, created_at}`, TTL 10ë¶„
6. ì´ë©”ì¼ ë°œì†¡ (AWS SES)
7. ì´ˆëŒ€ ë¡œê·¸ ê¸°ë¡

**ì‹¤íŒ¨ ì¼€ì´ìŠ¤**
- **401**: ë¯¸ì¸ì¦
- **403**: ê¶Œí•œ ë¶€ì¡± (Managerê°€ ì´ˆëŒ€ ì‹œë„, Adminì´ Admin ì´ˆëŒ€ ì‹œë„)
- **409**: ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼
- **422**: ìœ íš¨í•˜ì§€ ì•Šì€ role

---

#### 7-69: `GET /admin/upgrade/verify` (ì´ˆëŒ€ ì½”ë“œ ê²€ì¦)

**ìš”ì²­**: `GET /admin/upgrade/verify?code=ak_upgrade_xxx`

**ì‘ë‹µ (ì„±ê³µ 200)**
```json
{
  "email": "new-admin@example.com",
  "role": "admin",
  "invited_by": "hymn@amazingkorean.net",
  "expires_at": "2026-02-04T12:10:00Z"
}
```

**ì‹¤íŒ¨ ì¼€ì´ìŠ¤**
- **400**: ì½”ë“œ íŒŒë¼ë¯¸í„° ëˆ„ë½
- **401**: ë§Œë£Œ/ë¬´íš¨ ì½”ë“œ

---

#### 7-70: `POST /admin/upgrade/accept` (ê´€ë¦¬ì ê³„ì • ìƒì„±)

**ìš”ì²­**
```json
{
  "code": "ak_upgrade_xxx",
  "password": "SecureP@ss123",
  "name": "í™ê¸¸ë™",
  "nickname": "admin_hong",
  "country": "KR",
  "birthday": "1990-01-01",
  "gender": "male",
  "language": "ko"
}
```

**ì‘ë‹µ (ì„±ê³µ 201)**
```json
{
  "user_id": 123,
  "email": "new-admin@example.com",
  "user_auth": "admin",
  "message": "Admin account created successfully"
}
```

**ì²˜ë¦¬ íë¦„**
1. ì½”ë“œ ê²€ì¦ (Redis ì¡°íšŒ)
2. ë¹„ë°€ë²ˆí˜¸ í•´ì‹± (Argon2id)
3. ì‚¬ìš©ì ìƒì„± (user_auth = ì´ˆëŒ€ ì‹œ ì§€ì •ëœ role)
4. ì´ˆëŒ€ ì½”ë“œ ì‚­ì œ (ì¼íšŒìš©)
5. ì´ˆëŒ€ ìˆ˜ë½ ë¡œê·¸ ê¸°ë¡
6. (ì„ íƒ) ìë™ ë¡œê·¸ì¸ í† í° ë°œê¸‰

**ì‹¤íŒ¨ ì¼€ì´ìŠ¤**
- **400**: í•„ìˆ˜ í•„ë“œ ëˆ„ë½, í˜•ì‹ ì˜¤ë¥˜
- **401**: ë§Œë£Œ/ë¬´íš¨ ì½”ë“œ
- **409**: ì½”ë“œ ì´ë¯¸ ì‚¬ìš©ë¨
- **422**: ë¹„ë°€ë²ˆí˜¸ ì •ì±… ìœ„ë°˜, ë‹‰ë„¤ì„ ì¤‘ë³µ

</details>

---

<details>
  <summary>5.7 Phase 7 â€” admin ê³µí†µ ì •ì±… & ì‹œë‚˜ë¦¬ì˜¤ í…œí”Œë¦¿</summary>

#### ê³µí†µ ë³´ì•ˆ/ê¶Œí•œ
- ë¯¸ì¸ì¦: Auth=stop â†’ **401**
- ê¶Œí•œ ë¶€ì¡±(RBAC): Auth=forbid â†’ **403**
- ë¦¬ì†ŒìŠ¤ ì€ë‹‰ ì „ëµ(ì„ íƒ): ë¯¼ê° ë¦¬ì†ŒìŠ¤ëŠ” **404**ë¡œ ì€ë‹‰ ê°€ëŠ¥

#### ì—ëŸ¬ ìŠ¤í‚¤ë§ˆ(ê³ ì •)
`{ "error": { "http_status": 400|401|403|404|409|422|429|500, "code": "...", "message": "...", "details": {}, "trace_id": "..." } }`

#### ê²€ì¦ ê¸°ì¤€
- **400**: í˜•ì‹/ëˆ„ë½/íŒŒì‹± ì‹¤íŒ¨(ì˜ˆ: page=abc, size<1, ì˜ëª»ëœ ì •ë ¬ë¬¸ë²•)
- **422**: ë„ë©”ì¸ ì œì•½ ìœ„ë°˜(í—ˆìš©ë˜ì§€ ì•Šì€ sort í•„ë“œ, size ìƒí•œ ì´ˆê³¼, ë¹„ì¦ˆ ê·œì¹™ ìœ„ë°˜)
- **409**: ê³ ìœ ì œì•½/ìƒíƒœì¶©ëŒ(ì¤‘ë³µ ì´ë©”ì¼/íƒœê·¸, ì‚­ì œëœ ë¦¬ì†ŒìŠ¤ ìˆ˜ì • ê¸ˆì§€ ë“±)
- **429**: ëŒ€ëŸ‰/ì—°ì† ì‘ì—… ì°¨ë‹¨(ì„ íƒ, Retry-After í¬í•¨)

#### ë¡œê¹…(í•„ìˆ˜)
- ëª¨ë“  Admin ì—”ë“œí¬ì¸íŠ¸: ì„±ê³µ/ì‹¤íŒ¨ ëª¨ë‘ `admin_*_log` ê¸°ë¡(ìš”ì²­ ìš”ì•½, actor user_id, ëŒ€ìƒ/ê°œìˆ˜, ê²°ê³¼ì½”ë“œ, trace_id). ë¯¼ê°ê°’ì€ ë§ˆìŠ¤í‚¹.

---

#### ëª©ë¡/ì¡°íšŒ ê³µí†µ ì‹œë‚˜ë¦¬ì˜¤(ì˜ˆ: GET /admin/videos)
- ì„±ê³µ(ë°ì´í„° ìˆìŒ/ì—†ìŒ) â†’ **200**  
  Auth pass / Page initâ†’ready / Request pendingâ†’success / Data present|empty
- ì‹¤íŒ¨(ë¯¸ì¸ì¦/ê¶Œí•œ) â†’ **401**/**403**
- ì‹¤íŒ¨(í˜•ì‹/ë„ë©”ì¸) â†’ **400**/**422**

---

#### ë‹¨ê±´ ìƒì„± í…œí”Œë¦¿(ì˜ˆ: POST /admin/videos)
- ì„±ê³µ â†’ **201**  
  Page initâ†’ready / Form pristineâ†’dirtyâ†’validatingâ†’submittingâ†’success / Request pendingâ†’success / Data present  
  í—¤ë”: `Location: /admin/videos/{id}`
- ì‹¤íŒ¨(í˜•ì‹/ë„ë©”ì¸/ì¤‘ë³µ/ê¶Œí•œ) â†’ **400**/**422**/**409**/**401**/**403**

---

#### ë‹¤ì¤‘ ìƒì„±(ë²Œí¬) í…œí”Œë¦¿
- ì„±ê³µ(ì „ëŸ‰) â†’ **201**
- ì„±ê³µ(ë¶€ë¶„) â†’ **207**
- ì‹¤íŒ¨ í•­ëª©ì€ ë°°ì—´ë¡œ ì—ëŸ¬ ì‚¬ìœ  ì œê³µ(ì˜ˆ: 400/422/409)

---

#### ë‹¨ê±´ ìˆ˜ì • í…œí”Œë¦¿(ì˜ˆ: PATCH /admin/lessons/{id})
- ì„±ê³µ â†’ **200** ë˜ëŠ” **204**
- ì‹¤íŒ¨ â†’ **401**/**403**/**404**/**400**/**422**/**409**

---

#### ë²Œí¬ ìˆ˜ì • í…œí”Œë¦¿
- ì„±ê³µ(ì „ëŸ‰) â†’ **200** ë˜ëŠ” **204**
- ì„±ê³µ(ë¶€ë¶„) â†’ **207**
- ì‹¤íŒ¨ í•­ëª©ë³„ ì—ëŸ¬ ì‚¬ìœ  í¬í•¨

---

#### í†µê³„ ì¡°íšŒ(ì˜ˆ: GET /admin/videos/{id}/stats)
- ì„±ê³µ â†’ **200** (ë¹ˆ êµ¬ê°„ë„ **200**)
- ì‹¤íŒ¨ â†’ **401**/**403**/**404**/**400**/**422**  
  (ê¸°ê°„(fromâ‰¤to)Â·ê·¸ë¼ë‰¼ëŸ¬ë¦¬í‹° ê²€ì¦ í¬í•¨)

</details>

---

### 5.8 Phase 8 â€” scripts
| ë²ˆí˜¸ | ì‘ì—… | ê¸°ëŠ¥ ëª…ì¹­ | ì ê²€ì‚¬í•­ | ê¸°ëŠ¥ ì™„ë£Œ |
|---|---|---|---|---|
| 8-1 | Docker/ENV | ë¡œì»¬/ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ | ì¼ê´€ëœ `up/run` ìŠ¤í¬ë¦½íŠ¸í™” | [ ] |
| 8-2 | Migration | DB ì´ˆê¸°í™”/ì—…ë°ì´íŠ¸ | `sqlx migrate run` í‘œì¤€í™” | [ ] |
| 8-3 | Smoke | cURL/K6 ìŠ¤ëª¨í¬ | ì„±ê³µÂ·ì‹¤íŒ¨ 1ì¼€ì´ìŠ¤ ìë™í™” | [ ] |

---

### ë¹„ê³ 
- ì½”ìŠ¤(Course)ëŠ” í›„ìˆœìœ„. ERD ì •ë¦¬ í›„ ë³„ë„ Phaseë¡œ ì¶”ê°€ ì˜ˆì •.
- ëª¨ë“  PhaseëŠ” "**ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ â†’ í”„ë¡ íŠ¸ 1í™”ë©´ ì—°ë™ â†’ ìŠ¤ëª¨í¬(ì„±ê³µ+ëŒ€í‘œ ì—ëŸ¬)**" ìˆœìœ¼ë¡œ ì™„ë£Œ í‘œì‹œ.

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 6. í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡° & ê·œì¹™

> ëª©ì : AMK ë°±ì—”ë“œ(API)ì™€ ì¼ê´€ë˜ê²Œ ë™ì‘í•˜ëŠ” **Vite + React + Tailwind** ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œì˜ ê³µí†µ ê·œì¹™ì„ ì •ì˜í•œë‹¤.  
> ì´ ì„¹ì…˜ì€ **ì›¹(ë°˜ì‘í˜•, ì•±ê¹Œì§€ ê³ ë ¤)** ì„ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.

---

### 6.1 í”„ë¡ íŠ¸ì—”ë“œ ìŠ¤íƒ & ê¸°ë³¸ ì›ì¹™

> ëª©ì : AMK ë°±ì—”ë“œ(API)ì™€ ì¼ê´€ë˜ê²Œ ë™ì‘í•˜ë©°, **í•œêµ­ì–´ í•™ìŠµì í™˜ê²½(ì €ì‚¬ì–‘/ë°ì´í„° ì ˆì•½)**ì— ìµœì í™”ëœ **"Lightweight React"** ì•„í‚¤í…ì²˜ë¥¼ ì •ì˜í•œë‹¤.

- **ê¸°ìˆ  ìŠ¤íƒ (Strict)**
  - **Core**: Vite + React + TypeScript
    - *Create React App(CRA) ë° Next.js ì‚¬ìš© ê¸ˆì§€ (SPA ëª¨ë“œ ìœ ì§€)*
  - **Styling**: Tailwind CSS
  - **UI Library**: **shadcn/ui** (Radix UI ê¸°ë°˜ Headless)
    - *MUI, AntD ë“± ë²ˆë“¤ ì‚¬ì´ì¦ˆê°€ í° UI í”„ë ˆì„ì›Œí¬ ë°˜ì… ê¸ˆì§€*
  - **State Management**:
    - **Server State**: **TanStack Query (React Query)** (API ìºì‹± ë° ë¡œë”© ìƒíƒœ ê´€ë¦¬)
    - **Global Client State**: **Zustand** (ë¡œê·¸ì¸ ì„¸ì…˜ ë“± ìµœì†Œí•œì˜ ì „ì—­ ìƒíƒœ)
    - **Form**: **React Hook Form** + **Zod** (ë Œë”ë§ ìµœì í™” ë° ìŠ¤í‚¤ë§ˆ ê²€ì¦)
  - **Routing**: React Router (v6)
  - **i18n (ë‹¤êµ­ì–´)**: **react-i18next** + **i18next** (ko/en ì§€ì›, ìˆ˜ë™ ì „í™˜ ë°©ì‹)
  - **HTTP**: `fetch` API ë˜í¼ (Axios ì‚¬ìš© ì§€ì–‘, `src/api/client.ts`ë¡œ í†µì¼)

- **ì„¤ê³„ ê¸°ë³¸ ì›ì¹™**
  1. **ë‹¨ì¼ ì†ŒìŠ¤ ì˜¤ë¸Œ íŠ¸ë£¨ìŠ¤ (SSOT)**
     - ë°±ì—”ë“œ ìŠ¤í™/ì—”ë“œí¬ì¸íŠ¸/ìƒíƒœì½”ë“œ/ì—ëŸ¬ ì •ì±…ì€ **í•­ìƒ AMK_API_MASTER.md** ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.
  
  2. **ì„±ëŠ¥ ë° ë°ì´í„° ìµœì í™” (Data Saver First)**
     - **ëª©í‘œ**: ì¸í„°ë„· í™˜ê²½ì´ ì¢‹ì§€ ì•Šì€ êµ­ê°€ì˜ í•™ìŠµìë¥¼ ìœ„í•´ ì´ˆê¸° ë¡œë”© ì†ë„ì™€ ë°ì´í„° ì†Œëª¨ë¥¼ ìµœì†Œí™”í•œë‹¤.
     - **Code Splitting**: ëª¨ë“  í˜ì´ì§€ ë¼ìš°íŠ¸ëŠ” `React.lazy`ì™€ `Suspense`ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ë¡œë”©í•œë‹¤.
     - **Asset Lazy Loading**: ì´ë¯¸ì§€ì™€ ë¹„ë””ì˜¤(Vimeo Player SDK í¬í•¨)ëŠ” ë·°í¬íŠ¸ì— ë“¤ì–´ì˜¤ê±°ë‚˜ ì‚¬ìš©ìê°€ ìƒí˜¸ì‘ìš©(í´ë¦­)í•˜ê¸° ì „ê¹Œì§€ ì ˆëŒ€ ë¯¸ë¦¬ ë¡œë“œí•˜ì§€ ì•ŠëŠ”ë‹¤.
     - **No Heavy Libs**: Gzip ê¸°ì¤€ **10kb**ë¥¼ ì´ˆê³¼í•˜ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ ì‹œ, ë°˜ë“œì‹œ ëŒ€ì²´ì¬(ì§ì ‘ êµ¬í˜„ ë˜ëŠ” ê²½ëŸ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬)ë¥¼ ê²€í† í•œë‹¤.

  3. **ëª¨ë°”ì¼ í¼ìŠ¤íŠ¸ & ì•± í™•ì¥ì„± (Mobile First Architecture)**
     - **ë°˜ì‘í˜•**: ëª¨ë“  UIëŠ” ëª¨ë°”ì¼(`sm`) ê¸°ì¤€ìœ¼ë¡œ ë¨¼ì € ì„¤ê³„í•˜ê³ , íƒœë¸”ë¦¿(`md`) ë° ë°ìŠ¤í¬í†±(`lg`)ìœ¼ë¡œ í™•ì¥í•œë‹¤.
     - **ë¡œì§ ë¶„ë¦¬ (Hook Separation)**:
       - í–¥í›„ **React Native ëª¨ë°”ì¼ ì•±** í™•ì¥ì„ ê³ ë ¤í•˜ì—¬, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì»´í¬ë„ŒíŠ¸(UI) ë‚´ë¶€ì— ì‘ì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.
       - ë°˜ë“œì‹œ **Custom Hook** (`useAuth`, `useVideoPlayer` ë“±)ìœ¼ë¡œ ì¶”ì¶œí•˜ì—¬ UIì™€ ë¡œì§ì„ 100% ë¶„ë¦¬í•œë‹¤.

  4. **ë„ë©”ì¸(Category) ì£¼ë„ êµ¬ì¡°**
     - ë°±ì—”ë“œì™€ ë™ì¼í•˜ê²Œ `auth / user / video / study / lesson / admin` ë„ë©”ì¸ ê¸°ì¤€ìœ¼ë¡œ í´ë”ì™€ ë¡œì§ì„ ê²©ë¦¬í•œë‹¤.
     - í˜ì´ì§€ ì•ˆì—ì„œ "ì¦‰ì„ ì»´í¬ë„ŒíŠ¸"ë¥¼ ë§Œë“¤ì§€ ì•Šê³ , `common/ui`ì˜ ë””ìì¸ ì‹œìŠ¤í…œì„ ì¡°ë¦½í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

---

### 6.2 í”„ë¡ íŠ¸ ë””ë ‰í„°ë¦¬ êµ¬ì¡° & ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ

> ëª©ì : **ë„ë©”ì¸ ì£¼ë„(Domain-Driven)** êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, shadcn/ui í‘œì¤€ê³¼ React Hook íŒ¨í„´ì„ ê²°í•©í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì„ ê·¹ëŒ€í™”í•œë‹¤.

#### 6.2.1 ë””ë ‰í„°ë¦¬ êµ¬ì¡° (Strict)

- ê¸°ì¤€ ê²½ë¡œ: `frontend/src/`

```text
src/
  app/
    router.tsx           # ë¼ìš°íŠ¸ ì •ì˜ (React Router v6)
    layout_root.tsx      # ìµœìƒìœ„ ë ˆì´ì•„ì›ƒ (AppShell)
    providers.tsx        # ì „ì—­ Provider ëª¨ìŒ (QueryClient, AuthProvider ë“±)
  
  api/
    client.ts            # fetch ë˜í¼ (Axios ì§€ì–‘), Interceptor (í† í°/ì—ëŸ¬)
    # ë„ë©”ì¸ë³„ API í˜¸ì¶œ í•¨ìˆ˜ (fetcher)
    auth.ts
    user.ts
    video.ts
    study.ts
    lesson.ts
    admin.ts

  category/              # â˜… í•µì‹¬: ë„ë©”ì¸ë³„ ê¸°ëŠ¥ ê²©ë¦¬ (Vertical Slicing)
    auth/
      page/              # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ (Routeì™€ 1:1 ë§¤í•‘)
      component/         # í•´ë‹¹ ë„ë©”ì¸ ì „ìš© UI ì¡°ê°
      hook/              # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ & Custom Hook (UI ë¶„ë¦¬ ì›ì¹™)
      types.ts           # í•´ë‹¹ ë„ë©”ì¸ ì „ìš© Request/Response DTO íƒ€ì…
    user/
      page/
      component/
      hook/
      types.ts
    video/
      # ... (ë™ì¼ êµ¬ì¡°)
    study/
      # ... (ë™ì¼ êµ¬ì¡°)
    lesson/
      # ... (ë™ì¼ êµ¬ì¡°)
    admin/
      # ... (ë™ì¼ êµ¬ì¡°)

  components/            # ê³µìš© ì»´í¬ë„ŒíŠ¸ (Horizontal Slicing)
    ui/                  # â˜… shadcn/ui ì„¤ì¹˜ ê²½ë¡œ (Button, Dialog ë“±)
    layout/              # Header, Footer, Sidebar ë“± ë ˆì´ì•„ì›ƒ ì¡°ê°
    shared/              # ë„ë©”ì¸ì— ì¢…ì†ë˜ì§€ ì•ŠëŠ” ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ (LoadingSpinner ë“±)

  i18n/                  # â˜… ë‹¤êµ­ì–´(i18n) ëª¨ë“ˆ
    index.ts             # i18next ì´ˆê¸°í™”, changeLanguage/getSavedLanguage í—¬í¼
    locales/
      ko.json            # í•œêµ­ì–´ ë²ˆì—­ (ê¸°ë³¸ ì–¸ì–´)
      en.json            # ì˜ì–´ ë²ˆì—­

  hooks/                 # ì „ì—­ Custom Hook
    use_auth.ts          # ì¸ì¦ ìƒíƒœ ê´€ë¦¬ (Zustand + Logic)
    use_language_sync.ts # DB ì–¸ì–´ ì„¤ì • â†” i18n ë™ê¸°í™”
    use_toast.ts         # ì•Œë¦¼ UI ì œì–´
    use_mobile.ts        # ëª¨ë°”ì¼ ê°ì§€ ë° ë°˜ì‘í˜• ì²˜ë¦¬

  lib/
    utils.ts             # cn() ë“± shadcn/ui í•„ìˆ˜ ìœ í‹¸
    constants.ts         # ì „ì—­ ìƒìˆ˜
    format.ts            # ë‚ ì§œ/ì‹œê°„/í†µí™” í¬ë§·í„°
```

> **ë„¤ì´ë° ê·œì¹™ (Strict)**
> - **Files**:
>   - React ì»´í¬ë„ŒíŠ¸ (`.tsx`): **PascalCase** (ì˜ˆ: `LoginPage.tsx`, `VideoCard.tsx`)
>   - ê·¸ ì™¸ TS íŒŒì¼ (`.ts`): **snake_case** (ì˜ˆ: `video_api.ts`, `use_auth.ts`, `utils.ts`)
> - **Code**:
>   - ì»´í¬ë„ŒíŠ¸/ì¸í„°í˜ì´ìŠ¤/íƒ€ì…ëª…: **PascalCase**
>   - ë³€ìˆ˜/í•¨ìˆ˜ëª…: **camelCase**
>   - **API DTO í•„ë“œëª…**: ë°±ì—”ë“œ DB ì»¬ëŸ¼ëª…ê³¼ 100% ì¼ì¹˜í•˜ëŠ” **snake_case** (ì˜ˆ: `video_id`, `is_completed`)
>     - *í”„ë¡ íŠ¸ì—”ë“œì—ì„œ camelCaseë¡œ ë³€í™˜í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤.*

#### 6.2.2 ì»´í¬ë„ŒíŠ¸ 3ë‹¨ê³„ ê³„ì¸µ

1. **Page ì»´í¬ë„ŒíŠ¸ (`category/*/page/`)**
   - **ì—­í• **: ë¼ìš°íŒ…ì˜ ì¢…ì°©ì . ë°ì´í„° í˜ì¹­(`useQuery`)ê³¼ ë ˆì´ì•„ì›ƒ ì¡°ë¦½ë§Œ ë‹´ë‹¹.
   - **ê·œì¹™**:
     - `useEffect` ë“± ë³µì¡í•œ ë¡œì§ì„ ì§ì ‘ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤. (Hookìœ¼ë¡œ ìœ„ì„)
     - ìŠ¤íƒ€ì¼ë§(Tailwind)ì„ ìµœì†Œí™”í•˜ê³ , `component`ë“¤ì„ ë°°ì¹˜í•˜ëŠ” ë° ì§‘ì¤‘í•œë‹¤.
     - íŒŒì¼ëª… ì˜ˆì‹œ: `VideoListPage.tsx`, `SignupPage.tsx`

2. **ë„ë©”ì¸ ì»´í¬ë„ŒíŠ¸ (`category/*/component/`)**
   - **ì—­í• **: íŠ¹ì • ë„ë©”ì¸ ê¸°ëŠ¥(ë¹„ë””ì˜¤ í”Œë ˆì´ì–´, ë¬¸ì œ í’€ì´ í¼)ì„ ìˆ˜í–‰í•˜ëŠ” UI ë¸”ë¡.
   - **ê·œì¹™**:
     - í•´ë‹¹ ë„ë©”ì¸(`category`) ë‚´ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤.
     - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í•„ìš”í•œ ê²½ìš°, ìƒìœ„ Pageì—ì„œ Propsë¡œ ë°›ê±°ë‚˜ ì „ìš© Hookì„ ì‚¬ìš©í•œë‹¤.
     - íŒŒì¼ëª… ì˜ˆì‹œ: `VideoPlayer.tsx`, `AnswerForm.tsx`

3. **ê³µìš© UI ì»´í¬ë„ŒíŠ¸ (`components/ui/`)**
   - **ì—­í• **: ë””ìì¸ ì‹œìŠ¤í…œì˜ ì›ì(Atom). (`shadcn/ui` ì»´í¬ë„ŒíŠ¸ë“¤)
   - **ê·œì¹™**:
     - **ë„ë©”ì¸ ë¡œì§(ë¹„ì¦ˆë‹ˆìŠ¤)ì„ ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤.**
     - `className` propì„ í†µí•´ ì™¸ë¶€ì—ì„œ ìŠ¤íƒ€ì¼ í™•ì¥ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
     - íŒŒì¼ëª… ì˜ˆì‹œ: `Button.tsx`, `Dialog.tsx`

#### 6.2.3 í›…(Hook) & API ë ˆì´ì–´ ì„¤ê³„

- **API Layer (`src/api/*.ts`)**
  - ìˆœìˆ˜ í•¨ìˆ˜(Pure Function)ë¡œ êµ¬ì„±ëœ `fetch` í˜¸ì¶œë¶€.
  - React ì˜ì¡´ì„±(State, Hook)ì´ ì „í˜€ ì—†ì–´ì•¼ í•œë‹¤.
  - `client.ts`ë¥¼ importí•˜ì—¬ ì‚¬ìš©í•œë‹¤.

- **Query Hook (`category/*/hook/`)**
  - **TanStack Query**ë¥¼ ë˜í•‘í•˜ì—¬ ë°ì´í„° ìƒíƒœ(`isLoading`, `data`, `error`)ë¥¼ ì œê³µí•˜ëŠ” í›….
  - ì˜ˆ: `useVideoListQuery`, `useVideoProgressMutation`
  - ì´ ê³„ì¸µì—ì„œ **API ì‘ë‹µ íƒ€ì…(DTO)**ê³¼ **í”„ë¡ íŠ¸ì—”ë“œ ë·° ëª¨ë¸** ê°„ì˜ ë³€í™˜ì´ í•„ìš”í•˜ë‹¤ë©´ ìˆ˜í–‰í•œë‹¤. (ë‹¨, ê¸°ë³¸ì ìœ¼ë¡œëŠ” DTO êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥)

- **Logic Hook (`category/*/hook/`)**
  - UI ìƒíƒœ(Form, Modal open/close)ì™€ ì‚¬ìš©ì ì¸í„°ë™ì…˜ í•¸ë“¤ëŸ¬ë¥¼ ìº¡ìŠí™”.
  - Page ì»´í¬ë„ŒíŠ¸ê°€ "Controller" ì—­í• ì„ í•˜ì§€ ì•Šë„ë¡ ë¡œì§ì„ ë¶„ë¦¬í•´ë‚´ëŠ” í•µì‹¬ ê³„ì¸µ.
  - ì˜ˆ: `useSignupForm`, `useVideoPlayerController`

#### 6.2.4 ë‹¤êµ­ì–´(i18n) ì•„í‚¤í…ì²˜

> ëª©ì : í•œêµ­ì–´(ko)ì™€ ì˜ì–´(en)ë¥¼ ì§€ì›í•˜ë©°, **ì‚¬ìš©ì ìˆ˜ë™ ì „í™˜** ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë¸Œë¼ìš°ì € ì–¸ì–´ ìë™ ê°ì§€ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

##### ì§€ì› ì–¸ì–´ & ê¸°ë³¸ê°’

| ì½”ë“œ | ì–¸ì–´ | ë¹„ê³  |
|------|------|------|
| `ko` | í•œêµ­ì–´ | **ê¸°ë³¸ ì–¸ì–´ (fallback)** |
| `en` | English | |

##### ì–¸ì–´ ê²°ì • ìš°ì„ ìˆœìœ„

```
1. DB user_set_language (ë¡œê·¸ì¸ ìƒíƒœ)
2. localStorage "language" í‚¤
3. ê¸°ë³¸ê°’ "ko"
```

- **ë¡œê·¸ì¸ ì‹œ**: `useLanguageSync` í›…ì´ DBì˜ `user_set_language`ë¥¼ ê°€ì ¸ì™€ i18n + localStorageì— ì ìš© (ìµœì´ˆ 1íšŒ)
- **ë¹„ë¡œê·¸ì¸ ì‹œ**: localStorageì— ì €ì¥ëœ ì–¸ì–´ë¥¼ ìœ ì§€
- **ë¡œê·¸ì•„ì›ƒ ì‹œ**: ë§ˆì§€ë§‰ ì„ íƒí•œ ì–¸ì–´ë¥¼ localStorageì—ì„œ ìœ ì§€

##### ë²ˆì—­ íŒŒì¼ êµ¬ì¡°

- ê²½ë¡œ: `src/i18n/locales/{ko,en}.json`
- ë„¤ì„ìŠ¤í˜ì´ìŠ¤ êµ¬ì¡° (í”Œë« JSON, ë„ë©”ì¸ë³„ prefix):

```json
{
  "common": { "loading": "...", "save": "..." },
  "nav":    { "about": "...", "login": "..." },
  "footer": { "brandDescription": "...", "copyright": "..." },
  "auth":   { "loginTitle": "...", "signupButton": "..." },
  "user":   { "myPageTitle": "...", "settingsTitle": "..." },
  "home":   { "heroTitle": "...", "ctaStart": "..." },
  "about":  { "badge": "...", "missionTitle": "..." },
  "study":  { "listTitle": "...", "kindChoice": "..." },
  "lesson": { "listTitle": "...", "accessPaid": "..." },
  "video":  { "listTitle": "...", "emptyTitle": "..." },
  "error":  { "notFoundTitle": "...", "accessDeniedTitle": "..." }
}
```

- **ê·œì¹™**: ko.jsonê³¼ en.jsonì˜ í‚¤ êµ¬ì¡°ëŠ” **ë°˜ë“œì‹œ 1:1 ì¼ì¹˜**í•´ì•¼ í•œë‹¤.
- **ë³´ê°„(Interpolation)**: `{{variable}}` ë¬¸ë²• ì‚¬ìš© (ì˜ˆ: `"ì´ {{count}}ê°œ"`)

##### ì½”ë“œ ì‚¬ìš© íŒ¨í„´

| ì»¨í…ìŠ¤íŠ¸ | íŒ¨í„´ | ì˜ˆì‹œ |
|----------|------|------|
| React ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ | `useTranslation` í›… | `const { t } = useTranslation();` â†’ `t("auth.loginTitle")` |
| React ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ (Hook, Zod ìŠ¤í‚¤ë§ˆ ë“±) | `i18n.t()` ì§ì ‘ í˜¸ì¶œ | `import i18n from "@/i18n";` â†’ `i18n.t("common.requestFailed")` |
| ì–¸ì–´ ë³€ê²½ | `changeLanguage` í—¬í¼ | `import { changeLanguage } from "@/i18n";` â†’ `changeLanguage("en")` |

##### ì–¸ì–´ ì „í™˜ UI & ë™ê¸°í™”

- **í—¤ë” í† ê¸€**: Globe ì•„ì´ì½˜ ë²„íŠ¼ìœ¼ë¡œ koâ†”en ì „í™˜
  - ë°ìŠ¤í¬í†±: `"EN"` / `"KO"` ì•½ì–´ í‘œì‹œ
  - ëª¨ë°”ì¼: `"English"` / `"í•œêµ­ì–´"` ì „ì²´ í‘œì‹œ (ì „í™˜ ëŒ€ìƒ ì–¸ì–´ë¥¼ í•´ë‹¹ ì–¸ì–´ë¡œ í‘œê¸°)
  - ë¡œê·¸ì¸ ìƒíƒœì¼ ê²½ìš° `useUpdateSettings`ë¡œ DBì—ë„ ì €ì¥
- **ì„¤ì • í˜ì´ì§€**: Select ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì–¸ì–´ ì„ íƒ â†’ ì €ì¥ ì‹œ DB + i18n ë™ì‹œ ì ìš©
- **ë™ê¸°í™”**: í—¤ë” í† ê¸€ ë³€ê²½ ì‹œ `i18n.language` ë³€ê²½ ê°ì§€ë¥¼ í†µí•´ ì„¤ì • í˜ì´ì§€ formì— ì¦‰ì‹œ ë°˜ì˜

##### ì ìš© ë²”ìœ„

| ëŒ€ìƒ | i18n ì ìš© | ë¹„ê³  |
|------|-----------|------|
| ì‚¬ìš©ì ëŒ€ë©´ í˜ì´ì§€ (í™ˆ, ë¡œê·¸ì¸, í•™ìŠµ ë“±) | O | ëª¨ë“  UI í…ìŠ¤íŠ¸ `t()` ì²˜ë¦¬ |
| ë ˆì´ì•„ì›ƒ (í—¤ë”, í‘¸í„°) | O | |
| ì—ëŸ¬ í˜ì´ì§€ (404, 403, 500) | O | |
| ê´€ë¦¬ì(Admin) í˜ì´ì§€ | X | í•œêµ­ì–´ ì „ìš© (ê´€ë¦¬ìê°€ í•œêµ­ì–´ ì‚¬ìš©ì) |
| Zod ìœ íš¨ì„± ê²€ì¦ ë©”ì‹œì§€ | O | `i18n.t()` íŒ¨í„´ ì‚¬ìš© |
| Toast ì•Œë¦¼ ë©”ì‹œì§€ | O | Hook ë‚´ì—ì„œ `i18n.t()` ì‚¬ìš© |

---

### 6.3 ë¼ìš°íŒ… & ì ‘ê·¼ ì œì–´

> ëª©ì : 5. ê¸°ëŠ¥ & API ë¡œë“œë§µì˜ â€œí™”ë©´ ê²½ë¡œâ€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, **Code Splittingì´ ì ìš©ëœ React Router íŠ¸ë¦¬**ì™€ **ì—„ê²©í•œ ì ‘ê·¼ ì œì–´(Auth/Admin Guard)**ë¥¼ ì •ì˜í•œë‹¤.

#### 6.3.1 ë¼ìš°íŠ¸ ë§¤í•‘ ì›ì¹™ (Lazy Loading í•„ìˆ˜)

- **ë¼ìš°íŠ¸ ì •ì˜ ìœ„ì¹˜**
  - `src/app/router.tsx` ì—ì„œ **ì „ì²´ ë¼ìš°íŠ¸ íŠ¸ë¦¬**ë¥¼ ì •ì˜í•œë‹¤.
  - **ì„±ëŠ¥ ì›ì¹™**: ëª¨ë“  í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ëŠ” `React.lazy`ë¡œ importí•˜ì—¬, ì´ˆê¸° ë²ˆë“¤ ì‚¬ì´ì¦ˆë¥¼ ìµœì†Œí™”í•´ì•¼ í•œë‹¤.

- **íŒŒì¼ëª… íŒ¨í„´ (ì˜ˆì‹œ)**
  - `/` â†’ `category/home/page/HomePage.tsx` (í™ˆ)
  - `/about` â†’ `category/about/page/AboutPage.tsx` (ì†Œê°œ)
  - `/login` â†’ `category/auth/page/LoginPage.tsx`
  - `/videos/:video_id` â†’ `category/video/page/VideoDetailPage.tsx`
  - `/admin/users` â†’ `category/admin/page/AdminUserListPage.tsx`
  - *íŒŒì¼ëª…ì€ PascalCaseë¥¼ ë”°ë¥¸ë‹¤.*

- **ë¼ìš°íŠ¸ êµ¬ì„± ì˜ˆì‹œ (Strict Code Splitting)**

```tsx
// app/router.tsx
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { Suspense, lazy } from "react";
import { AppShell } from "@/components/layout/AppShell"; // layout ê²½ë¡œ ìˆ˜ì •ë¨
import { RequireAuth } from "./route_guard_auth";
import { RequireAdmin } from "./route_guard_admin";
import { LoadingSpinner } from "@/components/shared/LoadingSpinner";

// â˜… í•µì‹¬: ëª¨ë“  í˜ì´ì§€ëŠ” Lazy Load ì²˜ë¦¬
const HomePage = lazy(() => import("@/category/home/page/HomePage"));
const AboutPage = lazy(() => import("@/category/about/page/AboutPage"));
const LoginPage = lazy(() => import("@/category/auth/page/LoginPage"));
const SignupPage = lazy(() => import("@/category/auth/page/SignupPage"));
const VideoListPage = lazy(() => import("@/category/video/page/VideoListPage"));
const VideoDetailPage = lazy(() => import("@/category/video/page/VideoDetailPage"));
const StudyListPage = lazy(() => import("@/category/study/page/StudyListPage"));
const LessonListPage = lazy(() => import("@/category/lesson/page/LessonListPage"));
const MePage = lazy(() => import("@/category/user/page/MePage"));
const AdminUserListPage = lazy(() => import("@/category/admin/page/AdminUserListPage"));

export function AppRouter() {
  return (
    <BrowserRouter>
      {/* Suspense: Lazy Loading ì¤‘ ë³´ì—¬ì¤„ Fallback UI */}
      <Suspense fallback={<LoadingSpinner fullScreen />}>
        <AppShell>
          <Routes>
            {/* Public Routes */}
            <Route path="/" element={<HomePage />} />
            <Route path="/about" element={<AboutPage />} />
            <Route path="/login" element={<LoginPage />} />
            <Route path="/signup" element={<SignupPage />} />
            <Route path="/videos" element={<VideoListPage />} />
            <Route path="/videos/:video_id" element={<VideoDetailPage />} />
            <Route path="/studies" element={<StudyListPage />} />
            <Route path="/lessons" element={<LessonListPage />} />

            {/* Protected Routes (Member) */}
            <Route element={<RequireAuth />}>
              <Route path="/me" element={<MePage />} />
            </Route>

            {/* Admin Routes (RBAC) */}
            <Route element={<RequireAdmin />}>
              <Route path="/admin/users" element={<AdminUserListPage />} />
              {/* ... other admin routes */}
            </Route>
            
            {/* 404 Handling */}
            <Route path="*" element={<div>Page Not Found</div>} />
          </Routes>
        </AppShell>
      </Suspense>
    </BrowserRouter>
  );
}
```

> ì‹¤ì œ êµ¬í˜„ ì‹œ íŒŒì¼ëª…/ì»´í¬ë„ŒíŠ¸ëª…ì€ ì´ ë¬¸ì„œì˜ **ë„¤ì´ë° ê·œì¹™(3.2.4 í”„ë¡ íŠ¸ì—”ë“œ ë„¤ì´ë°)** ì„ ë”°ë¥¸ë‹¤.

#### 6.3.2 ì ‘ê·¼ ì œì–´ íŒ¨í„´ (Auth / Admin ê°€ë“œ)

- **ê³µí†µ ê°œë…**
  - ë°±ì—”ë“œì˜ ìƒíƒœì¶•ì„ í”„ë¡ íŠ¸ì—ì„œ `useAuth()` í›…ì„ í†µí•´ `pass / stop / forbid` ìƒíƒœë¡œ í•´ì„í•œë‹¤.
  - **ê¶Œí•œ í™•ì¸ ë¡œì§ì€ `hooks/use_auth.ts`ì— ì¤‘ì•™í™”í•œë‹¤.**

- **`RequireAuth` (ì‚¬ìš©ì ë¡œê·¸ì¸ í•„ìˆ˜)**
  - **ë¡œì§**:
    - `authStatus === "pass"` (í† í° ìœ íš¨) AND `user_state === "on"` (ê³„ì • í™œì„±)
  - **ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬**:
    - `authStatus === "stop"` (ë¯¸ë¡œê·¸ì¸/í† í°ë§Œë£Œ) â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ (`state: { from: location }` ì „ë‹¬)
    - `user_state !== "on"` (ì •ì§€/íƒˆí‡´) â†’ "ê³„ì • ë¹„í™œì„±í™”" ì•ˆë‚´ í˜ì´ì§€ë¡œ ì´ë™.

- **`RequireAdmin` (ê´€ë¦¬ì RBAC)** âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-01)
  - **ë¡œì§**:
    - `RequireAuth` í†µê³¼ AND `user_auth_enum` IN `['HYMN', 'admin']`
    - âš ï¸ `manager` ì—­í• ì€ **admin ì ‘ê·¼ ë¶ˆê°€** (í–¥í›„ class ê¸°ë°˜ ì ‘ê·¼ ê¶Œí•œìœ¼ë¡œ ë³„ë„ êµ¬í˜„ ì˜ˆì •)
  - **ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬**:
    - ì¸ì¦ì€ ë˜ì—ˆìœ¼ë‚˜ ê¶Œí•œ ë¶€ì¡± â†’ `/403` í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    - *ì ˆëŒ€ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ íŠ•ê²¨ë‚´ì§€ ì•ŠëŠ”ë‹¤ (ë¬´í•œ ë£¨í”„ ë°©ì§€).*
  - **ë°±ì—”ë“œ ë¯¸ë“¤ì›¨ì–´** (`src/api/admin/role_guard.rs`):
    - HYMN/admin â†’ 200 í†µê³¼
    - manager â†’ 403 "Access denied: Manager role requires class-based access"
    - learner â†’ 403 "Access denied: Insufficient permissions for admin access"

- **ì—ëŸ¬ í˜ì´ì§€** âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-01)
  - ìœ„ì¹˜: `frontend/src/category/error/page/`
  - í˜ì´ì§€ ëª©ë¡:
    | ë¼ìš°íŠ¸ | ì»´í¬ë„ŒíŠ¸ | ì„¤ëª… |
    |--------|----------|------|
    | `/403` | `AccessDeniedPage` | ê¶Œí•œ ì—†ìŒ (ShieldX ì•„ì´ì½˜) |
    | `/error` | `ErrorPage` | ì„œë²„ ì—ëŸ¬ (ServerCrash ì•„ì´ì½˜, ì¬ì‹œë„ ë²„íŠ¼) |
    | `*` | `NotFoundPage` | 404 í˜ì´ì§€ ì—†ìŒ (FileQuestion ì•„ì´ì½˜) |

- **Redirect ì •ì±… (Guest Guard)**
  - ë¡œê·¸ì¸ ìƒíƒœ(`pass`)ì¸ ì‚¬ìš©ìê°€ `/login` ë˜ëŠ” `/signup` ì ‘ê·¼ ì‹œ:
    - ì¼ë°˜ ì‚¬ìš©ì â†’ `/videos` (ë©”ì¸)ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    - ê´€ë¦¬ì â†’ `/admin/dashboard` ë“±ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì„ íƒ ì‚¬í•­)

---

### 6.4 ìƒíƒœ ê´€ë¦¬ & API ì—°ë™ íŒ¨í„´

> ëª©ì : **TanStack Query(Server State)**ì™€ **Zustand(Client State)**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ, ë°±ì—”ë“œ APIì™€ í”„ë¡ íŠ¸ì—”ë“œ UIë¥¼ **ì„ ì–¸ì (Declarative)**ìœ¼ë¡œ ì—°ê²°í•œë‹¤.

#### 6.4.1 ì¸ì¦ ìƒíƒœ ê´€ë¦¬ (Zustand + AuthProvider)

- **í† í°/ì„¸ì…˜ ë³´ê´€ ì „ëµ (Strict)**
  - **Access Token**: ë©”ëª¨ë¦¬(Zustand Store) ë˜ëŠ” React Query ìºì‹œì—ë§Œ ë³´ê´€. (LocalStorage ì €ì¥ ê¸ˆì§€ - XSS ì·¨ì•½)
  - **Refresh Token**: `httpOnly` ì¿ í‚¤ë¡œ ë°±ì—”ë“œê°€ ì„¤ì •. (JS ì ‘ê·¼ ë¶ˆê°€)

- **Auth Store êµ¬ì¡° (`hooks/use_auth.ts`)**
  - `Zustand`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì—­ ì¸ì¦ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤.
  - **State**:
    - `user`: User DTO | null
    - `authStatus`: `"pass"`(ì¸ì¦ë¨) | `"stop"`(ë¯¸ì¸ì¦/ë§Œë£Œ) | `"forbid"`(ê¶Œí•œë¶€ì¡±)
    - `isAdmin`: boolean (Helper Getter)
  - **Actions**:
    - `login(token, user)`: ìƒíƒœ ì—…ë°ì´íŠ¸ ë° í† í° ë©”ëª¨ë¦¬ ì €ì¥
    - `logout()`: ìƒíƒœ ì´ˆê¸°í™” ë° `/auth/logout` API í˜¸ì¶œ
    - `refresh()`: ì•± ì´ˆê¸° ì§„ì… ì‹œ `/auth/refresh` í˜¸ì¶œí•˜ì—¬ ì„¸ì…˜ ë³µêµ¬

#### 6.4.2 ê³µí†µ API í´ë¼ì´ì–¸íŠ¸ (`src/api/client.ts`)

- **ì—­í• **
  - `fetch` API ê¸°ë°˜ì˜ Singleton ì¸ìŠ¤í„´ìŠ¤.
  - **Interceptor**: ìš”ì²­ ì‹œ í—¤ë”ì— `Authorization: Bearer {token}` ìë™ ì£¼ì….
  - **Error Handling**: HTTP ì—ëŸ¬ë¥¼ `AppError` ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ throw.

- **ë„¤ì´ë° ê·œì¹™ (Strict)**
  - **Request/Response DTOëŠ” ë°±ì—”ë“œì™€ ë™ì¼í•˜ê²Œ `snake_case`ë¥¼ ì‚¬ìš©í•œë‹¤.**
  - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `camelCase`ë¡œ ë³€í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤. (ë¶ˆí•„ìš”í•œ ì—°ì‚° ë° ë§¤í•‘ ì˜¤ë²„í—¤ë“œ ì œê±°)

- **ì—ëŸ¬ ë§¤í•‘ ê·œì¹™ (Global Error Boundary)**
  - `401 Unauthorized` â†’ `authStatus`ë¥¼ `"stop"`ìœ¼ë¡œ ë³€ê²½í•˜ê³  ë¡œê·¸ì¸ ëª¨ë‹¬/í˜ì´ì§€ ìœ ë„.
  - `403 Forbidden` â†’ `authStatus`ë¥¼ `"forbid"`ë¡œ ë³€ê²½.
  - `5xx Server Error` â†’ Toast ë©”ì‹œì§€ë¡œ "ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”" ì¶œë ¥.

#### 6.4.3 ë„ë©”ì¸ë³„ í›… íŒ¨í„´ (React Query & Custom Hooks)

> **ì›ì¹™**: UI ì»´í¬ë„ŒíŠ¸ëŠ” `useEffect`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì•„ë˜ í›…ì„ í†µí•´ ë°ì´í„°ë¥¼ êµ¬ë…í•œë‹¤.

- **Query Hook (Data Fetching)**
  - **TanStack Query**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤.
  - íŒŒì¼ ìœ„ì¹˜: `category/*/hook/use[Domain]Query.ts`
  - ì˜ˆì‹œ:
    ```typescript
    // useVideoListQuery.ts
    export const useVideoListQuery = (params) => {
      return useQuery({
        queryKey: ["videos", params],
        queryFn: () => fetchVideos(params), // api/video.ts í˜¸ì¶œ
        staleTime: 1000 * 60 * 5, // 5ë¶„ê°„ ìºì‹œ ìœ ì§€ (ë°ì´í„° ì ˆì•½)
      });
    };
    ```

- **Mutation Hook (Data Update)**
  - ë°ì´í„° ë³€ê²½(POST/PUT/DELETE)ì„ ë‹´ë‹¹í•œë‹¤.
  - ì˜ˆì‹œ:
    ```typescript
    // useVideoProgressMutation.ts
    export const useVideoProgressMutation = () => {
      const queryClient = useQueryClient();
      return useMutation({
        mutationFn: updateVideoProgress,
        onSuccess: () => {
          queryClient.invalidateQueries(["videos"]); // ëª©ë¡ ê°±ì‹ 
        }
      });
    };
    ```

- **Controller Hook (UI Logic)**
  - í¼ í•¸ë“¤ë§, ëª¨ë‹¬ ì œì–´ ë“± ìˆœìˆ˜ í´ë¼ì´ì–¸íŠ¸ ë¡œì§.
  - `useForm`(React Hook Form)ê³¼ `zod` ìŠ¤í‚¤ë§ˆë¥¼ ê²°í•©í•˜ì—¬ ì‚¬ìš©í•œë‹¤.
  - ì˜ˆ: `useSignupForm`, `useVideoPlayerController`

#### 6.4.4 ìƒíƒœì¶•ê³¼ UI ìƒíƒœ ë§¤í•‘

> **5. ê¸°ëŠ¥ & API ë¡œë“œë§µ**ì˜ ìƒíƒœì¶•ì„ í”„ë¡ íŠ¸ì—”ë“œ ë³€ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” ê·œì¹™ì´ë‹¤.

- **Request ìƒíƒœ (React Query ìƒíƒœ ë§¤í•‘)**
  - `pending` â†’ `isLoading` (ìŠ¤í”¼ë„ˆ í‘œì‹œ)
  - `error` â†’ `isError` (ì—ëŸ¬ ë©”ì‹œì§€/ì¬ì‹œë„ ë²„íŠ¼ í‘œì‹œ)
  - `success` â†’ `data` (ì½˜í…ì¸  ë Œë”ë§)
  - `retryable` â†’ React Queryì˜ `retry` ì˜µì…˜ìœ¼ë¡œ ìë™ ì²˜ë¦¬

- **Course ìƒíƒœ (ì ‘ê·¼ ê¶Œí•œ ê³„ì‚°)**
  - `/videos/{id}` ë“± ìœ ë£Œ ì½˜í…ì¸  ì ‘ê·¼ ì‹œ `Course` ì¶•(`buy/taster/buy-not`)ì„ ê³„ì‚°í•˜ëŠ” ë¡œì§ì€ **Selector** ë˜ëŠ” **Helper Hook**ìœ¼ë¡œ ë¶„ë¦¬í•œë‹¤.
  - ì˜ˆ: `useCourseAccess(videoId)`
    - Return: `{ canPlay: boolean, showPaywall: boolean }`
    - ë¡œì§: ë‚´ ìˆ˜ê°•ê¶Œ ëª©ë¡ê³¼ í•´ë‹¹ ë¹„ë””ì˜¤ì˜ `is_free` ì—¬ë¶€ë¥¼ ëŒ€ì¡°.

- **Form ìƒíƒœ**
  - React Hook Formì˜ `formState`ë¥¼ ê·¸ëŒ€ë¡œ í™œìš©í•œë‹¤.
  - `isSubmitting` (ì „ì†¡ ì¤‘), `isValid` (ìœ íš¨ì„± ê²€ì¦ í†µê³¼), `errors` (í•„ë“œë³„ ì—ëŸ¬)

### 6.5 UI/UX & Tailwind ê·œì¹™ (shadcn/ui System)

> ëª©ì : **shadcn/ui** ë””ìì¸ ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œ, ëª¨ë°”ì¼ í¼ìŠ¤íŠ¸ ë° ì˜ë¯¸ë¡ ì (Semantic) ìŠ¤íƒ€ì¼ë§ ê·œì¹™ì„ ì •ì˜í•˜ì—¬ ì¼ê´€ì„±ê³¼ ìƒì‚°ì„±ì„ í™•ë³´í•œë‹¤.

#### 6.5.1 ë””ìì¸ ì‹œìŠ¤í…œ ì² í•™ (Shadcn First)

- **Mobile First**: ëª¨ë“  ë ˆì´ì•„ì›ƒì€ ëª¨ë°”ì¼(`sm`)ì—ì„œ ì‹œì‘í•˜ì—¬ íƒœë¸”ë¦¿(`md`), ë°ìŠ¤í¬í†±(`lg`)ìœ¼ë¡œ í™•ì¥í•œë‹¤.
- **Semantic Styling**: ìƒ‰ìƒ ì½”ë“œë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì—­í• ì— ë”°ë¥¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.
  - âŒ Bad: `bg-blue-600`, `text-gray-500`
  - â­• Good: `bg-primary`, `text-muted-foreground`
- **Atomic Components**:
  - ë²„íŠ¼, ì¸í’‹ ë“±ì„ ì²˜ìŒë¶€í„° ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.
  - `components/ui/`ì— ì„¤ì¹˜ëœ **shadcn ì»´í¬ë„ŒíŠ¸**(`<Button>`, `<Input>`, `<Card>`)ë¥¼ ì¡°ë¦½í•˜ì—¬ í™”ë©´ì„ êµ¬ì„±í•œë‹¤.

#### 6.5.2 ë ˆì´ì•„ì›ƒ & ê·¸ë¦¬ë“œ

- **AppShell (`components/layout/RootLayout.tsx`)**
  - ì•±ì˜ ìµœìƒìœ„ ê»ë°ê¸°.
  - êµ¬ì„±:
    - **Header**: ë¡œê³  + í–„ë²„ê±° ë©”ë‰´(ëª¨ë°”ì¼) / ë„¤ë¹„ê²Œì´ì…˜(ë°ìŠ¤í¬í†±) + ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
    - **Main**: `max-w-screen-xl mx-auto px-4` (ì½˜í…ì¸  ì¤‘ì•™ ì •ë ¬ ë° ê°€ë¡œ ì—¬ë°± í™•ë³´)
    - **Footer**: íšŒì‚¬ ì •ë³´, ì—°ë½ì²˜, ì´ìš©ì•½ê´€/ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë§í¬

- **Header ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡°**
  ```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ [Amazing Korean]    [ì†Œê°œ] [ì˜ìƒ] [í•™ìŠµ] [ìˆ˜ì—…]     [ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ] â”‚
  â”‚      (Logo)           (Navigation)                  (Auth)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ```
  - **ì™¼ìª½ (Logo)**: "Amazing Korean" í…ìŠ¤íŠ¸ ë¡œê³  (í´ë¦­ ì‹œ `/` í™ˆìœ¼ë¡œ ì´ë™)
  - **ê°€ìš´ë° (Navigation)**: ë©”ì¸ ë©”ë‰´
    | ë©”ë‰´ëª… | ë¼ìš°íŠ¸ | ì„¤ëª… |
    |--------|--------|------|
    | ì†Œê°œ | `/about` | ì„œë¹„ìŠ¤ ì†Œê°œ |
    | ì˜ìƒ | `/videos` | ì˜ìƒ ëª©ë¡ |
    | í•™ìŠµ | `/studies` | í•™ìŠµ ëª©ë¡ |
    | ìˆ˜ì—… | `/lessons` | ìˆ˜ì—… ëª©ë¡ |
  - **ì˜¤ë¥¸ìª½ (Auth)**: ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ ì¡°ê±´ë¶€ ë Œë”ë§
    - ë¹„ë¡œê·¸ì¸: `[ë¡œê·¸ì¸]` `[íšŒì›ê°€ì…]` ë²„íŠ¼
    - ë¡œê·¸ì¸: `[ë§ˆì´í˜ì´ì§€]` `[ë¡œê·¸ì•„ì›ƒ]` ë²„íŠ¼

- **ë°˜ì‘í˜• ì „ëµ**
  - **Grid**: `grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6` íŒ¨í„´ì„ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤.
  - **Spacing**: ëª¨ë°”ì¼ì—ì„œëŠ” `gap-4`, ë°ìŠ¤í¬í†±ì—ì„œëŠ” `gap-6` ì´ìƒì„ ì‚¬ìš©í•˜ì—¬ ì‹œì›í•œ ëŠë‚Œì„ ì¤€ë‹¤.

#### 6.5.3 Tailwind & Color System (Theme)

- **ìƒ‰ìƒ í† í° (globals.css ê¸°ë°˜)**
  - `primary`: ë¸Œëœë“œ ë©”ì¸ ì»¬ëŸ¬ (Amazing Korean Blue) â†’ ì£¼ìš” ì•¡ì…˜ ë²„íŠ¼
  - `secondary`: ë³´ì¡° ì»¬ëŸ¬ â†’ ì·¨ì†Œ/ì„œë¸Œ ë²„íŠ¼
  - `destructive`: ìœ„í—˜/ì‚­ì œ â†’ `bg-red-600` ê³„ì—´
  - `muted`: ë¹„í™œì„±/ë°°ê²½ â†’ `bg-gray-100` ê³„ì—´
  - `accent`: ê°•ì¡° í¬ì¸íŠ¸ â†’ í•™ìŠµ ì™„ë£Œ ì²´í¬ ë“±

- **íƒ€ì´í¬ê·¸ë˜í”¼**
  - `h1` (Page Title): `text-2xl font-bold tracking-tight md:text-3xl`
  - `h2` (Section): `text-xl font-semibold tracking-tight`
  - `p` (Body): `leading-7 [&:not(:first-child)]:mt-6`
  - `small` (Caption): `text-sm font-medium leading-none`
  - `muted` (Subtext): `text-sm text-muted-foreground`

- **ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (`cn`)**
  - Tailwind í´ë˜ìŠ¤ ë³‘í•©ì„ ìœ„í•´ `lib/utils.ts`ì˜ `cn()` í•¨ìˆ˜ë¥¼ ì ê·¹ í™œìš©í•œë‹¤.
  - ì˜ˆ: `<div className={cn("flex items-center", isMobile && "flex-col")}>`

#### 6.5.4 ì£¼ìš” UI íŒ¨í„´ ê°€ì´ë“œ

- **Card Pattern (ëª©ë¡ ì•„ì´í…œ)**
  - `Card`, `CardHeader`, `CardContent`, `CardFooter` ì»´í¬ë„ŒíŠ¸ ì¡°í•© ì‚¬ìš©.
  - ì¸ë„¤ì¼(ì´ë¯¸ì§€/ë¹„ë””ì˜¤)ì€ **`aspect-video` (16:9 ë¹„ìœ¨)** í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë ˆì´ì•„ì›ƒ ì´ë™(CLS)ì„ ë°©ì§€í•œë‹¤.

- **Form Pattern (ë¡œê·¸ì¸/ì…ë ¥)**
  - **React Hook Form** + **zod** + **shadcn Form** ì¡°í•© í•„ìˆ˜.
  - `<Form>` ê°ì‹¸ê¸° â†’ `<FormField>` â†’ `<FormItem>` â†’ `<FormControl>` êµ¬ì¡° ì¤€ìˆ˜.
  - ì—ëŸ¬ ë©”ì‹œì§€ëŠ” `<FormMessage />` ì»´í¬ë„ŒíŠ¸ë¡œ ìë™ ë…¸ì¶œ.

- **Feedback (Toast)**
  - ì‚¬ìš©ì ì•¡ì…˜ ê²°ê³¼ëŠ” `alert()` ëŒ€ì‹  **Toast** (`hooks/use-toast.ts`)ë¥¼ ì‚¬ìš©í•œë‹¤.
  - ì„±ê³µ: `toast({ title: "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", variant: "default" })`
  - ì—ëŸ¬: `toast({ title: "ì˜¤ë¥˜ ë°œìƒ", variant: "destructive" })`

#### 6.5.5 ë¯¸ë””ì–´ & ë°ì´í„° ìµœì í™” (UX)

- **ì´ë¯¸ì§€ (Image)**
  - í¬ë§·: `WebP` ì‚¬ìš© ê¶Œì¥.
  - ë¡œë”©: `loading="lazy"` ì†ì„± í•„ìˆ˜.
  - í”Œë ˆì´ìŠ¤í™€ë”: ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ê¸° ì „ `bg-muted` ì˜ì—­ì„ ë¯¸ë¦¬ ì¡ì•„ì¤€ë‹¤.

- **ë¹„ë””ì˜¤ (Video)**
  - ëª©ë¡ í™”ë©´ì—ì„œëŠ” ë¬´ê±°ìš´ `Vimeo Player` ëŒ€ì‹  **ê°€ë²¼ìš´ ì¸ë„¤ì¼ ì´ë¯¸ì§€**ë§Œ ë³´ì—¬ì¤€ë‹¤.
  - ì‚¬ìš©ìê°€ "ì¬ìƒ" ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œë§Œ í”Œë ˆì´ì–´ SDKë¥¼ ë¡œë“œí•œë‹¤ (Lazy Interaction).

---

### 6.6 í”„ë¡ íŠ¸ í…ŒìŠ¤íŠ¸ & ë¹Œë“œ/ë°°í¬ (ìš”ì•½)

> ëª©ì : Vite + React í™˜ê²½ì—ì„œ **Type Safety**ë¥¼ ë³´ì¥í•˜ë©°, ë¹Œë“œëœ ì •ì  ìì›(`dist/`)ì„ ìš´ì˜ í™˜ê²½ì— ì¼ê´€ë˜ê²Œ ë°°í¬í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì •ì˜í•œë‹¤.

#### 6.6.1 ë¡œì»¬ ê°œë°œ í”Œë¡œìš°

- **íŒ¨í‚¤ì§€ ê´€ë¦¬**
  - `npm`ì„ í‘œì¤€ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¡œ ì‚¬ìš©í•œë‹¤. (`package-lock.json` ê³µìœ )
  - ì„¤ì¹˜: `npm install`
  - shadcn ì»´í¬ë„ŒíŠ¸ ì¶”ê°€: `npx shadcn@latest add [component-name]`

- **í™˜ê²½ ë³€ìˆ˜ (.env)**
  - `.env.local` (ë¡œì»¬ ì „ìš©, gitignore ëŒ€ìƒ)
  - `.env.production` (ìš´ì˜ ì „ìš©)
  - í•„ìˆ˜ ë³€ìˆ˜:
    - `VITE_API_BASE_URL`: ë°±ì—”ë“œ API ì£¼ì†Œ (ì˜ˆ: `http://localhost:8080` ë˜ëŠ” `https://api.amazingkorean.net`)
    - *Client ì½”ë“œì—ì„œëŠ” `import.meta.env.VITE_API_BASE_URL`ë¡œ ì ‘ê·¼.*

- **ê°œë°œ ì„œë²„ ì‹¤í–‰**
  - `npm run dev` (ê¸°ë³¸ í¬íŠ¸: 5173)

#### 6.6.2 ë¹Œë“œ & ë°°í¬ ì „ëµ

- **ë¹Œë“œ ì»¤ë§¨ë“œ (Strict)**
  - `npm run build` ì‹¤í–‰ ì‹œ:
    1.  `tsc -b` (TypeScript ì»´íŒŒì¼ ê²€ì‚¬)ê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤. **íƒ€ì… ì—ëŸ¬ ë°œìƒ ì‹œ ë¹Œë“œëŠ” ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.**
    2.  Viteê°€ í”„ë¡œë•ì…˜ìš© ìµœì í™”(Minify, Tree Shaking)ë¥¼ ìˆ˜í–‰í•˜ê³  `dist/` í´ë”ë¥¼ ìƒì„±í•œë‹¤.

- **ë²ˆë“¤ í¬ê¸° ìµœì í™” (TODO)**
  - í˜„ì¬ ë©”ì¸ ë²ˆë“¤ í¬ê¸°: **~1,273 KB** (gzip ~350 KB) â€” Vite ê¶Œì¥ ê¸°ì¤€ 500 KB ì´ˆê³¼
  - ê°œì„  ë°©ì•ˆ:
    1. `React.lazy()` + `Suspense`ë¥¼ í™œìš©í•œ **ë¼ìš°íŠ¸ ê¸°ë°˜ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…**
    2. `vite.config.ts`ì˜ `build.rollupOptions.output.manualChunks`ë¡œ vendor ì²­í¬ ë¶„ë¦¬ (react, react-dom, i18next ë“±)
    3. ëŒ€í˜• ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë™ì  import (`import()`) ì „í™˜
  - í˜„ì¬ ë‹¨ì¼ ë²ˆë“¤ì´ ê¸°ëŠ¥ìƒ ë¬¸ì œëŠ” ì—†ìœ¼ë‚˜, í˜ì´ì§€/ê¸°ëŠ¥ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì´ˆê¸° ë¡œë”© ì†ë„ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.

- **SPA ì„œë¹™ ì „ëµ (SPA Fallback)**
  - í”„ë¡ íŠ¸ì—”ë“œëŠ” **Single Page Application**ì´ë¯€ë¡œ, **ëª¨ë“  404 ìš”ì²­ì„ `index.html`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸**í•´ì•¼ í•œë‹¤.
  - **Nginx ë°°í¬ ì‹œ**: `try_files $uri $uri/ /index.html;` ì„¤ì • í•„ìˆ˜.
  - **Rust(Axum) í†µí•© ë°°í¬ ì‹œ**: ì •ì  íŒŒì¼ ì„œë¹™ í•¸ë“¤ëŸ¬ì—ì„œ Fallback ê²½ë¡œ ì„¤ì • í•„ìš”.

#### 6.6.2-0 ë„ë©”ì¸ ë° DNS ì„¤ì • (Route 53)

- **ë„ë©”ì¸**: `amazingkorean.net`
- **DNS ê´€ë¦¬**: AWS Route 53

##### DNS ë ˆì½”ë“œ ì„¤ì •

| ë ˆì½”ë“œ íƒ€ì… | ì´ë¦„ | ê°’ | TTL |
|------------|------|-----|-----|
| CNAME | amazingkorean.net | amazing-korean-api.pages.dev | 300 |
| CNAME | www | amazing-korean-api.pages.dev | 300 |
| A | api | 3.39.234.157 | 300 |

##### ì„œë¹„ìŠ¤ URL

| ì„œë¹„ìŠ¤ | URL |
|--------|-----|
| í”„ë¡ íŠ¸ì—”ë“œ | https://amazingkorean.net |
| í”„ë¡ íŠ¸ì—”ë“œ (www) | https://www.amazingkorean.net |
| ë°±ì—”ë“œ API | https://api.amazingkorean.net |
| Cloudflare Pages | https://amazing-korean-api.pages.dev |

#### 6.6.2-1 Cloudflare Pages ë°°í¬ (í”„ë¡ íŠ¸ì—”ë“œ)

- **ë°°í¬ í”Œë«í¼**: Cloudflare Pages
- **GitHub ì—°ë™**: `AmazingKoreanCenter/amazing-korean-api`
- **ë¹Œë“œ ì„¤ì •**:
  - Framework preset: `Vite`
  - Build command: `npm run build`
  - Build output directory: `dist`
  - Root directory: `frontend`
- **í™˜ê²½ ë³€ìˆ˜**:
  - `VITE_API_BASE_URL`: `https://api.amazingkorean.net`
- **ì»¤ìŠ¤í…€ ë„ë©”ì¸**:
  - `amazingkorean.net`
  - `www.amazingkorean.net`
- **SPA ë¼ìš°íŒ…**: Cloudflare PagesëŠ” SPA Fallbackì„ ìë™ ì§€ì› (ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”)

#### 6.6.2-2 AWS EC2 ë°°í¬ (ë°±ì—”ë“œ)

- **EC2 ì¸ìŠ¤í„´ìŠ¤**: Amazon Linux 2023 ë˜ëŠ” Ubuntu 22.04 LTS
- **Instance Type**: t2.micro (1 vCPU, 1GB) - ë¹Œë“œ ì‹œ t3.medium ê¶Œì¥
- **Storage**: **ìµœì†Œ 20GB gp3** (Rust ë¹Œë“œì— í•„ìš”, 8GBëŠ” ë¶€ì¡±)
- **Public IP**: `43.200.180.110` (ì¸ìŠ¤í„´ìŠ¤ ì¤‘ì§€/ì‹œì‘ ì‹œ ë³€ê²½ë¨)
- **ë„ë©”ì¸**: `api.amazingkorean.net`
- **ë°°í¬ ë°©ì‹**: Docker Compose
- **Nginx ì„¤ì •**: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ (80/443 â†’ API:3000)
- **SSL**: Cloudflare Flexible (í”„ë¡ì‹œ ëª¨ë“œ)
- **ë¹Œë“œ ì‹œê°„**: t2.microì—ì„œ ë¹Œë“œ ë¶ˆê°€ (ë©”ëª¨ë¦¬ ë¶€ì¡±), t3.medium ê¶Œì¥

> **ì°¸ê³ **: t2.micro (1GB RAM)ëŠ” Rust ë¹Œë“œì— ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¹Œë“œ ì‹œ ì„ì‹œë¡œ t3.mediumìœ¼ë¡œ ë³€ê²½ í›„, ì™„ë£Œ í›„ ë‹¤ì‹œ t2.microë¡œ ë³€ê²½í•˜ì„¸ìš”.

##### í™˜ê²½ ë³€ìˆ˜ (.env.prod)

```env
POSTGRES_PASSWORD=your-secure-password
JWT_SECRET=your-32-byte-minimum-secret-key
DOMAIN=api.amazingkorean.net
CORS_ORIGINS=http://localhost:5173,https://amazingkorean.net,https://www.amazingkorean.net
```

##### 0. SQLx ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì¤€ë¹„ (Docker ë¹Œë“œ ì „ í•„ìˆ˜)

Docker ë¹Œë“œ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì—†ì´ SQLx ë§¤í¬ë¡œë¥¼ ì»´íŒŒì¼í•˜ë ¤ë©´ `.sqlx` ìºì‹œê°€ í•„ìš”í•©ë‹ˆë‹¤.

```bash
# ë¡œì»¬ì—ì„œ PostgreSQL ì‹¤í–‰ ì¤‘ì¸ ìƒíƒœì—ì„œ
cargo install sqlx-cli --no-default-features --features native-tls,postgres

# .sqlx ìºì‹œ ìƒì„±
cargo sqlx prepare

# Gitì— ì»¤ë°‹
git add .sqlx
git commit -m "Add SQLx offline cache"
git push
```

> **ì°¸ê³ **: Dockerfileì— `ENV SQLX_OFFLINE=true`ì™€ `COPY .sqlx ./.sqlx`ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
> Rust ë²„ì „ì€ **1.85 ì´ìƒ** í•„ìš” (edition2024 ì§€ì›).

##### 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„

**Amazon Linux 2023 (ê¶Œì¥)**

```bash
# 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ê¶Œì¥ ì‚¬ì–‘)
# - OS: Amazon Linux 2023
# - Instance Type: t2.micro (í”„ë¦¬í‹°ì–´) ë˜ëŠ” t3.small
# - Storage: 20GB gp3 (8GBëŠ” Rust ë¹Œë“œ ì‹œ ë””ìŠ¤í¬ ë¶€ì¡± ë°œìƒ)
# - Security Group: 22(SSH), 80(HTTP), 443(HTTPS) í¬íŠ¸ ì˜¤í”ˆ

# 2. SSH ì ‘ì† (Amazon LinuxëŠ” ec2-user ì‚¬ìš©)
ssh -i your-key.pem ec2-user@your-ec2-ip

# 3. Git ì„¤ì¹˜ (Amazon Linuxì—ëŠ” ê¸°ë³¸ ì„¤ì¹˜ ì•ˆë¨)
sudo yum install -y git

# 4. Docker ì„¤ì¹˜
sudo yum install -y docker
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER

# 5. Docker Compose (Buildx) ì„¤ì¹˜
DOCKER_CONFIG=${DOCKER_CONFIG:-$HOME/.docker}
mkdir -p $DOCKER_CONFIG/cli-plugins
curl -SL https://github.com/docker/compose/releases/latest/download/docker-compose-linux-x86_64 \
  -o $DOCKER_CONFIG/cli-plugins/docker-compose
chmod +x $DOCKER_CONFIG/cli-plugins/docker-compose

# Buildx ì„¤ì¹˜ (compose buildì— í•„ìš”)
curl -SL https://github.com/docker/buildx/releases/download/v0.15.1/buildx-v0.15.1.linux-amd64 \
  -o $DOCKER_CONFIG/cli-plugins/docker-buildx
chmod +x $DOCKER_CONFIG/cli-plugins/docker-buildx

# 6. ë¡œê·¸ì•„ì›ƒ í›„ ì¬ì ‘ì† (docker ê·¸ë£¹ ì ìš©)
exit
ssh -i your-key.pem ec2-user@your-ec2-ip
```

**Ubuntu 22.04 LTS (ëŒ€ì•ˆ)**

```bash
# SSH ì ‘ì† (UbuntuëŠ” ubuntu ì‚¬ìš©)
ssh -i your-key.pem ubuntu@your-ec2-ip

# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
sudo apt update && sudo apt upgrade -y

# Docker ì„¤ì¹˜
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# Docker Compose ì„¤ì¹˜
sudo apt install docker-compose-plugin -y

# ë¡œê·¸ì•„ì›ƒ í›„ ì¬ì ‘ì†
exit
ssh -i your-key.pem ubuntu@your-ec2-ip
```

##### 1-1. EBS ë³¼ë¥¨ í™•ì¥ (ë””ìŠ¤í¬ ë¶€ì¡± ì‹œ)

```bash
# AWS ì½˜ì†”ì—ì„œ EBS ë³¼ë¥¨ í¬ê¸° ë³€ê²½ í›„ (ì˜ˆ: 8GB â†’ 20GB)

# íŒŒí‹°ì…˜ í™•ì¥ (Amazon Linux / Ubuntu ê³µí†µ)
sudo growpart /dev/xvda 1

# íŒŒì¼ì‹œìŠ¤í…œ í™•ì¥
# Amazon Linux (xfs):
sudo xfs_growfs /

# Ubuntu (ext4):
sudo resize2fs /dev/xvda1

# í™•ì¸
df -h
```

##### 2. í”„ë¡œì íŠ¸ ë°°í¬

```bash
# 1. í”„ë¡œì íŠ¸ í´ë¡  ë° ë¸Œëœì¹˜ ì„¤ì •
git clone https://github.com/AmazingKoreanCenter/amazing-korean-api.git
cd amazing-korean-api
git checkout KKRYOUN  # ë˜ëŠ” ë°°í¬í•  ë¸Œëœì¹˜

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cat > .env.prod << 'EOF'
POSTGRES_PASSWORD=your-secure-password
JWT_SECRET=your-32-byte-minimum-secret-key
DOMAIN=api.amazingkorean.net
CORS_ORIGINS=http://localhost:5173,https://amazingkorean.net,https://www.amazingkorean.net
EOF
```

```bash
# 3. í•„ìš” ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p certbot/www certbot/conf

# 4. Docker Compose ì‹¤í–‰ (t2.micro ê¸°ì¤€ 15-30ë¶„ ì†Œìš”)
docker compose -f docker-compose.prod.yml --env-file .env.prod up -d --build

# 5. ë¡œê·¸ í™•ì¸
docker compose -f docker-compose.prod.yml logs -f
```

> **ì£¼ì˜**: `.sqlx` í´ë”ê°€ ì—†ìœ¼ë©´ ë¹Œë“œ ì‹¤íŒ¨í•©ë‹ˆë‹¤. "Step 0. SQLx ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì¤€ë¹„" ì°¸ì¡°.

##### 3. SSL ì¸ì¦ì„œ ë°œê¸‰ (Let's Encrypt)

```bash
# 1. ì´ˆê¸° ì¸ì¦ì„œ ë°œê¸‰ (HTTP ëª¨ë“œë¡œ nginx ì‹¤í–‰ ì¤‘ì¸ ìƒíƒœì—ì„œ)
docker compose -f docker-compose.prod.yml run --rm certbot certonly \
  --webroot \
  --webroot-path=/var/www/certbot \
  -d api.yourdomain.com \
  --email your-email@example.com \
  --agree-tos \
  --no-eff-email

# 2. nginx.conf HTTPS ì„¹ì…˜ í™œì„±í™” (ì£¼ì„ í•´ì œ)
nano nginx/nginx.conf

# 3. Nginx ì¬ì‹œì‘
docker compose -f docker-compose.prod.yml restart nginx
```

##### 4. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
# SQLx CLI ì„¤ì¹˜ (ë¡œì»¬ ë˜ëŠ” EC2ì—ì„œ)
cargo install sqlx-cli --no-default-features --features postgres

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
DATABASE_URL=postgres://postgres:your-password@localhost:5432/amazing_korean_db \
  sqlx migrate run
```

##### 5. ë°°í¬ í›„ í™•ì¸

```bash
# API í—¬ìŠ¤ì²´í¬
curl http://your-ec2-ip/health

# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker compose -f docker-compose.prod.yml ps

# ë¡œê·¸ í™•ì¸
docker compose -f docker-compose.prod.yml logs api
```

##### 6. ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `Dockerfile` | Rust ë°±ì—”ë“œ ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ (rust:1.85, SQLx offline mode) |
| `docker-compose.prod.yml` | í”„ë¡œë•ì…˜ êµ¬ì„± (API + DB + Redis + Nginx) |
| `nginx/nginx.conf` | ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ + SSL + CORS ì„¤ì • |
| `.sqlx/` | SQLx ì˜¤í”„ë¼ì¸ ìºì‹œ (Docker ë¹Œë“œ ì‹œ í•„ìˆ˜) |
| `.env.prod` | í”„ë¡œë•ì…˜ í™˜ê²½ ë³€ìˆ˜ (Gitì— í¬í•¨í•˜ì§€ ì•ŠìŒ) |

##### 7. ìœ ìš©í•œ ëª…ë ¹ì–´

```bash
# ì „ì²´ ì¬ì‹œì‘
docker compose -f docker-compose.prod.yml down && docker compose -f docker-compose.prod.yml up -d

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ë¹Œë“œ
docker compose -f docker-compose.prod.yml up -d --build api

# ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
docker compose -f docker-compose.prod.yml logs -f api

# ì»¨í…Œì´ë„ˆ ì‰˜ ì ‘ì†
docker exec -it amk-api /bin/bash
docker exec -it amk-pg psql -U postgres -d amazing_korean_db

# ë¹Œë“œ ì§„í–‰ ìƒí™© í™•ì¸ (ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ)
docker stats
```

##### 8. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

| ì—ëŸ¬ | ì›ì¸ | í•´ê²° |
|------|------|------|
| `Permission denied (publickey)` | SSH ì‚¬ìš©ì ì´ë¦„ ì˜¤ë¥˜ | Amazon Linux: `ec2-user@`, Ubuntu: `ubuntu@` |
| `git: command not found` | Git ë¯¸ì„¤ì¹˜ (Amazon Linux) | `sudo yum install -y git` |
| `compose build requires buildx` | Buildx ë¯¸ì„¤ì¹˜ | ìœ„ Docker ì„¤ì¹˜ ì„¹ì…˜ ì°¸ì¡° |
| `feature 'edition2024' is required` | Rust ë²„ì „ ë‚®ìŒ | Dockerfileì—ì„œ `rust:1.85-bookworm` ì‚¬ìš© |
| `No space left on device` | ë””ìŠ¤í¬ ë¶€ì¡± (8GB) | EBS ë³¼ë¥¨ 20GB gp3ë¡œ í™•ì¥ |
| `set DATABASE_URL to use query macros` | SQLx ìºì‹œ ì—†ìŒ | `cargo sqlx prepare` í›„ `.sqlx` ì»¤ë°‹ |
| `divergent branches` (git pull) | ë¸Œëœì¹˜ ì¶©ëŒ | `git fetch origin && git reset --hard origin/BRANCH` |
| `address already in use` (443) | í¬íŠ¸ ì¶©ëŒ | `sudo fuser -k 443/tcp` í›„ ì¬ì‹œì‘ |
| `database is being accessed` | DB ì—°ê²° ì¤‘ | API ì¤‘ì§€ í›„ `pg_terminate_backend()` ì‹¤í–‰ |

##### 9. Cloudflare SSL ì„¤ì • (Let's Encrypt ëŒ€ì•ˆ)

Cloudflare í”„ë¡ì‹œ ì‚¬ìš© ì‹œ Let's Encrypt ì—†ì´ SSL ì ìš© ê°€ëŠ¥:

1. Cloudflare ëŒ€ì‹œë³´ë“œ â†’ `amazingkorean.net` â†’ **DNS**
2. `api` A ë ˆì½”ë“œì˜ í”„ë¡ì‹œ ìƒíƒœë¥¼ **ì£¼í™©ìƒ‰ êµ¬ë¦„** (Proxied)ìœ¼ë¡œ ì„¤ì •
3. **SSL/TLS** â†’ **Overview** â†’ ëª¨ë“œë¥¼ **Flexible**ë¡œ ì„¤ì •

> **ì°¸ê³ **: Flexible ëª¨ë“œëŠ” Cloudflare â†” ì‚¬ìš©ì ê°„ HTTPS, Cloudflare â†” EC2 ê°„ HTTPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

##### 10. ë¡œì»¬ â†’ EC2 ë°ì´í„° ì´ì „

ê°œë°œ í™˜ê²½ì˜ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í”„ë¡œë•ì…˜ìœ¼ë¡œ ì´ì „í•˜ëŠ” ë°©ë²•:

**ë¡œì»¬ (WSL)ì—ì„œ:**
```bash
# 1. SSH í‚¤ ê¶Œí•œ ì„¤ì • (WSLì—ì„œ Windows ë“œë¼ì´ë¸Œ ì‚¬ìš© ì‹œ)
cp /mnt/d/YOUR_PATH/your-key.pem ~/
chmod 400 ~/your-key.pem

# 2. ë°ì´í„°ë² ì´ìŠ¤ ë¤í”„ (ìŠ¤í‚¤ë§ˆ + ë°ì´í„°)
docker exec amk-pg pg_dump -U postgres -d amazing_korean_db --exclude-table=_sqlx_migrations > ~/db_full.sql

# 3. EC2ë¡œ íŒŒì¼ ì „ì†¡
scp -i ~/your-key.pem ~/db_full.sql ec2-user@YOUR_EC2_IP:~/db_full.sql
```

**EC2ì—ì„œ:**
```bash
# 1. API ì¤‘ì§€
docker stop amk-api

# 2. ê¸°ì¡´ ì—°ê²° ì¢…ë£Œ ë° DB ë¦¬ì…‹
docker exec -it amk-pg psql -U postgres -c "SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname = 'amazing_korean_db' AND pid <> pg_backend_pid();"
docker exec -it amk-pg psql -U postgres -c "DROP DATABASE amazing_korean_db;"
docker exec -it amk-pg psql -U postgres -c "CREATE DATABASE amazing_korean_db;"

# 3. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
docker exec -i amk-pg psql -U postgres -d amazing_korean_db < ~/db_full.sql

# 4. API ì¬ì‹œì‘
docker start amk-api

# 5. í™•ì¸
docker exec -it amk-pg psql -U postgres -d amazing_korean_db -c "\dt"
docker exec -it amk-pg psql -U postgres -d amazing_korean_db -c "SELECT COUNT(*) FROM users;"
```

> **ì£¼ì˜**: `--exclude-table=_sqlx_migrations`ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ë¡ í…Œì´ë¸”ì€ ì œì™¸í•©ë‹ˆë‹¤.

#### 6.6.2-3 GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸

> **ëª©ì **: EC2ì—ì„œ Rust ë¹Œë“œ ì—†ì´ ìë™ ë°°í¬. t2.micro (1GB RAM)ë¡œ ìš´ì˜ ê°€ëŠ¥.

##### CI/CD íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  git push   â”‚ â†’  â”‚  GitHub Actions  â”‚ â†’  â”‚ Docker Hub  â”‚ â†’  â”‚   EC2   â”‚
â”‚  (ë¡œì»¬)      â”‚    â”‚  (ë¹Œë“œ ì„œë²„)      â”‚    â”‚ (ì´ë¯¸ì§€ì €ì¥) â”‚    â”‚  (ì‹¤í–‰)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **ì½”ë“œ Push** â†’ `main` ë˜ëŠ” `KKRYOUN` ë¸Œëœì¹˜ì— push
2. **GitHub Actions** â†’ GitHub ì„œë²„(7GB RAM)ì—ì„œ Docker ì´ë¯¸ì§€ ë¹Œë“œ
3. **Docker Hub Push** â†’ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ Docker Hubì— ì—…ë¡œë“œ
4. **EC2 ë°°í¬** â†’ SSHë¡œ EC2 ì ‘ì† â†’ ì´ë¯¸ì§€ pull â†’ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘

##### GitHub Secrets ì„¤ì •

GitHub repo â†’ **Settings** â†’ **Secrets and variables** â†’ **Actions**ì—ì„œ ì¶”ê°€:

| Secret Name | ê°’ | ì„¤ëª… |
|-------------|-----|------|
| `DOCKERHUB_USERNAME` | Docker Hub ì‚¬ìš©ìëª… | |
| `DOCKERHUB_TOKEN` | Docker Hub Access Token | Read & Write ê¶Œí•œ |
| `EC2_HOST` | EC2 Public IP | ì˜ˆ: `43.200.180.110` |
| `EC2_SSH_KEY` | .pem íŒŒì¼ ë‚´ìš© ì „ì²´ | `-----BEGIN` ~ `END-----` |
| `POSTGRES_PASSWORD` | DB ë¹„ë°€ë²ˆí˜¸ | |
| `JWT_SECRET` | JWT ì‹œí¬ë¦¿ í‚¤ | |

##### Workflow íŒŒì¼ (.github/workflows/deploy.yml)

```yaml
name: Deploy to EC2

on:
  push:
    branches: [main, KKRYOUN]
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

env:
  DOCKER_IMAGE: ${{ secrets.DOCKERHUB_USERNAME }}/amazing-korean-api

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            ${{ env.DOCKER_IMAGE }}:latest
            ${{ env.DOCKER_IMAGE }}:${{ github.sha }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

  deploy:
    needs: build-and-push
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to EC2
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ec2-user
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            cd ~/amazing-korean-api
            docker pull ${{ env.DOCKER_IMAGE }}:latest
            docker compose -f docker-compose.prod.yml --env-file .env.prod up -d
            docker image prune -f
```

##### docker-compose.prod.yml (ì´ë¯¸ì§€ ì‚¬ìš© ë°©ì‹)

```yaml
services:
  api:
    image: ${DOCKER_IMAGE:-amazing-korean-api}:latest  # Docker Hub ì´ë¯¸ì§€ ì‚¬ìš©
    container_name: amk-api
    # ... ì´í•˜ ë™ì¼
```

> **ì°¸ê³ **: ê¸°ì¡´ `build:` ë¸”ë¡ ëŒ€ì‹  `image:` ì‚¬ìš©. EC2ì—ì„œ ë¹Œë“œí•˜ì§€ ì•ŠìŒ.

##### .dockerignore

```
# Documentation
docs/
*.md

# Frontend (Cloudflare Pagesì—ì„œ ë³„ë„ ë°°í¬)
frontend/

# Git
.git/
.github/

# Development
.env
target/
tests/
```

##### ë°°í¬ ë°©ë²•

```bash
# ìë™ ë°°í¬ (pushë§Œ í•˜ë©´ ë)
git add . && git commit -m "feat: ìƒˆ ê¸°ëŠ¥" && git push origin KKRYOUN

# ìˆ˜ë™ ë°°í¬ (GitHub Actions í˜ì´ì§€ì—ì„œ)
# Actions â†’ Deploy to EC2 â†’ Run workflow
```

##### ì¥ì 

| í•­ëª© | ì´ì „ (EC2 ë¹Œë“œ) | í˜„ì¬ (CI/CD) |
|------|----------------|--------------|
| Rust ì»´íŒŒì¼ | EC2ì—ì„œ (t3.medium í•„ìš”) | GitHub Actionsì—ì„œ |
| ë¹Œë“œ ì‹œê°„ | 15-30ë¶„ | 5-10ë¶„ |
| EC2 ìŠ¤í™ | t3.medium ì„ì‹œ í•„ìš” | t2.micro ìœ ì§€ ê°€ëŠ¥ |
| ë°°í¬ ë°©ì‹ | SSH ì ‘ì† í›„ ìˆ˜ë™ | `git push`ë§Œ |

#### 6.6.2-4 EC2 ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ

##### ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸

```bash
# ì „ì²´ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
df -h

# Docker ê´€ë ¨ ìš©ëŸ‰
docker system df

# Docker ì´ë¯¸ì§€ë³„ ìš©ëŸ‰
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"
```

##### ë””ìŠ¤í¬ ì •ë¦¬

```bash
# Docker Build Cache ì •ë¦¬ (CI/CD ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”)
docker builder prune -f

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì •ë¦¬
docker image prune -a

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë³¼ë¥¨ ì •ë¦¬ (ì£¼ì˜: ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥)
docker volume prune
```

##### Docker/ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸

```bash
# Docker ì—…ë°ì´íŠ¸ (Amazon Linux)
sudo yum update docker -y
sudo systemctl restart docker

# ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í›„ ì¬ì‹œì‘
docker compose -f docker-compose.prod.yml --env-file .env.prod pull
docker compose -f docker-compose.prod.yml --env-file .env.prod up -d
```

> **ì°¸ê³ **: CI/CD ì ìš© í›„ EC2ì—ì„œëŠ” ë¹Œë“œ ì‘ì—…ì´ ì—†ìœ¼ë¯€ë¡œ t2.micro (1GB RAM)ë¡œ ëª¨ë“  ìœ ì§€ë³´ìˆ˜ ì‘ì—… ê°€ëŠ¥.

#### 6.6.3 í’ˆì§ˆ ë³´ì¦ (QA) & ìŠ¤ëª¨í¬ ì²´í¬

- **ì •ì  ë¶„ì„ (CI Gate)**
  - `npm run lint`: ESLint (ì½”ë“œ ìŠ¤íƒ€ì¼ ë° ì ì¬ì  ë²„ê·¸ ê²€ì‚¬)
  - `npm run typecheck`: TypeScript íƒ€ì… ì •í•©ì„± ê²€ì‚¬ (í•„ìˆ˜)

- **ìˆ˜ë™ ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ (Release Checklist)**
  - ë°°í¬ ì „ ì•„ë˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ **ë°˜ë“œì‹œ 1íšŒ ìˆ˜ë™ í™•ì¸**í•œë‹¤.
    1.  **ì§„ì…**: ëœë”© í˜ì´ì§€ ë¡œë”© ë° í°íŠ¸/ì´ë¯¸ì§€ ê¹¨ì§ í™•ì¸.
    2.  **ì¸ì¦**: ë¡œê·¸ì¸(í† í° ë°œê¸‰) â†’ ìƒˆë¡œê³ ì¹¨ ì‹œ ë¡œê·¸ì¸ ìœ ì§€ í™•ì¸.
    3.  **ì˜ìƒ**: ë¹„ë””ì˜¤ ëª©ë¡ ë¡œë”© â†’ ìƒì„¸ í˜ì´ì§€ ì§„ì… â†’ í”Œë ˆì´ì–´ ì¬ìƒ í™•ì¸.
    4.  **ë¼ìš°íŒ…**: ì˜ëª»ëœ URL ì…ë ¥ ì‹œ 404 í˜ì´ì§€(ë˜ëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸) ë™ì‘ í™•ì¸.

#### 6.6.4 í–¥í›„ í™•ì¥ ê³„íš (Roadmap)

- **ìë™í™” í…ŒìŠ¤íŠ¸ ë„ì… (Phase 3 ì´í›„)**
  - **Unit Test**: `Vitest` ë„ì…. (ìœ í‹¸ í•¨ìˆ˜ ë° ë³µì¡í•œ Hook ë¡œì§ ê²€ì¦)
  - **E2E Test**: `Playwright` ë„ì…. (í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ìë™í™”)

- **CI/CD íŒŒì´í”„ë¼ì¸**
  - GitHub Actions ì—°ë™:
    - Push ì‹œ: `Lint` + `Typecheck` ìë™ ì‹¤í–‰.
    - Tag/Merge ì‹œ: `Build` ìˆ˜í–‰ í›„ Docker Image ìƒì„± ë˜ëŠ” S3 ì—…ë¡œë“œ.

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 7. ì‘ì—… ë°©ì‹ / ì—”ì§€ë‹ˆì–´ë§ ê°€ì´ë“œ (ìš”ì•½)

> ê¸°ì¡´ `AMK_ENGINEERING_GUIDE.md` + `README_for_assistant.md` + `AMK_PROJECT_JOURNAL.md`ì˜ â€œê²°ì •/ê·œì¹™â€ ë¶€ë¶„ì„ í†µí•©í•œ ì„¹ì…˜.

### 7.1 ì‘ì—… ì›ì¹™

1. **ë¬¸ì„œ ìš°ì„ **
   - ìŠ¤í™/ê¸°ëŠ¥/ê·œì¹™ì€ í•­ìƒ ì´ ë¬¸ì„œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.
2. **íŒŒì¼ ì „ì²´ êµì²´ë³¸**
   - LLM/Geminiì—ê²Œ ì½”ë“œ íŒ¨ì¹˜ë¥¼ ìš”ì²­í•  ë•ŒëŠ” **í•­ìƒ â€œíŒŒì¼ ì „ì²´ êµì²´ë³¸â€**ìœ¼ë¡œ ìš”ì²­/ì‘ë‹µí•œë‹¤.
3. **ì •ì  ê°€ë“œ í•„ìˆ˜**
   - `cargo fmt -- --check`
   - `cargo clippy -- -D warnings`
   - `cargo check`
   - ìœ„ 3ê°œë¥¼ ëª¨ë‘ í†µê³¼í•´ì•¼ PR/ë¨¸ì§€ ê°€ëŠ¥.
4. **ë§ˆì´ê·¸ë ˆì´ì…˜ ê·œì¹™**
   - ì´ë¯¸ ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì€ **ìˆ˜ì •/ì´ë¦„ ë³€ê²½ ê¸ˆì§€**.
   - ë³€ê²½ì´ í•„ìš”í•˜ë©´ í•­ìƒ **ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ê°€**.
   - SQLx ë§ˆì»¤ëŠ” `--! up` / `--! down`ë§Œ ì‚¬ìš© (ASCII í•˜ì´í”ˆ).
   - ì ìš© ìˆœì„œ : 1) USERS â†’ 2) LOGIN â†’ 3) VIDEO â†’ 4) STUDY â†’ 5) LESSON
5. **ë¡œê·¸/ê°ì‚¬**
   - ë„ë©”ì¸ë³„ ë³€ê²½ ì‚¬í•­ ê¸°ë¡ : `USERS_LOG`, `LOGIN_LOG`, `VIDEO_LOG`, `STUDY_TASK_LOG`
   - ê´€ë¦¬ì í™œë™ ì‚¬í•­ ê¸°ë¡ : `ADMIN_USERS_LOG`, `ADMIN_VIDEO_LOG`, `ADMIN_STUDY_LOG`, `ADMIN_LESSON_LOG`
6. **ë³´ì•ˆ (ê¸°ë³¸)**  
   - ê³„ì • ìƒíƒœ
     - `user_state == 'on'` ì¸ ì‚¬ìš©ìë§Œ ë¡œê·¸ì¸/ì•¡ì„¸ìŠ¤ í—ˆìš©.
     - ë¡œê·¸ì¸ ì‹œì  + ëª¨ë“  ì¸ì¦ ë³´í˜¸ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ `user_state`ë¥¼ ë‹¤ì‹œ ê²€ì¦í•œë‹¤.
   - ì¸ì¦ í† í°
     - ëª¨ë“  ë³´í˜¸ ì—”ë“œí¬ì¸íŠ¸ëŠ” `Authorization: Bearer <ACCESS_TOKEN>`ë¥¼ ìš”êµ¬í•œë‹¤.
     - í† í° ì•ˆì˜ `sub`(user_id)ëŠ” **ìœ ì¼í•œ ì‹ ë¢° ê°€ëŠ¥í•œ ì‚¬ìš©ì ì‹ë³„ì**ë¡œ ì‚¬ìš©í•˜ê³ ,  
       ìš”ì²­ ë°”ë””/ì¿¼ë¦¬ë¡œ ë“¤ì–´ì˜¤ëŠ” user_idëŠ” ì‹ ë¢°í•˜ì§€ ì•ŠëŠ”ë‹¤.
   - ë¹„ë°€ë²ˆí˜¸ ë° ë¯¼ê°ì •ë³´
     - ë¹„ë°€ë²ˆí˜¸ëŠ” Argon2 ë“± ì•ˆì „í•œ í•´ì‹œë¡œë§Œ ì €ì¥í•˜ê³ , **ì›ë¬¸ì€ ì ˆëŒ€ ì €ì¥/ë¡œê·¸ì— ë‚¨ê¸°ì§€ ì•ŠëŠ”ë‹¤.**
     - USERS_LOG, ADMIN_*_LOG ë“± ì–´ë–¤ ë¡œê·¸ì—ë„ ë¹„ë°€ë²ˆí˜¸/í† í°/ì¿ í‚¤ ê°’ì€ ë‚¨ê¸°ì§€ ì•ŠëŠ”ë‹¤.
   - ì„¸ì…˜/ë¦¬í”„ë ˆì‹œ í† í°
     - ì„¸ì…˜/ë¦¬í”„ë ˆì‹œëŠ” Redis í‚¤(`ak:session:*`, `ak:refresh:*`)ë¥¼ ì‚¬ìš©í•œë‹¤.
     - ë¦¬í”„ë ˆì‹œëŠ” **ì‚¬ìš© ì‹œ ë¡œí…Œì´ì…˜(rotate-on-use)** í•˜ê³ ,  
       ì¬ì‚¬ìš©ì´ ê°ì§€ë˜ë©´ í•´ë‹¹ ì„¸ì…˜/ì‚¬ìš©ìì˜ ê´€ë ¨ ì„¸ì…˜ì„ ì¼ê´„ íê¸°í•˜ëŠ” ì •ì±…ê³¼ ì—°ë™í•œë‹¤.
   - ê´€ë¦¬ì RBAC
     - ê´€ë¦¬ì ë¡¤ì€ `HYMN / admin / manager` ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.
     - `/admin/**` ê²½ë¡œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **â€œí—ˆìš©ëœ ë¡¤ë§Œ ì ‘ê·¼ ê°€ëŠ¥â€**(default deny) ì›ì¹™ì„ ë”°ë¥¸ë‹¤.
     - ë¡¤ë³„ ì„¸ë¶€ ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤ëŠ” **Open Questions ì„¹ì…˜**ì—ì„œ ì •ì˜/ì—…ë°ì´íŠ¸ í•œë‹¤.
   - í†µì‹ 
     - ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ HTTPSë¥¼ ì‚¬ìš©í•˜ê³ , í† í°/ì„¸ì…˜ IDë¥¼ URL(query string)ì— ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.

### 7.2 ê°œë°œ í”Œë¡œìš°

1. ê°œë°œ ì‚¬í•­ì— ëŒ€í•œ ì´ ë¬¸ì„œ(**AMK_API_MASTER.md**) í™•ì¸ ë° ì°¸ì¡°
2. 1) ê¸°ì¡´ ê°œë°œ ì‚¬í•­ : **AMK_API_MASTER.md** í™•ì¸ ë° ì°¸ì¡° í›„ í•´ë‹¹ ê°œë°œ ì‚¬í•­ ì‘ì—… ì§„í–‰
   2) ì‹ ê·œ ê°œë°œ ì‚¬í•­ : ì‹ ê·œ API ëª…ì‹œ â†’ **AMK_API_MASTER.md** í™•ì¸ ë° ì°¸ì¡° â†’ **AMK_API_MASTER.md** í˜•ì‹ìœ¼ë¡œ ë¬¸ì„œ ì—…ë°ì´íŠ¸ â†’ í•´ë‹¹ ê°œë°œ ì‚¬í•­ ì‘ì—… ì§„í–‰
3. GEMINI í…œí”Œë¦¿ì— ë”°ë¼ patch prompt ì‘ì„±
4. ì½”ë“œ/ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
5. ì •ì  ê°€ë“œ(cargo check/fmt/clippy) + ìµœì†Œ ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸(cURL or ìŠ¤í¬ë¦½íŠ¸)
6. ê´€ë ¨ ë¡œë“œë§µ í–‰ì˜ â€œê¸°ëŠ¥ ì™„ë£Œâ€ ì²´í¬ë°•ìŠ¤ ì—…ë°ì´íŠ¸

### 7.3 DTO/ê²€ì¦ ê·œì¹™ (ìš”ì•½)

- ê³µí†µ ì›ì¹™
  - HTTP ê²½ê³„ì—ì„œëŠ” í•­ìƒ **DTO(struct)** ë¥¼ ì‚¬ìš©í•˜ê³ ,  
    ë‚´ë¶€ ë„ë©”ì¸ íƒ€ì…ê³¼ ë¶„ë¦¬í•œë‹¤.
  - í•„ìˆ˜/ì˜µì…˜ í•„ë“œ, ê¸°ë³¸ê°’, ê²€ì¦ ê·œì¹™ì€ **DTOì— ëª…ì‹œ**í•œë‹¤.

- ë¬¸ìì—´ í•„ë“œ
  - `trim` í›„ ê²€ì¦ì„ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.
  - ê¸¸ì´ ì œí•œì„ ëª…ì‹œí•œë‹¤. (ì˜ˆ: ì´ë©”ì¼/ë‹‰ë„¤ì„ ë“±ì€ ìµœì†Œ/ìµœëŒ€ ê¸¸ì´ ì§€ì •)
  - ê³µë°±ë§Œ ìˆëŠ” ë¬¸ìì—´ì€ â€œë¹ˆ ê°’â€ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ , í•„ìš”í•œ ê²½ìš° 400ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.

- ì´ë©”ì¼
  - RFC ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ (ì˜ˆ: `validator` í¬ë ˆì´íŠ¸).
  - ëŒ€ì†Œë¬¸ìëŠ” êµ¬ë¶„í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ê¸°ë³¸ ê°€ì •ìœ¼ë¡œ í•œë‹¤.

- ë¹„ë°€ë²ˆí˜¸
  - ìµœì†Œ ê¸¸ì´/ë³µì¡ë„ëŠ” í”„ë¡œì íŠ¸ ì •ì±…ìœ¼ë¡œ ì •ì˜ (ì˜ˆ: ìµœì†Œ 8ì ì´ìƒ).
  - DTOì—ì„œ ë¬¸ìì—´ ê¸¸ì´ë§Œ ê²€ì¦í•˜ê³ , **í•´ì‹œëŠ” service ê³„ì¸µì—ì„œ ìˆ˜í–‰**í•œë‹¤.
  - ë¹„ë°€ë²ˆí˜¸ ì›ë¬¸ì€ ì ˆëŒ€ ë¡œê·¸/ì´ë ¥ì— ë‚¨ê¸°ì§€ ì•ŠëŠ”ë‹¤.

- ë‚ ì§œ
  - DTOì—ì„œëŠ” `chrono::NaiveDate` ì‚¬ìš©.
  - DBì—ëŠ” `DATE` ë˜ëŠ” `TIMESTAMPTZ`ë¡œ ìºìŠ¤íŒ…í•œë‹¤.
  - ì˜ëª»ëœ ë‚ ì§œ í˜•ì‹ì€ 400 + `invalid_argument` ë¡œ ì‘ë‹µí•œë‹¤.

- Enum í•„ë“œ
  - DTOì—ì„œëŠ” enum íƒ€ì…ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ë¬¸ìì—´ ì…ë ¥ì„ enumìœ¼ë¡œ ë§¤í•‘í•œë‹¤.
  - ì •ì˜ë˜ì§€ ì•Šì€ ê°’ì´ ë“¤ì–´ì˜¤ë©´ 400 + `invalid_argument`.
  - enum ê°’ì€ **ì´ ë¬¸ì„œ 4. ë°ì´í„° ëª¨ë¸ ê°œìš”ì˜ enum ì •ì˜**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.

- ID / í˜ì´ì§•
  - IDëŠ” ìŒìˆ˜ê°€ ì•„ë‹Œ ì •ìˆ˜ë¡œ ê²€ì¦í•œë‹¤. (0 ë˜ëŠ” ìŒìˆ˜ëŠ” 400)
  - í˜ì´ì§• íŒŒë¼ë¯¸í„°
    - `page >= 1`, `1 <= size <= ìµœëŒ€ê°’(ì˜ˆ: 100)`
    - ìœ„ë°˜ ì‹œ 400 + `invalid_argument`.

### 7.4 ì„œë¹„ìŠ¤ ê³„ì¸µ ë° íŒŒì¼ êµ¬ì¡°

> ê¸°ì¤€ ê²½ë¡œ: `src/` (ì˜ˆ: `\\wsl.localhost\Ubuntu\home\kkryo\dev\amazing-korean-api\src`)

#### 7.4.1 ë””ë ‰í„°ë¦¬ êµ¬ì¡°(ìš”ì•½)

- `src/api`
  - `admin/{lesson,study,user,video}/`
    - `dto.rs`, `handler.rs`, `repo.rs`, `router.rs`, `service.rs`, `mod.rs`
  - `auth/`
    - `dto.rs`, `extractor.rs`, `handler.rs`, `jwt.rs`, `repo.rs`, `router.rs`, `service.rs`, `token_utils.rs`, `mod.rs`
  - `health/`
    - `handler.rs`, `mod.rs`
  - `lesson/`, `study/`, `user/`, `video/`
    - ê° ë„ë©”ì¸ë³„ `dto.rs`, `handler.rs`, `repo.rs`, `router.rs`, `service.rs`, `mod.rs`
  - `scripts/`
    - `db_fastcheck.sh`
  - `mod.rs` (api ë£¨íŠ¸ ëª¨ë“ˆ)

- ë£¨íŠ¸ íŒŒì¼
  - `config.rs`  : í™˜ê²½ ë³€ìˆ˜/ì„¤ì • ë¡œë”©
  - `docs.rs`    : OpenAPI/Swagger ì •ì˜
  - `error.rs`   : ê³µí†µ ì—ëŸ¬ íƒ€ì…(AppError ë“±)
  - `main.rs`    : ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸(ì„œë²„ ë¶€íŠ¸ìŠ¤íŠ¸ë©)
  - `state.rs`   : `AppState` ì •ì˜(DB í’€, Redis, ì„¤ì • ë“±)
  - `types.rs`   : ê³µìš© íƒ€ì…/ë³„ì¹­

#### 7.4.2 ê³„ì¸µë³„ ì—­í• 

- `dto.rs`
  - ìš”ì²­/ì‘ë‹µ DTO ì •ì˜
  - `serde`/`validator`/`utoipa::ToSchema` ë“±ì„ ì‚¬ìš©
  - **í•µì‹¬:** HTTP ê²½ê³„ì—ì„œë§Œ ì“°ì´ëŠ” íƒ€ì…(ë‚´ë¶€ ë„ë©”ì¸ ëª¨ë¸ê³¼ ë¶„ë¦¬)

- `handler.rs`
  - Axum í•¸ë“¤ëŸ¬ í•¨ìˆ˜(ë¼ìš°íŠ¸ë³„ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„)
  - ì—­í• :
    - Path/Query/Json ë“± ìš”ì²­ íŒŒë¼ë¯¸í„° íŒŒì‹±
    - DTO ê²€ì¦ ê²°ê³¼ ì²˜ë¦¬
    - `Claims`/`AppState` ì¶”ì¶œ
    - **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì§ì ‘ ìˆ˜í–‰í•˜ì§€ ì•Šê³  `service`ë¥¼ í˜¸ì¶œ**

- `service.rs`
  - ë„ë©”ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì¤‘ì‹¬ ê³„ì¸µ
  - ì—­í• :
    - ìœ ì¦ˆì¼€ì´ìŠ¤ ë‹¨ìœ„ ë©”ì„œë“œ (ì˜ˆ: `signup_user`, `update_video`, `submit_answer`)
    - ì—¬ëŸ¬ `repo` í˜¸ì¶œì„ ë¬¶ì–´ **íŠ¸ëœì­ì…˜ ê²½ê³„**ë¥¼ í˜•ì„±
    - ê²€ì¦/ê¶Œí•œ ì²´í¬/ìƒíƒœ ì „ì´ ê·œì¹™ì„ ì—¬ê¸°ì„œ ì²˜ë¦¬
  - ì›ì¹™:
    - HTTP/í”„ë ˆì„ì›Œí¬ ì˜ì¡´ì„± ì—†ìŒ (ê°€ëŠ¥í•œ í•œ ìˆœìˆ˜ ë¡œì§ ìœ ì§€)
    - handlerëŠ” ì–‡ê²Œ, serviceëŠ” ë‘ê»ê²Œ

- `repo.rs`
  - DB ì ‘ê·¼ ì „ë‹´ ê³„ì¸µ(sqlx ì¿¼ë¦¬)
  - ì—­í• :
    - SELECT/INSERT/UPDATE/DELETE ë° ì €ì¥ í”„ë¡œì‹œì €/í•¨ìˆ˜ í˜¸ì¶œ
    - ì…ë ¥/ì¶œë ¥ì„ structë¡œ ë§¤í•‘
  - ì›ì¹™:
    - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì€ ë„£ì§€ ì•ŠëŠ”ë‹¤(ê²€ì¦/ê¶Œí•œ/ìƒíƒœ ì „ì´ëŠ” service ë‹´ë‹¹)
    - í•„ìš” ì‹œ íŠ¸ëœì­ì…˜ í•¸ë“¤ëŸ¬(`&mut Transaction<'_, Postgres>`)ë¥¼ ì¸ìë¡œ ë°›ì•„ ì‚¬ìš©

- `router.rs`
  - ë„ë©”ì¸ë³„ ì„œë¸Œ ë¼ìš°í„° ì •ì˜
  - ì—­í• :
    - ê° HTTP ë©”ì„œë“œ + ê²½ë¡œì— `handler`ë¥¼ ë§¤í•‘
    - ë„ë©”ì¸ ê³µí†µ ë¯¸ë“¤ì›¨ì–´(ì˜ˆ: ê´€ë¦¬ì ì¸ì¦, ë¡œê¹…) ë¶€ì°©
  - ë°˜í™˜ íƒ€ì…:
    - `Router<AppState>` (ìƒìœ„ `api::mod.rs`ì—ì„œ `.nest("/videos", video::router())` í˜•íƒœë¡œ ì‚¬ìš©)

- `mod.rs`
  - ê° ë„ë©”ì¸ ëª¨ë“ˆì˜ ë£¨íŠ¸
  - ì—­í• :
    - `pub mod dto; pub mod handler; ...` ì„ ì–¸
    - `pub fn router() -> Router<AppState>` ê°™ì€ ì§„ì… í•¨ìˆ˜ ë…¸ì¶œ
    - ìƒìœ„ ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•  ê³µê°œ íƒ€ì…/í•¨ìˆ˜ re-export

#### 7.4.3 íŠ¹ìˆ˜ ëª¨ë“ˆ(auth, health, scripts)

- `api/auth/`
  - `extractor.rs` : `Claims` ë“± ì¸ì¦ ê´€ë ¨ Axum extractor
  - `jwt.rs`       : JWT ì¸ì½”ë”©/ë””ì½”ë”©, í‚¤ ê´€ë¦¬
  - `token_utils.rs`: ì•¡ì„¸ìŠ¤/ë¦¬í”„ë ˆì‹œ í† í° ìƒì„±Â·ê²€ì¦ ìœ í‹¸
  - ë‚˜ë¨¸ì§€(`dto/handler/repo/service/router`)ëŠ” ì¼ë°˜ ë„ë©”ì¸ê³¼ ë™ì¼ íŒ¨í„´

- `api/health/`
  - `handler.rs`: `/health/live`, `/health/ready` ë“± í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
  - `mod.rs`: í—¬ìŠ¤ ë¼ìš°í„° ë…¸ì¶œ

- `api/scripts/db_fastcheck.sh`
  - ë¡œì»¬/CIìš© DB ë¹ ë¥¸ ì—°ê²° í™•ì¸ ìŠ¤í¬ë¦½íŠ¸
  - `sqlx` ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì „ DB ì¤€ë¹„ ìƒíƒœ ì ê²€ ë“±ì— ì‚¬ìš©

### 7.5 íŠ¸ëœì­ì…˜ íŒ¨í„´

> ëª©í‘œ: **ì—¬ëŸ¬ DB ì‘ì—…ì„ í•œ ë©ì–´ë¦¬(ì›ì ë‹¨ìœ„)ë¡œ ì²˜ë¦¬**í•´ì„œ  
> ì¤‘ê°„ì— ì—ëŸ¬ê°€ ë‚˜ë©´ ì „ë¶€ ë˜ëŒë¦¬ê³ , ì„±ê³µí•˜ë©´ ì „ë¶€ ë°˜ì˜ë˜ë„ë¡ í•œë‹¤.

#### 7.5.1 ì–¸ì œ íŠ¸ëœì­ì…˜ì„ ì“°ëŠ”ê°€

- ëŒ€í‘œ ì‚¬ìš© ì‚¬ë¡€
  - `USERS` + `USERS_LOG` ê°™ì´ **ë³¸ í…Œì´ë¸” + ë¡œê·¸ í…Œì´ë¸”**ì„ í•¨ê»˜ ê°±ì‹ í•  ë•Œ
  - `VIDEO` / `STUDY` / `LESSON` ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë©´ì„œ **ê´€ë ¨ `ADMIN_*_LOG`ê¹Œì§€ í•¨ê»˜ ê¸°ë¡**í•  ë•Œ
  - í•œ HTTP ìš”ì²­ ì•ˆì—ì„œ **ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì—°ì†ìœ¼ë¡œ ë³€ê²½**í•´ì•¼ í•  ë•Œ
  - ê²°ì œ/ìˆ˜ê°•ê¶Œ ë“± **ë¹„ì¦ˆë‹ˆìŠ¤ ì¼ê´€ì„±ì´ íŠ¹íˆ ì¤‘ìš”í•œ ì‘ì—…** (PAY + COURSE/COURSE_PROGRESS ë“±)
- ì›ì¹™
  - â€œì´ ì¤‘ í•˜ë‚˜ë§Œ ë°˜ì˜ë˜ê³  ë‚˜ë¨¸ì§€ëŠ” ì‹¤íŒ¨í•˜ë©´ ì•ˆ ë˜ëŠ” ì‘ì—…â€ì´ë©´ **íŠ¸ëœì­ì…˜ì„ ì“´ë‹¤.**
  - â€œë¡œê·¸/í†µê³„ê°€ ì•½ê°„ ëŠ¦ê²Œ ìŒ“ì—¬ë„ ë˜ëŠëƒ?â€ê°€ ì•„ë‹ˆë¼  
    **â€œì´ ë³€ê²½ê³¼ ë¡œê·¸/í†µê³„ê°€ í•­ìƒ ê°™ì´ ìˆì–´ì•¼ í•˜ëŠëƒâ€** ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•œë‹¤.
  - í˜„ì¬ AMKì˜ ê¸°ë³¸ ë°©í–¥:
    - **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ìƒíƒœ + ê·¸ì— ëŒ€í•œ ë¡œê·¸**ëŠ” í•œ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ í•¨ê»˜ ì²˜ë¦¬í•œë‹¤.

#### 7.5.2 ì–´ë””ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì—¬ëŠ”ê°€

- handler ê³„ì¸µ
  - íŠ¸ëœì­ì…˜ì„ **ì§ì ‘ ì—´ì§€ ì•ŠëŠ”ë‹¤.**
  - ì—­í• :
    - HTTP ìš”ì²­ íŒŒì‹± (path/query/body)
    - ì¸ì¦/ì¸ê°€ ì •ë³´ ì¶”ì¶œ (Claims ë“±)
    - ê¸°ë³¸ ìˆ˜ì¤€ì˜ ìœ íš¨ì„± ê²€ì‚¬
    - â†’ ì´í›„ **service** í•¨ìˆ˜ í˜¸ì¶œ
- service ê³„ì¸µ
  - **íŠ¸ëœì­ì…˜ ì‹œì‘/ì»¤ë°‹/ë¡¤ë°±ì˜ ì±…ì„ì„ ê°€ì§„ë‹¤.**
  - í•˜ë‚˜ì˜ ìœ ì¦ˆì¼€ì´ìŠ¤(ì˜ˆ: `/users` signup, `/users/me` update ë“±)ì— í•„ìš”í•˜ë‹¤ë©´  
    service í•¨ìˆ˜ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì—´ê³ , ë„ë©”ì¸ repoë“¤ì„ í˜¸ì¶œí•œë‹¤.
  - íŒ¨í„´ ì˜ˆì‹œ:

    ```rust
    pub async fn update_user_and_log(
        state: &AppState,
        input: UpdateUserInput,
        actor_id: i64,
    ) -> AppResult<User> {
        // 1) íŠ¸ëœì­ì…˜ ì‹œì‘
        let mut tx = state.db.begin().await?;

        // 2) ë©”ì¸ ìƒíƒœ ë³€ê²½
        let user = user_repo::update_user(&mut tx, &input).await?;

        // 3) ë¡œê·¸ ê¸°ë¡
        user_repo::insert_users_log(&mut tx, &user, actor_id, "update_profile").await?;

        // 4) (í•„ìš” ì‹œ) í†µê³„/ê¸°íƒ€ íŒŒìƒ ë°ì´í„° ê°±ì‹ 

        // 5) ì „ë¶€ ì„±ê³µí–ˆìœ¼ë©´ ì»¤ë°‹
        tx.commit().await?;

        Ok(user)
    }
    ```
    
  - ì¤‘ê°„ì— ì—ëŸ¬ê°€ ë‚˜ë©´ `commit()`ì— ë„ë‹¬í•˜ì§€ ëª»í•˜ê³ ,
    íŠ¸ëœì­ì…˜ ê°ì²´ê°€ dropë˜ë©´ì„œ ì „ì²´ ì‘ì—…ì´ **ë¡¤ë°±**ëœë‹¤ê³  ë³´ëŠ” ê²ƒì„ ê¸°ë³¸ ì „ì œë¡œ í•œë‹¤.
- repo ê³„ì¸µ
  - â€œì–´ë–¤ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(DB ì—°ê²° or íŠ¸ëœì­ì…˜)ë¥¼ ë°›ì„ì§€â€ë§Œ ì‹ ê²½ ì“´ë‹¤.
  - íŠ¸ëœì­ì…˜ì„ ì‹œì‘/ì»¤ë°‹í•˜ì§€ ì•Šê³ , **ë„˜ê²¨ë°›ì€ executor ì•ˆì—ì„œë§Œ ì¿¼ë¦¬ ì‹¤í–‰**í•œë‹¤.
    ```rust
    pub async fn update_user<'e, E>(
        executor: E,
        input: &UpdateUserInput,
    ) -> AppResult<UserRow>
    where
        E: sqlx::Executor<'e, Database = sqlx::Postgres>,
    {
        // UPDATE users SET ... WHERE user_id = ...
        // ...
    }
    ```
  - ê°™ì€ repo í•¨ìˆ˜ê°€ íŠ¸ëœì­ì…˜ ì•ˆ/ë°– ì–‘ìª½ì—ì„œ ì¬ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡  
    **`&PgPool` / `&mut Transaction<'_, Postgres>` ëª¨ë‘ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ì œë„¤ë¦­ executor íŒ¨í„´**ì„ ì‚¬ìš©í•œë‹¤.

#### 7.5.3 API upsert íŒ¨í„´ (ì˜ˆ: ë¹„ë””ì˜¤ ì§„ë„ ì €ì¥)

- ë¹„ë””ì˜¤ ì§„ë„ APIëŠ” DB í•¨ìˆ˜ í˜•íƒœë¡œ upsertë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ íŒ¨í„´ìœ¼ë¡œ í•œë‹¤.
  - ì˜ˆ: `api_upsert_video_progress(user_id, video_id, progress, ...)`
- ì´ í•¨ìˆ˜ ì•ˆì—ì„œ:
  - ìƒˆ ê¸°ë¡ì´ë©´ `INSERT`
  - ê¸°ì¡´ ê¸°ë¡ì´ë©´ `UPDATE`
  - í•„ìš”í•œ ê²½ìš° `VIDEO_LOG` / `VIDEO_STAT_DAILY` ë“± ì—°ê´€ ì •ë³´ê¹Œì§€ í•¨ê»˜ ê°±ì‹ 
  - â†’ ë¥¼ **í•œ ë²ˆì— ì²˜ë¦¬**í•˜ë„ë¡ ì„¤ê³„í•œë‹¤. (DB í•¨ìˆ˜ ë‚´ë¶€ê°€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ì—­í• )
- ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œëŠ”:
  - 1) ì…ë ¥ ê²€ì¦ (0~100 ë²”ìœ„, ì‚¬ìš©ì ê¶Œí•œ, ì†Œìœ ê¶Œ ë“±)
  - 2) `api_upsert_video_progress(...)`ë¥¼ **í•œ ë²ˆ í˜¸ì¶œí•˜ëŠ” ê²ƒ**ì„  
       â€œì´ ì‘ì—…ì˜ íŠ¸ëœì­ì…˜ ë‹¨ìœ„â€ë¡œ ë³¸ë‹¤.
- í•œ HTTP ìš”ì²­ì—ì„œ
  - â€œì§„ë„ upsert + ë‹¤ë¥¸ í…Œì´ë¸” ë³€ê²½â€ì´ í•¨ê»˜ í•„ìš”í•˜ë‹¤ë©´,
  - 7.5.2 íŒ¨í„´ëŒ€ë¡œ **ì„œë¹„ìŠ¤ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì—´ê³ **, ê·¸ ì•ˆì—ì„œ
    - `api_upsert_video_progress(...)`
    - + ê¸°íƒ€ repo í•¨ìˆ˜
    - ë¥¼ í•¨ê»˜ í˜¸ì¶œí•œë‹¤.

#### 7.5.4 íŠ¸ëœì­ì…˜ ë‚´ë¶€ ìˆœì„œ íŒ¨í„´

> ê¸°ë³¸ ìˆœì„œ: **ê²€ì¦ â†’ ë©”ì¸ ë³€ê²½ â†’ ë¡œê·¸ â†’ (í†µê³„/íŒŒìƒ) â†’ ì»¤ë°‹**

- 1) ê²€ì¦ / í˜„ì¬ ìƒíƒœ ì¡°íšŒ
  - ì˜ˆ:
    - ëŒ€ìƒ ë ˆì½”ë“œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    - ì†Œìœ ê¶Œ/ê¶Œí•œ ì²´í¬
    - ì¤‘ë³µ ì—¬ë¶€(ì´ë©”ì¼ ì¤‘ë³µ ë“±)
  - ì£¼ë¡œ `SELECT ... FOR UPDATE` ë˜ëŠ” ë‹¨ìˆœ `SELECT` ë¡œ ì²˜ë¦¬
- 2) ë©”ì¸ ìƒíƒœ ë³€ê²½
  - ë¹„ì¦ˆë‹ˆìŠ¤ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ì£¼ëŠ” í…Œì´ë¸” ë³€ê²½
    - ì˜ˆ: `USERS`, `USERS_SETTING`, `STUDY_TASK_STATUS`, `LESSON_PROGRESS` ë“±
  - `INSERT` / `UPDATE` / `DELETE` ì¤‘ì‹¬
- 3) ë¡œê·¸/ê°ì‚¬ ê¸°ë¡
  - `USERS_LOG`, `LOGIN_LOG`, `VIDEO_LOG`, `STUDY_TASK_LOG`, `ADMIN_*_LOG` ë“±
  - ê°€ëŠ¥í•˜ë©´ **before/after ìŠ¤ëƒ…ìƒ·, actor, action**ì„ í•¨ê»˜ ì €ì¥
- 4) í†µê³„/íŒŒìƒ ë°ì´í„°(ì„ íƒ)
  - ì§‘ê³„/í†µê³„ìš© í…Œì´ë¸” (`VIDEO_STAT_DAILY` ë“±)
  - í•„ìš” ì‹œì—ë§Œ ê°±ì‹ , ë„ˆë¬´ ë³µì¡í•´ì§€ë©´ ì¶”í›„ ë¹„ë™ê¸°/ë°°ì¹˜ë¡œ ë¶„ë¦¬ ê²€í† 
- 5) ì»¤ë°‹
  - ìœ„ ë‹¨ê³„ë“¤(1~4)ì´ ëª¨ë‘ ì„±ê³µí•œ ê²½ìš°ì—ë§Œ `commit()`
  - ì¤‘ê°„ì— í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ â†’ **ì „ì²´ ë¡¤ë°±**  
    â†’ ì‹¤ì œ ë°ì´í„°ì™€ ë¡œê·¸/í†µê³„ ê°„ **ì¼ê´€ì„± ìœ ì§€**

- ì˜ˆì‹œ (USERS + USERS_LOG):

  ```rust
  pub async fn update_profile(
      state: &AppState,
      req: UpdateProfileReq,
      actor_id: i64,
  ) -> AppResult<UserMeRes> {
      let mut tx = state.db.begin().await?;

      // 1) í˜„ì¬ ìƒíƒœ ì¡°íšŒ (ê²€ì¦)
      let before = user_repo::find_user_for_update(&mut tx, req.user_id).await?;

      // 2) ë©”ì¸ ìƒíƒœ ë³€ê²½
      let after = user_repo::update_user_profile(&mut tx, &req).await?;

      // 3) ë¡œê·¸ ê¸°ë¡
      user_repo::insert_users_log(&mut tx, &before, &after, actor_id, "update_profile").await?;

      // 4) (í•„ìš” ì‹œ) í†µê³„/íŒŒìƒ ë°ì´í„° ê°±ì‹ 

      // 5) ì»¤ë°‹
      tx.commit().await?;

      Ok(UserMeRes::from(after))
  }

> **ìš”ì•½**  
> í•˜ë‚˜ì˜ ìœ ì¦ˆì¼€ì´ìŠ¤ ì•ˆì—ì„œ ì—¬ëŸ¬ DB ì‘ì—…ì´ í•„ìš”í•˜ë©´ **service ë ˆì´ì–´ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì—´ê³ **,  
> **ê²€ì¦ â†’ ë©”ì¸ ë³€ê²½ â†’ ë¡œê·¸ â†’ (í†µê³„) â†’ ì»¤ë°‹** ìˆœì„œë¡œ ì‹¤í–‰í•œë‹¤.  
> ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ìš©ì ì…ì¥ì—ì„œëŠ” â€œìš”ì²­ í•œ ë²ˆâ€ì´,  
> ê´€ë¦¬/ìš´ì˜ ì…ì¥ì—ì„œëŠ” **ì¼ê´€ì„± ìˆëŠ” ìƒíƒœ + ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë¡œê·¸**ë¡œ ë‚¨ëŠ”ë‹¤.

### 7.6 í…ŒìŠ¤íŠ¸ & ìë™í™”

> ëª©í‘œ: **â€œì‚¬ëŒì´ ì‹¤ìˆ˜ë¡œ ë¹¼ë¨¹ì§€ ì•Šê²Œâ€ ìµœì†Œí•œì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ëŒë¦¬ëŠ” ê²ƒ**  
> (ì²˜ìŒì—ëŠ” ê°€ë³ê²Œ ì‹œì‘í•˜ê³ , ì ì§„ì ìœ¼ë¡œ í™•ì¥í•œë‹¤.)

#### 7.6.1 ìµœì†Œ ì •ì  ê°€ë“œ (ë¡œì»¬ + CI ê³µí†µ)

- í•­ìƒ ëŒë ¤ì•¼ í•˜ëŠ” ê¸°ë³¸ ê°€ë“œ:
  - `cargo fmt -- --check`  : í¬ë§· ì¼ê´€ì„±
  - `cargo clippy -- -D warnings` : ì ì¬ ë²„ê·¸/ë‚˜ìœ íŒ¨í„´ ì°¨ë‹¨
  - `cargo check` : íƒ€ì…/ë¹Œë“œ ì˜¤ë¥˜ ì‚¬ì „ ê²€ì¶œ
- ì‚¬ìš© ë°©ì‹:
  - **ë¡œì»¬**: ê¸°ëŠ¥ ê°œë°œ í›„ ì»¤ë°‹ ì „ì— ìˆ˜ë™ ì‹¤í–‰
  - **CI**: PR ìƒì„±/ì—…ë°ì´íŠ¸ ì‹œ ìë™ ì‹¤í–‰ (í–¥í›„ GitHub Actions ë“±ìœ¼ë¡œ êµ¬ì„± ì˜ˆì •)

#### 7.6.2 ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ (ê¸°ëŠ¥ ë‹¨ìœ„ í™•ì¸)

- ëª©ì :
  - â€œì„œë²„ê°€ ëœ¨ê³ , ëŒ€í‘œì ì¸ API ëª‡ ê°œëŠ” ì •ìƒ ì‘ë‹µì„ ì¤€ë‹¤â€ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê¸° ìœ„í•¨.
- ëŒ€ìƒ:
  - ëŒ€í‘œ ì—”ë“œí¬ì¸íŠ¸
    - health: `/health`
    - auth: `/auth/login`, `/auth/refresh`
    - user: `/users`, `/users/me`
    - videos: `/videos`, `/videos/{id}`, `/videos/{id}/progress`
    - admin: `/admin/videos`, `/admin/studies` ë“±
- í˜•íƒœ:
  - `scripts/` í´ë”ì— cURL ê¸°ë°˜ ìŠ¤ëª¨í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‘”ë‹¤.
    - ì˜ˆ: `scripts/smoke_health.sh`, `scripts/smoke_auth.sh`, `scripts/smoke_videos.sh`
  - ê° ìŠ¤í¬ë¦½íŠ¸ëŠ” **ì„±ê³µ ì¼€ì´ìŠ¤ + ëŒ€í‘œ ì—ëŸ¬ ì¼€ì´ìŠ¤ 1ê°œ ì •ë„**ë¥¼ í¬í•¨í•œë‹¤.
    - ì˜ˆ: í† í° ì—†ì´ `/users/me` í˜¸ì¶œ â†’ 401 í™•ì¸
- ì‹¤í–‰ íƒ€ì´ë°:
  - **ë¡œì»¬**: í° ë³€ê²½(ì˜ˆ: ë„ë©”ì¸ ì¶”ê°€, ë§ˆì´ê·¸ë ˆì´ì…˜ ë³€ê²½) í›„ ìˆ˜ë™ ì‹¤í–‰
  - **CI (í–¥í›„)**: main ë¸Œëœì¹˜ì— ë¨¸ì§€ë˜ê¸° ì „ 1íšŒ ì‹¤í–‰ì„ ëª©í‘œë¡œ í•œë‹¤.

#### 7.6.3 ìë™í™” ë ˆë²¨ (ì´ˆê¸° ë°©ì¹¨)

- 1ë‹¨ê³„: ë¡œì»¬ ìŠ¤í¬ë¦½íŠ¸
  - ê°œë°œìëŠ” ë‹¤ìŒì„ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤.
    - `./scripts/db_fastcheck.sh` (DB ì¤€ë¹„ ìƒíƒœ ì ê²€)
    - `cargo fmt -- --check`
    - `cargo clippy -- -D warnings`
    - `cargo check`
    - í•„ìš” ì‹œ `./scripts/smoke_*.sh`
- 2ë‹¨ê³„: CI ì—°ê³„ (í–¥í›„)
  - PR ìƒì„±/ì—…ë°ì´íŠ¸ ì‹œ:
    - `fmt` / `clippy` / `check` ìë™ ì‹¤í–‰
  - main ë¸Œëœì¹˜ ë¨¸ì§€ ì „:
    - ìµœì†Œ í•œ ê°œ ì´ìƒì˜ ìŠ¤ëª¨í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì˜ˆ: `smoke_health.sh`, `smoke_auth.sh`)
- 3ë‹¨ê³„: ë¶€í•˜/ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (K6, í–¥í›„)
  - K6 ìŠ¤í¬ë¦½íŠ¸ë¥¼ `scripts/k6/` ì•„ë˜ì— ë‘ê³ ,
  - ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤(ë¡œê·¸ì¸ + ë¹„ë””ì˜¤ ì¡°íšŒ + ì§„ë„ ì €ì¥ ë“±)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•œë‹¤.
  - CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ë˜ëŠ” ìˆ˜ë™ íŠ¸ë¦¬ê±°ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤.

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 7.7 ì½”ë“œ ì˜ˆì‹œ (Best Practices)

> ì´ ì„¹ì…˜ì˜ ì½”ë“œëŠ” **ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ê²€ì¦ëœ íŒ¨í„´**ì…ë‹ˆë‹¤.
> LLMì—ê²Œ ìƒˆ ê¸°ëŠ¥ ìš”ì²­ ì‹œ "Section 7.7ì˜ íŒ¨í„´ X ì‚¬ìš©" ì§€ì‹œí•˜ë©´ ì¼ê´€ëœ ì½”ë“œ ìƒì„± ê°€ëŠ¥.

### 7.7.1 ë°±ì—”ë“œ íŒ¨í„´ (Rust/Axum)

---

#### 7.7.1-0. ê³µìš© ì½”ë“œ (Common Code)

> **ğŸ“‹ SSoT ê²€ì¦ ì™„ë£Œ** (2026-01-22)
> ì•„ë˜ ë‚´ìš©ì€ ì‹¤ì œ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.

##### íŒŒì¼ ëª©ë¡ ë° ì—­í• 

| íŒŒì¼ | ì—­í•  | ì˜ì¡´ ê´€ê³„ |
|------|------|----------|
| `src/config.rs` | ëŸ°íƒ€ì„ ì„¤ì • SSoT (í™˜ê²½ë³€ìˆ˜ íŒŒì‹±) | dotenvy |
| `src/state.rs` | AppState ì˜ì¡´ì„± ì»¨í…Œì´ë„ˆ | config.rs |
| `src/error.rs` | ì „ì—­ ì—ëŸ¬ íƒ€ì… + HTTP ì‘ë‹µ í‘œì¤€í™” | ë…ë¦½ |
| `src/types.rs` | DB enum â†” Rust enum â†” JSON ë§¤í•‘ | ë…ë¦½ |
| `src/docs.rs` | OpenAPI ë¬¸ì„œ ì§‘ê³„ + ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ | ë„ë©”ì¸ í•¸ë“¤ëŸ¬ë“¤ |
| `src/main.rs` | ë¶€íŠ¸ìŠ¤íŠ¸ë© (ë¦¬ì†ŒìŠ¤ ìƒì„± â†’ ì„œë²„ ì‹¤í–‰) | ëª¨ë“  ëª¨ë“ˆ |
| `src/api/mod.rs` | ë„ë©”ì¸ ë¼ìš°í„° ì¡°ë¦½ | ë„ë©”ì¸ ë¼ìš°í„°ë“¤ |

---

##### 1ï¸âƒ£ `src/config.rs` â€” ëŸ°íƒ€ì„ ì„¤ì • SSoT

**ì—­í• **: í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •ì˜ **ë‹¨ì¼ ì§„ì…ì **. ëª¨ë“  ëŸ°íƒ€ì„ íŒŒë¼ë¯¸í„°ê°€ ì´ íŒŒì¼ì—ì„œ ê´€ë¦¬ë¨.

```rust
use std::env;

#[derive(Clone)]
pub struct Config {
    // í•„ìˆ˜ ì¸í”„ë¼
    pub database_url: String,
    pub bind_addr: String,
    pub redis_url: String,

    // JWT ì„¤ì • (í•„ìˆ˜)
    pub jwt_secret: String,
    pub jwt_expire_hours: i64,
    pub jwt_access_ttl_min: i64,

    // Refresh Token ì„¤ì •
    pub refresh_ttl_days: i64,
    pub refresh_cookie_name: String,
    pub refresh_cookie_domain: Option<String>,
    pub refresh_cookie_secure: bool,
    pub refresh_cookie_samesite: String,

    // ê¸°ëŠ¥ í† ê¸€
    pub enable_docs: bool,
    pub skip_db: bool,

    // Rate Limit
    pub rate_limit_login_window_sec: i64,
    pub rate_limit_login_max: i64,
}

impl Config {
    pub fn from_env() -> Self {
        dotenvy::dotenv().ok();

        // JWT_SECRETë§Œ í•„ìˆ˜ (expect)
        let jwt_secret = env::var("JWT_SECRET")
            .expect("JWT_SECRET must be set");

        // ë‚˜ë¨¸ì§€ëŠ” ê¸°ë³¸ê°’ ì œê³µ
        let database_url = env::var("DATABASE_URL")
            .unwrap_or_else(|_| "postgres://...".into());
        // ... ìƒëµ
    }
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- `JWT_SECRET`ë§Œ **í•„ìˆ˜** (ì—†ìœ¼ë©´ panic) â€” ë³´ì•ˆ ê°•ì œ
- ë‚˜ë¨¸ì§€ ì„¤ì •ì€ **ê¸°ë³¸ê°’ ì œê³µ** â€” ë¡œì»¬ ê°œë°œ í¸ì˜ì„±
- `refresh_cookie_samesite_or()` í—¬í¼ë¡œ ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬

**âš ï¸ ê·œì¹™**:
- ìƒˆ í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ ì‹œ â†’ **ë°˜ë“œì‹œ Configì— í•„ë“œ ì¶”ê°€**
- ê¸°ë³¸ê°’ ê²°ì • ì‹œ â†’ ë¡œì»¬ ê°œë°œ í¸ì˜ vs í”„ë¡œë•ì…˜ ì•ˆì „ì„± ê³ ë ¤

---

##### 2ï¸âƒ£ `src/state.rs` â€” AppState ì˜ì¡´ì„± ì»¨í…Œì´ë„ˆ

**ì—­í• **: í•¸ë“¤ëŸ¬/ì„œë¹„ìŠ¤/ë ˆí¬ì—ì„œ ê³µí†µ ì ‘ê·¼í•˜ëŠ” **ì˜ì¡´ì„± ë¬¶ìŒ**

```rust
use axum::extract::FromRef;
use deadpool_redis::Pool as RedisPool;
use sqlx::{Pool, Postgres};
use std::time::Instant;

use crate::config::Config;

#[derive(Clone, FromRef)]
pub struct AppState {
    pub db: Pool<Postgres>,    // Postgres ì»¤ë„¥ì…˜ í’€
    pub redis: RedisPool,       // Redis ì»¤ë„¥ì…˜ í’€
    pub cfg: Config,            // ëŸ°íƒ€ì„ ì„¤ì •
    pub started_at: Instant,    // ì„œë²„ ì‹œì‘ ì‹œê°„ (uptime ê³„ì‚°ìš©)
}

impl AsRef<AppState> for AppState {
    fn as_ref(&self) -> &AppState {
        self
    }
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- `#[derive(Clone, FromRef)]` â†’ State ì¶”ì¶œ + ë¶€ë¶„ ì¶”ì¶œ ê°€ëŠ¥
- í•¸ë“¤ëŸ¬ì—ì„œ: `State(state): State<AppState>`
- ì„œë¸ŒìŠ¤í…Œì´íŠ¸ ì¶”ì¶œ: `State(db): State<Pool<Postgres>>`

**âš ï¸ ê·œì¹™**:
- í•¸ë“¤ëŸ¬ â†’ `&state.db`, `&state.redis`, `&state.cfg`ë¡œ í•˜ìœ„ ë ˆì´ì–´ì— ì „ë‹¬
- ìƒˆ ì „ì—­ ë¦¬ì†ŒìŠ¤ ì¶”ê°€ ì‹œ â†’ AppStateì— í•„ë“œ ì¶”ê°€ + main.rsì—ì„œ ì´ˆê¸°í™”

---

##### 3ï¸âƒ£ `src/error.rs` â€” ì „ì—­ ì—ëŸ¬ íƒ€ì… + HTTP ì‘ë‹µ í‘œì¤€í™”

**ì—­í• **: ëª¨ë“  ë ˆì´ì–´ì˜ ì—ëŸ¬ë¥¼ **í†µì¼ëœ HTTP ì‘ë‹µ**ìœ¼ë¡œ ë³€í™˜

```rust
use thiserror::Error;
use axum::{
    http::{StatusCode, header},
    response::{IntoResponse, Response},
    Json,
};

#[derive(Debug, Error)]
pub enum AppError {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ì—ëŸ¬
    #[error("Internal server error")]
    Internal(String),
    #[error("Health check failed: {0}")]
    HealthInternal(String),
    #[error("Bad request: {0}")]
    BadRequest(String),
    #[error("Unprocessable entity: {0}")]
    Unprocessable(String),         // 422
    #[error("Unauthorized: {0}")]
    Unauthorized(String),
    #[error("Forbidden: {0}")]
    Forbidden(String),
    #[error("Not found")]
    NotFound,
    #[error("Conflict: {0}")]
    Conflict(String),              // 409
    #[error("Too many requests: {0}")]
    TooManyRequests(String),       // 429
    #[error("Service unavailable: {0}")]
    ServiceUnavailable(String),    // 503
    #[error("External service error: {0}")]
    External(String),              // 502

    // ì¸í”„ë¼ ì—ëŸ¬ (ìë™ ë³€í™˜)
    #[error(transparent)]
    Sqlx(#[from] sqlx::Error),
    #[error(transparent)]
    Anyhow(#[from] anyhow::Error),
    #[error(transparent)]
    Redis(#[from] deadpool_redis::redis::RedisError),
    #[error(transparent)]
    Jsonwebtoken(#[from] jsonwebtoken::errors::Error),
    #[error(transparent)]
    Validation(#[from] validator::ValidationErrors),
}

// ì „ì—­ Result íƒ€ì…
pub type AppResult<T> = Result<T, AppError>;
```

**HTTP ì‘ë‹µ í‘œì¤€í™”**:

```rust
impl IntoResponse for AppError {
    fn into_response(self) -> Response {
        let (status, code, message, details, retry_after) = match &self {
            AppError::BadRequest(msg) =>
                (StatusCode::BAD_REQUEST, "BAD_REQUEST", msg.clone(), None, None),
            AppError::Unauthorized(msg) =>
                (StatusCode::UNAUTHORIZED, "UNAUTHORIZED", msg.clone(), None, None),
            AppError::TooManyRequests(msg) =>
                (StatusCode::TOO_MANY_REQUESTS, "TOO_MANY_REQUESTS", msg.clone(), None, Some(60)),
            // ... ê¸°íƒ€ ë§¤ì¹­
        };

        // í‘œì¤€ ì—ëŸ¬ ë°”ë””
        let body = serde_json::json!({
            "error": {
                "code": code,
                "http_status": status.as_u16(),
                "message": message,
                "details": details,
                "trace_id": "req-TODO"  // TODO: Request ID ì—°ë™
            }
        });

        let mut res = (status, Json(body)).into_response();
        if let Some(sec) = retry_after {
            res.headers_mut().insert(
                header::RETRY_AFTER,
                sec.to_string().parse().unwrap()
            );
        }
        res
    }
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- `AppResult<T>` = `Result<T, AppError>` â€” ì „ ë ˆì´ì–´ ê³µìš©
- `?` ì—°ì‚°ìë¡œ ì—ëŸ¬ ì „íŒŒ â†’ ìë™ìœ¼ë¡œ HTTP ì‘ë‹µ ë³€í™˜
- `#[from]` ì–´íŠ¸ë¦¬ë·°íŠ¸ë¡œ ì¸í”„ë¼ ì—ëŸ¬ ìë™ ë˜í•‘
- 429 ì‘ë‹µ ì‹œ `Retry-After` í—¤ë” ìë™ ì¶”ê°€

**âš ï¸ ê·œì¹™**:
- ìƒˆ ì—ëŸ¬ íƒ€ì… í•„ìš” ì‹œ â†’ `AppError` variant ì¶”ê°€
- ì„œë¹„ìŠ¤/ë ˆí¬ì—ì„œ `Err(AppError::NotFound)` í˜•íƒœë¡œ ë°˜í™˜
- í”„ë¡ íŠ¸ì—”ë“œëŠ” `error.code` í•„ë“œë¡œ ì—ëŸ¬ ì¢…ë¥˜ íŒë‹¨

---

##### 4ï¸âƒ£ `src/types.rs` â€” DB enum â†” Rust enum â†” JSON ë§¤í•‘

**ì—­í• **: DB enum íƒ€ì…ì˜ **ë‹¨ì¼ ì •ì˜** (ì¤‘ë³µ enum ê¸ˆì§€)

```rust
use serde::{Deserialize, Serialize};
use sqlx::Type;
use utoipa::ToSchema;
use std::fmt;

// Triple Derive íŒ¨í„´: sqlx + serde + utoipa
#[derive(Clone, Debug, Serialize, Deserialize, Type, ToSchema, PartialEq)]
#[sqlx(type_name = "user_auth")]        // DB enum ì´ë¦„
#[serde(rename_all = "lowercase")]      // JSON: "google", "email"
pub enum UserAuth {
    Google,
    Apple,
    Email,
}

// Display êµ¬í˜„ (ë¡œê¹…ìš©)
impl fmt::Display for UserAuth {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        match self {
            UserAuth::Google => write!(f, "google"),
            UserAuth::Apple => write!(f, "apple"),
            UserAuth::Email => write!(f, "email"),
        }
    }
}

// íŠ¹ìˆ˜ ì¼€ì´ìŠ¤: DBì™€ API ì´ë¦„ì´ ë‹¤ë¥¼ ë•Œ
#[derive(Clone, Debug, Serialize, Deserialize, Type, ToSchema, PartialEq)]
#[sqlx(type_name = "lesson_type")]
#[serde(rename_all = "lowercase")]
pub enum LessonType {
    Video,
    #[sqlx(rename = "HYMN")]           // DBì—ëŠ” ëŒ€ë¬¸ìë¡œ ì €ì¥
    #[serde(rename = "hymn")]          // JSONì—ëŠ” ì†Œë¬¸ìë¡œ ë…¸ì¶œ
    Hymn,
}

#[derive(Clone, Debug, Serialize, Deserialize, Type, ToSchema, PartialEq)]
#[sqlx(type_name = "user_level")]
pub enum UserLevel {
    #[serde(rename = "basic_900")]     // JSON: "basic_900"
    Basic900,
    #[serde(rename = "basic_1800")]
    Basic1800,
    // ...
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **Triple Derive**: `sqlx::Type` + `serde` + `utoipa::ToSchema`
- DB enum ì´ë¦„: `#[sqlx(type_name = "...")]`
- JSON ì§ë ¬í™”: `#[serde(rename_all = "...")]` ë˜ëŠ” ê°œë³„ `#[serde(rename = "...")]`
- ì˜ˆì™¸ ì¼€ì´ìŠ¤: `#[sqlx(rename = "...")]`ë¡œ DB ê°’ ëª…ì‹œ

**âš ï¸ ê·œì¹™**:
- **ì¤‘ë³µ enum ì •ì˜ ê¸ˆì§€** â€” ëª¨ë“  ë„ë©”ì¸ì—ì„œ `crate::types::*` import
- ìƒˆ DB enum ì¶”ê°€ ì‹œ â†’ ì—¬ê¸°ì— ì •ì˜ + ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì„±
- Swaggerì— ìë™ ë…¸ì¶œë¨ (ToSchema)

---

##### 5ï¸âƒ£ `src/docs.rs` â€” OpenAPI ë¬¸ì„œ ì§‘ê³„

**ì—­í• **: ëª¨ë“  API ê²½ë¡œì™€ ìŠ¤í‚¤ë§ˆë¥¼ **ë‹¨ì¼ OpenAPI ë¬¸ì„œ**ë¡œ ì§‘ê³„

```rust
use utoipa::openapi::security::{HttpAuthScheme, HttpBuilder, SecurityScheme};
use utoipa::{Modify, OpenApi};

// ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ ë“±ë¡
pub struct SecurityAddon;

impl Modify for SecurityAddon {
    fn modify(&self, openapi: &mut utoipa::openapi::OpenApi) {
        let components = openapi.components.get_or_insert(Default::default());

        // JWT Bearer Auth
        components.add_security_scheme(
            "bearerAuth",
            SecurityScheme::Http(
                HttpBuilder::new()
                    .scheme(HttpAuthScheme::Bearer)
                    .bearer_format("JWT")
                    .build(),
            ),
        );

        // Refresh Token Cookie
        components.add_security_scheme(
            "refreshCookie",
            SecurityScheme::ApiKey(utoipa::openapi::security::ApiKey::Cookie(
                utoipa::openapi::security::ApiKeyValue::new("ak_refresh"),
            )),
        );
    }
}

#[derive(OpenApi)]
#[openapi(
    info(title = "Amazing Korean API", version = "0.1.0"),
    paths(
        // ëª¨ë“  í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ë‚˜ì—´
        crate::api::auth::handler::login,
        crate::api::auth::handler::refresh,
        crate::api::user::handler::get_me,
        crate::api::video::handler::get_video_detail,
        // ... ì „ì²´ paths
    ),
    components(schemas(
        // ëª¨ë“  DTO/Enum ë‚˜ì—´
        crate::api::auth::dto::LoginRequest,
        crate::api::auth::dto::LoginResponse,
        crate::types::UserAuth,
        crate::error::ErrorBody,
        // ... ì „ì²´ schemas
    )),
    tags(
        (name = "Auth", description = "ì¸ì¦ ê´€ë ¨ API"),
        (name = "User", description = "ì‚¬ìš©ì ê´€ë ¨ API"),
        (name = "Video", description = "ë¹„ë””ì˜¤ ê´€ë ¨ API"),
        // ... ì „ì²´ tags
    ),
    modifiers(&SecurityAddon)
)]
pub struct ApiDoc;
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- `paths(...)`: ë¬¸ì„œí™”í•  í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ëª©ë¡
- `components(schemas(...))`: ë¬¸ì„œí™”í•  DTO/Enum ëª©ë¡
- `tags(...)`: Swagger UI ê·¸ë£¹í•‘
- `SecurityAddon`: `bearerAuth` + `refreshCookie` ìŠ¤í‚¤ë§ˆ ë“±ë¡

**âš ï¸ ê·œì¹™**:
- ìƒˆ í•¸ë“¤ëŸ¬ ì¶”ê°€ ì‹œ â†’ `paths(...)`ì— ë“±ë¡ **í•„ìˆ˜**
- ìƒˆ DTO ì¶”ê°€ ì‹œ â†’ `components(schemas(...))`ì— ë“±ë¡ **í•„ìˆ˜**
- í•¸ë“¤ëŸ¬ì— `#[utoipa::path(...)]` ë§¤í¬ë¡œ í•„ìˆ˜

---

##### 6ï¸âƒ£ `src/main.rs` â€” ë¶€íŠ¸ìŠ¤íŠ¸ë©

**ì—­í• **: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ìˆœì„œ ì •ì˜

```rust
#[tokio::main]
async fn main() -> anyhow::Result<()> {
    // 1) ì„¤ì • ë¡œë“œ
    let cfg = Config::from_env();

    // 2) Tracing ì´ˆê¸°í™”
    tracing_subscriber::registry()
        .with(tracing_subscriber::EnvFilter::new(
            std::env::var("RUST_LOG")
                .unwrap_or_else(|_| "amazing_korean_api=debug,tower_http=debug".into()),
        ))
        .with(tracing_subscriber::fmt::layer())
        .init();

    // 3) Postgres í’€ ìƒì„±
    let database_url = if cfg.database_url.contains("?") {
        cfg.database_url.clone()
    } else {
        format!("{}?connect_timeout=5", cfg.database_url)
    };

    let pool: Pool<Postgres> = if std::env::var("DB_EAGER").ok().as_deref() == Some("1") {
        PgPoolOptions::new()
            .acquire_timeout(Duration::from_secs(5))
            .connect(&database_url)      // ì¦‰ì‹œ ì—°ê²° ì‹œë„
            .await?
    } else {
        PgPoolOptions::new()
            .acquire_timeout(Duration::from_secs(5))
            .connect_lazy(&database_url)?  // ì²« ì¿¼ë¦¬ ì‹œ ì—°ê²°
    };

    // 4) Redis í’€ ìƒì„±
    let redis_cfg = deadpool_redis::Config::from_url(cfg.redis_url.clone());
    let redis: RedisPool = redis_cfg
        .create_pool(Some(deadpool_redis::Runtime::Tokio1))
        .expect("Failed to create Redis pool");

    // 5) AppState ìƒì„±
    let app_state = AppState {
        db: pool,
        redis,
        cfg: cfg.clone(),
        started_at: Instant::now(),
    };

    // 6) CORS ì„¤ì •
    let cors = CorsLayer::new()
        .allow_origin("http://localhost:5173".parse::<HeaderValue>().unwrap())
        .allow_methods([Method::GET, Method::POST, Method::PUT,
                       Method::PATCH, Method::DELETE, Method::OPTIONS])
        .allow_headers([AUTHORIZATION, CONTENT_TYPE, ACCEPT])
        .allow_credentials(true);  // ì¿ í‚¤ êµí™˜ í—ˆìš©

    // 7) ë¼ìš°í„° ì¡°ë¦½ + CORS ë ˆì´ì–´
    let app = api::app_router(app_state).layer(cors);

    // 8) ì„œë²„ ì‹œì‘
    let listener = TcpListener::bind(&cfg.bind_addr).await?;
    tracing::info!("âœ… Server listening on http://{}", cfg.bind_addr);

    axum::serve(listener, app).await?;
    Ok(())
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **ë¶€íŠ¸ìŠ¤íŠ¸ë© ìˆœì„œ**: Config â†’ Tracing â†’ DB Pool â†’ Redis Pool â†’ AppState â†’ CORS â†’ Router â†’ Serve
- `DB_EAGER=1`: ì¦‰ì‹œ DB ì—°ê²° (CI/í”„ë¡œë•ì…˜ ê¶Œì¥)
- `connect_lazy()`: ì²« ì¿¼ë¦¬ ì‹œ ì—°ê²° (ë¡œì»¬ ê°œë°œ ë¹ ë¥¸ ì‹œì‘)
- `allow_credentials(true)`: Refresh Token ì¿ í‚¤ êµí™˜ í•„ìˆ˜

**âš ï¸ ê·œì¹™**:
- ìƒˆ ì „ì—­ ë¦¬ì†ŒìŠ¤ ì¶”ê°€ ì‹œ â†’ main.rsì—ì„œ ì´ˆê¸°í™” + AppStateì— ì£¼ì…
- CORS origin ì¶”ê°€ í•„ìš” ì‹œ â†’ `allow_origin()` ìˆ˜ì •

---

##### 7ï¸âƒ£ `src/api/mod.rs` â€” ë„ë©”ì¸ ë¼ìš°í„° ì¡°ë¦½

**ì—­í• **: ëª¨ë“  ë„ë©”ì¸ ë¼ìš°í„°ë¥¼ **ìµœì¢… ì¡°ë¦½**

```rust
use crate::state::AppState;
use axum::routing::get;

use crate::docs::ApiDoc;
use utoipa::OpenApi;
use utoipa_swagger_ui::SwaggerUi;

// ë„ë©”ì¸ ëª¨ë“ˆ ì„ ì–¸
pub mod admin;
pub mod auth;
pub mod course;
pub mod health;
pub mod lesson;
pub mod study;
pub mod user;
pub mod video;

// ë„ë©”ì¸ ë¼ìš°í„° import
use self::admin::router::admin_router;
use self::auth::router::auth_router;
use self::course::router::course_router;
use self::lesson::router::router as lesson_router;
use self::study::router::router as study_router;
use self::user::router::user_router;
use self::video::router::router as video_router;

pub fn app_router(state: AppState) -> axum::Router {
    axum::Router::new()
        // merge: ë£¨íŠ¸ ë ˆë²¨ ë¼ìš°í„° ê²°í•©
        .merge(course_router())
        .merge(user_router())
        // nest: URL prefix ë¶„ë¦¬
        .nest("/auth", auth_router())
        .nest("/admin", admin_router())
        .nest("/lessons", lesson_router())
        .nest("/videos", video_router())
        .nest("/studies", study_router())
        // Health check (ì§ì ‘ ë“±ë¡)
        .route("/healthz", get(health::handler::health))
        .route("/health", get(health::handler::health))
        .route("/ready", get(health::handler::ready))
        // Swagger UI
        .merge(SwaggerUi::new("/docs").url("/api-docs/openapi.json", ApiDoc::openapi()))
        // ì „ì—­ ìƒíƒœ ì£¼ì…
        .with_state(state)
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- `merge()`: ë£¨íŠ¸ ë ˆë²¨ ê²½ë¡œ ê²°í•© (ì˜ˆ: `/users`, `/courses`)
- `nest("/prefix", router)`: URL prefix ì¶”ê°€ (ì˜ˆ: `/auth/login`, `/videos/123`)
- `.with_state(state)`: **ë§ˆì§€ë§‰ì— í•œ ë²ˆë§Œ** í˜¸ì¶œ
- ë„ë©”ì¸ ë¼ìš°í„°ëŠ” ìƒíƒœ ì—†ì´ ê²½ë¡œë§Œ ì •ì˜

**âš ï¸ ê·œì¹™**:
- ìƒˆ ë„ë©”ì¸ ì¶”ê°€ ì‹œ â†’ `pub mod xxx;` + `use self::xxx::router::xxx_router;` + `merge()` ë˜ëŠ” `nest()`
- Swaggerì— ë…¸ì¶œí•  ê²½ë¡œë§Œ docs.rsì— ë“±ë¡

---

##### ğŸ“Š ê³µí†µ íŒ¨í„´ ìš”ì•½

| ê´€ì‹¬ì‚¬ | íŒŒì¼ | íŒ¨í„´ |
|--------|------|------|
| ì„¤ì • | `config.rs` | í™˜ê²½ë³€ìˆ˜ â†’ Config êµ¬ì¡°ì²´ |
| ìƒíƒœ | `state.rs` | AppState + FromRef |
| ì—ëŸ¬ | `error.rs` | AppError + IntoResponse |
| íƒ€ì… | `types.rs` | Triple Derive (sqlx + serde + utoipa) |
| ë¬¸ì„œ | `docs.rs` | utoipa OpenApi derive |
| ì¡°ë¦½ | `api/mod.rs` | merge/nest + with_state |

##### ğŸ”„ ë ˆì´ì–´ ê°„ ë°ì´í„° íë¦„

```
[HTTP Request]
      â†“
[Router] â†’ Path ë§¤ì¹­
      â†“
[Handler] â†’ State<AppState> ì£¼ì…
      â†“
[Service] â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, &state.db ì‚¬ìš©
      â†“
[Repo] â†’ sqlx ì¿¼ë¦¬, AppResult<T> ë°˜í™˜
      â†“
[Handler] â†’ AppResult<Json<Response>>
      â†“
[AppError::IntoResponse] â†’ í‘œì¤€ JSON ì—ëŸ¬
      â†“
[HTTP Response]
```

---

#### 7.7.1-1. dto.rs

> **ğŸ“‹ SSoT ê²€ì¦ ì™„ë£Œ** (2026-01-22)
> ì•„ë˜ ë‚´ìš©ì€ ì‹¤ì œ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.

##### íŒŒì¼ ëª©ë¡ ë° ì—­í• 

| íŒŒì¼ | ì—­í•  | íŠ¹ì§• |
|------|------|------|
| `src/api/auth/dto.rs` | ì¸ì¦ ìš”ì²­/ì‘ë‹µ (ë¡œê·¸ì¸, í† í° ë“±) | `#[schema(example)]` ì ê·¹ ì‚¬ìš© |
| `src/api/lesson/dto.rs` | ë ˆìŠ¨ ëª©ë¡/ìƒì„¸/ì§„ë„ | `IntoParams` ì‚¬ìš©, `sqlx::FromRow` |
| `src/api/study/dto.rs` | í•™ìŠµ ëª©ë¡/ë¬¸ì œ/ì œì¶œ | Tagged Union, types.rs enum ì¬ì‚¬ìš© |
| `src/api/user/dto.rs` | íšŒì›ê°€ì…/í”„ë¡œí•„/ì„¤ì • | PATCH íŒ¨í„´, ìë™ ë¡œê·¸ì¸ ì‘ë‹µ |
| `src/api/video/dto.rs` | ë¹„ë””ì˜¤ ëª©ë¡/ìƒì„¸/ì§„ë„ | JSONB ë§¤í•‘, default í•¨ìˆ˜ |

---

##### dto.rsì˜ ì—­í•  (AMK ê¸°ì¤€)

**API ê²½ê³„ íƒ€ì…**: handlerê°€ ë°›ëŠ” ì…ë ¥(Query/Path/Json Body)ê³¼ ë°˜í™˜(ì‘ë‹µ ë°”ë””)ì˜ **"ê³„ì•½(Contract)"**ì„ ì •ì˜

**ë¬¸ì„œí™”/ê²€ì¦ì˜ ì¤‘ì‹¬**:
- `utoipa::ToSchema` / `IntoParams`ë¡œ OpenAPI ìŠ¤í‚¤ë§ˆ ìƒì„±
- `validator::Validate`ë¡œ ì…ë ¥ ê²€ì¦ (íŠ¹íˆ Body DTO)

**DB ìŠ¤í‚¤ë§ˆì™€ì˜ ê´€ê³„**:
- 1:1ë¡œ ê°™ì„ í•„ìš” ì—†ìŒ (ë³´ì•ˆ/UX ëª©ì ì— ë”°ë¼ ì¶•ì•½Â·ê°€ê³µ ê°€ëŠ¥)
- ë‹¨, DB enumì€ `crate::types::*`ë¥¼ ì¬ì‚¬ìš©í•´ì„œ ë¶ˆì¼ì¹˜/íŒŒì‹± ë¹„ìš© ìµœì†Œí™”

---

##### 1ï¸âƒ£ `src/api/auth/dto.rs` â€” ì¸ì¦ ìš”ì²­/ì‘ë‹µ

**ì—­í• **: ë¡œê·¸ì¸, í† í° ê°±ì‹ , ì•„ì´ë”” ì°¾ê¸°, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •, ë¡œê·¸ì•„ì›ƒ

```rust
use serde::{Deserialize, Serialize};
use utoipa::ToSchema;
use validator::Validate;

// =====================================================================
// Request DTOs (ìš”ì²­)
// =====================================================================

#[derive(Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
#[schema(example = json!({
    "email": "front@front.com",
    "password": "front123!",
    "device": "web",
    "browser": "chrome",
    "os": "linux"
}))]
pub struct LoginReq {
    #[validate(email)]
    pub email: String,

    #[validate(length(min = 6, max = 72))]
    pub password: String,

    // í´ë¼ì´ì–¸íŠ¸ê°€ ëª…ì‹œì ìœ¼ë¡œ ë³´ë‚¼ ê²½ìš°ë¥¼ ìœ„í•´ Option ìœ ì§€
    #[serde(default)]
    pub device: Option<String>,
    #[serde(default)]
    pub browser: Option<String>,
    #[serde(default)]
    pub os: Option<String>,
}

#[derive(Serialize, Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct RefreshReq {
    // ì¿ í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½(ì•± ë“±)ì„ ìœ„í•´ ë°”ë””ë¡œë„ ë°›ì„ ìˆ˜ ìˆê²Œ ìœ ì§€
    #[validate(length(min = 1))]
    pub refresh_token: String,
}

// =====================================================================
// Response DTOs (ì‘ë‹µ)
// =====================================================================

/// ì•¡ì„¸ìŠ¤ í† í° ê³µí†µ ê·œê²©
#[derive(Debug, Serialize, Deserialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct AccessTokenRes {
    pub access_token: String,
    pub token_type: String, // "Bearer" ê³ ì •
    pub expires_in: i64,    // ì´ˆ ë‹¨ìœ„
    pub expires_at: String, // í”„ë¡ íŠ¸ì—”ë“œ í¸ì˜ìš© ISO String
}

#[derive(Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct LoginRes {
    pub user_id: i64,
    pub access: AccessTokenRes,
    pub session_id: String,
}

#[derive(Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct LogoutRes {
    pub ok: bool,
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **Request/Response ì„¹ì…˜ ë¶„ë¦¬**: ì£¼ì„ìœ¼ë¡œ ëª…í™•íˆ êµ¬ë¶„
- **`#[schema(example = json!(...))]`**: Swagger UIì—ì„œ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **`#[serde(default)]`**: í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ì§€ ì•Šì•„ë„ OK (Option + default)
- **`AccessTokenRes` ê³µí†µí™”**: `LoginRes`, `RefreshRes` ë“±ì—ì„œ ì¬ì‚¬ìš©

**âš ï¸ ê·œì¹™**:
- `expires_at`ì€ í”„ë¡ íŠ¸ì—”ë“œ í¸ì˜ë¥¼ ìœ„í•´ String ìœ ì§€ (ISO 8601 í˜•ì‹)
- `json!` ë§¤í¬ë¡œ ì‚¬ìš© ì‹œ íŒŒì¼ ìƒë‹¨ì— `use serde_json::json;` í™•ì¸

---

##### 2ï¸âƒ£ `src/api/user/dto.rs` â€” íšŒì›ê°€ì…/í”„ë¡œí•„/ì„¤ì •

**ì—­í• **: íšŒì›ê°€ì… (ìë™ ë¡œê·¸ì¸ í¬í•¨), í”„ë¡œí•„ CRUD, í™˜ê²½ì„¤ì •

```rust
use crate::api::auth::dto::AccessTokenRes;
use crate::types::{UserAuth, UserGender};
use chrono::{DateTime, NaiveDate, Utc};
use serde::{Deserialize, Serialize};
use utoipa::ToSchema;
use validator::Validate;

// =====================================================================
// Request DTOs (ìš”ì²­)
// =====================================================================

/// íšŒì›ê°€ì… ìš”ì²­
#[derive(Debug, Serialize, Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct SignupReq {
    #[validate(email)]
    pub email: String,

    #[validate(length(min = 8, max = 72))]
    pub password: String,

    #[validate(length(min = 1, max = 50))]
    pub name: String,

    #[validate(length(min = 1, max = 100))]
    pub nickname: String,

    /// ISO 639-1 ì–¸ì–´ ì½”ë“œ (ì˜ˆ: "ko", "en")
    #[validate(length(min = 2, max = 2))]
    pub language: String,

    /// ISO 3166-1 alpha-2 êµ­ê°€ ì½”ë“œ (ì˜ˆ: "KR", "US")
    #[validate(length(min = 2, max = 50))]
    pub country: String,

    #[schema(value_type = String, format = "date")]
    pub birthday: NaiveDate,

    pub gender: UserGender, // Enum: male, female, other, none

    pub terms_service: bool,
    pub terms_personal: bool,
}

/// í”„ë¡œí•„ ìˆ˜ì • ìš”ì²­ (PATCH)
#[derive(Debug, Serialize, Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct ProfileUpdateReq {
    #[serde(default, skip_serializing_if = "Option::is_none")]
    #[validate(length(min = 1, max = 100))]
    pub nickname: Option<String>,

    #[serde(default, skip_serializing_if = "Option::is_none")]
    #[validate(length(min = 1, max = 50))]
    pub language: Option<String>,

    #[serde(default, skip_serializing_if = "Option::is_none")]
    #[schema(value_type = String, format = "date")]
    pub birthday: Option<NaiveDate>,

    #[serde(default, skip_serializing_if = "Option::is_none")]
    pub gender: Option<UserGender>,
}

// =====================================================================
// Response DTOs (ì‘ë‹µ)
// =====================================================================

/// íšŒì›ê°€ì… ì™„ë£Œ ì‘ë‹µ (ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬ë¨)
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct SignupRes {
    pub user_id: i64,
    pub email: String,
    pub name: String,
    pub nickname: String,
    // ... ê¸°íƒ€ í•„ë“œ

    /// ìë™ ë°œê¸‰ëœ ì•¡ì„¸ìŠ¤ í† í°
    pub access: AccessTokenRes,
    /// í˜„ì¬ ì„¸ì…˜ ID
    pub session_id: String,
}

/// ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´
#[derive(Debug, Serialize, sqlx::FromRow, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct ProfileRes {
    pub id: i64,
    pub email: String,
    pub name: String,
    pub nickname: Option<String>,
    pub language: Option<String>,
    pub country: Option<String>,
    #[schema(value_type = String, format = "date")]
    pub birthday: Option<NaiveDate>,
    pub gender: UserGender,
    pub user_state: bool,
    pub user_auth: UserAuth,
    #[schema(value_type = String, format = "date-time")]
    pub created_at: DateTime<Utc>,
    /// ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì—¬ë¶€ (OAuth ì „ìš© ê³„ì •ì€ false)
    pub has_password: bool,
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **`crate::types::*` enum ì¬ì‚¬ìš©**: `UserGender`, `UserAuth` ë“± DB enumê³¼ ì¼ì¹˜
- **PATCH íŒ¨í„´**: `Option<T>` + `#[serde(default, skip_serializing_if = "Option::is_none")]`
- **ìë™ ë¡œê·¸ì¸ ì‘ë‹µ**: `SignupRes`ì— `AccessTokenRes` + `session_id` í¬í•¨
- **`#[schema(value_type = String, format = "date")]`**: Swaggerì—ì„œ ë‚ ì§œ í˜•ì‹ í‘œì‹œ
- **`sqlx::FromRow`**: DB ì¡°íšŒ ê²°ê³¼ ì§ì ‘ ë§¤í•‘ ê°€ëŠ¥

**âš ï¸ ê·œì¹™**:
- enum í•„ë“œëŠ” **ë°˜ë“œì‹œ** `crate::types::*` ì‚¬ìš© (String ê¸ˆì§€)
- ë‚ ì§œ í•„ë“œì— `#[schema(value_type = String, format = "...")]` í•„ìˆ˜

---

##### 3ï¸âƒ£ `src/api/video/dto.rs` â€” ë¹„ë””ì˜¤ ëª©ë¡/ìƒì„¸/ì§„ë„

**ì—­í• **: ë¹„ë””ì˜¤ ê²€ìƒ‰/ëª©ë¡, ìƒì„¸ ì •ë³´, í•™ìŠµ ì§„ë„ ê´€ë¦¬

```rust
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use sqlx::{types::Json, FromRow};
use utoipa::ToSchema;
use validator::Validate;

// =====================================================================
// Request DTOs (ìš”ì²­)
// =====================================================================

/// ë¹„ë””ì˜¤ ëª©ë¡ ì¡°íšŒ ë° ê²€ìƒ‰ ìš”ì²­ (Query String)
#[derive(Debug, Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct VideoListReq {
    #[serde(default = "default_page")]
    #[validate(range(min = 1))]
    pub page: u64,

    #[serde(default = "default_per_page")]
    #[validate(range(min = 1, max = 100))]
    pub per_page: u64,

    pub q: Option<String>,          // ê²€ìƒ‰ì–´
    pub tag: Option<String>,        // íƒœê·¸ í•„í„°
    pub state: Option<String>,      // ìƒíƒœ í•„í„°
    pub sort: Option<String>,       // ì •ë ¬
}

fn default_page() -> u64 { 1 }
fn default_per_page() -> u64 { 20 }

/// í•™ìŠµ ì§„ë„ ì—…ë°ì´íŠ¸ ìš”ì²­
#[derive(Debug, Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct VideoProgressUpdateReq {
    #[validate(range(min = 0, max = 100))]
    pub progress_rate: i32,
}

// =====================================================================
// Response DTOs (ì‘ë‹µ)
// =====================================================================

/// ëª©ë¡ í˜ì´ì§• ë©”íƒ€ë°ì´í„°
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct VideoListMeta {
    pub total_count: i64,
    pub total_pages: i64,
    pub current_page: u64,
    pub per_page: u64,
}

/// ë¹„ë””ì˜¤ ëª©ë¡ ì‘ë‹µ (Data + Meta)
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct VideoListRes {
    pub meta: VideoListMeta,
    pub data: Vec<VideoListItem>,  // â­ í‘œì¤€: { meta, data }
}

/// ìƒì„¸ íƒœê·¸ ì •ë³´ (JSONB êµ¬ì¡°)
#[derive(Debug, Serialize, Deserialize, ToSchema, Clone)]
#[serde(rename_all = "snake_case")]
pub struct VideoTagDetail {
    pub key: Option<String>,
    pub title: Option<String>,
    pub subtitle: Option<String>,
}

/// ë¹„ë””ì˜¤ ìƒì„¸ ì •ë³´
#[derive(Debug, Serialize, FromRow, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct VideoDetailRes {
    pub video_id: i64,
    pub video_url_vimeo: String,
    pub video_state: String,

    // DBì˜ JSONB íƒ€ì…ì„ Rust êµ¬ì¡°ì²´ë¡œ ë§¤í•‘
    #[schema(value_type = Vec<VideoTagDetail>)]
    pub tags: Json<Vec<VideoTagDetail>>,

    pub created_at: DateTime<Utc>,
}

/// í•™ìŠµ ì§„ë„ ì¡°íšŒ ì‘ë‹µ
#[derive(Debug, Serialize, FromRow, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct VideoProgressRes {
    pub video_id: i64,

    #[sqlx(rename = "video_progress_log")]
    pub progress_rate: i32,

    #[sqlx(rename = "video_completed_log")]
    pub is_completed: bool,
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **`#[serde(default = "í•¨ìˆ˜ëª…")]`**: í˜ì´ì§• ê¸°ë³¸ê°’ ì„¤ì •
- **`#[validate(range(min = 0, max = 100))]`**: ë²”ìœ„ ê²€ì¦
- **JSONB ë§¤í•‘**: `sqlx::types::Json<Vec<T>>` + `#[schema(value_type = Vec<T>)]`
- **`#[sqlx(rename = "...")]`**: DB ì»¬ëŸ¼ëª… â†” DTO í•„ë“œëª… ë§¤í•‘
- **ì‘ë‹µ í‘œì¤€**: `{ meta, data }` êµ¬ì¡° â­

**âš ï¸ ê·œì¹™**:
- í˜ì´ì§• ì‘ë‹µì€ **`{ meta, data }`** í˜•íƒœë¡œ í†µì¼ ê¶Œì¥
- JSONB í•„ë“œëŠ” `#[schema(value_type = ...)]`ë¡œ Swagger ë¬¸ì„œí™”

---

##### 4ï¸âƒ£ `src/api/study/dto.rs` â€” í•™ìŠµ ëª©ë¡/ë¬¸ì œ/ì œì¶œ

**ì—­í• **: í•™ìŠµ í”„ë¡œê·¸ë¨ ëª©ë¡, ë¬¸ì œ ìƒì„¸, ì •ë‹µ ì œì¶œ, í•´ì„¤/ìƒíƒœ ì¡°íšŒ

```rust
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use sqlx::FromRow;
use utoipa::ToSchema;

use crate::types::{StudyProgram, StudyState, StudyTaskKind};

// =========================================================================
// Request DTOs (ìš”ì²­)
// =========================================================================

/// í•™ìŠµ ëª©ë¡ ì¡°íšŒ ìš”ì²­ (Query String)
#[derive(Debug, Deserialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct StudyListReq {
    pub page: Option<u32>,
    pub per_page: Option<u32>,
    pub program: Option<String>,
    pub sort: Option<String>,
}

/// ì •ë ¬ ì˜µì…˜ (ì„œë¹„ìŠ¤ì—ì„œ íŒŒì‹±)
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum StudyListSort {
    Latest,
    Oldest,
    Alphabetical,
}

impl StudyListSort {
    pub fn parse(value: &str) -> Option<Self> {
        match value {
            "latest" => Some(Self::Latest),
            "oldest" => Some(Self::Oldest),
            "alphabetical" => Some(Self::Alphabetical),
            _ => None,
        }
    }
}

/// ì •ë‹µ ì œì¶œ ìš”ì²­ (JSON Body) - Tagged Union
#[derive(Debug, Deserialize, Serialize, ToSchema)]
#[serde(tag = "kind", rename_all = "snake_case")]
pub enum SubmitAnswerReq {
    Choice { pick: i32 },
    Typing { text: String },
    Voice { text: String },
}

// =========================================================================
// Response DTOs (ì‘ë‹µ)
// =========================================================================

/// í•™ìŠµ ëª©ë¡ ì•„ì´í…œ (DB Row)
#[derive(Debug, Serialize, FromRow, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct StudySummaryDto {
    pub study_id: i32,
    pub study_idx: String,
    pub program: StudyProgram,     // â­ types.rs enum ì¬ì‚¬ìš©
    pub title: Option<String>,
    pub state: StudyState,         // â­ types.rs enum ì¬ì‚¬ìš©
    pub created_at: DateTime<Utc>,
}

/// í•™ìŠµ ëª©ë¡ ì „ì²´ ì‘ë‹µ
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct StudyListResp {
    pub list: Vec<StudySummaryDto>,  // ì°¸ê³ : videoëŠ” data, lessonì€ items
    pub meta: StudyListMeta,
}

/// í•™ìŠµ ë¬¸ì œ ìƒì„¸ ì •ë³´ (Payload í¬í•¨)
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct StudyTaskDetailRes {
    pub task_id: i32,
    pub study_id: i32,
    pub kind: StudyTaskKind,       // â­ types.rs enum ì¬ì‚¬ìš©
    pub seq: i32,
    pub created_at: DateTime<Utc>,
    pub payload: TaskPayload,
}

/// ë¬¸ì œ ìœ í˜•ë³„ í˜ì´ë¡œë“œ (Untagged Union)
#[derive(Debug, Serialize, ToSchema)]
#[serde(untagged)]
pub enum TaskPayload {
    Choice(ChoicePayload),
    Typing(TypingPayload),
    Voice(VoicePayload),
}

#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct ChoicePayload {
    pub question: String,
    pub choice_1: String,
    pub choice_2: String,
    pub choice_3: String,
    pub choice_4: String,
    pub audio_url: Option<String>,
    pub image_url: Option<String>,
}

/// ì •ë‹µ ì œì¶œ ê²°ê³¼
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct SubmitAnswerRes {
    pub is_correct: bool,
    #[serde(skip_serializing_if = "Option::is_none")]
    pub correct_answer: Option<String>,
    #[serde(skip_serializing_if = "Option::is_none")]
    pub explanation: Option<String>,
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **`crate::types::*` enum ì ê·¹ ì¬ì‚¬ìš©**: `StudyProgram`, `StudyState`, `StudyTaskKind`
- **Tagged Union**: `#[serde(tag = "kind")]`ë¡œ ìš”ì²­ ë‹¤í˜•ì„± ì²˜ë¦¬
- **Untagged Union**: `#[serde(untagged)]`ë¡œ ì‘ë‹µ í˜ì´ë¡œë“œ êµ¬ë¶„
- **ë³„ë„ íŒŒì‹± enum**: `StudyListSort::parse()`ë¡œ ì •ë ¬ ì˜µì…˜ ì²˜ë¦¬
- **`#[serde(skip_serializing_if = "Option::is_none")]`**: null í•„ë“œ ìƒëµ

**âš ï¸ ê·œì¹™**:
- ë¬¸ì œ ìœ í˜•ë³„ ë¡œì§ì€ ì„œë¹„ìŠ¤ì—ì„œ `match` ì²˜ë¦¬
- DB enumì€ **ì ˆëŒ€** Stringìœ¼ë¡œ ë°›ì§€ ì•ŠìŒ

---

##### 5ï¸âƒ£ `src/api/lesson/dto.rs` â€” ë ˆìŠ¨ ëª©ë¡/ìƒì„¸/ì§„ë„

**ì—­í• **: ë ˆìŠ¨ ëª©ë¡, ë ˆìŠ¨ ìƒì„¸ (ì•„ì´í…œ í¬í•¨), í•™ìŠµ ì§„ë„

```rust
use chrono::{DateTime, Utc};
use serde::{Deserialize, Serialize};
use utoipa::{IntoParams, ToSchema};

// Query DTO - IntoParams ì‚¬ìš©
#[derive(Debug, Deserialize, IntoParams, ToSchema)]
pub struct LessonListReq {
    pub page: Option<i64>,
    pub per_page: Option<i64>,
    pub sort: Option<String>,
}

// Response DTO - sqlx::FromRow ì§ì ‘ derive
#[derive(Debug, Serialize, sqlx::FromRow, ToSchema)]
pub struct LessonRes {
    pub id: i64,
    pub title: String,
    pub description: Option<String>,
    pub lesson_idx: String,
    pub thumbnail_url: Option<String>,
}

#[derive(Debug, Serialize, ToSchema)]
pub struct LessonListMeta {
    pub total_count: i64,
    pub total_pages: i64,
    pub current_page: i64,
    pub per_page: i64,
}

#[derive(Debug, Serialize, ToSchema)]
pub struct LessonListRes {
    pub items: Vec<LessonRes>,    // ì°¸ê³ : videoëŠ” data, studyëŠ” list
    pub meta: LessonListMeta,
}

/// ë ˆìŠ¨ ì•„ì´í…œ (ë¹„ë””ì˜¤ or ê³¼ì œ)
#[derive(Debug, Serialize, sqlx::FromRow, ToSchema)]
pub struct LessonItemRes {
    pub seq: i32,
    pub kind: crate::types::LessonItemKind,  // â­ types.rs enum ì¬ì‚¬ìš©
    pub video_id: Option<i64>,
    pub task_id: Option<i64>,
}

/// í•™ìŠµ ì§„ë„ ì¡°íšŒ ì‘ë‹µ
#[derive(Debug, Serialize, sqlx::FromRow, ToSchema)]
pub struct LessonProgressRes {
    pub percent: i32,
    pub last_seq: Option<i32>,
    pub updated_at: Option<DateTime<Utc>>,
}

/// ì§„ë„ ì—…ë°ì´íŠ¸ ìš”ì²­
#[derive(Debug, Deserialize, ToSchema)]
pub struct LessonProgressUpdateReq {
    pub percent: i32,
    pub last_seq: Option<i32>,
}
```

**ğŸ”‘ í•µì‹¬ í¬ì¸íŠ¸**:
- **`IntoParams`**: Query String íŒŒë¼ë¯¸í„° Swagger ë¬¸ì„œí™”
- **`sqlx::FromRow` ì§ì ‘ derive**: DTOê°€ DB Rowì™€ 1:1 ë§¤í•‘
- **`crate::types::LessonItemKind`**: enum ì¬ì‚¬ìš©ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± í™•ë³´

**âš ï¸ ê·œì¹™**:
- lessonì€ `#[serde(rename_all = "snake_case")]` ìƒëµë¨ (í•„ë“œëª…ì´ ì´ë¯¸ snake_case)
- ëª¨ë“  DTOì— `rename_all` ëª…ì‹œ ê¶Œì¥ (ì•ˆì „ì„±)

---

##### ğŸ“Š DTO ê³µí†µ íŒ¨í„´ ìš”ì•½

| íŒ¨í„´ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| Request/Response ë¶„ë¦¬ | ì£¼ì„ìœ¼ë¡œ ì„¹ì…˜ êµ¬ë¶„ | `// ===== Request DTOs =====` |
| snake_case ê°•ì œ | `#[serde(rename_all = "snake_case")]` | ëª¨ë“  DTOì— ì ìš© ê¶Œì¥ |
| enum ì¬ì‚¬ìš© | `crate::types::*` import | `UserGender`, `StudyTaskKind` ë“± |
| ê²€ì¦ | `validator::Validate` + ì†ì„± | `#[validate(email)]`, `#[validate(range(...))]` |
| Swagger ì˜ˆì‹œ | `#[schema(example = json!(...))]` | Request DTOì— ì ìš© |
| ë‚ ì§œ í˜•ì‹ | `#[schema(value_type = String, format = "date")]` | `NaiveDate`, `DateTime<Utc>` |
| JSONB ë§¤í•‘ | `Json<T>` + `#[schema(value_type = T)]` | `tags: Json<Vec<VideoTagDetail>>` |
| PATCH íŒ¨í„´ | `Option<T>` + `skip_serializing_if` | `ProfileUpdateReq` |
| Tagged Union | `#[serde(tag = "kind")]` | `SubmitAnswerReq` |
| DB ì»¬ëŸ¼ ë§¤í•‘ | `#[sqlx(rename = "...")]` | `VideoProgressRes` |

---

##### âš ï¸ í˜„ì¬ ë¶ˆì¼ì¹˜ ì‚¬í•­ (ê°œì„  ê¶Œì¥)

| í•­ëª© | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ |
|------|----------|------|
| **ì‘ë‹µ ë°°ì—´ í‚¤** | video: `data`, lesson: `items`, study: `list` | `{ meta, data }`ë¡œ í†µì¼ |
| **enum ì‚¬ìš©** | user/video ì¼ë¶€ì—ì„œ String ì‚¬ìš© | ëª¨ë‘ `crate::types::*` enumìœ¼ë¡œ |
| **rename_all** | lessonë§Œ ìƒëµ | ëª¨ë“  DTOì— ëª…ì‹œ |
| **IntoParams** | lessonë§Œ ì‚¬ìš© | Query DTO ì „ì²´ì— ì ìš© ê¶Œì¥ |

---

##### ğŸ“‹ dto.rs í‘œì¤€ í…œí”Œë¦¿

```rust
// dto.rs (Best Practices Template)

use chrono::{DateTime, NaiveDate, Utc};
use serde::{Deserialize, Serialize};
use utoipa::{IntoParams, ToSchema};
use validator::Validate;

// DB enum ì¬ì‚¬ìš© (ë„ë©”ì¸ë³„ë¡œ í•„ìš”í•œ ê²ƒë§Œ)
use crate::types::*;

// =====================================================================
// Request DTOs (Query / Path / Body)
// =====================================================================

/// (Query) List pagination
#[derive(Debug, Deserialize, IntoParams, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct ListReq {
    #[serde(default = "default_page")]
    pub page: Option<u32>,
    #[serde(default = "default_per_page")]
    pub per_page: Option<u32>,
}

fn default_page() -> Option<u32> { Some(1) }
fn default_per_page() -> Option<u32> { Some(20) }

/// (Body) Create/Update - Validate í•„ìˆ˜
#[derive(Debug, Deserialize, Validate, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct CreateReq {
    #[validate(length(min = 1, max = 100))]
    pub name: String,
}

// =====================================================================
// Response DTOs
// =====================================================================

/// Pagination meta (í‘œì¤€)
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct PageMeta {
    pub total_count: i64,
    pub total_pages: u32,
    pub current_page: u32,
    pub per_page: u32,
}

/// List response (í‘œì¤€: meta + data)
#[derive(Debug, Serialize, ToSchema)]
#[serde(rename_all = "snake_case")]
pub struct ListRes<T> {
    pub meta: PageMeta,
    pub data: Vec<T>,
}
```

---

##### ğŸ”„ DTO â†” DB ë°ì´í„° íë¦„

```
[HTTP Request]
      â†“
[DTO Request] â†’ validator::Validate ê²€ì¦
      â†“
[Service] â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
      â†“
[Repo] â†’ sqlx ì¿¼ë¦¬
      â†“
[DTO Response] â† sqlx::FromRow ë˜ëŠ” ìˆ˜ë™ ë§¤í•‘
      â†“
[HTTP Response] â†’ serde::Serialize â†’ JSON
```

---

#### 7.7.1-2. repo.rs
> **Claude ì½”ë“œ ë¶„ì„ ê¸°ë°˜** (2025-01-22)

##### ğŸ“ íŒŒì¼ ê°œìš”

| íŒŒì¼ | ë¼ì¸ìˆ˜ | êµ¬ì¡° | ì—ëŸ¬ íƒ€ì… | íŠ¹ì§• |
|------|--------|------|-----------|------|
| [auth/repo.rs](src/api/auth/repo.rs) | 476 | `struct AuthRepo;` (stateless) | `AppResult` | TX ë¶„ë¦¬, FOR UPDATE |
| [user/repo.rs](src/api/user/repo.rs) | 286 | standalone functions | `AppResult` | RETURNING, audit log |
| [video/repo.rs](src/api/video/repo.rs) | 254 | `struct VideoRepo;` (stateless) | `AppResult` | QueryBuilder, JSONB |
| [study/repo.rs](src/api/study/repo.rs) | 467 | `struct StudyRepo;` (stateless) | `AppResult` | query_as! macro, Rowâ†’DTO ë³€í™˜ |
| [lesson/repo.rs](src/api/lesson/repo.rs) | 232 | `struct LessonRepo { pool }` âš ï¸ | `sqlx::Error` âš ï¸ | Upsert, stateful |

##### 1ï¸âƒ£ Auth Domain ([auth/repo.rs](src/api/auth/repo.rs))

**ì—­í• **: ë¡œê·¸ì¸ ì„¸ì…˜ ê´€ë¦¬, ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì¡°íšŒ

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. Internal Row Model (DB ì „ìš© êµ¬ì¡°ì²´)
#[derive(Debug, sqlx::FromRow)]
pub struct LoginRecord {
    pub user_id: i64,
    pub session_id: String,      // UUID â†’ String ë³€í™˜
    pub refresh_hash: String,
    pub login_ip: Option<String>, // Inet â†’ String
    pub login_device: String,     // Enum â†’ String
    // ...
}

// 2. TX vs Pool í•¨ìˆ˜ ë¶„ë¦¬
pub async fn find_login_by_session_id_tx(
    tx: &mut Transaction<'_, Postgres>,
    session_id: &str,
) -> AppResult<Option<LoginRecord>> { /* ... */ }

pub async fn find_login_by_session_id(
    pool: &PgPool,
    session_id: &str,
) -> AppResult<Option<LoginRecord>> { /* ... */ }

// 3. FOR UPDATE Lock íŒ¨í„´
pub async fn find_login_by_session_id_for_update_tx(
    tx: &mut Transaction<'_, Postgres>,
    session_id: &str,
) -> AppResult<Option<LoginRecord>> {
    sqlx::query_as::<_, LoginRecord>(r#"
        SELECT /* ... */
        FROM public.login
        WHERE login_session_id = CAST($1 AS uuid)
        FOR UPDATE  -- ë™ì‹œì„± ì œì–´
    "#)
    .bind(session_id)
    .fetch_optional(&mut **tx)
    .await?
}

// 4. Enum ì•ˆì „ ë§¤í•‘ (CASE WHEN)
INSERT INTO public.login (/* ... */)
VALUES (
    $1,
    CASE lower($3)
        WHEN 'mobile'  THEN 'mobile'::login_device_enum
        WHEN 'tablet'  THEN 'tablet'::login_device_enum
        WHEN 'desktop' THEN 'desktop'::login_device_enum
        WHEN 'web'     THEN 'desktop'::login_device_enum
        ELSE 'other'::login_device_enum
    END,
    /* ... */
)
```

##### 2ï¸âƒ£ User Domain ([user/repo.rs](src/api/user/repo.rs))

**ì—­í• **: íšŒì›ê°€ì…, í”„ë¡œí•„/ì„¤ì • CRUD, ê°ì‚¬ ë¡œê·¸

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. INSERT + RETURNINGìœ¼ë¡œ ì¦‰ì‹œ ì‘ë‹µ êµ¬ì„±
pub async fn signup_tx(
    tx: &mut Transaction<'_, Postgres>,
    /* params... */
) -> AppResult<ProfileRes> {
    let res = sqlx::query_as::<_, ProfileRes>(r#"
        INSERT INTO users (/* ... */)
        VALUES ($1, $2, $3::user_language_enum, $4::user_gender_enum, /* ... */)
        RETURNING
            user_id as id,
            user_email as email,
            user_language::TEXT as language,  -- DB Enum â†’ String
            user_gender as gender,             -- DB Enum â†’ Rust Enum
            /* ... */
    "#)
    .bind(/* ... */)
    .fetch_one(&mut **tx)
    .await?;
    Ok(res)
}

// 2. PATCH ì—…ë°ì´íŠ¸ (COALESCE íŒ¨í„´)
pub async fn update_profile_tx(
    tx: &mut Transaction<'_, Postgres>,
    user_id: i64,
    req: &ProfileUpdateReq,
) -> AppResult<Option<ProfileRes>> {
    sqlx::query_as::<_, ProfileRes>(r#"
        UPDATE users SET
            user_nickname = COALESCE($2, user_nickname),
            user_language = COALESCE($3::user_language_enum, user_language),
            user_country  = COALESCE($4, user_country)
        WHERE user_id = $1
        RETURNING /* ... */
    "#)
    .bind(user_id)
    .bind(req.nickname.as_ref())  // Option â†’ bind
    .bind(req.language.as_ref())
    /* ... */
}

// 3. ê°ì‚¬ ë¡œê·¸ (í˜„ì¬ rowë¥¼ SELECTë¡œ ë³µì‚¬)
pub async fn insert_user_log_after_tx(
    tx: &mut Transaction<'_, Postgres>,
    actor_user_id: Option<i64>,
    user_id: i64,
    action: &str,
    success: bool,
) -> AppResult<()> {
    sqlx::query(r#"
        INSERT INTO public.users_log (
            updated_by_user_id, user_action_log, /* ... */
        )
        SELECT
            $1, CAST($2 AS user_action_log_enum), $3, u.user_id,
            u.user_auth, u.user_state, u.user_email, /* ... */
        FROM public.users u
        WHERE u.user_id = $4
    "#)
    /* ... */
}
```

##### 3ï¸âƒ£ Video Domain ([video/repo.rs](src/api/video/repo.rs))

**ì—­í• **: ë¹„ë””ì˜¤ ëª©ë¡/ìƒì„¸ ì¡°íšŒ, í•™ìŠµ ì§„ë„ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. QueryBuilderë¡œ ë™ì  ì¿¼ë¦¬
pub async fn list_videos(
    pool: &PgPool,
    req: &VideoListReq,
) -> AppResult<(Vec<VideoListItem>, i64)> {
    let mut qb = QueryBuilder::new(r#"
        SELECT
            v.video_id::bigint as video_id,  -- INT4 â†’ INT8 ìºìŠ¤íŒ…
            COUNT(*) OVER() as total_count   -- Window Function
        FROM video v
        WHERE 1=1
    "#);

    // ë™ì  í•„í„° ì¶”ê°€
    if let Some(state) = &req.state {
        qb.push(" AND v.video_state = ");
        qb.push_bind(state);
        qb.push("::video_state_enum");
    }

    if let Some(q) = &req.q {
        qb.push(" AND (title ILIKE ");
        qb.push_bind(format!("%{}%", q));
        qb.push(")");
    }

    // í˜ì´ì§•
    qb.push(" LIMIT ").push_bind(req.per_page as i64);
    qb.push(" OFFSET ").push_bind(offset);

    let rows = qb.build().fetch_all(pool).await?;
    /* ... */
}

// 2. JSONB ì§‘ê³„
pub async fn get_video_detail(/* ... */) -> AppResult<Option<VideoDetailRes>> {
    sqlx::query_as::<_, VideoDetailRes>(r#"
        SELECT
            COALESCE(
                jsonb_agg(
                    jsonb_build_object(
                        'key', vt.video_tag_key,
                        'title', vt.video_tag_title
                    )
                ) FILTER (WHERE vt.video_tag_id IS NOT NULL),
                '[]'::jsonb
            ) as tags
        FROM video v
        LEFT JOIN video_tag vt ON /* ... */
        GROUP BY v.video_id
    "#)
}

// 3. Upsert + ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸
pub async fn update_progress(/* ... */) -> AppResult<VideoProgressRes> {
    sqlx::query_as::<_, VideoProgressRes>(r#"
        INSERT INTO video_log (user_id, video_id, video_progress_log, video_completed_log)
        VALUES ($1, $2, $3, $4)
        ON CONFLICT (user_id, video_id) DO UPDATE SET
            video_progress_log = EXCLUDED.video_progress_log,
            video_completed_log = CASE
                WHEN video_log.video_completed_log = true THEN true  -- í•œë²ˆ ì™„ë£Œë©´ ìœ ì§€
                ELSE EXCLUDED.video_completed_log
            END
        RETURNING /* ... */
    "#)
}
```

##### 4ï¸âƒ£ Study Domain ([study/repo.rs](src/api/study/repo.rs))

**ì—­í• **: í•™ìŠµ ê³¼ì œ ì¡°íšŒ, ì±„ì , ìƒíƒœ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. ë‚´ë¶€ Row â†’ DTO ë³€í™˜ íŒ¨í„´
#[derive(sqlx::FromRow)]
struct StudyTaskDetailRow {
    task_id: i32,
    kind: StudyTaskKind,
    // LEFT JOIN í•„ë“œë“¤ (ëª¨ë‘ nullable)
    choice_1: Option<String>,
    typing_image_url: Option<String>,
    voice_audio_url: Option<String>,
}

impl StudyTaskDetailRow {
    fn map_to_res(self) -> Option<StudyTaskDetailRes> {
        let payload = match self.kind {
            StudyTaskKind::Choice => TaskPayload::Choice(ChoicePayload { /* ... */ }),
            StudyTaskKind::Typing => TaskPayload::Typing(TypingPayload { /* ... */ }),
            StudyTaskKind::Voice  => TaskPayload::Voice(VoicePayload { /* ... */ }),
        };
        Some(StudyTaskDetailRes { /* ... */ })
    }
}

// 2. sqlx::query_as! ë§¤í¬ë¡œ (íƒ€ì… ëª…ì‹œ)
pub async fn find_task_detail(
    pool: &PgPool,
    task_id: i64,
) -> AppResult<Option<StudyTaskDetailRes>> {
    let row = sqlx::query_as!(
        StudyTaskDetailRow,
        r#"
        SELECT
            t.study_task_id::INT AS task_id,
            t.study_task_kind AS "kind!: StudyTaskKind",       -- "!" = non-null ê°•ì œ
            stc.study_task_choice_1::TEXT AS "choice_1?",      -- "?" = nullable ëª…ì‹œ
            stt.study_task_typing_image_url::TEXT AS "typing_image_url?",
            stv.study_task_voice_audio_url::TEXT AS "voice_audio_url?"
        FROM study_task t
        LEFT JOIN study_task_choice stc ON t.study_task_id = stc.study_task_id
        LEFT JOIN study_task_typing stt ON t.study_task_id = stt.study_task_id
        LEFT JOIN study_task_voice stv ON t.study_task_id = stv.study_task_id
        WHERE t.study_task_id = $1
        "#,
        task_id as i32  // input ìºìŠ¤íŒ…
    )
    .fetch_optional(pool)
    .await?;

    match row {
        Some(r) => Ok(r.map_to_res()),
        None => Ok(None),
    }
}

// 3. Count + List 2ì¿¼ë¦¬ íŒ¨í„´
pub async fn find_open_studies(
    pool: &PgPool,
    page: u32,
    per_page: u32,
) -> AppResult<(Vec<StudySummaryDto>, i64)> {
    // A. Count
    let count: i64 = QueryBuilder::new("SELECT COUNT(*) FROM study WHERE ...")
        .build_query_scalar()
        .fetch_one(pool)
        .await?;

    // B. List
    let list = QueryBuilder::new("SELECT /* ... */ FROM study WHERE ...")
        .push(" ORDER BY ...")
        .push(" LIMIT ").push_bind(per_page)
        .push(" OFFSET ").push_bind(offset)
        .build_query_as::<StudySummaryDto>()
        .fetch_all(pool)
        .await?;

    Ok((list, count))
}
```

##### 5ï¸âƒ£ Lesson Domain ([lesson/repo.rs](src/api/lesson/repo.rs))

**ì—­í• **: ë ˆìŠ¨ ëª©ë¡/ìƒì„¸, ì•„ì´í…œ ì¡°íšŒ, ì§„ë„ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. Upsert (ON CONFLICT)
pub async fn upsert_progress(
    &self,
    lesson_id: i64,
    user_id: i64,
    percent: i32,
    last_seq: Option<i32>,
) -> Result<LessonProgressRes, sqlx::Error> {
    sqlx::query_as::<_, LessonProgressRes>(r#"
        INSERT INTO lesson_progress (
            lesson_id, user_id, lesson_progress_percent,
            lesson_progress_last_item_seq, lesson_progress_last_progress_at
        )
        VALUES ($1, $2, $3, $4, NOW())
        ON CONFLICT (lesson_id, user_id) DO UPDATE SET
            lesson_progress_percent = EXCLUDED.lesson_progress_percent,
            lesson_progress_last_item_seq = EXCLUDED.lesson_progress_last_item_seq,
            lesson_progress_last_progress_at = EXCLUDED.lesson_progress_last_progress_at
        RETURNING /* ... */
    "#)
    .bind(lesson_id)
    .bind(user_id)
    .bind(percent)
    .bind(last_seq)  -- Option<i32> ì§ì ‘ ë°”ì¸ë”©
    .fetch_one(&self.pool)
    .await
}

// 2. EXISTS ì²´í¬
pub async fn exists_lesson(&self, lesson_id: i64) -> Result<bool, sqlx::Error> {
    sqlx::query_scalar::<_, bool>(r#"
        SELECT EXISTS(SELECT 1 FROM lesson WHERE lesson_id = $1)
    "#)
    .bind(lesson_id)
    .fetch_one(&self.pool)
    .await
}
```

##### ğŸ“Š ê³µí†µ íŒ¨í„´ ìš”ì•½

| íŒ¨í„´ | ìš©ë„ | ì‚¬ìš©ì²˜ | ì½”ë“œ ì˜ˆì‹œ |
|------|------|--------|----------|
| **TX ë¶„ë¦¬** | ë™ì¼ ì¿¼ë¦¬ì˜ Pool/TX ë²„ì „ | auth | `_tx` suffix |
| **FOR UPDATE** | ë™ì‹œì„± ì œì–´ (refresh) | auth | `FOR UPDATE` lock |
| **RETURNING** | INSERT í›„ ì¦‰ì‹œ ë°˜í™˜ | user, video, lesson | `RETURNING col AS alias` |
| **COALESCE** | PATCH nullable ì²˜ë¦¬ | user, video | `COALESCE($2, col)` |
| **QueryBuilder** | ë™ì  WHERE/ORDER | video, study | `push_bind()` |
| **COUNT OVER()** | 1ì¿¼ë¦¬ í˜ì´ì§• | video | `COUNT(*) OVER()` |
| **Count+List** | 2ì¿¼ë¦¬ í˜ì´ì§• | study | ë³„ë„ count ì¿¼ë¦¬ |
| **query_as!** | íƒ€ì… ì•ˆì „ ì¿¼ë¦¬ | study | `"field!: Type"`, `"field?"` |
| **Rowâ†’DTO** | ë‹¤í˜•ì„± ë³€í™˜ | study | `map_to_res()` |
| **ON CONFLICT** | Upsert | video, lesson | `DO UPDATE SET` |
| **CASE WHEN** | Enum ì•ˆì „ ë§¤í•‘ | auth | `CASE lower($x) WHEN...` |
| **JSONB agg** | 1:N ì§‘ê³„ | video | `jsonb_agg(jsonb_build_object())` |

##### âš ï¸ í˜„ì¬ ë¶ˆì¼ì¹˜/ê°œì„  í•„ìš” ì‚¬í•­

| ì´ìŠˆ | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ í‘œì¤€ | íŒŒì¼ |
|------|----------|----------|------|
| **ì—ëŸ¬ íƒ€ì…** | `sqlx::Error` | `AppResult<T>` | lesson_repo |
| **Repo êµ¬ì¡°** | `LessonRepo { pool }` (stateful) | `struct XxxRepo;` (stateless) | lesson_repo |
| **TX ì±…ì„** | repoê°€ tx ì‹œì‘ | serviceê°€ tx ê´€ë¦¬ | study_repo.submit_grade_tx |
| **nullable ë§¤í•‘** | `refresh_hash: String` | `Option<String>` | auth_repo.LoginRecord |

##### ğŸ“‹ í‘œì¤€ í…œí”Œë¦¿

```rust
// repo.rs (AMK í‘œì¤€ ê³¨ê²©)
use sqlx::{PgPool, Postgres, Transaction, QueryBuilder};
use crate::error::AppResult;

// âœ… Stateless êµ¬ì¡°ì²´
pub struct XxxRepo;

impl XxxRepo {
    // =====================================================
    // A. ë‹¨ê±´ ì¡°íšŒ
    // =====================================================
    pub async fn find_by_id(pool: &PgPool, id: i64) -> AppResult<Option<XxxDto>> {
        sqlx::query_as::<_, XxxDto>(r#"
            SELECT xxx_id::bigint as id, /* ... */
            FROM xxx WHERE xxx_id = $1
        "#)
        .bind(id)
        .fetch_optional(pool)
        .await
        .map_err(Into::into)
    }

    // =====================================================
    // B. ì¡´ì¬ ì—¬ë¶€
    // =====================================================
    pub async fn exists(pool: &PgPool, id: i64) -> AppResult<bool> {
        sqlx::query_scalar::<_, bool>(
            "SELECT EXISTS(SELECT 1 FROM xxx WHERE xxx_id = $1)"
        )
        .bind(id)
        .fetch_one(pool)
        .await
        .map_err(Into::into)
    }

    // =====================================================
    // C. ë¦¬ìŠ¤íŠ¸ (Count + List íŒ¨í„´)
    // =====================================================
    pub async fn list(
        pool: &PgPool,
        page: u32,
        per_page: u32,
    ) -> AppResult<(Vec<XxxDto>, i64)> {
        // 1) Count
        let count: i64 = sqlx::query_scalar("SELECT COUNT(*) FROM xxx")
            .fetch_one(pool).await?;

        // 2) List
        let offset = (page as i64 - 1) * per_page as i64;
        let list = sqlx::query_as::<_, XxxDto>(r#"
            SELECT /* ... */ FROM xxx
            ORDER BY created_at DESC
            LIMIT $1 OFFSET $2
        "#)
        .bind(per_page as i64)
        .bind(offset)
        .fetch_all(pool).await?;

        Ok((list, count))
    }

    // =====================================================
    // D. ì“°ê¸° (TX ë²„ì „)
    // =====================================================
    pub async fn create_tx(
        tx: &mut Transaction<'_, Postgres>,
        req: &XxxReq,
    ) -> AppResult<XxxDto> {
        sqlx::query_as::<_, XxxDto>(r#"
            INSERT INTO xxx (col1, col2)
            VALUES ($1, $2::some_enum)
            RETURNING xxx_id::bigint as id, col1, col2
        "#)
        .bind(&req.col1)
        .bind(&req.col2)
        .fetch_one(&mut **tx)
        .await
        .map_err(Into::into)
    }

    // =====================================================
    // E. Upsert
    // =====================================================
    pub async fn upsert(pool: &PgPool, key: i64, val: i32) -> AppResult<XxxDto> {
        sqlx::query_as::<_, XxxDto>(r#"
            INSERT INTO xxx (key_col, val_col)
            VALUES ($1, $2)
            ON CONFLICT (key_col) DO UPDATE SET
                val_col = EXCLUDED.val_col
            RETURNING /* ... */
        "#)
        .bind(key)
        .bind(val)
        .fetch_one(pool)
        .await
        .map_err(Into::into)
    }
}
```

##### ğŸ”„ ë°ì´í„° íë¦„

```
[Service] â†’ pool or tx ì „ë‹¬
      â†“
[Repo Function]
      â†“
sqlx::query_as / query_scalar / query
      â†“
.bind() â†’ Parameter ë°”ì¸ë”©
      â†“
.fetch_one/optional/all(&mut **tx) or (pool)
      â†“
Result<T, sqlx::Error> â†’ AppResult<T> ë³€í™˜
      â†“
[Service]ë¡œ ë°˜í™˜
```

---

#### 7.7.1-3. service.rs
> **Claude ì½”ë“œ ë¶„ì„ ê¸°ë°˜** (2025-01-22)

##### ğŸ“ íŒŒì¼ ê°œìš”

| íŒŒì¼ | ë¼ì¸ìˆ˜ | êµ¬ì¡° | ì£¼ìš” ì—­í•  | íŠ¹ì§• |
|------|--------|------|----------|------|
| [auth/service.rs](src/api/auth/service.rs) | 569 | `struct AuthService;` (stateless) | ë¡œê·¸ì¸, í† í° ê°±ì‹ , ë¡œê·¸ì•„ì›ƒ | Rate limit, Refresh rotation |
| [user/service.rs](src/api/user/service.rs) | 266 | `struct UserService;` (stateless) | íšŒì›ê°€ì…, í”„ë¡œí•„, ì„¤ì • | Auto login, Validation |
| [video/service.rs](src/api/video/service.rs) | 105 | `struct VideoService;` (stateless) | ë¹„ë””ì˜¤ ëª©ë¡, ì§„ë„ ê´€ë¦¬ | ë‹¨ìˆœ CRUD |
| [study/service.rs](src/api/study/service.rs) | 309 | `struct StudyService;` (stateless) | í•™ìŠµ ê³¼ì œ, ì±„ì , í•´ì„¤ | Enum íŒŒì‹±, Optional ë¡œê¹… |
| [lesson/service.rs](src/api/lesson/service.rs) | 197 | `struct LessonService { repo }` âš ï¸ | ë ˆìŠ¨ ëª©ë¡, ì§„ë„ | Stateful (ë‹¤ë¥¸ íŒ¨í„´) |

##### 1ï¸âƒ£ Auth Domain ([auth/service.rs](src/api/auth/service.rs))

**ì—­í• **: ì¸ì¦ ì „ì²´ íë¦„ (ë¡œê·¸ì¸/ë¦¬í”„ë ˆì‹œ/ë¡œê·¸ì•„ì›ƒ/ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •)

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. íƒ€ì´ë° ê³µê²© ë°©ì§€ (Dummy Hash)
fn dummy_password_hash() -> AppResult<PasswordHash<'static>> {
    static DUMMY_HASH: OnceLock<String> = OnceLock::new();
    let hash_str = DUMMY_HASH.get_or_init(|| {
        let salt = SaltString::generate(&mut OsRng);
        Argon2::default()
            .hash_password(b"dummy_password", &salt)
            .expect("argon2 dummy hash should succeed")
            .to_string()
    });
    PasswordHash::new(hash_str).map_err(|_| AppError::Internal("...".into()))
}

// 2. Rate Limiting (Redis INCR + EXPIRE)
let rl_key = format!("rl:login:{}:{}", email, login_ip);
let mut redis_conn = st.redis.get().await?;

let attempts: i64 = redis_conn.incr(&rl_key, 1).await?;
if attempts == 1 {
    let _: () = redis_conn.expire(&rl_key, st.cfg.rate_limit_login_window_sec).await?;
}
if attempts > st.cfg.rate_limit_login_max {
    return Err(AppError::TooManyRequests("AUTH_429_TOO_MANY_ATTEMPTS".into()));
}

// 3. Refresh Token Rotation + Reuse Detection
pub async fn refresh(st: &AppState, old_refresh_token: &str, ...) -> AppResult<...> {
    let (session_id, incoming_hash) = Self::parse_refresh_token(old_refresh_token)?;

    // DB Lock (FOR UPDATE)
    let mut tx = st.db.begin().await?;
    let login_record = AuthRepo::find_login_by_session_id_for_update_tx(&mut tx, &session_id).await?;

    // Reuse Detection (Critical Security)
    if login_record.refresh_hash != incoming_hash {
        warn!("Refresh token reuse detected! Session: {}", session_id);
        AuthRepo::update_login_state_by_session_tx(&mut tx, &session_id, "compromised").await?;
        tx.commit().await?;

        // Redis ì¦‰ì‹œ ë¬´íš¨í™”
        let _ = redis_conn.del(format!("ak:refresh:{}", login_record.refresh_hash)).await;
        let _ = redis_conn.del(format!("ak:session:{}", session_id)).await;

        return Err(AppError::Conflict("AUTH_409_REUSE_DETECTED".into()));
    }

    // Rotate: ìƒˆ í† í° ë°œê¸‰
    let (new_refresh_token, new_refresh_hash) = Self::generate_refresh_token_and_hash(&session_id);
    AuthRepo::update_login_refresh_hash_tx(&mut tx, &session_id, &new_refresh_hash).await?;
    tx.commit().await?;

    // Redis Sync (Old ì‚­ì œ â†’ New ë“±ë¡)
    let _: () = redis_conn.del(format!("ak:refresh:{}", login_record.refresh_hash)).await?;
    let _: () = redis_conn.set_ex(format!("ak:refresh:{}", new_refresh_hash), &session_id, ttl).await?;
    // ...
}

// 4. DB TX í›„ Redis ë°˜ì˜ íŒ¨í„´ (Login ì˜ˆì‹œ)
pub async fn login(st: &AppState, req: LoginReq, ...) -> AppResult<(LoginRes, Cookie, i64)> {
    // ... validation, password verify ...

    // [DB Transaction]
    let mut tx = st.db.begin().await?;
    AuthRepo::insert_login_record_tx(&mut tx, ...).await?;
    AuthRepo::insert_login_log_tx(&mut tx, ...).await?;
    tx.commit().await?;  // DB ë¨¼ì € ì»¤ë°‹

    // [Redis Caching] - ì»¤ë°‹ í›„ ì‹¤í–‰
    let _: () = redis_conn.set_ex(format!("ak:session:{}", session_id), user_id, ttl).await?;
    let _: () = redis_conn.set_ex(format!("ak:refresh:{}", refresh_hash), &session_id, ttl).await?;

    // [Cookie ìƒì„±]
    let mut refresh_cookie = Cookie::new(st.cfg.refresh_cookie_name.clone(), refresh_token);
    refresh_cookie.set_http_only(true);
    refresh_cookie.set_secure(st.cfg.refresh_cookie_secure);
    // ...
}
```

##### 2ï¸âƒ£ User Domain ([user/service.rs](src/api/user/service.rs))

**ì—­í• **: íšŒì›ê°€ì… (ìë™ ë¡œê·¸ì¸ í¬í•¨), í”„ë¡œí•„/ì„¤ì • CRUD

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. DB Unique Violation ê°ì§€ (PG ì—ëŸ¬ ì½”ë“œ)
const PG_UNIQUE_VIOLATION: &'static str = "23505";

fn is_unique_violation(err: &AppError) -> bool {
    if let AppError::Sqlx(sqlx::Error::Database(db)) = err {
        db.code().as_deref() == Some(Self::PG_UNIQUE_VIOLATION)
    } else {
        false
    }
}

// 2. ì‚¬ì „ ì²´í¬ + DB ìµœì¢… ë°©ì–´ íŒ¨í„´
pub async fn signup(st: &AppState, req: SignupReq, ...) -> AppResult<...> {
    // [ì‚¬ì „ ì²´í¬]
    if repo::find_user_id_by_email(&st.db, &req.email).await?.is_some() {
        return Err(AppError::Conflict("Email already exists".into()));
    }

    // [DB Insert with Unique Constraint]
    let user = match repo::signup_tx(&mut tx, ...).await {
        Ok(u) => u,
        Err(e) if Self::is_unique_violation(&e) => {
            return Err(AppError::Conflict("Email exists".into()))  // ë™ì‹œ ìš”ì²­ ë°©ì–´
        },
        Err(e) => return Err(e),
    };
    // ...
}

// 3. Best-Effort ê°ì‚¬ ë¡œê·¸ (ì‹¤íŒ¨í•´ë„ ì—…ë¬´ íë¦„ ìœ ì§€)
if let Err(e) = repo::insert_user_log_after_tx(&mut tx, Some(user.id), user.id, "signup", true).await {
    warn!(error = ?e, user_id = user.id, "Failed to insert signup log");
    // ë¡œê·¸ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
}

// 4. ê¸°ë³¸ê°’ Fallback (ì„¤ì • ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ë°˜í™˜)
pub async fn get_settings(st: &AppState, user_id: i64) -> AppResult<SettingsRes> {
    let settings = repo::find_users_setting(&st.db, user_id).await?;

    Ok(settings.unwrap_or_else(|| SettingsRes {
        user_set_language: "ko".to_string(),
        user_set_timezone: "UTC".to_string(),
        user_set_note_email: false,
        user_set_note_push: false,
        updated_at: chrono::Utc::now(),
    }))
}
```

##### 3ï¸âƒ£ Video Domain ([video/service.rs](src/api/video/service.rs))

**ì—­í• **: ë¹„ë””ì˜¤ ëª©ë¡/ìƒì„¸ ì¡°íšŒ, ì§„ë„ìœ¨ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. ë‹¨ìˆœ Validation â†’ Repo â†’ Meta ê³„ì‚° íŒ¨í„´
pub async fn list_videos(st: &AppState, req: VideoListReq) -> AppResult<VideoListRes> {
    // Validation
    if let Err(e) = req.validate() {
        return Err(AppError::BadRequest(e.to_string()));
    }

    // Repo í˜¸ì¶œ (Data + Total Count)
    let (data, total_count) = VideoRepo::list_videos(&st.db, &req).await?;

    // Meta ê³„ì‚°
    let total_pages = if total_count == 0 { 0 }
    else { (total_count + req.per_page as i64 - 1) / req.per_page as i64 };

    Ok(VideoListRes { meta: VideoListMeta { total_count, total_pages, ... }, data })
}

// 2. ì¡´ì¬ í™•ì¸ í›„ ê¸°ë³¸ê°’ ë°˜í™˜ íŒ¨í„´
pub async fn get_video_progress(st: &AppState, user_id: i64, video_id: i64) -> AppResult<VideoProgressRes> {
    // ë¹„ë””ì˜¤ ì¡´ì¬ í™•ì¸
    if !VideoRepo::exists_by_id(&st.db, video_id).await? {
        return Err(AppError::NotFound);
    }

    // ì§„ë„ ì¡°íšŒ â†’ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
    let progress = VideoRepo::find_progress(&st.db, user_id, video_id).await?;
    Ok(progress.unwrap_or_else(|| VideoProgressRes {
        video_id,
        progress_rate: 0,
        is_completed: false,
        last_watched_at: None,
    }))
}
```

##### 4ï¸âƒ£ Study Domain ([study/service.rs](src/api/study/service.rs))

**ì—­í• **: í•™ìŠµ ê³¼ì œ ì¡°íšŒ, ì±„ì , ìƒíƒœ/í•´ì„¤ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. Enum ë¬¸ìì—´ íŒŒì‹± (í—¬í¼ í•¨ìˆ˜)
fn parse_study_program(value: &str) -> Option<StudyProgram> {
    match value {
        "basic_pronunciation" => Some(StudyProgram::BasicPronunciation),
        "basic_word" => Some(StudyProgram::BasicWord),
        "topik_read" => Some(StudyProgram::TopikRead),
        // ...
        _ => None,
    }
}

// 2. ìš”ì²­ Kind â†” DB Kind ì¼ì¹˜ ê²€ì¦
pub async fn submit_answer(st: &AppState, auth: AuthUser, task_id: i32, req: SubmitAnswerReq) -> AppResult<SubmitAnswerRes> {
    let answer_key = StudyRepo::find_answer_key(&st.db, task_id).await?.ok_or(AppError::NotFound)?;

    let req_kind = match &req {
        SubmitAnswerReq::Choice { .. } => StudyTaskKind::Choice,
        SubmitAnswerReq::Typing { .. } => StudyTaskKind::Typing,
        SubmitAnswerReq::Voice { .. } => StudyTaskKind::Voice,
    };

    if req_kind != answer_key.kind {
        return Err(AppError::BadRequest("Task kind mismatch".into()));
    }
    // ... ì±„ì  ë¡œì§ ...
}

// 3. Best-Effort ì•¡ì…˜ ë¡œê¹… (ì‹¤íŒ¨í•´ë„ ê²½ê³ ë§Œ)
pub async fn get_study_task(st: &AppState, task_id: i32, auth: Option<AuthUser>) -> AppResult<StudyTaskDetailRes> {
    let task = StudyRepo::find_task_detail(&st.db, i64::from(task_id)).await?.ok_or(AppError::NotFound)?;

    if let Some(AuthUser(claims)) = auth {
        if let Err(err) = StudyRepo::log_task_action(&st.db, claims.sub, &claims.session_id, task_id, StudyTaskLogAction::View).await {
            warn!(error = ?err, user_id = claims.sub, task_id, "Failed to log study task view");
            // ë¡œê·¸ ì‹¤íŒ¨í•´ë„ ê³„ì† ë°˜í™˜
        }
    }
    Ok(task)
}

// 4. ê¶Œí•œ ê²€ì¦ (ì‹œë„ íšŸìˆ˜ ê¸°ë°˜)
pub async fn get_task_explain(st: &AppState, auth: AuthUser, task_id: i32) -> AppResult<TaskExplainRes> {
    let try_count = StudyRepo::get_try_count(&st.db, auth.0.sub, task_id).await?;
    if try_count < 1 {
        return Err(AppError::Forbidden);  // 1íšŒ ì´ìƒ ì‹œë„í•´ì•¼ í•´ì„¤ ì¡°íšŒ ê°€ëŠ¥
    }
    // ...
}
```

##### 5ï¸âƒ£ Lesson Domain ([lesson/service.rs](src/api/lesson/service.rs))

**ì—­í• **: ë ˆìŠ¨ ëª©ë¡/ìƒì„¸, ì§„ë„ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**: âš ï¸ **Stateful êµ¬ì¡° (ë‹¤ë¥¸ ë„ë©”ì¸ê³¼ ë‹¤ë¦„)**

```rust
// âš ï¸ ë‹¤ë¥¸ Serviceì™€ ë‹¬ë¦¬ repoë¥¼ í•„ë“œë¡œ ì†Œìœ 
pub struct LessonService {
    repo: LessonRepo,  // AppStateê°€ ì•„ë‹Œ ì§ì ‘ ì†Œìœ 
}

impl LessonService {
    pub fn new(repo: LessonRepo) -> Self {
        Self { repo }
    }

    pub async fn list_lessons(&self, req: LessonListReq) -> AppResult<LessonListRes> {
        // &self.repo ì‚¬ìš© (AppState ë¯¸ì‚¬ìš©)
        let total_count = self.repo.count_all().await?;  // sqlx::Error ë°˜í™˜ âš ï¸
        let items = self.repo.find_all(per_page, offset).await?;
        // ...
    }
}
```

##### ğŸ“Š ê³µí†µ íŒ¨í„´ ìš”ì•½

| íŒ¨í„´ | ìš©ë„ | ì‚¬ìš©ì²˜ | ì½”ë“œ |
|------|------|--------|------|
| **Rate Limiting** | ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€ | auth, user | `redis.incr()` + `expire()` |
| **Timing Attack ë°©ì–´** | ë¡œê·¸ì¸ ë³´ì•ˆ | auth | `dummy_password_hash()` |
| **Refresh Rotation** | í† í° íƒˆì·¨ ê°ì§€ | auth | FOR UPDATE + hash ë¹„êµ |
| **DBâ†’Redis ìˆœì„œ** | ì¼ê´€ì„± ë³´ì¥ | auth, user | `tx.commit()` í›„ Redis |
| **Unique Violation** | ì¤‘ë³µ ë°©ì–´ | user | `code == "23505"` |
| **Best-Effort Log** | ë¡œê¹… ì‹¤íŒ¨ í—ˆìš© | user, study | `warn!()` + ê³„ì† ì§„í–‰ |
| **Default Fallback** | ë°ì´í„° ì—†ì„ ë•Œ | video, study, lesson | `unwrap_or_else(|| default)` |
| **Kind Mismatch** | íƒ€ì… ê²€ì¦ | study | ìš”ì²­ Kind â†” DB Kind |
| **ê¶Œí•œ ê²€ì¦** | ì ‘ê·¼ ì œì–´ | study | `try_count < 1` â†’ Forbidden |

##### âš ï¸ í˜„ì¬ ë¶ˆì¼ì¹˜/ê°œì„  í•„ìš” ì‚¬í•­

| ì´ìŠˆ | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ í‘œì¤€ | íŒŒì¼ |
|------|----------|----------|------|
| **Refresh Token í¬ë§·** | `session_id:uuid` (auth) vs `random_32bytes` (user) | í†µì¼ í•„ìš” | auth vs user |
| **Service êµ¬ì¡°** | `LessonService { repo }` (stateful) | `struct XxxService;` (stateless) | lesson |
| **ì—ëŸ¬ íƒ€ì…** | `sqlx::Error` ì§ì ‘ ë°˜í™˜ | `AppResult<T>` | lesson (via repo) |
| **SADD ëˆ„ë½** | loginì—ì„œ user_sessions SADD ì•ˆí•¨ | SADD ì¶”ê°€ í•„ìš” | auth |
| **set_domain ì¤‘ë³µ** | 2ë²ˆ í˜¸ì¶œ | 1ë²ˆìœ¼ë¡œ ì •ë¦¬ | auth |

##### ğŸ“‹ í‘œì¤€ í…œí”Œë¦¿

```rust
// service.rs (AMK í‘œì¤€ ê³¨ê²©)
use crate::{error::{AppError, AppResult}, state::AppState};
use super::{dto::*, repo};
use validator::Validate;
use tracing::warn;

// âœ… Stateless êµ¬ì¡°ì²´
pub struct XxxService;

impl XxxService {
    // =====================================================
    // A. ëª©ë¡ ì¡°íšŒ (Validation â†’ Repo â†’ Meta)
    // =====================================================
    pub async fn list(st: &AppState, req: XxxListReq) -> AppResult<XxxListRes> {
        // 1. Validation
        if let Err(e) = req.validate() {
            return Err(AppError::BadRequest(e.to_string()));
        }

        // 2. Repo í˜¸ì¶œ
        let (list, total_count) = repo::find_list(&st.db, &req).await?;

        // 3. Meta ê³„ì‚°
        let total_pages = if total_count == 0 { 0 }
        else { (total_count + req.per_page - 1) / req.per_page };

        Ok(XxxListRes { list, meta: XxxMeta { total_count, total_pages, ... } })
    }

    // =====================================================
    // B. ìƒì„¸ ì¡°íšŒ (Exists Check â†’ Fetch)
    // =====================================================
    pub async fn get_detail(st: &AppState, id: i64) -> AppResult<XxxDetail> {
        let item = repo::find_by_id(&st.db, id).await?.ok_or(AppError::NotFound)?;
        Ok(item)
    }

    // =====================================================
    // C. ì“°ê¸° (TX â†’ Log â†’ Commit)
    // =====================================================
    pub async fn create(st: &AppState, user_id: i64, req: XxxCreateReq) -> AppResult<XxxRes> {
        req.validate().map_err(|e| AppError::BadRequest(e.to_string()))?;

        let mut tx = st.db.begin().await?;

        let result = repo::create_tx(&mut tx, &req).await?;

        // Best-effort logging
        if let Err(e) = repo::log_action_tx(&mut tx, user_id, "create").await {
            warn!(error = ?e, "Failed to log action");
        }

        tx.commit().await?;
        Ok(result)
    }
}
```

##### ğŸ”„ ë°ì´í„° íë¦„

```
[Handler] â†’ AppState, AuthUser, Req DTO ì¶”ì¶œ
      â†“
[Service] â†’ Validation â†’ Rate Limit (Redis) â†’ Business Logic
      â†“
[Repo] â†’ DB Query (TX or Pool)
      â†“
[Service] â†’ DB Commit â†’ Redis Sync â†’ Response êµ¬ì„±
      â†“
[Handler] â†’ HTTP Response (JSON)
```

---

#### 7.7.1-4. handler.rs
> **Claude ì½”ë“œ ë¶„ì„ ê¸°ë°˜** (2025-01-22)

##### ğŸ“ íŒŒì¼ ê°œìš”

| íŒŒì¼ | ë¼ì¸ìˆ˜ | Extractor ì‚¬ìš© | ì£¼ìš” ì—­í•  | íŠ¹ì§• |
|------|--------|---------------|----------|------|
| [auth/handler.rs](src/api/auth/handler.rs) | 282 | State, HeaderMap, CookieJar, Json, AuthUser | ë¡œê·¸ì¸, í† í° ê°±ì‹ , ë¡œê·¸ì•„ì›ƒ | Cookie ì§ì ‘ ê´€ë¦¬ |
| [user/handler.rs](src/api/user/handler.rs) | 240 | State, HeaderMap, CookieJar, Json, AuthUser | íšŒì›ê°€ì…, í”„ë¡œí•„, ì„¤ì • | 201 + Location í—¤ë” |
| [video/handler.rs](src/api/video/handler.rs) | 117 | State, Query, Path, Json, AuthUser | ë¹„ë””ì˜¤ ëª©ë¡, ì§„ë„ | ì™„ì „íˆ ì–‡ì€ ë ˆì´ì–´ |
| [study/handler.rs](src/api/study/handler.rs) | 142 | State, Query, Path, Json, AuthUser, OptionalAuthUser | í•™ìŠµ ê³¼ì œ, ì±„ì  | Optional ì¸ì¦ |
| [lesson/handler.rs](src/api/lesson/handler.rs) | 150 | State, Query, Path, Json, AuthUser | ë ˆìŠ¨ ëª©ë¡, ì§„ë„ | Service ì¸ìŠ¤í„´ìŠ¤í™” âš ï¸ |

##### 1ï¸âƒ£ Auth Domain ([auth/handler.rs](src/api/auth/handler.rs))

**ì—­í• **: ë¡œê·¸ì¸, í† í° ê°±ì‹ , ë¡œê·¸ì•„ì›ƒ, ì•„ì´ë”” ì°¾ê¸°, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. Client Context ì¶”ì¶œ í—¬í¼
fn extract_client_ip(headers: &HeaderMap) -> String {
    // x-forwarded-for â†’ x-real-ip â†’ fallback ìˆœì„œ
    if let Some(v) = headers.get("x-forwarded-for").and_then(|v| v.to_str().ok()) {
        if let Some(first) = v.split(',').next() {
            let ip = first.trim();
            if !ip.is_empty() { return ip.to_string(); }
        }
    }
    if let Some(v) = headers.get("x-real-ip").and_then(|v| v.to_str().ok()) {
        let ip = v.trim();
        if !ip.is_empty() { return ip.to_string(); }
    }
    // Fallback (env ì„¤ì • ê°€ëŠ¥)
    "127.0.0.1".to_string()
}

fn extract_user_agent(headers: &HeaderMap) -> Option<String> {
    headers.get("user-agent").and_then(|v| v.to_str().ok()).map(|s| s.to_string())
}

// 2. Login Handler - Serviceê°€ Cookie ë°˜í™˜
#[utoipa::path(
    post,
    path = "/auth/login",
    tag = "auth",
    request_body = LoginReq,
    responses(
        (status = 200, description = "Login successful", body = LoginRes),
        (status = 401, description = "Unauthorized", body = crate::error::ErrorBody),
        (status = 429, description = "Too Many Requests", body = crate::error::ErrorBody)
    )
)]
pub async fn login(
    State(st): State<AppState>,
    headers: HeaderMap,
    jar: CookieJar,
    Json(req): Json<LoginReq>,
) -> Result<(CookieJar, Json<LoginRes>), AppError> {
    let ip = extract_client_ip(&headers);
    let ua = extract_user_agent(&headers);

    // Serviceê°€ Cookieê¹Œì§€ ìƒì„±í•´ì„œ ë°˜í™˜
    let (login_res, cookie, _) = AuthService::login(&st, req, ip, ua).await?;
    let jar = jar.add(cookie);

    Ok((jar, Json(login_res)))
}

// 3. Refresh Handler - Handlerê°€ Cookie ì§ì ‘ ìƒì„±
pub async fn refresh(
    State(st): State<AppState>,
    headers: HeaderMap,
    jar: CookieJar,
) -> Result<(CookieJar, Json<LoginRes>), AppError> {
    // ì¿ í‚¤ì—ì„œ ë¦¬í”„ë ˆì‹œ í† í° ì¶”ì¶œ
    let refresh_token = jar
        .get(&st.cfg.refresh_cookie_name)
        .map(|c| c.value().to_string())
        .ok_or(AppError::Unauthorized("Missing refresh token".into()))?;

    let (refresh_res, new_token_str, ttl_secs) =
        AuthService::refresh(&st, &refresh_token, ip, ua).await?;

    // Handlerì—ì„œ ì¿ í‚¤ ì§ì ‘ ì„¤ì • (Rotation)
    let mut refresh_cookie = Cookie::new(st.cfg.refresh_cookie_name.clone(), new_token_str);
    refresh_cookie.set_path("/");
    refresh_cookie.set_http_only(true);
    refresh_cookie.set_secure(st.cfg.refresh_cookie_secure);
    refresh_cookie.set_same_site(match st.cfg.refresh_cookie_samesite_or("Lax") {
        "Strict" => SameSite::Strict,
        "Lax" => SameSite::Lax,
        "None" => SameSite::None,
        _ => SameSite::Lax,
    });
    refresh_cookie.set_expires(OffsetDateTime::now_utc() + Duration::seconds(ttl_secs));

    if let Some(domain) = &st.cfg.refresh_cookie_domain {
        refresh_cookie.set_domain(domain.clone());
    }

    Ok((jar.add(refresh_cookie), Json(refresh_res)))
}

// 4. Logout Handler - Cookie ë§Œë£Œ ì„¤ì •
pub async fn logout(
    State(st): State<AppState>,
    AuthUser(auth_user): AuthUser,
    headers: HeaderMap,
    jar: CookieJar,
) -> Result<(CookieJar, StatusCode), AppError> {
    AuthService::logout(&st, auth_user.sub, &auth_user.session_id, ip, ua).await?;

    // ì¿ í‚¤ ë§Œë£Œ (ê³¼ê±° ì‹œê°„ ì„¤ì •)
    let mut refresh_cookie = Cookie::new(st.cfg.refresh_cookie_name.clone(), "");
    refresh_cookie.set_expires(OffsetDateTime::now_utc() - Duration::days(1));
    // ... ê¸°íƒ€ ì†ì„± ì„¤ì •

    Ok((jar.add(refresh_cookie), StatusCode::NO_CONTENT))
}
```

##### 2ï¸âƒ£ User Domain ([user/handler.rs](src/api/user/handler.rs))

**ì—­í• **: íšŒì›ê°€ì… (ìë™ ë¡œê·¸ì¸), í”„ë¡œí•„/ì„¤ì • CRUD

**í•µì‹¬ íŒ¨í„´**:

```rust
// 1. Signup - 201 + Location í—¤ë” + Cookie
#[utoipa::path(
    post,
    path = "/users",
    tag = "user",
    request_body = SignupReq,
    responses(
        (status = 201, description = "íšŒì›ê°€ì… ì„±ê³µ (ìë™ ë¡œê·¸ì¸)", body = SignupRes),
        (status = 409, description = "ì´ë©”ì¼ ì¤‘ë³µ", body = crate::error::ErrorBody)
    )
)]
pub async fn signup(
    State(st): State<AppState>,
    headers: HeaderMap,
    jar: CookieJar,
    Json(req): Json<SignupReq>,
) -> AppResult<(CookieJar, (StatusCode, HeaderMap, Json<SignupRes>))> {
    let ip = extract_client_ip(&headers);
    let ua = extract_user_agent(&headers);

    let (res, refresh_token, refresh_ttl_secs) = UserService::signup(&st, req, ip, ua).await?;

    // Cookie::build() ë°©ì‹ (ë‹¤ë¥¸ ìŠ¤íƒ€ì¼)
    let refresh_cookie = Cookie::build(Cookie::new(
        st.cfg.refresh_cookie_name.clone(),
        refresh_token,
    ))
    .path("/")
    .http_only(true)
    .secure(st.cfg.refresh_cookie_secure)
    .same_site(...)
    .expires(...)
    .domain(st.cfg.refresh_cookie_domain.clone().unwrap_or_default())  // âš ï¸
    .build();

    // Location í—¤ë” ì„¤ì • (RESTful)
    let mut resp_headers = HeaderMap::new();
    let location = format!("/users/{}", res.user_id);
    resp_headers.insert(axum::http::header::LOCATION, HeaderValue::from_str(&location)?);

    Ok((jar.add(refresh_cookie), (StatusCode::CREATED, resp_headers, Json(res))))
}

// 2. ì–‡ì€ Handler íŒ¨í„´ (ëŒ€ë¶€ë¶„ì˜ ì—”ë“œí¬ì¸íŠ¸)
pub async fn get_me(
    State(st): State<AppState>,
    AuthUser(auth_user): AuthUser,
) -> AppResult<Json<ProfileRes>> {
    let user = UserService::get_me(&st, auth_user.sub).await?;
    Ok(Json(user))
}

pub async fn update_me(
    State(st): State<AppState>,
    AuthUser(auth_user): AuthUser,
    Json(req): Json<ProfileUpdateReq>,
) -> AppResult<Json<ProfileRes>> {
    let user = UserService::update_me(&st, auth_user.sub, req).await?;
    Ok(Json(user))
}
```

##### 3ï¸âƒ£ Video Domain ([video/handler.rs](src/api/video/handler.rs))

**ì—­í• **: ë¹„ë””ì˜¤ ëª©ë¡/ìƒì„¸, í•™ìŠµ ì§„ë„ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**: **ì™„ì „íˆ ì–‡ì€ Handler** (Best Practice)

```rust
// 1. Query Parameter + OpenAPI ìˆ˜ë™ ë¬¸ì„œí™”
#[utoipa::path(
    get,
    path = "/videos",
    params(
        ("page" = Option<u64>, Query, description = "Page number (default 1)"),
        ("per_page" = Option<u64>, Query, description = "Items per page (default 20, max 100)"),
        ("q" = Option<String>, Query, description = "Search query"),
        ("tag" = Option<String>, Query, description = "Filter by tag key"),
        ("state" = Option<String>, Query, description = "Filter by state")
    ),
    responses((status = 200, description = "List of videos", body = VideoListRes)),
    tag = "videos"
)]
pub async fn list_videos(
    State(state): State<AppState>,
    Query(req): Query<VideoListReq>,
) -> AppResult<Json<VideoListRes>> {
    let res = VideoService::list_videos(&state, req).await?;
    Ok(Json(res))
}

// 2. Path Parameter (IdParam DTO ì‚¬ìš©)
pub async fn get_video_detail(
    State(state): State<AppState>,
    Path(IdParam { id }): Path<IdParam>,
) -> AppResult<Json<VideoDetailRes>> {
    let video = VideoService::get_video_detail(&state, id).await?;
    Ok(Json(video))
}

// 3. ì¸ì¦ í•„ìš” ì—”ë“œí¬ì¸íŠ¸
#[utoipa::path(
    // ...
    security(("bearerAuth" = [])),
    tag = "videos"
)]
pub async fn get_video_progress(
    State(state): State<AppState>,
    AuthUser(auth_user): AuthUser,  // ì¸ì¦ í•„ìˆ˜
    Path(IdParam { id }): Path<IdParam>,
) -> AppResult<Json<VideoProgressRes>> {
    let progress = VideoService::get_video_progress(&state, auth_user.sub, id).await?;
    Ok(Json(progress))
}
```

##### 4ï¸âƒ£ Study Domain ([study/handler.rs](src/api/study/handler.rs))

**ì—­í• **: í•™ìŠµ ëª©ë¡, ë¬¸ì œ ìƒì„¸, ì •ë‹µ ì œì¶œ, ìƒíƒœ/í•´ì„¤ ì¡°íšŒ

**í•µì‹¬ íŒ¨í„´**: **OptionalAuthUser** (ë¹„ë¡œê·¸ì¸ ì ‘ê·¼ í—ˆìš©)

```rust
// 1. Optional Auth - ë¹„ë¡œê·¸ì¸ë„ ì ‘ê·¼ ê°€ëŠ¥
pub async fn get_study_task(
    State(state): State<AppState>,
    OptionalAuthUser(auth): OptionalAuthUser,  // â­ Optional
    Path(task_id): Path<i32>,
) -> AppResult<Json<StudyTaskDetailRes>> {
    let res = StudyService::get_study_task(&state, task_id, auth).await?;
    Ok(Json(res))
}

// 2. AuthUser ì „ì²´ ì „ë‹¬ íŒ¨í„´ (ë‹¤ë¥¸ ë„ë©”ì¸ê³¼ ë‹¤ë¦„)
pub async fn submit_answer(
    State(state): State<AppState>,
    auth_user: AuthUser,  // âš ï¸ êµ¬ì¡° ë¶„í•´ ì—†ì´ ì „ì²´ ì „ë‹¬
    Path(task_id): Path<i32>,
    Json(req): Json<SubmitAnswerReq>,
) -> AppResult<Json<SubmitAnswerRes>> {
    let res = StudyService::submit_answer(&state, auth_user, task_id, req).await?;
    Ok(Json(res))
}

// 3. Forbidden ì‘ë‹µ ê°€ëŠ¥ ì—”ë“œí¬ì¸íŠ¸
#[utoipa::path(
    get,
    path = "/studies/tasks/{id}/explain",
    responses(
        (status = 200, description = "Task Explanation", body = TaskExplainRes),
        (status = 403, description = "Forbidden", body = crate::error::ErrorBody)  // 1íšŒ ì´ìƒ í’€ì–´ì•¼ ì¡°íšŒ ê°€ëŠ¥
    ),
    security(("bearerAuth" = [])),
    tag = "study"
)]
pub async fn get_task_explain(/* ... */) { /* ... */ }
```

##### 5ï¸âƒ£ Lesson Domain ([lesson/handler.rs](src/api/lesson/handler.rs))

**ì—­í• **: ë ˆìŠ¨ ëª©ë¡/ìƒì„¸, ì•„ì´í…œ, ì§„ë„ ê´€ë¦¬

**í•µì‹¬ íŒ¨í„´**: âš ï¸ **Service ì¸ìŠ¤í„´ìŠ¤í™”** (ë‹¤ë¥¸ ë„ë©”ì¸ê³¼ ë‹¤ë¦„)

```rust
// âš ï¸ ë§¤ ìš”ì²­ë§ˆë‹¤ Service ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
pub async fn list_lessons(
    State(state): State<AppState>,
    Query(req): Query<LessonListReq>,
) -> AppResult<Json<LessonListRes>> {
    // ë‹¤ë¥¸ ë„ë©”ì¸: VideoService::list_videos(&state, req)
    // Lesson: ì¸ìŠ¤í„´ìŠ¤í™” í•„ìš”
    let service = LessonService::new(LessonRepo::new(state.db.clone()));
    let res = service.list_lessons(req).await?;
    Ok(Json(res))
}

pub async fn get_lesson_progress(
    State(state): State<AppState>,
    AuthUser(auth_user): AuthUser,
    Path(lesson_id): Path<i64>,
) -> AppResult<Json<LessonProgressRes>> {
    let service = LessonService::new(LessonRepo::new(state.db.clone()));
    let res = service.get_lesson_progress(auth_user.sub, lesson_id).await?;
    Ok(Json(res))
}
```

##### ğŸ“Š ê³µí†µ íŒ¨í„´ ìš”ì•½

| íŒ¨í„´ | ìš©ë„ | ì‚¬ìš©ì²˜ | ì½”ë“œ ì˜ˆì‹œ |
|------|------|--------|----------|
| **State<AppState>** | ì „ì—­ ìƒíƒœ ì£¼ì… | ëª¨ë“  handler | `State(st): State<AppState>` |
| **Json<Req>** | JSON Body ì¶”ì¶œ | POST/PUT/PATCH | `Json(req): Json<LoginReq>` |
| **Query(Req)** | Query String ì¶”ì¶œ | GET (ëª©ë¡) | `Query(req): Query<VideoListReq>` |
| **Path(id)** | Path Parameter ì¶”ì¶œ | ìƒì„¸/ìˆ˜ì •/ì‚­ì œ | `Path(id): Path<i64>` |
| **AuthUser** | ì¸ì¦ í•„ìˆ˜ | ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ | `AuthUser(auth): AuthUser` |
| **OptionalAuthUser** | ì¸ì¦ ì„ íƒ | ë¹„ë¡œê·¸ì¸ í—ˆìš© | `OptionalAuthUser(auth)` |
| **CookieJar** | ì¿ í‚¤ ê´€ë¦¬ | auth, user | `jar: CookieJar` |
| **HeaderMap** | í—¤ë” ì¶”ì¶œ | IP/UA í•„ìš” ì‹œ | `headers: HeaderMap` |

##### âš ï¸ í˜„ì¬ ë¶ˆì¼ì¹˜/ê°œì„  í•„ìš” ì‚¬í•­

| ì´ìŠˆ | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ í‘œì¤€ | íŒŒì¼ |
|------|----------|----------|------|
| **í—¬í¼ ì¤‘ë³µ** | auth, user ê°ê° ì •ì˜ | ê³µí†µ ëª¨ë“ˆë¡œ ì¶”ì¶œ | `api/common/http.rs` |
| **ì¿ í‚¤ ìƒì„± ì±…ì„** | login: service, refresh/signup: handler | í•œ ê³³ìœ¼ë¡œ í†µì¼ | auth, user |
| **ì¿ í‚¤ domain ì„¤ì •** | `unwrap_or_default()` | `if let Some()` íŒ¨í„´ | user_handler |
| **Service í˜¸ì¶œ ë°©ì‹** | lessonë§Œ ì¸ìŠ¤í„´ìŠ¤í™” | stateless í†µì¼ | lesson_handler |
| **AuthUser ì „ë‹¬** | studyë§Œ ì „ì²´ ì „ë‹¬ | êµ¬ì¡° ë¶„í•´ í†µì¼ | study_handler |
| **ë°˜í™˜ íƒ€ì…** | auth: `Result<_, AppError>`, ê¸°íƒ€: `AppResult` | `AppResult` í†µì¼ | auth_handler |

##### ğŸ“‹ í‘œì¤€ í…œí”Œë¦¿

```rust
// handler.rs (AMK í‘œì¤€ ê³¨ê²©)
use axum::{
    extract::{State, Path, Query},
    http::HeaderMap,
    Json,
};
use axum_extra::extract::cookie::{Cookie, CookieJar, SameSite};

use crate::{state::AppState, error::AppResult};
use crate::api::auth::extractor::{AuthUser, OptionalAuthUser};
use super::{dto::*, service::XxxService};

// =====================================================================
// ê³µí†µ í—¬í¼ (ê¶Œì¥: api/common/http.rsë¡œ ë¶„ë¦¬)
// =====================================================================

fn extract_client_ip(headers: &HeaderMap) -> String {
    headers.get("x-forwarded-for")
        .and_then(|v| v.to_str().ok())
        .and_then(|s| s.split(',').next())
        .map(|s| s.trim().to_string())
        .filter(|s| !s.is_empty())
        .or_else(|| headers.get("x-real-ip")
            .and_then(|v| v.to_str().ok())
            .map(|s| s.trim().to_string()))
        .unwrap_or_else(|| "127.0.0.1".to_string())
}

fn extract_user_agent(headers: &HeaderMap) -> Option<String> {
    headers.get("user-agent")
        .and_then(|v| v.to_str().ok())
        .map(|s| s.to_string())
}

// =====================================================================
// 1. ê³µê°œ ëª©ë¡ (ì¸ì¦ ë¶ˆí•„ìš”)
// =====================================================================
#[utoipa::path(
    get,
    path = "/xxx",
    params(
        ("page" = Option<u32>, Query, description = "Page number"),
        ("per_page" = Option<u32>, Query, description = "Items per page")
    ),
    responses(
        (status = 200, description = "List", body = XxxListRes),
        (status = 400, description = "Bad Request", body = crate::error::ErrorBody)
    ),
    tag = "xxx"
)]
pub async fn list_xxx(
    State(st): State<AppState>,
    Query(req): Query<XxxListReq>,
) -> AppResult<Json<XxxListRes>> {
    let res = XxxService::list(&st, req).await?;
    Ok(Json(res))
}

// =====================================================================
// 2. ìƒì„¸ ì¡°íšŒ (ì„ íƒì  ì¸ì¦)
// =====================================================================
#[utoipa::path(
    get,
    path = "/xxx/{id}",
    params(("id" = i64, Path, description = "Resource ID")),
    responses(
        (status = 200, description = "Detail", body = XxxDetailRes),
        (status = 404, description = "Not Found", body = crate::error::ErrorBody)
    ),
    tag = "xxx"
)]
pub async fn get_xxx_detail(
    State(st): State<AppState>,
    OptionalAuthUser(auth): OptionalAuthUser,  // ë¹„ë¡œê·¸ì¸ í—ˆìš©
    Path(id): Path<i64>,
) -> AppResult<Json<XxxDetailRes>> {
    let res = XxxService::get_detail(&st, id, auth).await?;
    Ok(Json(res))
}

// =====================================================================
// 3. ìƒì„±/ìˆ˜ì • (ì¸ì¦ í•„ìˆ˜)
// =====================================================================
#[utoipa::path(
    post,
    path = "/xxx",
    request_body = XxxCreateReq,
    responses(
        (status = 201, description = "Created", body = XxxRes),
        (status = 401, description = "Unauthorized", body = crate::error::ErrorBody)
    ),
    security(("bearerAuth" = [])),
    tag = "xxx"
)]
pub async fn create_xxx(
    State(st): State<AppState>,
    AuthUser(auth): AuthUser,  // êµ¬ì¡° ë¶„í•´
    Json(req): Json<XxxCreateReq>,
) -> AppResult<Json<XxxRes>> {
    let res = XxxService::create(&st, auth.sub, req).await?;
    Ok(Json(res))
}

// =====================================================================
// 4. ì¿ í‚¤ ë°˜í™˜ í•„ìš” ì‹œ
// =====================================================================
pub async fn login(
    State(st): State<AppState>,
    headers: HeaderMap,
    jar: CookieJar,
    Json(req): Json<LoginReq>,
) -> AppResult<(CookieJar, Json<LoginRes>)> {
    let ip = extract_client_ip(&headers);
    let ua = extract_user_agent(&headers);

    let (res, token, ttl) = AuthService::login(&st, req, ip, ua).await?;
    let cookie = build_refresh_cookie(&st, token, ttl);

    Ok((jar.add(cookie), Json(res)))
}

// ì¿ í‚¤ ë¹Œë“œ í—¬í¼ (ê¶Œì¥: ê³µí†µ ëª¨ë“ˆ)
fn build_refresh_cookie(st: &AppState, token: String, ttl: i64) -> Cookie<'static> {
    let mut c = Cookie::new(st.cfg.refresh_cookie_name.clone(), token);
    c.set_path("/");
    c.set_http_only(true);
    c.set_secure(st.cfg.refresh_cookie_secure);
    c.set_same_site(match st.cfg.refresh_cookie_samesite_or("Lax") {
        "Strict" => SameSite::Strict,
        "None" => SameSite::None,
        _ => SameSite::Lax,
    });
    c.set_expires(cookie::time::OffsetDateTime::now_utc() + cookie::time::Duration::seconds(ttl));
    if let Some(domain) = &st.cfg.refresh_cookie_domain {
        c.set_domain(domain.clone());
    }
    c
}
```

##### ğŸ”„ ë°ì´í„° íë¦„

```
[HTTP Request]
      â†“
[Extractor] â†’ State, Query, Path, Json, AuthUser ì¶”ì¶œ
      â†“
[Handler] â†’ ì–‡ì€ ë ˆì´ì–´ (Service í˜¸ì¶œë§Œ)
      â†“
[Service] â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ê²€ì¦, TX
      â†“
[Handler] â†’ AppResult<Json<Res>> ë˜ëŠ” (CookieJar, Json<Res>)
      â†“
[HTTP Response] â†’ 200/201/4xx/5xx + JSON Body
```

---

#### 7.7.1-5. router.rs
> **Claude ì½”ë“œ ë¶„ì„ ê¸°ë°˜** (2025-01-22)

##### ğŸ“ íŒŒì¼ ê°œìš”

| íŒŒì¼ | ë¼ì¸ìˆ˜ | í•¨ìˆ˜ëª… | ì¡°ë¦½ ë°©ì‹ | ì£¼ìš” ê²½ë¡œ |
|------|--------|--------|----------|----------|
| [auth/router.rs](src/api/auth/router.rs) | 16 | `auth_router()` | nest | /login, /logout, /refresh ë“± |
| [user/router.rs](src/api/user/router.rs) | 15 | `user_router()` | merge âš ï¸ | /users, /users/me ë“± |
| [video/router.rs](src/api/video/router.rs) | 16 | `router()` | nest | /, /{id}, /{id}/progress |
| [study/router.rs](src/api/study/router.rs) | 17 | `router()` | nest | /, /tasks/{id}/answer ë“± |
| [lesson/router.rs](src/api/lesson/router.rs) | 17 | `router()` | nest | /, /{id}, /{id}/progress |

##### 1ï¸âƒ£ Auth Domain ([auth/router.rs](src/api/auth/router.rs))

**ì—­í• **: ì¸ì¦ ê´€ë ¨ ë¼ìš°íŠ¸ (ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, í† í° ê°±ì‹ , ê³„ì • ì°¾ê¸°/ë³µêµ¬)

```rust
use axum::{routing::post, Router};
use crate::state::AppState;
use super::handler;

pub fn auth_router() -> Router<AppState> {
    Router::new()
        // ì„¸ì…˜/í† í° ê´€ë ¨
        .route("/login", post(handler::login))
        .route("/logout", post(handler::logout))
        .route("/logout/all", post(handler::logout_all)) // ëª¨ë“  ê¸°ê¸° ë¡œê·¸ì•„ì›ƒ
        .route("/refresh", post(handler::refresh))

        // ê³„ì • ì°¾ê¸°/ë³µêµ¬
        .route("/find-id", post(handler::find_id))
        .route("/reset-pw", post(handler::reset_password))
}
```

**íŠ¹ì§•**:
- ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ê°€ **POST** (ì•¡ì…˜ ì¤‘ì‹¬ API)
- ìƒìœ„ì—ì„œ `nest("/auth", auth_router())` ë°©ì‹ìœ¼ë¡œ ì¡°ë¦½
- í•¨ìˆ˜ëª…ì— ë„ë©”ì¸ ì ‘ë‘ì‚¬ í¬í•¨ (`auth_router`)

##### 2ï¸âƒ£ User Domain ([user/router.rs](src/api/user/router.rs))

**ì—­í• **: ì‚¬ìš©ì ê´€ë ¨ ë¼ìš°íŠ¸ (íšŒì›ê°€ì…, í”„ë¡œí•„, ì„¤ì •)

```rust
use super::handler::{get_me, get_settings, signup, update_me, update_settings};
use crate::state::AppState;
use axum::{
    routing::{get, post},
    Router,
};

/// ì„œë¸Œ ë¼ìš°í„°ëŠ” Router<AppState> ë°˜í™˜(í”„ë¡œì íŠ¸ ê·œì¹™)
pub fn user_router() -> Router<AppState> {
    Router::new()
        .route("/users", post(signup))
        .route("/users/me", get(get_me).put(update_me).post(update_me))
        .route("/users/me/settings", get(get_settings).post(update_settings))
}
```

**íŠ¹ì§•**:
- âš ï¸ **ì ˆëŒ€ ê²½ë¡œ** ì‚¬ìš© (`/users`, `/users/me`)
- ìƒìœ„ì—ì„œ `merge(user_router())` ë°©ì‹ìœ¼ë¡œ ì¡°ë¦½ (nest ì•„ë‹˜)
- í•œ ê²½ë¡œì— ì—¬ëŸ¬ ë©”ì„œë“œ: `.get(get_me).put(update_me).post(update_me)`
- í•¨ìˆ˜ëª…ì— ë„ë©”ì¸ ì ‘ë‘ì‚¬ í¬í•¨ (`user_router`)

##### 3ï¸âƒ£ Video Domain ([video/router.rs](src/api/video/router.rs))

**ì—­í• **: ë¹„ë””ì˜¤ ê´€ë ¨ ë¼ìš°íŠ¸ (ëª©ë¡, ìƒì„¸, ì§„ë„)

```rust
use axum::{routing::get, Router};
use crate::state::AppState;
use super::handler;

pub fn router() -> Router<AppState> {
    Router::new()
        .route("/", get(handler::list_videos))
        .route("/{id}", get(handler::get_video_detail))
        .route(
            "/{id}/progress",
            get(handler::get_video_progress).post(handler::update_video_progress),
        )
}
```

**íŠ¹ì§•**:
- **ìƒëŒ€ ê²½ë¡œ** ì‚¬ìš© (`/`, `/{id}`)
- ìƒìœ„ì—ì„œ `nest("/videos", router())` ë°©ì‹ìœ¼ë¡œ ì¡°ë¦½
- ì§„ë„: GET (ì¡°íšŒ) + POST (ì—…ë°ì´íŠ¸) ë™ì¼ ê²½ë¡œ
- í•¨ìˆ˜ëª… ë‹¨ìˆœ (`router`)

##### 4ï¸âƒ£ Study Domain ([study/router.rs](src/api/study/router.rs))

**ì—­í• **: í•™ìŠµ ê´€ë ¨ ë¼ìš°íŠ¸ (ëª©ë¡, ë¬¸ì œ, ì œì¶œ, ìƒíƒœ, í•´ì„¤)

```rust
use axum::{
    routing::{get, post},
    Router,
};
use crate::state::AppState;
use super::handler;

pub fn router() -> Router<AppState> {
    Router::new()
        .route("/", get(handler::list_studies))
        .route("/tasks/{id}", get(handler::get_study_task))
        .route("/tasks/{id}/answer", post(handler::submit_answer))
        .route("/tasks/{id}/status", get(handler::get_task_status))
        .route("/tasks/{id}/explain", get(handler::get_task_explain))
}
```

**íŠ¹ì§•**:
- **ì¤‘ì²© ë¦¬ì†ŒìŠ¤** íŒ¨í„´: `/studies` â†’ `/tasks/{id}` â†’ `/answer`, `/status`, `/explain`
- ì œì¶œë§Œ POST, ë‚˜ë¨¸ì§€ëŠ” GET
- ìƒìœ„ì—ì„œ `nest("/studies", router())` ë°©ì‹ìœ¼ë¡œ ì¡°ë¦½

##### 5ï¸âƒ£ Lesson Domain ([lesson/router.rs](src/api/lesson/router.rs))

**ì—­í• **: ë ˆìŠ¨ ê´€ë ¨ ë¼ìš°íŠ¸ (ëª©ë¡, ìƒì„¸, ì•„ì´í…œ, ì§„ë„)

```rust
use axum::{routing::get, Router};
use crate::state::AppState;
use super::handler;

pub fn router() -> Router<AppState> {
    Router::new()
        .route("/", get(handler::list_lessons))
        .route("/{id}", get(handler::get_lesson_detail))
        .route("/{id}/items", get(handler::get_lesson_items))
        .route(
            "/{id}/progress",
            get(handler::get_lesson_progress).post(handler::update_lesson_progress),
        )
}
```

**íŠ¹ì§•**:
- Videoì™€ ë™ì¼í•œ **progress íŒ¨í„´** (GET + POST)
- ì¶”ê°€ ì„œë¸Œ ë¦¬ì†ŒìŠ¤: `/{id}/items`
- ìƒìœ„ì—ì„œ `nest("/lessons", router())` ë°©ì‹ìœ¼ë¡œ ì¡°ë¦½

##### ğŸ“Š ê³µí†µ íŒ¨í„´ ìš”ì•½

| íŒ¨í„´ | ì„¤ëª… | ì‚¬ìš©ì²˜ |
|------|------|--------|
| **Router<AppState> ë°˜í™˜** | ì„œë¸Œ ë¼ìš°í„° í‘œì¤€ ì‹œê·¸ë‹ˆì²˜ | ëª¨ë“  router |
| **ìƒëŒ€ ê²½ë¡œ + nest** | í”„ë¦¬í”½ìŠ¤ëŠ” ìƒìœ„ì—ì„œ ê´€ë¦¬ | auth, video, study, lesson |
| **ì ˆëŒ€ ê²½ë¡œ + merge** | ë¼ìš°í„°ê°€ ì „ì²´ ê²½ë¡œ ì •ì˜ | user âš ï¸ |
| **RESTful êµ¬ì¡°** | `/`, `/{id}`, `/{id}/sub` | video, lesson |
| **ë‹¤ì¤‘ ë©”ì„œë“œ ì²´ì´ë‹** | `.get(...).post(...)` | progress, me, settings |
| **POST ì „ìš©** | ì•¡ì…˜ ì¤‘ì‹¬ API | auth |
| **ì¤‘ì²© ë¦¬ì†ŒìŠ¤** | `/parent/child/{id}/action` | study |

##### ğŸ“‹ ë¼ìš°íŠ¸ ì „ì²´ ë§¤í•‘

| ë„ë©”ì¸ | ìµœì¢… ê²½ë¡œ | Method | Handler |
|--------|----------|--------|---------|
| **Auth** | `/auth/login` | POST | login |
| | `/auth/logout` | POST | logout |
| | `/auth/logout/all` | POST | logout_all |
| | `/auth/refresh` | POST | refresh |
| | `/auth/find-id` | POST | find_id |
| | `/auth/reset-pw` | POST | reset_password |
| **User** | `/users` | POST | signup |
| | `/users/me` | GET/PUT/POST | get_me, update_me |
| | `/users/me/settings` | GET/POST | get_settings, update_settings |
| **Video** | `/videos` | GET | list_videos |
| | `/videos/{id}` | GET | get_video_detail |
| | `/videos/{id}/progress` | GET/POST | get/update_video_progress |
| **Study** | `/studies` | GET | list_studies |
| | `/studies/tasks/{id}` | GET | get_study_task |
| | `/studies/tasks/{id}/answer` | POST | submit_answer |
| | `/studies/tasks/{id}/status` | GET | get_task_status |
| | `/studies/tasks/{id}/explain` | GET | get_task_explain |
| **Lesson** | `/lessons` | GET | list_lessons |
| | `/lessons/{id}` | GET | get_lesson_detail |
| | `/lessons/{id}/items` | GET | get_lesson_items |
| | `/lessons/{id}/progress` | GET/POST | get/update_lesson_progress |

##### âš ï¸ í˜„ì¬ ë¶ˆì¼ì¹˜/ê°œì„  í•„ìš” ì‚¬í•­

| ì´ìŠˆ | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ í‘œì¤€ |
|------|----------|----------|
| **í•¨ìˆ˜ëª… ë¶ˆì¼ì¹˜** | `auth_router()`, `user_router()` vs `router()` | í•˜ë‚˜ë¡œ í†µì¼ |
| **ì¡°ë¦½ ë°©ì‹ ë¶ˆì¼ì¹˜** | userë§Œ merge + ì ˆëŒ€ê²½ë¡œ | nest + ìƒëŒ€ê²½ë¡œ í†µì¼ |
| **PUT vs POST** | update_meì— PUTê³¼ POST ë‘˜ ë‹¤ | PUT ë˜ëŠ” PATCH í•˜ë‚˜ë§Œ |

##### ğŸ“‹ í‘œì¤€ í…œí”Œë¦¿

```rust
// router.rs (AMK í‘œì¤€ ê³¨ê²©)
use axum::{
    routing::{get, post},
    Router,
};
use crate::state::AppState;
use super::handler;

/// ì„œë¸Œ ë¼ìš°í„°ëŠ” Router<AppState> ë°˜í™˜
/// ìƒìœ„ì—ì„œ nest("/xxx", router())ë¡œ ì¡°ë¦½
pub fn router() -> Router<AppState> {
    Router::new()
        // ëª©ë¡
        .route("/", get(handler::list))

        // ìƒì„¸
        .route("/{id}", get(handler::get_detail))

        // ì„œë¸Œ ë¦¬ì†ŒìŠ¤ (ì¡°íšŒ + ìˆ˜ì •)
        .route(
            "/{id}/progress",
            get(handler::get_progress).post(handler::update_progress),
        )

        // ì•¡ì…˜ (POST only)
        .route("/{id}/action", post(handler::do_action))
}
```

##### ğŸ”„ ìƒìœ„ ì¡°ë¦½ ì˜ˆì‹œ

```rust
// api/mod.rs ë˜ëŠ” main.rs
use axum::Router;
use crate::state::AppState;

pub fn api_router(state: AppState) -> Router {
    Router::new()
        // nest ë°©ì‹ (ê¶Œì¥) - ìƒëŒ€ ê²½ë¡œ ë¼ìš°í„°
        .nest("/auth", auth::router::auth_router())
        .nest("/videos", video::router::router())
        .nest("/studies", study::router::router())
        .nest("/lessons", lesson::router::router())

        // merge ë°©ì‹ - ì ˆëŒ€ ê²½ë¡œ ë¼ìš°í„° (userë§Œ í•´ë‹¹)
        .merge(user::router::user_router())

        // ì „ì—­ ìƒíƒœ ì£¼ì… (ê°€ì¥ ë§ˆì§€ë§‰)
        .with_state(state)
}
```

---

#### 7.7.1-6. ê¸°íƒ€ íŒŒì¼ë“¤ (Auth ìœ í‹¸ë¦¬í‹°)
> **Claude ì½”ë“œ ë¶„ì„ ê¸°ë°˜** (2025-01-22)

##### ğŸ“ íŒŒì¼ ê°œìš”

| íŒŒì¼ | ë¼ì¸ìˆ˜ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜/íƒ€ì… |
|------|--------|------|---------------|
| [extractor.rs](src/api/auth/extractor.rs) | 85 | ì¸ì¦ Extractor | `AuthUser`, `OptionalAuthUser` |
| [jwt.rs](src/api/auth/jwt.rs) | 62 | JWT í† í° ê´€ë¦¬ | `Claims`, `create_token`, `decode_token` |
| [password.rs](src/api/auth/password.rs) | 37 | ë¹„ë°€ë²ˆí˜¸ í•´ì‹± | `hash_password`, `verify_password` |
| [token_utils.rs](src/api/auth/token_utils.rs) | 44 | Refresh í† í° ìœ í‹¸ | `parse_refresh_token_bytes`, `generate_refresh_cookie_value` |

##### 1ï¸âƒ£ extractor.rs - ì¸ì¦ Extractor

**ì—­í• **: Handlerì—ì„œ ì¸ì¦ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ `AuthUser`, `OptionalAuthUser` Extractor ì œê³µ

```rust
use axum::extract::{FromRef, FromRequestParts};
use axum::http::{header::AUTHORIZATION, request::Parts};
use crate::api::auth::jwt::{self, Claims};
use crate::error::AppError;
use crate::state::AppState;

// ì¸ì¦ í•„ìˆ˜ Extractor
pub struct AuthUser(pub Claims);

// ì¸ì¦ ì„ íƒ Extractor (ë¹„ë¡œê·¸ì¸ í—ˆìš©)
pub struct OptionalAuthUser(pub Option<AuthUser>);

impl<S> FromRequestParts<S> for AuthUser
where
    S: Send + Sync,
    AppState: FromRef<S>,  // Stateì—ì„œ AppState ì¶”ì¶œ ê°€ëŠ¥í•´ì•¼ í•¨
{
    type Rejection = AppError;

    fn from_request_parts(
        parts: &mut Parts,
        state: &S,
    ) -> impl core::future::Future<Output = Result<Self, Self::Rejection>> + Send {
        // AppStateì—ì„œ JWT secret ì¶”ì¶œ
        let app_state = AppState::from_ref(state);
        let secret = app_state.cfg.jwt_secret.clone();
        let auth_header = parts.headers.get(AUTHORIZATION).cloned();

        async move {
            // Authorization: Bearer <token> íŒŒì‹±
            let token = auth_header
                .and_then(|h| h.to_str().ok().map(|s| s.to_string()))
                .and_then(|s| s.strip_prefix("Bearer ").map(|t| t.to_string()))
                .ok_or_else(|| AppError::Unauthorized("Missing or invalid Authorization header".into()))?;

            // JWT ê²€ì¦
            let claims = jwt::decode_token(&token, &secret)
                .map_err(|_| AppError::Unauthorized("Invalid token".into()))?;

            Ok(AuthUser(claims))
        }
    }
}

// OptionalAuthUser: í—¤ë” ì—†ìœ¼ë©´ Ok(None), ìˆìœ¼ë©´ ê²€ì¦
impl<S> FromRequestParts<S> for OptionalAuthUser
where
    S: Send + Sync,
    AppState: FromRef<S>,
{
    type Rejection = AppError;

    fn from_request_parts(parts: &mut Parts, state: &S) -> impl core::future::Future<Output = Result<Self, Self::Rejection>> + Send {
        let app_state = AppState::from_ref(state);
        let secret = app_state.cfg.jwt_secret.clone();
        let auth_header = parts.headers.get(AUTHORIZATION).cloned();

        async move {
            let Some(header_value) = auth_header else {
                return Ok(OptionalAuthUser(None));  // í—¤ë” ì—†ìœ¼ë©´ None
            };
            // í—¤ë” ìˆìœ¼ë©´ ê²€ì¦ ì§„í–‰...
            let claims = jwt::decode_token(token, &secret)?;
            Ok(OptionalAuthUser(Some(AuthUser(claims))))
        }
    }
}
```

**íŠ¹ì§•**:
- `FromRef<S>` íŒ¨í„´ìœ¼ë¡œ Stateì—ì„œ AppState ì¶”ì¶œ
- Handlerì—ì„œ ì¸ì¦ ì½”ë“œ ì™„ì „ ì œê±° ê°€ëŠ¥
- `OptionalAuthUser`: ê³µê°œ API + ì„ íƒì  ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ì— ì í•©

##### 2ï¸âƒ£ jwt.rs - JWT í† í° ê´€ë¦¬

**ì—­í• **: Access Token ìƒì„±/ê²€ì¦, Claims êµ¬ì¡°ì²´ ì •ì˜

```rust
use jsonwebtoken::{decode, encode, DecodingKey, EncodingKey, Header, Validation};
use serde::{Deserialize, Serialize};
use time::{format_description::well_known::Rfc3339, Duration, OffsetDateTime};
use crate::api::auth::dto::AccessTokenRes;
use crate::error::{AppError, AppResult};

#[derive(Debug, Serialize, Deserialize)]
pub struct Claims {
    pub sub: i64,           // User ID
    pub session_id: String, // Session ID (ë¡œê·¸ì•„ì›ƒ ì‹œ íê¸°ìš©)
    pub exp: i64,           // Expiration time (Unix timestamp)
    pub iat: i64,           // Issued at
    pub iss: String,        // Issuer ("amk" ê³ ì •)
}

pub fn create_token(
    user_id: i64,
    session_id: &str,
    ttl_minutes: i64,
    secret: &str,
) -> AppResult<AccessTokenRes> {
    let now = OffsetDateTime::now_utc();
    let duration = Duration::minutes(ttl_minutes);
    let expires_in_dt = now + duration;

    let claims = Claims {
        sub: user_id,
        session_id: session_id.to_string(),
        exp: expires_in_dt.unix_timestamp(),
        iat: now.unix_timestamp(),
        iss: "amk".to_string(),
    };

    let token = encode(
        &Header::default(),
        &claims,
        &EncodingKey::from_secret(secret.as_bytes()),
    )?;

    // ISO 8601 í¬ë§· (í”„ë¡ íŠ¸ì—”ë“œ í¸ì˜ìš©)
    let expires_at_str = expires_in_dt.format(&Rfc3339)?;

    Ok(AccessTokenRes {
        access_token: token,
        token_type: "Bearer".to_string(),
        expires_in: ttl_minutes * 60,  // ì´ˆ ë‹¨ìœ„
        expires_at: expires_at_str,
    })
}

pub fn decode_token(token: &str, secret: &str) -> Result<Claims, jsonwebtoken::errors::Error> {
    decode(
        token,
        &DecodingKey::from_secret(secret.as_bytes()),
        &Validation::default(),
    )
    .map(|data| data.claims)
}
```

**íŠ¹ì§•**:
- `session_id` í¬í•¨ â†’ ì„¸ì…˜ ê¸°ë°˜ íê¸°(ë¡œê·¸ì•„ì›ƒ) ì§€ì›
- `iss: "amk"` ê³ ì • ë°œê¸‰ì
- `AccessTokenRes`: `token_type`, `expires_in`, `expires_at` í¬í•¨ (OAuth 2.0 ìŠ¤íƒ€ì¼)

##### 3ï¸âƒ£ password.rs - ë¹„ë°€ë²ˆí˜¸ í•´ì‹±

**ì—­í• **: Argon2id ê¸°ë°˜ ë¹„ë°€ë²ˆí˜¸ í•´ì‹±/ê²€ì¦

```rust
use argon2::{
    password_hash::{rand_core::OsRng, SaltString},
    Algorithm, Argon2, Params, PasswordHash, PasswordHasher, PasswordVerifier, Version,
};
use crate::error::{AppError, AppResult};

/// ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
pub fn hash_password(password: &str) -> AppResult<String> {
    let salt = SaltString::generate(&mut OsRng);

    // Argon2id ì„¤ì • (ë©”ëª¨ë¦¬ 19MB, 2 iterations, 1 parallelism)
    let params = Params::new(19_456, 2, 1, None)
        .map_err(|e| AppError::Internal(format!("Failed to create Argon2 params: {}", e)))?;

    let argon2 = Argon2::new(Algorithm::Argon2id, Version::V0x13, params);

    let password_hash = argon2
        .hash_password(password.as_bytes(), &salt)
        .map_err(|e| AppError::Internal(format!("Failed to hash password: {}", e)))?
        .to_string();

    Ok(password_hash)
}

/// ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
#[allow(dead_code)]
pub fn verify_password(password: &str, password_hash: &str) -> AppResult<bool> {
    let parsed_hash = PasswordHash::new(password_hash)
        .map_err(|_| AppError::Internal("Failed to parse password hash".into()))?;

    let valid = Argon2::default()
        .verify_password(password.as_bytes(), &parsed_hash)
        .is_ok();

    Ok(valid)
}
```

**íŠ¹ì§•**:
- **Argon2id** ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš© (í˜„ì¬ ê¶Œì¥ í‘œì¤€)
- íŒŒë¼ë¯¸í„° ì¤‘ì•™ ê´€ë¦¬ (ë©”ëª¨ë¦¬ 19MB, 2 iterations, 1 parallelism)
- `OsRng`ë¡œ ë³´ì•ˆ ë‚œìˆ˜ Salt ìƒì„±

##### 4ï¸âƒ£ token_utils.rs - Refresh í† í° ìœ í‹¸

**ì—­í• **: Refresh í† í° ìƒì„±/íŒŒì‹±

```rust
use base64::engine::general_purpose::{STANDARD, URL_SAFE, URL_SAFE_NO_PAD};
use base64::Engine as _;
use percent_encoding::percent_decode_str;
use rand::RngCore;
use uuid::Uuid;
use crate::error::AppError;

/// Refresh í† í° íŒŒì‹± (ë‹¤ì–‘í•œ í¬ë§· í—ˆìš©)
pub fn parse_refresh_token_bytes(s: &str) -> Result<Vec<u8>, AppError> {
    // 0) URL ë””ì½”ë”©
    let decoded = percent_decode_str(s)
        .decode_utf8()
        .map_err(|_| AppError::Unauthorized("Invalid refresh token format".into()))?;
    let ss = decoded.as_ref();

    // 1) UUID í—ˆìš©
    if let Ok(u) = Uuid::parse_str(ss) {
        return Ok(u.as_bytes().to_vec());
    }
    // 2) base64url no-pad
    if let Ok(b) = URL_SAFE_NO_PAD.decode(ss) {
        return Ok(b);
    }
    // 3) base64url with pad
    if let Ok(b) = URL_SAFE.decode(ss) {
        return Ok(b);
    }
    // 4) ì¼ë°˜ base64
    if let Ok(b) = STANDARD.decode(ss) {
        return Ok(b);
    }

    Err(AppError::Unauthorized("Invalid refresh token format".into()))
}

/// Refresh í† í° ìƒì„± (ëœë¤ 32ë°”ì´íŠ¸)
pub fn generate_refresh_cookie_value() -> (String, [u8; 32]) {
    let mut raw = [0u8; 32];
    rand::thread_rng().fill_bytes(&mut raw);
    let cookie_val = URL_SAFE_NO_PAD.encode(raw);
    (cookie_val, raw)  // (ì¿ í‚¤ê°’, raw ë°”ì´íŠ¸)
}
```

**íŠ¹ì§•**:
- **Opaque í† í°**: ëœë¤ 32ë°”ì´íŠ¸ â†’ base64url ì¸ì½”ë”©
- ë‹¤ì–‘í•œ í¬ë§· í—ˆìš© (UUID, base64url, base64) - ë§ˆì´ê·¸ë ˆì´ì…˜ í˜¸í™˜ì„±
- Raw ë°”ì´íŠ¸ ë°˜í™˜ â†’ SHA256 í•´ì‹œ í›„ DB ì €ì¥ ê°€ëŠ¥

##### ğŸ“Š ê³µí†µ íŒ¨í„´ ìš”ì•½

| íŒ¨í„´ | íŒŒì¼ | ì„¤ëª… |
|------|------|------|
| **ì¤‘ì•™ ì§‘ì¤‘í™”** | ëª¨ë‘ | ì¸ì¦/ë³´ì•ˆ ë¡œì§ì„ ìœ í‹¸ë¡œ ë¶„ë¦¬, Serviceì—ì„œ ì§ì ‘ êµ¬í˜„ ê¸ˆì§€ |
| **FromRef íŒ¨í„´** | extractor.rs | Stateì—ì„œ AppState ì¶”ì¶œí•˜ì—¬ config ì ‘ê·¼ |
| **Opaque Token** | token_utils.rs | RefreshëŠ” ëœë¤ ë°”ì´íŠ¸, AccessëŠ” JWT |
| **íŒŒë¼ë¯¸í„° ê³ ì •** | password.rs | Argon2 ì„¤ì •ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬ |
| **Claims í™•ì¥** | jwt.rs | session_id í¬í•¨ìœ¼ë¡œ ì„¸ì…˜ íê¸° ì§€ì› |

##### âš ï¸ í˜„ì¬ ë¶ˆì¼ì¹˜/ê°œì„  í•„ìš” ì‚¬í•­

| ì´ìŠˆ | í˜„ì¬ ìƒíƒœ | ê¶Œì¥ í‘œì¤€ |
|------|----------|----------|
| **JWT Validation** | `Validation::default()` | ì•Œê³ ë¦¬ì¦˜/issuer ëª…ì‹œì  ê²€ì¦ |
| **verify_password** | `Argon2::default()` | hash_passwordì™€ ë™ì¼ íŒŒë¼ë¯¸í„° ì‚¬ìš© |
| **Refresh í† í° ìŠ¤í™** | ë‹¤ì–‘í•œ í¬ë§· í—ˆìš© | ë‹¨ì¼ í¬ë§· (opaque + hash) í†µì¼ |

##### ğŸ“‹ Auth ìœ í‹¸ë¦¬í‹° ì‚¬ìš© íë¦„

```
[ë¡œê·¸ì¸ ìš”ì²­]
      â†“
[password.rs] â†’ hash_password() ë¹„êµ ë˜ëŠ” verify_password()
      â†“
[jwt.rs] â†’ create_token() â†’ AccessTokenRes
      â†“
[token_utils.rs] â†’ generate_refresh_cookie_value() â†’ (ì¿ í‚¤, raw)
      â†“
[DB/Redis] â†’ SHA256(raw) ì €ì¥
      â†“
[HTTP Response] â†’ Access Token (Body) + Refresh Token (Cookie)

---

[API ìš”ì²­ with Token]
      â†“
[extractor.rs] â†’ AuthUser ë˜ëŠ” OptionalAuthUser
      â†“
[jwt.rs] â†’ decode_token() â†’ Claims { sub, session_id, ... }
      â†“
[Handler] â†’ Claims.sub (user_id) ì‚¬ìš©
```

---

## 7.7.2 í”„ë¡ íŠ¸ì—”ë“œ íŒ¨í„´ (React/TypeScript)

ë°±ì—”ë“œ ë ˆì´ì–´(`dto.rs`, `repo.rs`, `service.rs`, `handler.rs`)ì™€ 1:1ë¡œ ëŒ€ì‘ë˜ëŠ” **Category-First** ì•„í‚¤í…ì²˜ë¥¼ ë”°ë¥¸ë‹¤.

**ë ˆì´ì–´ ëŒ€ì‘í‘œ:**

| ë°±ì—”ë“œ (Rust/Axum) | í”„ë¡ íŠ¸ì—”ë“œ (React/TS) | ì—­í•  |
|-------------------|----------------------|------|
| `dto.rs` | `types.ts` | ìš”ì²­/ì‘ë‹µ íƒ€ì… ì •ì˜ |
| `repo.rs` | `*_api.ts` | API í˜¸ì¶œ í•¨ìˆ˜ |
| `service.rs` | `hook/*.ts` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (TanStack Query) |
| `handler.rs` | `page/*.tsx` | UI ì¡°ë¦½ ë° ë Œë”ë§ |

**ê·œì¹™:**
1. **Backend Parity:** DTOëŠ” `snake_case`ë¥¼ ìœ ì§€í•˜ì—¬ ë³€í™˜ ë¹„ìš©ì„ ì—†ì•¤ë‹¤
2. **Auth Strategy:** Refresh Tokenì€ HttpOnly Cookie, Access Tokenì€ ë©”ëª¨ë¦¬(Zustand persist)ì— ì €ì¥
3. **Tech Stack:** `Axios` + `TanStack Query` + `Zustand` + `react-hook-form` + `Zod` + `shadcn/ui`

**ë””ë ‰í„°ë¦¬ êµ¬ì¡°:**
```
frontend/src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ client.ts              # Axios í´ë¼ì´ì–¸íŠ¸ + 401 refresh interceptor
â”œâ”€â”€ app/
â”‚   â””â”€â”€ routes.tsx             # React Router ë¼ìš°íŒ… ì •ì˜
â”œâ”€â”€ category/                  # ë„ë©”ì¸ë³„ í´ë”
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ page/              # login_page.tsx, signup_page.tsx ë“±
â”‚   â”‚   â”œâ”€â”€ hook/              # use_login.ts, use_logout.ts ë“±
â”‚   â”‚   â”œâ”€â”€ components/        # logout_button.tsx
â”‚   â”‚   â”œâ”€â”€ types.ts           # Zod schema + íƒ€ì…
â”‚   â”‚   â””â”€â”€ auth_api.ts        # API í•¨ìˆ˜ë“¤
â”‚   â”œâ”€â”€ video/
â”‚   â”‚   â”œâ”€â”€ page/
â”‚   â”‚   â”œâ”€â”€ hook/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â””â”€â”€ video_api.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                    # shadcn/ui ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ layout/
â”‚   â””â”€â”€ shared/
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ use_auth_store.ts      # Zustand + persist (ì „ì—­ ì¸ì¦ ìƒíƒœ)
â””â”€â”€ routes/
    â””â”€â”€ private_route.tsx      # PrivateRoute ê°€ë“œ
```

---

### 7.7.2-1. types.ts (Zod ìŠ¤í‚¤ë§ˆ & íƒ€ì… ì •ì˜)

ë°±ì—”ë“œ `dto.rs`ì™€ 1:1 ëŒ€ì‘. **snake_case í•„ë“œëª… ìœ ì§€**, Zodë¡œ ëŸ°íƒ€ì„ ê²€ì¦ + íƒ€ì… ì¶”ë¡ .

#### íŒŒì¼ ê°œìš”

| íŒŒì¼ | ì£¼ìš” íƒ€ì… | ë¹„ê³  |
|------|----------|------|
| `category/auth/types.ts` | `LoginReq`, `LoginRes`, `SignupReq`, `SignupRes` | ê³µìš© Enum í¬í•¨ (`UserAuth`, `UserGender`) |
| `category/video/types.ts` | `VideoListReq`, `VideoListRes`, `VideoDetail`, `VideoProgressRes` | List/Detail/Progress ë¶„ë¦¬ |
| `category/user/types.ts` | `UserDetail`, `UpdateUserReq`, `SettingsRes` | Authì—ì„œ Enum import |

#### ì½”ë“œ ì˜ˆì‹œ: `category/auth/types.ts`

```typescript
import { z } from "zod";

// ==========================================
// ê³µí†µ Enum
// ==========================================
export const userAuthSchema = z.enum(["HYMN", "admin", "manager", "learner"]);
export type UserAuth = z.infer<typeof userAuthSchema>;

export const userGenderSchema = z.enum(["none", "male", "female", "other"]);
export type UserGender = z.infer<typeof userGenderSchema>;

// ==========================================
// ì•¡ì„¸ìŠ¤ í† í° ì‘ë‹µ (ê³µí†µ)
// ==========================================
export const accessTokenResSchema = z.object({
  access_token: z.string(),
  expires_in: z.number().int(),
});
export type AccessTokenRes = z.infer<typeof accessTokenResSchema>;

// ==========================================
// ë¡œê·¸ì¸
// ==========================================
export const loginReqSchema = z.object({
  email: z.string().email(),
  password: z.string().min(6).max(72),
  device: z.string().optional(),
  browser: z.string().optional(),
});
export type LoginReq = z.infer<typeof loginReqSchema>;

export const loginResSchema = z.object({
  user_id: z.number().int(),
  access: accessTokenResSchema,
  session_id: z.string(),
});
export type LoginRes = z.infer<typeof loginResSchema>;

// ==========================================
// íšŒì›ê°€ì…
// ==========================================
export const signupReqSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8).max(72),
  name: z.string().min(1).max(50),
  nickname: z.string().min(1).max(100),
  terms_service: z.boolean(),
  terms_personal: z.boolean(),
  language: z.string().min(2).max(2),
  country: z.string().min(2).max(50),
  birthday: z.string().date(),  // YYYY-MM-DD
  gender: userGenderSchema,
});
export type SignupReq = z.infer<typeof signupReqSchema>;
```

#### ì½”ë“œ ì˜ˆì‹œ: `category/video/types.ts`

```typescript
import { z } from "zod";

// Request DTO
export const videoListReqSchema = z.object({
  page: z.number().int().min(1).optional(),
  per_page: z.number().int().min(1).max(100).optional(),
  q: z.string().optional(),
  tag: z.string().optional(),
});
export type VideoListReq = z.infer<typeof videoListReqSchema>;

// Response DTO - List Meta (í˜ì´ì§€ë„¤ì´ì…˜)
export const videoListMetaSchema = z.object({
  total_count: z.number().int(),
  total_pages: z.number().int(),
  current_page: z.number().int(),
  per_page: z.number().int(),
});

// Response DTO - List Item
export const videoListItemSchema = z.object({
  video_id: z.number().int(),
  video_idx: z.string(),
  title: z.string().nullable(),        // Option<String> â†’ nullable
  thumbnail_url: z.string().nullable(),
  state: z.string(),
  tags: z.array(z.string()),           // ëª©ë¡ì—ì„œëŠ” ë¬¸ìì—´ ë°°ì—´
  created_at: z.string().datetime(),
});

// Response DTO - List ì „ì²´
export const videoListResSchema = z.object({
  meta: videoListMetaSchema,
  data: z.array(videoListItemSchema),
});
export type VideoListRes = z.infer<typeof videoListResSchema>;

// Response DTO - Progress
export const videoProgressResSchema = z.object({
  video_id: z.number().int(),
  progress_rate: z.number().int(),
  is_completed: z.boolean(),
  last_watched_at: z.string().datetime().nullable(),
});
export type VideoProgressRes = z.infer<typeof videoProgressResSchema>;
```

#### í•µì‹¬ íŒ¨í„´

| íŒ¨í„´ | ì„¤ëª… |
|------|------|
| **snake_case ìœ ì§€** | ë°±ì—”ë“œ DTOì™€ ë™ì¼í•œ í•„ë“œëª… ì‚¬ìš© (camelCase ë³€í™˜ ê¸ˆì§€) |
| **Zod + infer** | ìŠ¤í‚¤ë§ˆ ì •ì˜ â†’ `z.infer<>` ë¡œ íƒ€ì… ì¶”ì¶œ |
| **nullable vs optional** | Rust `Option<T>` â†’ `.nullable()`, ì„ íƒ í•„ë“œ â†’ `.optional()` |
| **Enum ì¤‘ì•™í™”** | ê³µìš© Enumì€ `auth/types.ts`ì— ì •ì˜, ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ import |
| **List í‘œì¤€ êµ¬ì¡°** | `{ meta: { total_count, ... }, data: T[] }` |

---

### 7.7.2-2. *_api.ts (API í•¨ìˆ˜)

ë°±ì—”ë“œ `repo.rs`ì™€ 1:1 ëŒ€ì‘. `request()` ë˜í¼ë¥¼ ì‚¬ìš©í•˜ì—¬ API ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ.

#### íŒŒì¼ ê°œìš”

| íŒŒì¼ | ì£¼ìš” í•¨ìˆ˜ | HTTP ë©”ì„œë“œ |
|------|----------|-------------|
| `category/auth/auth_api.ts` | `login`, `signup`, `logout`, `findId`, `resetPassword` | POST |
| `category/video/video_api.ts` | `getVideoList`, `getVideoDetail`, `getVideoProgress`, `updateVideoProgress` | GET, POST |
| `category/user/user_api.ts` | `getUserMe`, `updateUserMe`, `getUserSettings`, `updateUserSettings` | GET, POST |

#### ì½”ë“œ ì˜ˆì‹œ: `category/auth/auth_api.ts`

```typescript
import { request } from "@/api/client";
import type {
  FindIdReq,
  LoginReq,
  LoginRes,
  ResetPasswordReq,
  SignupReq,
  SignupRes,
} from "@/category/auth/types";

export const login = (data: LoginReq) => {
  return request<LoginRes>("/auth/login", {
    method: "POST",
    data,
  });
};

export const signup = (data: SignupReq) => {
  // RESTful: ì‚¬ìš©ì ìƒì„±ì€ /users
  return request<SignupRes>("/users", {
    method: "POST",
    data,
  });
};

export const findId = (data: FindIdReq) => {
  return request<void>("/auth/find-id", {
    method: "POST",
    data,
  });
};

export const logout = () => {
  // í† í° í—¤ë”ëŠ” client interceptorê°€ ìë™ ì£¼ì…
  return request<void>("/auth/logout", {
    method: "POST",
  });
};
```

#### ì½”ë“œ ì˜ˆì‹œ: `category/video/video_api.ts`

```typescript
import { request } from "@/api/client";
import type {
  VideoDetail,
  VideoListReq,
  VideoListRes,
  VideoProgressUpdateReq,
  VideoProgressRes,
} from "@/category/video/types";

export const getVideoList = (params: VideoListReq = {}) => {
  return request<VideoListRes>("/videos", {
    params,
  });
};

export const getVideoDetail = (id: number) => {
  return request<VideoDetail>(`/videos/${id}`);
};

export const getVideoProgress = (videoId: number) => {
  return request<VideoProgressRes>(`/videos/${videoId}/progress`);
};

export const updateVideoProgress = (videoId: number, data: VideoProgressUpdateReq) => {
  return request<void>(`/videos/${videoId}/progress`, {
    method: "POST",
    data,
  });
};
```

#### ì½”ë“œ ì˜ˆì‹œ: `category/user/user_api.ts`

```typescript
import type {
  SettingsRes,
  SettingsUpdateReq,
  UpdateUserReq,
  UserDetail,
} from "@/category/user/types";
import { request } from "@/api/client";

export const getUserMe = () => {
  return request<UserDetail>("/users/me");
};

export const updateUserMe = (data: UpdateUserReq) => {
  return request<void>("/users/me", {
    method: "POST",
    data,
  });
};

export const getUserSettings = () => {
  return request<SettingsRes>("/users/me/settings");
};

export const updateUserSettings = (data: SettingsUpdateReq) => {
  return request<void>("/users/me/settings", {
    method: "POST",
    data,
  });
};
```

#### í•µì‹¬ íŒ¨í„´

| íŒ¨í„´ | ì„¤ëª… |
|------|------|
| **request<T> ë˜í¼** | ì œë„¤ë¦­ìœ¼ë¡œ ì‘ë‹µ íƒ€ì… ê°•ì œ |
| **GETì€ params** | `{ params: { page, per_page, ... } }` |
| **POSTëŠ” data** | `{ method: "POST", data: { ... } }` |
| **void ë°˜í™˜** | 204 No Content ì‘ë‹µ ì‹œ `request<void>` |
| **ê²½ë¡œ íŒŒë¼ë¯¸í„°** | í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ì‚¬ìš© `` `/videos/${id}` `` |

---

### 7.7.2-3. hook/*.ts (TanStack Query í›…)

ë°±ì—”ë“œ `service.rs`ì™€ 1:1 ëŒ€ì‘. `useMutation` (ë³€ê²½) / `useQuery` (ì¡°íšŒ) íŒ¨í„´.

#### íŒŒì¼ ê°œìš”

| íŒŒì¼ | í›… ì´ë¦„ | Query/Mutation | íŠ¹ì§• |
|------|--------|----------------|------|
| `auth/hook/use_login.ts` | `useLogin` | Mutation | Store ì—…ë°ì´íŠ¸, ë„¤ë¹„ê²Œì´ì…˜ |
| `auth/hook/use_logout.ts` | `useLogout` | Mutation | Store í´ë¦¬ì–´ |
| `video/hook/use_video_list.ts` | `useVideoList` | Query | staleTime 5ë¶„ |
| `video/hook/use_video_detail.ts` | `useVideoDetail` | Query | videoId ê¸°ë°˜ |

#### ì½”ë“œ ì˜ˆì‹œ: `category/auth/hook/use_login.ts` (Mutation)

```typescript
import { useMutation } from "@tanstack/react-query";
import { useNavigate } from "react-router-dom";
import { toast } from "sonner";

import { ApiError } from "@/api/client";
import type { LoginReq } from "@/category/auth/types";
import { useAuthStore } from "@/hooks/use_auth_store";

import { login } from "../auth_api";

// ì—ëŸ¬ ì½”ë“œë³„ ë©”ì‹œì§€ ë§¤í•‘
const statusMessageMap: Record<number, string> = {
  400: "ì…ë ¥ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.",
  401: "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
  403: "ì ‘ê·¼ì´ ì°¨ë‹¨ëœ ê³„ì •ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.",
  429: "ë„ˆë¬´ ë§ì€ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
  500: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
};

const getErrorMessage = (error: unknown) => {
  if (error instanceof ApiError) {
    return statusMessageMap[error.status] ?? error.message;
  }
  if (error instanceof Error && error.message) {
    return error.message;
  }
  return "ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
};

export const useLogin = () => {
  const navigate = useNavigate();

  return useMutation({
    mutationFn: (data: LoginReq) => login(data),
    onSuccess: (data) => {
      useAuthStore.getState().login(data);   // Store ì—…ë°ì´íŠ¸
      toast.success("ë¡œê·¸ì¸ ì„±ê³µ!");
      navigate("/");                         // í™ˆìœ¼ë¡œ ì´ë™
    },
    onError: (error) => {
      toast.error(getErrorMessage(error));
    },
  });
};
```

#### ì½”ë“œ ì˜ˆì‹œ: `category/video/hook/use_video_list.ts` (Query)

```typescript
import { useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { toast } from "sonner";

import { ApiError } from "@/api/client";
import type { VideoListReq } from "@/category/video/types";

import { getVideoList } from "../video_api";

const getErrorMessage = (error: unknown) => {
  if (error instanceof ApiError) {
    return error.message;
  }
  if (error instanceof Error && error.message) {
    return error.message;
  }
  return "ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
};

export const useVideoList = (params: VideoListReq) => {
  const query = useQuery({
    queryKey: ["videos", params],    // ìºì‹œ í‚¤: ["videos", { page, per_page, ... }]
    queryFn: () => getVideoList(params),
    staleTime: 1000 * 60 * 5,        // 5ë¶„ê°„ fresh ìœ ì§€
  });

  useEffect(() => {
    if (query.isError) {
      toast.error(getErrorMessage(query.error));
    }
  }, [query.error, query.isError]);

  return query;
};
```

#### í•µì‹¬ íŒ¨í„´

| íŒ¨í„´ | ì„¤ëª… |
|------|------|
| **Query Key ê·œì¹™** | `["ë„ë©”ì¸", params]` í˜•íƒœ (ex: `["videos", { page: 1 }]`) |
| **staleTime** | ë°ì´í„° fresh ìœ ì§€ ì‹œê°„ (ê¸°ë³¸ 5ë¶„) |
| **onSuccess/onError** | Mutation ì„±ê³µ/ì‹¤íŒ¨ ì‹œ ë¶€ìˆ˜ íš¨ê³¼ ì²˜ë¦¬ |
| **Store ì—°ë™** | `useAuthStore.getState()` ë¡œ Zustand ì•¡ì…˜ í˜¸ì¶œ |
| **ì—ëŸ¬ ë©”ì‹œì§€ ë§¤í•‘** | HTTP ìƒíƒœ ì½”ë“œë³„ ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ |
| **toast ì•Œë¦¼** | `sonner` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ í† ìŠ¤íŠ¸ ì•Œë¦¼ |

---

### 7.7.2-4. page/*.tsx (í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸)

ë°±ì—”ë“œ `handler.rs`ì™€ 1:1 ëŒ€ì‘. **ì¡°ë¦½(Composition)ë§Œ ë‹´ë‹¹**, ë¡œì§ì€ í›…ì— ìœ„ì„.

#### íŒŒì¼ ê°œìš”

| íŒŒì¼ | ì»´í¬ë„ŒíŠ¸ | ì‚¬ìš© í›… | íŠ¹ì§• |
|------|---------|--------|------|
| `auth/page/login_page.tsx` | `LoginPage` | `useLogin`, `useForm` | RHF + Zod + shadcn |
| `video/page/video_list_page.tsx` | `VideoListPage` | `useVideoList` | ëª©ë¡ ë Œë”ë§ |
| `user/page/my_page.tsx` | `MyPage` | `useUserMe` | ë‚´ ì •ë³´ ì¡°íšŒ |

#### ì½”ë“œ ì˜ˆì‹œ: `category/auth/page/login_page.tsx`

```tsx
import { zodResolver } from "@hookform/resolvers/zod";
import { Loader2 } from "lucide-react";
import { useForm } from "react-hook-form";
import { Link } from "react-router-dom";

import {
  Card, CardContent, CardDescription, CardHeader, CardTitle,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import {
  Form, FormControl, FormField, FormItem, FormLabel, FormMessage,
} from "@/components/ui/form";
import { loginReqSchema, type LoginReq } from "@/category/auth/types";

import { useLogin } from "../hook/use_login";

export function LoginPage() {
  const loginMutation = useLogin();

  const form = useForm<LoginReq>({
    resolver: zodResolver(loginReqSchema),  // Zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦
    mode: "onChange",
    defaultValues: {
      email: "",
      password: "",
    },
  });

  const onSubmit = (values: LoginReq) => {
    loginMutation.mutate(values);
  };

  return (
    <div className="flex min-h-screen w-full items-center justify-center bg-background px-4 py-10">
      <Card className="w-full max-w-md">
        <CardHeader className="space-y-2">
          <CardTitle>ë¡œê·¸ì¸</CardTitle>
          <CardDescription>
            ë‹¤ì‹œ ëŒì•„ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
              {/* ì´ë©”ì¼ ì…ë ¥ */}
              <FormField
                control={form.control}
                name="email"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>ì´ë©”ì¼</FormLabel>
                    <FormControl>
                      <Input
                        type="email"
                        placeholder="email@example.com"
                        autoComplete="email"
                        {...field}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              {/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ */}
              <FormField
                control={form.control}
                name="password"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>ë¹„ë°€ë²ˆí˜¸</FormLabel>
                    <FormControl>
                      <Input
                        type="password"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        autoComplete="current-password"
                        {...field}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              {/* í•˜ë‹¨ ë§í¬ */}
              <div className="flex items-center justify-between text-sm">
                <Link to="/signup" className="text-primary hover:underline">
                  ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…
                </Link>
                <Link to="/find-id" className="text-muted-foreground hover:underline">
                  ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
                </Link>
              </div>

              {/* ì œì¶œ ë²„íŠ¼ */}
              <Button
                type="submit"
                className="w-full"
                disabled={loginMutation.isPending}
              >
                {loginMutation.isPending ? (
                  <>
                    <Loader2 className="h-4 w-4 animate-spin mr-2" />
                    ë¡œê·¸ì¸ ì¤‘...
                  </>
                ) : (
                  "ë¡œê·¸ì¸"
                )}
              </Button>
            </form>
          </Form>
        </CardContent>
      </Card>
    </div>
  );
}
```

#### í•µì‹¬ íŒ¨í„´

| íŒ¨í„´ | ì„¤ëª… |
|------|------|
| **RHF + Zod** | `zodResolver(schema)` ë¡œ í¼ ê²€ì¦ ìë™í™” |
| **shadcn/ui Form** | `Form`, `FormField`, `FormItem` ì»´í¬ë„ŒíŠ¸ ì¡°í•© |
| **Mutation ìƒíƒœ** | `isPending` ìœ¼ë¡œ ë¡œë”© ìƒíƒœ í‘œì‹œ |
| **í˜ì´ì§€ëŠ” ì¡°ë¦½ë§Œ** | ë¡œì§ì€ í›…(`useLogin`)ì— ìœ„ì„ |
| **ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ** | `max-w-md`, `min-h-screen` ë“± Tailwind ìœ í‹¸ë¦¬í‹° |

---

### 7.7.2-5. ê³µìš© ì¸í”„ë¼ (Shared Infrastructure)

ë„ë©”ì¸ ê°„ ê³µìœ ë˜ëŠ” í•µì‹¬ ëª¨ë“ˆë“¤.

#### íŒŒì¼ ê°œìš”

| íŒŒì¼ | ì—­í•  | ì£¼ìš” ê¸°ëŠ¥ |
|------|------|----------|
| `api/client.ts` | HTTP í´ë¼ì´ì–¸íŠ¸ | Axios + 401 refresh interceptor |
| `hooks/use_auth_store.ts` | ì „ì—­ ì¸ì¦ ìƒíƒœ | Zustand + persist |
| `app/routes.tsx` | ë¼ìš°íŒ… ì •ì˜ | Public/Private ë¼ìš°íŠ¸ ë¶„ë¦¬ |
| `routes/private_route.tsx` | ì¸ì¦ ê°€ë“œ | ë¡œê·¸ì¸ í•„ìˆ˜ ë¼ìš°íŠ¸ ë³´í˜¸ |

#### ì½”ë“œ ì˜ˆì‹œ: `api/client.ts` (í•µì‹¬ ë¶€ë¶„)

```typescript
import axios, { type AxiosRequestConfig } from "axios";

import type { LoginRes } from "@/category/auth/types";
import { useAuthStore } from "@/hooks/use_auth_store";

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL ?? "/api";

export class ApiError extends Error {
  status: number;
  constructor(status: number, message: string) {
    super(message);
    this.name = "ApiError";
    this.status = status;
  }
}

export const api = axios.create({
  baseURL: API_BASE_URL,
  withCredentials: true,  // Refresh Cookie ì „ì†¡ í•„ìˆ˜
});

// 401 Silent Refresh Interceptor
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    if (
      error.response?.status === 401 &&
      originalRequest &&
      !originalRequest._retry
    ) {
      originalRequest._retry = true;
      try {
        // Refresh ìš”ì²­ (Cookie ê¸°ë°˜)
        const refreshResponse = await api.post("/auth/refresh", {});
        const loginData = refreshResponse.data as LoginRes;
        const newToken = `Bearer ${loginData.access.access_token}`;

        // í—¤ë” ê°±ì‹ 
        api.defaults.headers.common["Authorization"] = newToken;
        originalRequest.headers["Authorization"] = newToken;

        // Store ì—…ë°ì´íŠ¸
        useAuthStore.getState().login(loginData);

        // ì› ìš”ì²­ ì¬ì‹œë„
        return api(originalRequest);
      } catch (refreshError) {
        // Refresh ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì•„ì›ƒ
        useAuthStore.getState().logout();
        window.location.href = "/login";
        return Promise.reject(refreshError);
      }
    }
    return Promise.reject(error);
  }
);

// ì œë„¤ë¦­ request í•¨ìˆ˜
export async function request<T>(
  path: string,
  options: Omit<AxiosRequestConfig, "url"> = {}
): Promise<T> {
  const response = await api.request<T>({ url: path, ...options });
  if (response.status === 204 || response.data === "") {
    return undefined as T;
  }
  return response.data;
}
```

#### ì½”ë“œ ì˜ˆì‹œ: `hooks/use_auth_store.ts`

```typescript
import { create } from "zustand";
import { persist } from "zustand/middleware";

import type { LoginRes } from "@/category/auth/types";
import type { SignupRes } from "@/category/user/types";

type StoredUser = Omit<SignupRes, "access" | "session_id"> | Pick<LoginRes, "user_id">;

type AuthState = {
  user: StoredUser | null;
  accessToken: string | null;
  isLoggedIn: boolean;
  login: (data: LoginRes | SignupRes) => void;
  logout: () => void;
};

const initialState: Pick<AuthState, "user" | "accessToken" | "isLoggedIn"> = {
  user: null,
  accessToken: null,
  isLoggedIn: false,
};

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      ...initialState,
      login: (data) => {
        set({
          user: "email" in data
            ? { user_id: data.user_id, email: data.email, name: data.name, nickname: data.nickname }
            : { user_id: data.user_id },
          accessToken: data.access.access_token,
          isLoggedIn: true,
        });
      },
      logout: () => {
        set({ ...initialState });
        useAuthStore.persist.clearStorage();
      },
    }),
    {
      name: "auth-storage",  // localStorage í‚¤
    }
  )
);
```

#### ì½”ë“œ ì˜ˆì‹œ: `routes/private_route.tsx`

```tsx
import { Navigate, Outlet } from "react-router-dom";
import { useAuthStore } from "@/hooks/use_auth_store";

export default function PrivateRoute() {
  const user = useAuthStore((state) => state.user);

  // ìœ ì € ì •ë³´ê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  if (!user) {
    return <Navigate to="/login" replace />;
  }

  // ìˆìœ¼ë©´ ìì‹ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
  return <Outlet />;
}
```

#### ì½”ë“œ ì˜ˆì‹œ: `app/routes.tsx`

```tsx
import { Route, Routes } from "react-router-dom";

import { LoginPage } from "@/category/auth/page/login_page";
import { SignupPage } from "@/category/auth/page/signup_page";
import { VideoListPage } from "@/category/video/page/video_list_page";
import { MyPage } from "@/category/user/page/my_page";
import PrivateRoute from "@/routes/private_route";

export function AppRoutes() {
  return (
    <Routes>
      {/* ëˆ„êµ¬ë‚˜ ì ‘ê·¼ ê°€ëŠ¥ (Public) */}
      <Route path="/login" element={<LoginPage />} />
      <Route path="/signup" element={<SignupPage />} />
      <Route path="/videos" element={<VideoListPage />} />

      {/* ë¡œê·¸ì¸í•œ ì‚¬ëŒë§Œ ì ‘ê·¼ ê°€ëŠ¥ (Private) */}
      <Route element={<PrivateRoute />}>
        <Route path="/user/me" element={<MyPage />} />
        <Route path="/settings" element={<SettingsPage />} />
      </Route>
    </Routes>
  );
}
```

#### í•µì‹¬ íŒ¨í„´

| íŒ¨í„´ | ì„¤ëª… |
|------|------|
| **401 Silent Refresh** | í† í° ë§Œë£Œ ì‹œ ìë™ ê°±ì‹  í›„ ì› ìš”ì²­ ì¬ì‹œë„ |
| **Zustand persist** | `localStorage`ì— ì¸ì¦ ìƒíƒœ ìœ ì§€ (ìƒˆë¡œê³ ì¹¨ ëŒ€ì‘) |
| **PrivateRoute ê°€ë“œ** | `<Outlet />` íŒ¨í„´ìœ¼ë¡œ ìì‹ ë¼ìš°íŠ¸ ë³´í˜¸ |
| **withCredentials** | Refresh Token Cookie ì „ì†¡ì„ ìœ„í•´ í•„ìˆ˜ |
| **ApiError í´ë˜ìŠ¤** | HTTP ìƒíƒœ ì½”ë“œ ê¸°ë°˜ ì—ëŸ¬ í•¸ë“¤ë§ |

---

### 7.7.2-6. í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° íë¦„ (Data Flow)

```
[ì‚¬ìš©ì ì•¡ì…˜]
      â†“
[Page Component] â†’ useForm() + zodResolver(schema)
      â†“
[Custom Hook] â†’ useMutation() / useQuery()
      â†“
[*_api.ts] â†’ request<T>() í˜¸ì¶œ
      â†“
[api/client.ts] â†’ axios + interceptor
      â†“
[Backend API]
      â†“
[Response]
      â†“
[Custom Hook] â†’ onSuccess: Store ì—…ë°ì´íŠ¸, toast ì•Œë¦¼
      â†“
[Page Component] â†’ UI ë°˜ì˜ (isPending, data, error)
```

---

## 8. LLM í˜‘ì—… ê·œì¹™ (ë‚˜ì™€ ì¼í•˜ëŠ” ë²•)

> ê¸°ì¡´ `README_for_assistant.md` + GEMINI í…œí”Œë¦¿ ê´€ë ¨ ë‚´ìš© ì •ë¦¬.

### 8.1 ì§ˆë¬¸/ìš”ì²­ ë°©ì‹

1) ìš”ì²­ : ê¸°ì¡´ ì‘ì—… ì§„í–‰, ì‹ ê·œ ì‘ì—… ì¶”ê°€ ë° ì§„í–‰, ì‘ì—… ê´€ë ¨ ì§ˆë¬¸
2) ëŒ€ìƒ : ì‘ì—… í™˜ê²½(aws, docker, linux ë“±ë“±), ì‘ì—… ì½”ë“œ(database, backend, frontend, web&app ë“±ë“±)
3) ë°©ì‹ : **AMK_API_MASTER.mdì˜ ì„¹ì…˜ / ê³„ì¸µ / íŒŒì¼** ë°”íƒ•ìœ¼ë¡œ ì‘ì—… ê´€ë ¨ ì‚¬í•­ ì‘ì„± ex) â€œPhase 3-5 `/videos/{id}/progress`ì— ëŒ€í•œ Rust í•¸ë“¤ëŸ¬/ì„œë¹„ìŠ¤/í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•´ì¤˜â€
4) ê²°ê³¼ : í•´ë‹¹ ì‘ì—…ì˜ ê¸°ëŒ“ê°’ ì‘ì„± ex) â€œPhase 3-5 `/videos/{id}/progress`ì— ëŒ€í•œ Rust í•¸ë“¤ëŸ¬/ì„œë¹„ìŠ¤/í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•´ì„œ ì˜¤ë¥˜ ì—†ì´ ì˜ ì‘ë™ í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¤˜â€

### 8.2 LLM ì‘ë‹µ ê¸°ëŒ€ í˜•ì‹

1) ì§ˆë¬¸ ë‹¨ê³„  
   - LLMì€ ìš”ì²­ ë‚´ìš©ì„ í•œ ì¤„ë¡œ ìš”ì•½í•´ì„œ â€œì§€ê¸ˆ ì–´ë–¤ ì‘ì—…ì„ í•˜ë ¤ëŠ”ì§€â€ë¥¼ ë¨¼ì € ì •ë¦¬í•œë‹¤.  
   - ë¬¸ì„œ(AMK_API_MASTER.md)ì™€ ì½”ë“œ/ìš”ì²­ì´ ëª…ë°±íˆ ì¶©ëŒí•˜ê±°ë‚˜, ì„ íƒì§€ê°€ í¬ê²Œ ê°ˆë¦¬ëŠ” ì§€ì ì´ ìˆì„ ë•Œë§Œ ì§§ê²Œ ì§ˆì˜í•œë‹¤.  
   - ê·¸ ì™¸ì—ëŠ” í•„ìš”í•œ ê°€ì •ì„ ëª…ì‹œí•˜ê³  ë°”ë¡œ ì‘ì—…ì„ ì§„í–‰í•œë‹¤.

2) ì§„í–‰ ê¸°ì¤€  
   - ìš”ì²­í•œ ì‘ì—…ì— ëŒ€í•´, ë‚´ê°€ ì œì‹œí•œ **AMK_API_MASTER.mdì˜ ì„¹ì…˜ / ê³„ì¸µ / íŒŒì¼**ì„ ìµœìš°ì„ ìœ¼ë¡œ ì°¸ì¡°í•˜ì—¬ ì‘ì—…ì„ ì§„í–‰í•œë‹¤.  
   - ë¬¸ì„œì™€ í˜„ì¬ ì½”ë“œê°€ ë‹¤ë¥¼ ê²½ìš°, ë¬¸ì„œë¥¼ â€œì •ë‹µâ€ìœ¼ë¡œ ë³´ê³  ì½”ë“œë¥¼ ë¬¸ì„œì— ë§ì¶˜ë‹¤(ì˜ˆì™¸ê°€ í•„ìš”í•˜ë©´ ëª…ì‹œ).

3) ë‹µë³€ êµ¬ì¡°  
   - 3-1) ìš”ì•½: ì´ë²ˆ ë‹µë³€ì—ì„œ ë¬´ì—‡ì„ í–ˆëŠ”ì§€ í•œ ì¤„ ë˜ëŠ” ì§§ì€ ë‹¨ë½ìœ¼ë¡œ ì •ë¦¬  
   - 3-2) ì„¸ë¶€ë‚´ìš©: íŒŒì¼/í•¨ìˆ˜/ì¿¼ë¦¬ ë‹¨ìœ„ë¡œ êµ¬ì²´ì ì¸ ë³€ê²½ ë‚´ìš© ì œì‹œ(í•„ìš” ì‹œ ì½”ë“œë¸”ë¡)  
   - 3-3) ê²°ê³¼ ë° íš¨ê³¼: ë³€ê²½ í›„ ì–´ë–¤ ì‹œë‚˜ë¦¬ì˜¤ê°€ ê°€ëŠ¥í•´ì¡ŒëŠ”ì§€, ì–´ë–¤ ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆëŠ”ì§€ ì„¤ëª…  
   - 3-4) ìš°ë ¤ì  ë° ê°œì„  ì‚¬í•­(ìˆë‹¤ë©´): ì„±ëŠ¥/ë³´ì•ˆ/í™•ì¥ì„±/ì¶”ê°€ ë¦¬íŒ©í„°ë§ í¬ì¸íŠ¸ ë“±  
   - 3-5) ë‹¤ìŒ ì‘ì—… ì¶”ì²œ: ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§ˆ Phase/íƒœìŠ¤í¬ í•œë‘ ê°œ ì œì•ˆ  
   - *ê°„ë‹¨í•œ Q&A/ê°œë… ì„¤ëª…ë§Œ í•„ìš”í•œ ê²½ìš°ì—ëŠ” 3-1~3-2 ì¤‘ì‹¬ìœ¼ë¡œ ë‹µë³€í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” í•„ìš” ì‹œì—ë§Œ í¬í•¨í•œë‹¤.*

4) ë§ˆë¬´ë¦¬ / ë¬¸ì„œ ë°˜ì˜  
   - ì‘ì—…ì´ ì™„ë£Œë˜ë©´, LLMì€ **AMK_API_MASTER.mdì—ì„œ ìˆ˜ì •ì´ í•„ìš”í•œ ìœ„ì¹˜ì™€ ë³€ê²½ ë‚´ìš©(ì²´í¬ë°•ìŠ¤, ë©”ëª¨ ë“±)**ì„ ì œì•ˆí•œë‹¤.  
   - ì‹¤ì œ íŒŒì¼ ìˆ˜ì •ì€ ì‚¬ìš©ìê°€ ìˆ˜í–‰í•˜ë˜, LLMì€ ë³µë¶™ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€ê²½ì•ˆì„ ì œê³µí•œë‹¤.

### 8.3 LLM_PATCH_TEMPLATE ì—°ë™

- ì‹¤ì œ ì½”ë“œ íŒ¨ì¹˜ëŠ” `LLM_PATCHS_TEMPLATE_BACKEND.md`, `LLM_PATCHS_TEMPLATE_FRONTEND.md` í˜•ì‹ì„ ë”°ë¥¸ë‹¤.
- ê¸°ë³¸ êµ¬ì¡°:
  - ROLE / OBJECTIVE / CONTEXT / CONTRACT / PATCH RULES / ACCEPTANCE / FILE PATCHES / cURL SMOKE
- ìš”ì²­ ì‹œ:
  - AMK_API_MASTER.mdì˜ **í•´ë‹¹ ì„¹ì…˜/Phase/ì—”ë“œí¬ì¸íŠ¸**ë¥¼ CONTRACTÂ·CONTEXTì— ëª…ì‹œí•œë‹¤.
  - ì˜ˆ) Phase 3-5 `/videos/{id}/progress` ìŠ¤í™ì„ ê¸°ì¤€ìœ¼ë¡œ íŒ¨ì¹˜ ìš”ì²­.
- ì‘ë‹µ/íŒ¨ì¹˜ ì‹œ:
  - FILE PATCHESì— ë‚˜ì˜¤ëŠ” ê° `// FILE: ...` ë¸”ë¡ì€ **íŒŒì¼ ì „ì²´ êµì²´ë³¸**ì´ë‹¤(ë¶€ë¶„ íŒ¨ì¹˜ ê¸ˆì§€).
  - ë„¤ì´ë°/enum/ìŠ¤í‚¤ë§ˆëŠ” AMK_API_MASTER.mdì˜ 3.2(ë„¤ì´ë° ê·œì¹™), 4.x(ë°ì´í„° ëª¨ë¸)ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ë”°ë¥¸ë‹¤.

---

### 8.4 í‘œì¤€ ì‘ì—… ì ˆì°¨ (SOP: Standard Operating Procedure)
ìš°ë¦¬ëŠ” í•­ìƒ ë‹¤ìŒ 11ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¤€ìˆ˜í•˜ë©° ì‘ì—…ì„ ì§„í–‰í•œë‹¤.

**[Phase 1: ì¤€ë¹„ (Plan)]**
1. **Request**: ì‚¬ìš©ìê°€ SSoT(`AMK_API_MASTER.md`)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • ê¸°ëŠ¥ êµ¬í˜„ì„ ìœ„í•œ **Codex í”„ë¡¬í”„íŠ¸ ìƒì„±**ì„ ìš”ì²­.
2. **Draft**: LLMì€ êµ¬í˜„í•  íŒŒì¼/ì½”ë“œ ì „ì²´ê°€ ë‹´ê¸´ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì œê³µ.
3. **Save**: ì‚¬ìš©ìëŠ” í•´ë‹¹ í”„ë¡¬í”„íŠ¸ë¥¼ í”„ë¡œì íŠ¸ `docs/` ë‚´ì— ì €ì¥.

**[Phase 2: êµ¬í˜„ (Execute)]**
4. **Run**: ì‚¬ìš©ìê°€ ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ë¥¼ Codex(ì—ë””í„°)ì—ì„œ ì‹¤í–‰.
5. **Code**: Codexê°€ ì½”ë“œ ì‘ì„± ì™„ë£Œ.

**[Phase 3: ê²€ì¦ (Verify)]**
6. **Test**: ì‚¬ìš©ìê°€ ë¡œì»¬ í™˜ê²½ì—ì„œ ì§ì ‘ ìˆ˜ë™ í…ŒìŠ¤íŒ… ë° ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰.
7. **Fix**: íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë°œìƒ ì‹œ, ë¡œê·¸ë¥¼ ì œê³µí•˜ê³  LLMì´ í•´ê²°ì±… ì œì‹œ (ë°˜ë³µ).

**[Phase 4: ë¬¸ì„œí™” (Document)]**
8. **Log Request**: í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„, ì‚¬ìš©ìê°€ "ì´ë²ˆ ì‘ì—…ì˜ ì´ìŠˆ/êµí›ˆ ì •ë¦¬í•´ ì¤˜"ë¼ê³  ìš”ì²­.
9. **Log Update**: LLMì´ `AMK_DEV_LOG.md`ì— ì¶”ê°€í•  ë‚´ìš©ì„ ì •ë¦¬í•˜ì—¬ ì œê³µ -> ì‚¬ìš©ìê°€ ì €ì¥.
10. **Status Request**: ì‚¬ìš©ìê°€ "ì‘ì—… í˜„í™© ì—…ë°ì´íŠ¸í•´ ì¤˜"ë¼ê³  ìš”ì²­.
11. **Status Update**: LLMì´ `AMK_..._STATUS.md`ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê°±ì‹  ë‚´ìš©ì„ ì œê³µ -> ì‚¬ìš©ìê°€ ì €ì¥.

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 9. Open Questions & ì„¤ê³„ TODO

> ê¸°ì¡´ `AMK_PROJECT_JOURNAL.md`ì˜ Open Questions + Engineering Guideì˜ â€œë‹¤ìŒ ë‹¨ê³„ ë¡œë“œë§µâ€ì—ì„œ ì •ì±… ìˆ˜ì¤€ë§Œ ì •ë¦¬.

### 9.1 RBAC / ê´€ë¦¬ì ê¶Œí•œ âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-01)

- ~~ì„ì‹œ ê°€ë“œ(ëª¨ë“  ìš”ì²­ í—ˆìš©)ë¥¼ ì‹¤ì œ RBACë¡œ êµì²´í•´ì•¼ í•¨.~~ â†’ **ì™„ë£Œ**
- ë¡¤ë³„ ì ‘ê·¼ ê¶Œí•œ:
  | ì—­í•  | Admin ì ‘ê·¼ | ë°ì´í„° ë²”ìœ„ | ë¹„ê³  |
  |------|----------|------------|------|
  | **HYMN** | âœ… ê°€ëŠ¥ | ì „ì²´ | ëª¨ë“  ê¸°ëŠ¥ + ì‹œìŠ¤í…œ ì„¤ì • |
  | **admin** | âœ… ê°€ëŠ¥ | ì „ì²´ | ì½ê¸°/ì“°ê¸° ëª¨ë“  ê¸°ëŠ¥ |
  | **manager** | âŒ ë¶ˆê°€ | ë‹´ë‹¹ class | í–¥í›„ class ê¸°ë°˜ ì ‘ê·¼ êµ¬í˜„ ì˜ˆì • |
  | **learner** | âŒ ë¶ˆê°€ | ìì‹ ë§Œ | ì¼ë°˜ ì‚¬ìš©ì |
- êµ¬í˜„ ë‚´ì—­:
  - ë°±ì—”ë“œ: `src/api/admin/role_guard.rs` - ë¯¸ë“¤ì›¨ì–´ RBAC
  - ë°±ì—”ë“œ: Admin IP Allowlist (`admin_ip_guard.rs`)
  - í”„ë¡ íŠ¸: `AdminRoute` ì»´í¬ë„ŒíŠ¸ - ì—­í•  í™•ì¸ í›„ `/403` ë¦¬ë‹¤ì´ë ‰íŠ¸
  - í”„ë¡ íŠ¸: ì—ëŸ¬ í˜ì´ì§€ (`/403`, `/error`, `*`)
- í–¥í›„ TODO:
  - manager ì—­í• : class í…Œì´ë¸” êµ¬í˜„ í›„ ë‹´ë‹¹ í•™ìŠµì ë²”ìœ„ ë‚´ ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬
  - ì„¸ë¶„í™”ëœ ê¶Œí•œ (ì˜ˆ: adminì´ ì¼ë¶€ ë¯¼ê° ê¸°ëŠ¥ ì œí•œ)

### 9.2 Admin action log actor ì—°ê²° âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-02)

- ~~`ADMIN_USERS_LOG` ë° ë¹„ë””ì˜¤/ìŠ¤í„°ë””/ë ˆìŠ¨ admin ë¡œê·¸ì— **actor user id** ì±„ìš°ê¸°~~ â†’ **ì™„ë£Œ**
  - `AuthUser` extractorì—ì„œ JWT Claimsì˜ `sub` (user_id) ì¶”ì¶œ
  - ëª¨ë“  Admin handler â†’ service â†’ repoê¹Œì§€ `actor_user_id` ì „ë‹¬
  - `create_audit_log()`ì—ì„œ `admin_id`ë¡œ ì •ìƒ ì €ì¥
- í–¥í›„ ê²€í† : ì—­í• ë³„ ë¡œê·¸ ì¡°íšŒ ë²”ìœ„ ì œí•œ (managerëŠ” ë‹´ë‹¹ classë§Œ ì¡°íšŒ ë“±)

### 9.3 í˜ì´ì§• ê³ ë„í™” (Keyset vs Page)

- í˜„ì¬ í‘œì¤€ì€ page/size ê¸°ë°˜
- **íŠ¸ë¦¬ê±°**: í…Œì´ë¸” ë°ì´í„° **1ë§Œ ê±´ ì´ìƒ** ì‹œ Keyset pagination ê²€í† 
- ëŒ€ìƒ í…Œì´ë¸”: `video_log`, `study_task_log`, `login_log`
- ê¸°ì¡´ APIì™€ í˜¸í™˜ì„± ìœ ì§€ (page/size íŒŒë¼ë¯¸í„° ë³‘í–‰)

### 9.4 í…ŒìŠ¤íŠ¸ ì „ëµ

**ëª©í‘œ ì„±ëŠ¥ (K6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê¸°ì¤€)**:

| ì—”ë“œí¬ì¸íŠ¸ | ëª©í‘œ RPS | P95 ì‘ë‹µì‹œê°„ |
|----------|---------|-------------|
| ì¸ì¦ (login/refresh) | 100 | < 200ms |
| ëª©ë¡ ì¡°íšŒ (videos/studies) | 200 | < 100ms |
| ìƒì„¸ ì¡°íšŒ | 300 | < 50ms |
| ì§„ë„ ì €ì¥ (progress) | 100 | < 150ms |

**ëŒ€í‘œ ì‹œë‚˜ë¦¬ì˜¤**: íšŒì›ê°€ì… â†’ ë¡œê·¸ì¸ â†’ ë¹„ë””ì˜¤ ì¡°íšŒ â†’ ì‹œì²­ â†’ ì§„ë„ ì €ì¥ â†’ í•™ìŠµ ë¬¸ì œ í’€ì´

### 9.5 ë³´ì•ˆ/ìš´ì˜ (í›„ìˆœìœ„ ê³„íš)

**âœ… ì™„ë£Œ í•­ëª© (2026-02-01):**
- ~~ì„¸ì…˜/ë¦¬í”„ë ˆì‹œ í† í° ì •ì±… ê°•í™”: ì—­í• ë³„ TTL~~ â†’ **ì™„ë£Œ** (HYMN: 1ì¼, admin/manager: 7ì¼, learner: 30ì¼)
- ~~ì ‘ê·¼ ì œì–´: ê´€ë¦¬ì IP allowlist~~ â†’ **ì™„ë£Œ** (`admin_ip_guard.rs`, CIDR ì§€ì›)
- ~~RBAC ë¯¸ë“¤ì›¨ì–´~~ â†’ **ì™„ë£Œ** (`role_guard.rs`, HYMN/adminë§Œ admin ì ‘ê·¼ í—ˆìš©)

**ğŸ“‹ ë‚¨ì€ í•­ëª© (ì™¸ë¶€ API ì—°ê²° ì‘ì—… í›„ ì§„í–‰):**
- ê´€ë¦¬ì MFA ë„ì… (íŠ¹íˆ HYMN/admin ê³„ì •) â€” ì†Œì…œ ë¡œê·¸ì¸/ê²°ì œ ì‹œìŠ¤í…œ í›„
- ë™ì‹œ ì„¸ì…˜ ìˆ˜ ì œí•œ â€” RDS ì´ì „ í›„
- í† í° ì¬ì‚¬ìš© íƒì§€ (Refresh Token Replay Attack ë°©ì§€) â€” RDS ì´ì „ í›„
- step-up MFA (ë¯¼ê°í•œ ì‘ì—… ì‹œ ì¶”ê°€ ì¸ì¦) â€” MFA ë„ì… í›„
- í† í° ì¬ë°œê¸‰ Redis ìºì‹± â€” ë™ì‹œ ì ‘ì†ì 10K+ ì‹œ ì¬ê²€í†  (ìºì‹œ ë¬´íš¨í™” ë³µì¡ë„ ê³ ë ¤)

### 9.6 ì½”ë“œ ì¼ê´€ì„± (Technical Debt) âœ…

> **ì™„ë£Œë¨** (2026-02-02). ëª¨ë“  í•­ëª© ì •ë¦¬ ì™„ë£Œ.

| ì´ìŠˆ | ìƒíƒœ | ë³€ê²½ ë‚´ìš© |
|------|:----:|----------|
| Refresh Token í¬ë§· | âœ… | user/service.rs â†’ `session_id:uuid` í¬ë§·ìœ¼ë¡œ í†µì¼ |
| LessonService êµ¬ì¡° | âœ… | Stateless íŒ¨í„´ ì ìš© (`struct LessonService;`) |
| Lesson ì—ëŸ¬ íƒ€ì… | âœ… | `AppResult<T>` ë˜í•‘ ì ìš© |
| login SADD ì¶”ê°€ | âœ… | auth/service.rs ë¡œê·¸ì¸ ì‹œ `ak:user_sessions` SADD ì¶”ê°€ |
| set_domain ì¤‘ë³µ | âœ… | auth/service.rs ì¤‘ë³µ í˜¸ì¶œ ì œê±° |
| Handler `_handler` ì ‘ë¯¸ì‚¬ | âœ… | `create_video_handler` â†’ `admin_create_video` ë“± í†µì¼ |
| Admin í•¨ìˆ˜ prefix | âœ… | `get_user_self_logs` â†’ `admin_get_user_self_logs` ë“± í†µì¼ |
| Video repo í•¨ìˆ˜ëª… | âœ… | `find_*` â†’ `get_*/list_*` íŒ¨í„´ í†µì¼ |

### 9.7 ì‘ì—… ë¡œë“œë§µ

> ë‚´ë¶€ DB ì‘ì—… â†’ ì™¸ë¶€ API ì—°ê²° ìˆœì„œë¡œ ì§„í–‰

#### ë‚´ë¶€ DB ì‘ì—… âœ…

| ìˆœì„œ | í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|------|------|------|------|
| 1 | Redis ì¸ì¦ ì„¤ì • | âœ… | `REDIS_PASSWORD` í™˜ê²½ë³€ìˆ˜ ì¶”ê°€, docker-compose ìˆ˜ì • |
| 2 | Redis í¬íŠ¸ ë°”ì¸ë”© | âœ… | ê°œë°œí™˜ê²½ 127.0.0.1:16379ë¡œ ì œí•œ |
| 3 | ì˜ìƒ ì‹¤ì œ ì‹œì²­ ì‹œê°„ | âœ… | `video_log`ì— `video_watch_duration_sec` ì»¬ëŸ¼ ì¶”ê°€ |
| 4 | Study ë ˆì´íŠ¸ë¦¬ë°‹ | âœ… | `rl:study_submit:{user_id}` í‚¤ë¡œ 30íšŒ/ë¶„ ì œí•œ |
| 5 | Course ë„ë©”ì¸ ì¶”ê°€ | âœ… | `20260202_ADD_COURSE_DOMAIN.sql` ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± |
| 6 | ìˆ˜ê°•ê¶Œ ì •ì±… ì ìš© | âœ… | `lesson_access` ê¸°ë°˜ 403 Forbidden ê²€ì¦ ë¡œì§ (lesson/service.rs) |

#### ì™¸ë¶€ API ì—°ê²°

| ìˆœì„œ | í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|------|------|:----:|------|
| 1-1 | Google OAuth | âœ… | Google OAuth 2.0 Authorization Code Flow êµ¬í˜„ ì™„ë£Œ |
| 1-2 | Apple OAuth | ë³´ë¥˜ | ê°œë°œ í™˜ê²½ ë° ë¹„ìš© ë¬¸ì œë¡œ ë³´ë¥˜ |
| 2 | ì´ë©”ì¼ ì¸ì¦ (AWS SES) | ğŸ“‹ | ì¼ë°˜ ê°€ì… ì‹œ ì´ë©”ì¼ ì¸ì¦ í•„ìˆ˜í™” (Phase 2 ì˜ˆì •) |
| 3 | ê²°ì œ ì‹œìŠ¤í…œ | ğŸ“‹ | Stripe, Polar ì—°ë™ (ìˆ˜ê°•ê¶Œê³¼ ì—°ê³„) |
| 4 | RDS/ElastiCache ì´ì „ | ğŸ“‹ | EC2 â†’ AWS RDS + ElastiCache (TLS, maxmemory ìë™ ì ìš©) |
| 5 | ë‹¤ì¤‘ ì„œë²„ êµ¬ì„± (HA) | ğŸ“‹ | ë‹¨ê³„ì  í™•ì¥: â‘ nginx+ì»¨í…Œì´ë„ˆ ë³µì œ(ë¹„ìš©0) â†’ â‘¡ALB+EC2 ë‹¤ì¤‘í™”+RDS â†’ â‘¢ECS Fargate+Auto Scaling |
| 6 | GeoIP ì„œë¹„ìŠ¤ ì „í™˜ | ë³´ë¥˜ | ip-api.com(HTTP) â†’ MaxMind GeoLite2(ë¡œì»¬ DB) ë˜ëŠ” HTTPS ì§€ì› ì„œë¹„ìŠ¤, íŠ¸ë˜í”½ ì¦ê°€ ì‹œ |

#### ë³´ì•ˆ & ë°ì´í„° ë³´í˜¸

| ìˆœì„œ | í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|------|------|:----:|------|
| 1 | DB í•„ë“œ ì•”í˜¸í™” | ğŸ“‹ | AES-256-GCM ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ì•”í˜¸í™” + Blind Index (HMAC-SHA256) |
| 2 | ì•”í˜¸í™” ëª¨ë“ˆ êµ¬í˜„ | ğŸ“‹ | `src/crypto/` â€” encrypt/decrypt, blind index ìƒì„± í•¨ìˆ˜ |
| 3 | ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ | ğŸ“‹ | Phase 1: í˜¸í™˜ ëª¨ë“œ â†’ Phase 2: ì¼ê´„ ì•”í˜¸í™” â†’ Phase 3: ì •ë¦¬ |

> **ì•”í˜¸í™” ëŒ€ìƒ**: `user_email`, `user_name`, `user_birthday`, `oauth_email`, `oauth_subject`, `login_ip`, ê°ì¢… ë¡œê·¸ í…Œì´ë¸” PII
> **í‚¤ ê´€ë¦¬**: `ENCRYPTION_KEY` (AES-256) + `HMAC_KEY` (blind index), í™˜ê²½ë³€ìˆ˜, AppState ë¡œë“œ
> **ë³´ì•ˆ ë¡œë“œë§µ**: 1ë‹¨ê³„ ì•± ë ˆë²¨ AES â†’ 2ë‹¨ê³„ AWS KMS envelope â†’ 3ë‹¨ê³„ HSM

#### ë‹¤êµ­ì–´ ì½˜í…ì¸  í™•ì¥

| ìˆœì„œ | í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|------|------|:----:|------|
| 1 | ë²ˆì—­ í…Œì´ë¸” ì„¤ê³„ | ğŸ“‹ | `content_translations` í…Œì´ë¸” (content_type, content_id, field_name, lang, status) |
| 2 | í°íŠ¸ ë™ì  ë¡œë”© | ğŸ“‹ | Noto Sans íŒ¨ë°€ë¦¬, ì‚¬ìš©ì ì–¸ì–´ë³„ ë¡œë“œ (ì „ì²´ 50MB+ â†’ í•„ìš”í•œ ê²ƒë§Œ) |
| 3 | RTL ì§€ì› | ğŸ“‹ | ì•„ëì–´ ëŒ€ì‘ â€” CSS Logical Properties, direction: rtl, ì•„ì´ì½˜ ë°˜ì „ |
| 4 | ë²ˆì—­ API ì—°ë™ | ğŸ“‹ | AI ìë™ ì´ˆì•ˆ ìƒì„± â†’ ê´€ë¦¬ì ê²€ìˆ˜ â†’ ìŠ¹ì¸ íŒŒì´í”„ë¼ì¸ |
| 5 | í•µì‹¬ 5ê°œ ì–¸ì–´ | ğŸ“‹ | en, ja, zh-CN, zh-TW, vi (Phase 2) |
| 6 | ë‚˜ë¨¸ì§€ 17ê°œ ì–¸ì–´ | ğŸ“‹ | id, th, my, km, mn, ru, uz, kk, tg, ne, si, hi, es, pt, fr, de, ar (Phase 3) |
| 7 | i18n ë™ì  ë¡œë”© + async | ğŸ“‹ | 22ê°œ ì–¸ì–´ í™•ì¥ ì‹œ ë²ˆë“¤ ë¶„ë¦¬(dynamic import) + changeLanguage async ì²˜ë¦¬ |

> **ì§€ì› ì–¸ì–´ (22ê°œ)**: en, zh-CN, zh-TW, ja, vi, id, th, my, km, mn, ru, uz, kk, tg, ne, si, hi, es, pt, fr, de, ar
> **ë²ˆì—­ ëŒ€ìƒ**: video title/description, category name, study_task title/description, achievement (UI ë©”íƒ€ë°ì´í„°ë§Œ, í•™ìŠµ ë³¸ë¬¸ ì œì™¸)
> **Fallback**: ì‚¬ìš©ì ì–¸ì–´ â†’ ko (í•œêµ­ì–´ ì›ë³¸)

#### ë³´ë¥˜/ë‚®ìŒ ìš°ì„ ìˆœìœ„

| í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|------|:----:|------|
| í•™ìŠµ ë¬¸ì œ ë™ì  ìƒì„±/ì „ë‹¬ | ë³´ë¥˜ | ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì™„ë¹„ í›„, ì‚¬ìš©ì ìš”êµ¬ ì‹œ êµ¬í˜„ |
| Lesson í†µê³„ ê¸°ëŠ¥ | ë³´ë¥˜ | `/admin/lessons/stats` â€” ê¸°ë³¸ progress ë°ì´í„° ìˆìŒ, ì¶”í›„ êµ¬í˜„ ì˜ˆì • |
| Login/Login_log í…Œì´ë¸” ê°œì„  | âœ… | UA ì„œë²„íŒŒì‹±(woothee), expire_at/active_at, revoked_reason, login_log ê°ì‚¬ ì»¬ëŸ¼, JWT jti, geo ê¸°ë³¸ê°’(LC/local/none) |
| í†µê³„ ë¹„ë™ê¸°/ë°°ì¹˜ ë¶„ë¦¬ | ë³´ë¥˜ | ì§‘ê³„/í†µê³„ ë³µì¡í•´ì§€ë©´ ê²€í†  |
| URL/í•¨ìˆ˜ëª… í†µì¼ | âœ… | 2026-02-02 ì™„ë£Œ â€” handler/service/repo ë„¤ì´ë° íŒ¨í„´ í†µì¼ |
| OAuth repo/service ì¤‘ë³µ í†µí•© | ë³´ë¥˜ | Apple OAuth ë“± ì„¸ ë²ˆì§¸ ì¸ì¦ ìˆ˜ë‹¨ ì¶”ê°€ ì‹œ ë¦¬íŒ©í† ë§ |
| enum sqlx::Type ë§¤í•‘ ì „í™˜ | ë³´ë¥˜ | ë‹¤êµ­ì–´ ì½˜í…ì¸  í™•ì¥ + ê²°ì œ ì—°ë™ ì™„ë£Œ í›„ ì§„í–‰ (ìˆ˜ë™ match â†’ `#[sqlx(type_name)]`) |

### 9.8 ë°ì´í„° ëª¨ë‹ˆí„°ë§ & ì ‘ê·¼

**í˜„ì¬ ìƒíƒœ**: SSH í„°ë„ + DB í´ë¼ì´ì–¸íŠ¸ë¡œ ìš´ì˜ ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥, Admin í†µê³„ API êµ¬í˜„ ì™„ë£Œ

#### 9.8.1 SSH í„°ë„ ì ‘ì†

```bash
# SSH í„°ë„ â†’ DBeaver/pgAdmin ì ‘ì†
ssh -i your-key.pem -L 5433:localhost:5432 ec2-user@43.200.180.110
# Host: localhost, Port: 5433, DB: amazing_korean_db
```

#### 9.8.2 Admin í†µê³„ API

- âœ… `/admin/users/stats`, `/admin/logins/stats`, `/admin/studies/stats`, `/admin/videos/stats`
- ğŸ”„ ì‹œìŠ¤í…œ ìƒíƒœ ëª¨ë‹ˆí„°ë§ (DB/Redis) â€” ë¯¸êµ¬í˜„

### 9.9 ë””ìì¸ & UI

**í˜„ì¬ ìƒíƒœ**: shadcn/ui + Tailwind ì‚¬ìš©, ë””ìì¸ ì‹œìŠ¤í…œ ë¯¸ì •ë¦½

**TODO**: ë¸Œëœë”©, íƒ€ì´í¬ê·¸ë˜í”¼, ë°˜ì‘í˜• ì ê²€

#### ë‹¤êµ­ì–´ UI ëŒ€ì‘ (22ê°œ ì–¸ì–´)

| í•­ëª© | ì„¤ëª… |
|------|------|
| **í°íŠ¸** | Noto Sans íŒ¨ë°€ë¦¬ ë™ì  ë¡œë”© (Latin/Cyrillic/CJK/Thai/Myanmar/Khmer/Sinhala/Devanagari/Arabic) |
| **RTL** | ì•„ëì–´(ar) â€” `direction: rtl`, CSS Logical Properties (`margin-inline-start` ë“±), ì•„ì´ì½˜ ë°©í–¥ ë°˜ì „ |
| **í…ìŠ¤íŠ¸ ê¸¸ì´** | ë…ì¼ì–´ ë“± 60%+ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆìŒ â†’ ê³ ì • í­ ê¸ˆì§€, flex/grid ì‚¬ìš©, `text-overflow: ellipsis` |
| **ì¤„ ë†’ì´** | Thai/Myanmar/Khmer/Sinhala ê²°í•© ë¬¸ì â†’ `line-height: 1.6~1.8` |
| **ë ˆì´ì•„ì›ƒ** | ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ê³µí†µ ëŒ€ì‘ ê°€ëŠ¥í•œ ìœ ì—°í•œ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„ |

### 9.10 ë§ˆì¼€íŒ… & ë°ì´í„° ë¶„ì„

**í˜„ì¬ ìƒíƒœ**: login_log, video_log, study_task_logë¡œ ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘ ì¤‘

**TODO**: ì‚¬ìš©ì ì„¸ê·¸ë¨¼íŠ¸ ì •ì˜, ë¦¬í…ì…˜ ë¶„ì„, ë§ˆì¼€íŒ… ìë™í™” ì—°ë™

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

## 10. ë³€ê²½ ì´ë ¥ (ìš”ì•½)

- **2026-02-06 â€” Gemini ì½”ë“œ ë¦¬ë·° ë°˜ì˜**
  - **ë°±ì—”ë“œ â€” ì½”ë“œ ìˆ˜ì • (8ê±´)**
    - `google.rs`: ID Token ì„œëª… ê²€ì¦ì„ Google JWKS ê³µê°œí‚¤ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½ (RS256, kid ë§¤ì¹­)
    - `ipgeo.rs`: `lookup()` ë°˜í™˜ íƒ€ì… `Option<GeoLocation>` â†’ `GeoLocation`, `is_private_ip()`ë¥¼ `std::net::IpAddr` íŒŒì‹±ìœ¼ë¡œ ê°œì„ 
    - `auth/service.rs`: ì´ë©”ì¼ ë¯¸ì„¤ì • ì‹œ `AppError::ServiceUnavailable` ë°˜í™˜, ì¸ë¼ì¸ Argon2 í•´ì‹± â†’ `password::hash_password()` í†µí•©, ì‹¤íŒ¨ ë¡œê¹… `let _ =` â†’ `if let Err(e)` + `warn!`
    - `admin/upgrade/service.rs`: ë¡œì»¬ `hash_password()` ì œê±° â†’ `password::hash_password()` ì‚¬ìš©, ì´ë©”ì¼ ë¯¸ì„¤ì • ì‹œ `ServiceUnavailable` ë°˜í™˜
    - `lesson/repo.rs`: DB ì—ëŸ¬ `.unwrap_or(false)` â†’ `?` ì „íŒŒ
    - `user/service.rs`: ipgeo `.unwrap_or_default()` ì œê±°
  - **ë¬¸ì„œ ì •ë¦¬**
    - Section 9.5/9.7ì— ì¶”í›„ ì‘ì—… í•­ëª© 5ê±´ ì¶”ê°€ (í† í° ìºì‹±, GeoIP ì „í™˜, i18n async, OAuth ì¤‘ë³µ í†µí•©, enum ë§¤í•‘)
    - ë¶ˆì¼ì¹˜ ë¬¸ì„œ 4ê±´ ì‚­ì œ: `AMK_BACKEND_STATUS.md`, `AMK_FRONTEND_STATUS.md`, `homepage_layout_design.md`, `login_table_plan.md`
    - `.gitignore`ì— `.aws/` ì¶”ê°€
    - Section 5.3-1 ì†Œì…œ ì „ìš© ê³„ì • ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ ìˆ˜ì •

- **2026-02-05 â€” Login/Login_log í…Œì´ë¸” ê°œì„ **
  - **ë°±ì—”ë“œ â€” User-Agent ì„œë²„ì‚¬ì´ë“œ íŒŒì‹±**
    - `woothee` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€, `ParsedUa` êµ¬ì¡°ì²´ ë° `parse_user_agent()` í•¨ìˆ˜ êµ¬í˜„
    - `login_os`, `login_browser`, `login_device`ë¥¼ ì„œë²„ì—ì„œ ìë™ ì±„ì›€ (í”„ë¡ íŠ¸ì—”ë“œ ì „ì†¡ ì œê±°)
    - OAuth/ì¼ë°˜ ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‘ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
  - **ë°±ì—”ë“œ â€” login í…Œì´ë¸” ì»¬ëŸ¼ í™œì„±í™”**
    - `login_expire_at`: `NOW() + refresh_ttl_secs` ê¸°ë¡, í† í° ê°±ì‹  ì‹œ ê°±ì‹ 
    - `login_active_at`: í† í° ê°±ì‹ (refresh) ì‹œ `NOW()` ì—…ë°ì´íŠ¸
    - `login_revoked_reason`: ìƒíƒœ ë³€ê²½ ì‹œ ì‚¬ìœ  ê¸°ë¡ (ê¸°ë³¸ê°’ `none`, revoke ì‹œ `password_changed`/`security_concern` ë“±)
  - **ë°±ì—”ë“œ â€” login_log í…Œì´ë¸” ê°ì‚¬ ì»¬ëŸ¼ í™œì„±í™”**
    - `login_access_log`: access token SHA-256 í•´ì‹œ (64ì)
    - `login_token_id_log`: JWT `jti` claim (UUID v4)
    - `login_fail_reason_log`: ì‹¤íŒ¨ ì‚¬ìœ  (ê¸°ë³¸ê°’ `none`, ì‹¤íŒ¨ ì‹œ `invalid_credentials`/`account_disabled`/`token_reuse`)
    - `login_expire_at_log`: ì„¸ì…˜ ë§Œë£Œ ì‹œê° ê¸°ë¡
    - login_log geo ì»¬ëŸ¼ì— COALESCE ê¸°ë³¸ê°’ ì¶”ê°€ (`LC`/`0`/`local`)
  - **ë°±ì—”ë“œ â€” JWT jti claim ì¶”ê°€**
    - `jwt::create_token()`ì—ì„œ UUID v4 ê¸°ë°˜ `jti` ìƒì„±, `Claims` êµ¬ì¡°ì²´ì— `jti` í•„ë“œ ì¶”ê°€
  - **ë°±ì—”ë“œ â€” Geo/NULL ê¸°ë³¸ê°’ ì •ì±… ë³€ê²½**
    - Private IP ê¸°ë³¸ê°’: `ZZ`â†’`LC`, `Unknown`â†’`local` (login/login_log ëª¨ë“  COALESCE)
    - `login_revoked_reason` NULLâ†’`none`, `login_fail_reason_log` NULLâ†’`none`
  - **í”„ë¡ íŠ¸ì—”ë“œ â€” ë²„ê·¸ ìˆ˜ì •**
    - `client.ts`: request interceptor ì¶”ê°€ (zustand â†’ axios Authorization í—¤ë” ìë™ ì„¤ì •)
    - `use_user_settings.ts`: `enabled` ì˜µì…˜ + `staleTime: 5ë¶„` ì¶”ê°€ (ë¯¸ë¡œê·¸ì¸ ì‹œ 401 ë£¨í”„ ë°©ì§€)
    - `use_language_sync.ts`: `{ enabled: isLoggedIn }` ì „ë‹¬
    - `types.ts`: `LoginReq`ì—ì„œ ë¶ˆí•„ìš” í•„ë“œ(`device`/`browser`/`os`) ì œê±°
  - **íŒŒì¼ ë³€ê²½ ëª©ë¡**
    - `Cargo.toml` â€” `woothee` ì˜ì¡´ì„± ì¶”ê°€
    - `src/api/auth/handler.rs` â€” `ParsedUa`, `parse_user_agent()` ì¶”ê°€
    - `src/api/auth/dto.rs` â€” `LoginReq` ê°„ì†Œí™”
    - `src/api/auth/jwt.rs` â€” `jti` claim ì¶”ê°€
    - `src/api/auth/repo.rs` â€” INSERT/UPDATE ì¿¼ë¦¬ì— ì‹ ê·œ ì»¬ëŸ¼ ë°˜ì˜, COALESCE ê¸°ë³¸ê°’ ë³€ê²½
    - `src/api/auth/service.rs` â€” UA/geo/audit íŒŒë¼ë¯¸í„° ì „ë‹¬, revoked_reason/fail_reason ê¸°ë³¸ê°’
    - `src/api/user/handler.rs` â€” UA íŒŒì‹± í˜¸ì¶œ
    - `src/api/user/service.rs` â€” íšŒì›ê°€ì… ë¡œê·¸ì— audit íŒŒë¼ë¯¸í„° ì¶”ê°€
    - `frontend/src/api/client.ts` â€” request interceptor ì¶”ê°€
    - `frontend/src/category/auth/types.ts` â€” LoginReq í•„ë“œ ì œê±°
    - `frontend/src/category/user/hook/use_user_settings.ts` â€” enabled/staleTime ì¶”ê°€
    - `frontend/src/hooks/use_language_sync.ts` â€” enabled ì¡°ê±´ ì¶”ê°€

- **2026-02-05 â€” DB ë³´ì•ˆ ê°•í™” ê³„íš ìˆ˜ë¦½**
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ AES-256-GCM ì•”í˜¸í™” ë°©ì‹ ê²°ì • (pgcrypto, AWS KMS ë¹„êµ í›„)
  - ì•”í˜¸í™” ëŒ€ìƒ í•„ë“œ ì‹ë³„: `user_email`, `user_name`, `user_birthday`, `oauth_email`, `oauth_subject`, `login_ip` ë“±
  - Blind Index (HMAC-SHA256) ì„¤ê³„: ê²€ìƒ‰ í•„ìš” í•„ë“œ(email, oauth_subject)ëŠ” ê°™ì€ í…Œì´ë¸”ì— `_idx` ì»¬ëŸ¼ ì¶”ê°€
  - í‚¤ ê´€ë¦¬: `ENCRYPTION_KEY` + `HMAC_KEY` (í™˜ê²½ë³€ìˆ˜, ê° 32ë°”ì´íŠ¸)
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ: 3ë‹¨ê³„ ì ì§„ì  (í˜¸í™˜ ëª¨ë“œ â†’ ì¼ê´„ ì•”í˜¸í™” â†’ ì •ë¦¬)
  - ë³´ì•ˆ ë¡œë“œë§µ: 1ë‹¨ê³„ ì•± ë ˆë²¨ AES â†’ 2ë‹¨ê³„ AWS KMS â†’ 3ë‹¨ê³„ HSM
  - Section 9.7 ë¡œë“œë§µì— "ë³´ì•ˆ & ë°ì´í„° ë³´í˜¸" ì„¹ì…˜ ì¶”ê°€

- **2026-02-05 â€” ë‹¤êµ­ì–´ ì½˜í…ì¸  í™•ì¥ ê³„íš ìˆ˜ë¦½**
  - 22ê°œ ì–¸ì–´ ì§€ì› ê³„íš: en, zh-CN, zh-TW, ja, vi, id, th, my, km, mn, ru, uz, kk, tg, ne, si, hi, es, pt, fr, de, ar
  - `content_translations` ë²ˆì—­ í…Œì´ë¸” ì„¤ê³„ (ì •ê·œí™”, fallback íŒ¨í„´)
  - í°íŠ¸ ì „ëµ: Noto Sans íŒ¨ë°€ë¦¬ ë™ì  ë¡œë”© (50MB+ â†’ ì–¸ì–´ë³„ ì„ íƒ ë¡œë“œ)
  - RTL ëŒ€ì‘ (ì•„ëì–´): CSS Logical Properties, direction: rtl
  - ë²ˆì—­ íŒŒì´í”„ë¼ì¸: AI ìë™ ì´ˆì•ˆ â†’ ê´€ë¦¬ì ê²€ìˆ˜ â†’ ìŠ¹ì¸
  - ë‹¨ê³„ì  ì ‘ê·¼: Phase 1 ê¸°ë°˜ â†’ Phase 2 í•µì‹¬ 5ê°œ(en,ja,zh-CN,zh-TW,vi) â†’ Phase 3 ë‚˜ë¨¸ì§€ 17ê°œ
  - Section 9.7 ë¡œë“œë§µì— "ë‹¤êµ­ì–´ ì½˜í…ì¸  í™•ì¥" ì„¹ì…˜ ì¶”ê°€, Section 9.9ì— ë‹¤êµ­ì–´ UI ëŒ€ì‘ ì¶”ê°€

- **2026-02-05 â€” ë‹¤êµ­ì–´ ì§€ì› (i18n) êµ¬í˜„**
  - ìƒì„¸: Section 6.2.4 ì°¸ì¡°

- **2026-02-03 â€” MyPage UI ë¦¬ë””ìì¸ & ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í”Œë¡œìš°**
  - **ë°±ì—”ë“œ**
    - `ProfileRes`ì— `has_password: bool` í•„ë“œ ì¶”ê°€ (OAuth ì „ìš© ê³„ì • êµ¬ë¶„)
    - `GET /users/me`, `POST /users/me` ì‘ë‹µì— `has_password` í¬í•¨
  - **í”„ë¡ íŠ¸ì—”ë“œ**
    - MyPage UI ë¦¬ë””ìì¸
      - í”„ë¡œí•„ í—¤ë”: ë‹‰ë„¤ì„ + user_auth ë±ƒì§€ë§Œ í‘œì‹œ
      - ë³´ê¸° ëª¨ë“œ í•„ë“œ ìˆœì„œ: ë‹‰ë„¤ì„ â†’ ì´ë¦„ â†’ ì´ë©”ì¼ â†’ ê°€ì…ì¼ â†’ ìƒë…„ì›”ì¼ â†’ ì–¸ì–´ â†’ êµ­ê°€ â†’ ì„±ë³„
      - í™˜ê²½ ì„¤ì • ë²„íŠ¼ì„ ìˆ˜ì • ë²„íŠ¼ ì˜†ìœ¼ë¡œ ì´ë™
      - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë²„íŠ¼ ì¶”ê°€ (OAuth ì „ìš© ê³„ì •ì€ ìˆ¨ê¹€)
    - `/request-reset-password` í˜ì´ì§€ ìƒì„± (PrivateRoute ë³´í˜¸)
      - ë¡œê·¸ì¸ ì‚¬ìš©ì ì´ë©”ì¼ ìë™ ì±„ìš°ê¸°
      - OAuth ì „ìš© ê³„ì • ì ‘ê·¼ ì‹œ ë§ˆì´í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      - ì´ë©”ì¼ ì…ë ¥ â†’ ì¸ì¦ë²ˆí˜¸ ì „ì†¡ â†’ ì¸ì¦ë²ˆí˜¸ í™•ì¸ UI (ë°±ì—”ë“œ API ì—°ë™ ëŒ€ê¸°)
    - í™˜ê²½ ì„¤ì • í˜ì´ì§€ì— ë§ˆì´í˜ì´ì§€ ëŒì•„ê°€ê¸° ë§í¬ ì¶”ê°€
    - `UserDetail` íƒ€ì…ì— `has_password: boolean` ì¶”ê°€
  - **ë¬¸ì„œ**
    - Section 7.7.1-1 ProfileRes ì½”ë“œ ì˜ˆì‹œ ì—…ë°ì´íŠ¸

- **2026-02-03 â€” Google OAuth ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„**
  - **ë°±ì—”ë“œ**
    - `GET /auth/google` â€” OAuth ì‹œì‘ (auth_url ë°˜í™˜)
    - `GET /auth/google/callback` â€” OAuth ì½œë°± ì²˜ë¦¬ (í† í° ë°œê¸‰, í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸)
    - `src/external/google.rs` â€” Google OAuth í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
    - `migrations/20260203_ADD_OAUTH_SUPPORT.sql` â€” `user_oauth` í…Œì´ë¸” ì¶”ê°€, `users.user_password` NULL í—ˆìš©
  - **í”„ë¡ íŠ¸ì—”ë“œ**
    - ë¡œê·¸ì¸ í˜ì´ì§€ì— "Googleë¡œ ë¡œê·¸ì¸" ë²„íŠ¼ ì¶”ê°€
    - `use_google_login.ts` í›… ìƒì„±
    - OAuth ì½œë°± ì²˜ë¦¬ (refreshToken í˜¸ì¶œ â†’ ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸)
  - **ë¬¸ì„œ**
    - Section 5.3 Phase 3 authì— 3-6 Google OAuth ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
    - Section 9.7 ì™¸ë¶€ API ì—°ê²° ë¡œë“œë§µ ì—…ë°ì´íŠ¸

- **2025-11-18**
  - `AMK_Feature_Roadmap.md`, `AMK_PROJECT_JOURNAL.md`, `AMK_ENGINEERING_GUIDE.md`, `AMK_API_OVERVIEW_FULL.md`, `README_for_assistant.md`ì˜ í•µì‹¬ ë‚´ìš©ì„ í†µí•©.
  - ì´ ë¬¸ì„œ(`AMK_API_MASTER.md`)ë¥¼ í”„ë¡œì íŠ¸ì˜ ë‹¨ì¼ ê¸°ì¤€ ë¬¸ì„œë¡œ ì§€ì •.
- **2026-01-21**
  - Section 0.4 "LLM í˜‘ì—… ê°€ì´ë“œ" ì¶”ê°€ (LLM í™œìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë° ì°¸ì¡° ë°©ë²•)
  - Section 3.7 "ì¸ì¦ & ì„¸ì…˜ ê´€ë¦¬ (í†µí•©)" ì¶”ê°€ (ì‚°ì¬ëœ ì¸ì¦ ê´€ë ¨ ë‚´ìš© í†µí•©)
  - Section 5.0 "Phase ë¡œë“œë§µ ì²´í¬ë°•ìŠ¤ ë²”ë¡€" ì¶”ê°€ (âœ…ğŸ†—âš ï¸âŒğŸ”„ ì˜ë¯¸ ëª…í™•í™”)
  - ë¬¸ì„œ ì „ì²´ ëª©ì°¨(TOC) ì¶”ê°€ ë° ì–‘ë°©í–¥ ë§í¬ êµ¬í˜„ (ê° ì„¹ì…˜ ì‹œì‘/ëì— "ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°" ë§í¬)
  - ì™¸ë¶€ íŒŒì¼ ì°¸ì¡° ë§í¬ ì—…ë°ì´íŠ¸ (AMK_SCHEMA_PATCHED.md, LLM_PATCHS_TEMPLATE_*.md)
- **2026-01-22**
  - Section 7.7.2 "í”„ë¡ íŠ¸ì—”ë“œ íŒ¨í„´" ì‹¤ì œ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ ì „ë©´ ì¬ì‘ì„± (ê¸°ì¡´ LLM ë¶„ì„ ë‚´ìš© ì œê±°)
  - Section 5 Phase ë²ˆí˜¸ ì²´ê³„ ì •ë¦¬ (5.3 video â†’ 5.4, 5.4 study â†’ 5.5, 5.5 lesson â†’ 5.6, 5.5.6 admin â†’ 5.7, 5.7 scripts â†’ 5.8)
  - ëª©ì°¨(TOC) ì‹¤ì œ ì„¹ì…˜ í—¤ë”©ê³¼ ë™ê¸°í™” (Section 6, 7, 8, 9 í•˜ìœ„ í•­ëª© ì¶”ê°€)
  - Section 9.6 "ì½”ë“œ ì¼ê´€ì„± (Technical Debt)" ì¶”ê°€
  - Section 9.7 "ì¶”í›„ ì‘ì—… í•­ëª© (ë¬¸ì„œ ë‚´ TODO í†µí•©)" ì¶”ê°€
- **2026-01-28 â€” Vimeo API ì—°ë™ & Admin Video ë¬¸ì„œí™”**
  - **Vimeo API ì—°ë™ (Phase 5 & 6 ê³„íš ê¸°ë°˜)**
    - `GET /admin/videos/vimeo/preview` â€” Vimeo ë©”íƒ€ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (7-10)
    - `POST /admin/videos/vimeo/upload-ticket` â€” Vimeo tus ì—…ë¡œë“œ í‹°ì¼“ ìƒì„± (7-11)
    - `video` í…Œì´ë¸”ì— `video_duration`, `video_thumbnail` ì»¬ëŸ¼ ì¶”ê°€
  - **Admin Video ì—”ë“œí¬ì¸íŠ¸ ì •ë¹„**
    - `GET /admin/videos/{id}` ìƒì„¸ ì¡°íšŒ ì¶”ê°€ (7-9)
    - Phase 7 ì—”ë“œí¬ì¸íŠ¸ ë²ˆí˜¸ ì¬ì •ë ¬ (7-8 ~ 7-57, ì´í›„ Study Stats ì¶”ê°€ë¡œ 7-67ê¹Œì§€ í™•ì¥)
  - **ë¬¸ì„œ ì—…ë°ì´íŠ¸**
    - Section 4.3 ë¹„ë””ì˜¤ ë„ë©”ì¸ì— ì‹ ê·œ ì»¬ëŸ¼ ëª…ì„¸ ì¶”ê°€
    - Section 5.4 Phase 4 videoì— ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ìƒì„¸ ì¶”ê°€ (VideoListItem, VideoDetailRes, VideoProgressRes)
    - Section 5.7 Phase 7 admin video ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ ê°±ì‹ 
- **2026-01-26 â€” v1.0.0 MVP ë¦´ë¦¬ìŠ¤**
  - **MVP ë°°í¬ ì™„ë£Œ**
    - Frontend: Cloudflare Pages (`amazingkorean.net`)
    - Backend: AWS EC2 (`api.amazingkorean.net`)
    - SSL: Cloudflare Flexible ëª¨ë“œ
  - **GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**
    - Section 6.6.2-3 "GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸" ì¶”ê°€
    - EC2ì—ì„œ ë¹Œë“œ ë¶ˆí•„ìš” â†’ t2.micro ìœ ì§€ ê°€ëŠ¥
    - `git push`ë§Œìœ¼ë¡œ ìë™ ë°°í¬
  - **ë°°í¬ ìµœì í™”**
    - `.dockerignore` ì¶”ê°€ (docs, frontend, .git ë“± ì œì™¸)
    - `docker-compose.prod.yml` Docker Hub ì´ë¯¸ì§€ ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
    - Section 6.6.2-4 "EC2 ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ" ì¶”ê°€
  - **ë²„ì „ ê´€ë¦¬**: Cargo.toml `version = "1.0.0"`, Git tag `v1.0.0` ìƒì„±
  - **Section 9 í™•ì¥** (Open Questions & ì„¤ê³„ TODO)
    - Section 9.8 "LLM í˜‘ì—… ë„êµ¬ ì „í™˜" ì¶”ê°€ (Patch í…œí”Œë¦¿ ì²˜ë¦¬ + GitHub Gemini)
    - Section 9.9 "ì¸í”„ë¼ ë¡œë“œë§µ (RDS ì´ì „)" ì¶”ê°€ (ì´ì „ ìˆœì„œ ë° ì‹œì  ê¸°ì¤€)
    - Section 9.10 "ë°ì´í„° ëª¨ë‹ˆí„°ë§ & ì ‘ê·¼" ì¶”ê°€ (SSH í„°ë„, Admin ëŒ€ì‹œë³´ë“œ, ë™ê¸°í™”)
    - ì´í›„ ë³€ê²½ ì‚¬í•­ì€ ì»¤ë°‹ ë©”ì‹œì§€ `docs: update AMK_API_MASTER <ìš”ì•½>` í˜•ì‹ìœ¼ë¡œ ê´€ë¦¬í•˜ê³ , í•„ìš” ì‹œ ì´ ì„¹ì…˜ì— ì¤‘ìš”í•œ ë°©í–¥ ì „í™˜ë§Œ ì¶”ê°€í•œë‹¤.
- **2026-01-28 â€” User/Login Stats & TODO ì •ë¹„**
  - **User/Login Stats êµ¬í˜„ (í˜„ì¬ 7-63 ~ 7-67ë¡œ ì¬ë²ˆí˜¸)**
    - `GET /admin/users/stats/summary` â€” ì—­í• ë³„(HYMN/admin/manager/learner) í†µê³„ë¡œ ë³€ê²½
    - `GET /admin/users/stats/signups` â€” ì—­í• ë³„ ì¼ë³„ ê°€ì… í†µê³„
    - `GET /admin/logins/stats/summary` â€” ë¡œê·¸ì¸ ì„±ê³µ/ì‹¤íŒ¨/ê³ ìœ ì‚¬ìš©ì/í™œì„±ì„¸ì…˜
    - `GET /admin/logins/stats/daily` â€” ì¼ë³„ ë¡œê·¸ì¸ í†µê³„
    - `GET /admin/logins/stats/devices` â€” ë””ë°”ì´ìŠ¤ë³„ í†µê³„
  - **ë²„ê·¸ ìˆ˜ì •**
    - Video ìƒì„¸ ì¡°íšŒ ì‹œ `video_state = 'open'` í•„í„° ì¶”ê°€ (ë¹„ê³µê°œ ì˜ìƒ ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨)
  - **Section 9 TODO ì—…ë°ì´íŠ¸**
    - Section 9.2 ë¡œê·¸ í…Œì´ë¸” ì—­í• ë³„ êµ¬ë¶„ í•­ëª© ì¶”ê°€
    - Section 9.7 ê¸°ëŠ¥ ê°œë°œì— Admin í¼ ê²€ì¦, ì˜ìƒ ì‹œì²­ ì‹œê°„, í† í”½ ì •ë‹µ ê²€ì‚¬, í•™ìŠµ ë¬¸ì œ ìƒì„± ì¶”ê°€
    - Section 9.11.2 ì—ëŸ¬ í˜ì´ì§€ í•­ëª© ì¶”ê°€
    - Section 9.12 "ë§ˆì¼€íŒ… & ë°ì´í„° ë¶„ì„" ì‹ ê·œ ì¶”ê°€
- **2026-01-29 â€” Admin Study Stats & Phase 7 ì •ë¹„**
  - **Study Stats êµ¬í˜„ (7-42 ~ 7-44)**
    - `GET /admin/studies/stats/summary` â€” ì´ í•™ìŠµìˆ˜/Taskìˆ˜/ì‹œë„ìˆ˜/í•´ê²°ìˆ˜/í•´ê²°ë¥ , Programë³„(basic_pronunciation/basic_word/basic_900/topik_read/topik_listen/topik_write/tbc)/Stateë³„(ready/open/close) ë¶„í¬
    - `GET /admin/studies/stats/top` â€” TOP í•™ìŠµ ì¡°íšŒ (ì‹œë„ìˆ˜/í•´ê²°ìˆ˜/í•´ê²°ë¥  ì •ë ¬, limit 1-50)
    - `GET /admin/studies/stats/daily` â€” ì¼ë³„ ì‹œë„ìˆ˜/í•´ê²°ìˆ˜/í™œì„±ì‚¬ìš©ì, ì œë¡œí•„
  - **Phase 7 ì—”ë“œí¬ì¸íŠ¸ ë²ˆí˜¸ ì¬ì •ë ¬ (7-1 ~ 7-67)**
    - ì¤‘ë³µëœ ë²ˆí˜¸ ìˆ˜ì • (7-23, 7-28 ì¤‘ë³µ í•´ì†Œ)
    - `GET /admin/studies/{id}` (7-23), `GET /admin/studies/tasks/{id}` (7-29) ëª…í™•í™”
    - Study Stats ì¶”ê°€ë¡œ ì¸í•œ í›„ì† ë²ˆí˜¸ ì¡°ì • (Lessons: 7-45~7-62, User/Login Stats: 7-63~7-67)
  - **í”„ë¡ íŠ¸ì—”ë“œ Study Stats í˜ì´ì§€ êµ¬í˜„**
    - `/admin/studies/stats` ë¼ìš°íŠ¸ ì¶”ê°€
    - Summary Cards, Program/State ë¶„í¬ ì°¨íŠ¸, TOP Studies í…Œì´ë¸”, Daily Stats í…Œì´ë¸”
    - Studies ëª©ë¡ í˜ì´ì§€ì— Stats ë²„íŠ¼ ì¶”ê°€
- **2026-01-31 â€” Admin Lesson í”„ë¡ íŠ¸ì—”ë“œ & Phase 7 Lesson ì •ë¹„**
  - **Admin Lesson í”„ë¡ íŠ¸ì—”ë“œ ì™„ì„±**
    - `/admin/lessons` â€” ëª©ë¡ (ê²€ìƒ‰/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜/ë²Œí¬ ìˆ˜ì •)
    - `/admin/lessons/new` â€” ë‹¨ê±´ ìƒì„±
    - `/admin/lessons/bulk-create` â€” CSV ë²Œí¬ ìƒì„±
    - `/admin/lessons/:lessonId` â€” ìƒì„¸/ìˆ˜ì • (Info/Items/Progress íƒ­)
  - **Lesson Items DELETE ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (7-57, 7-58)**
    - `DELETE /admin/lessons/{id}/items/{seq}` â€” ìˆ˜ì—… ì•„ì´í…œ ë‹¨ê±´ ì‚­ì œ
    - `DELETE /admin/lessons/bulk/items` â€” ìˆ˜ì—… ì•„ì´í…œ ë‹¤ì¤‘ ì‚­ì œ
  - **Phase 7 ì—”ë“œí¬ì¸íŠ¸ ë²ˆí˜¸ ì¬ì •ë ¬ (7-45 ~ 7-67)**
    - Lessons: 7-45~7-62 (DELETE ì¶”ê°€ë¡œ +2)
    - User/Login Stats: 7-63~7-67 (ê¸°ì¡´ 7-61~7-65ì—ì„œ +2)
  - **Study Task ì ‘ê·¼ ì œì–´ ê°œì„ **
    - `study_state = 'open'` í•„í„° ì¶”ê°€ (ë¶€ëª¨ Studyê°€ ë‹«íˆë©´ Task ì ‘ê·¼ ì°¨ë‹¨)
    - `find_task_detail`, `find_answer_key`, `get_try_count`, `find_task_explain`, `exists_task` í•¨ìˆ˜ì— INNER JOIN study ì¶”ê°€
  - **Progress ìˆ˜ì • UI êµ¬í˜„**
    - Lesson Progress íƒ­ì— ë‹¨ê±´/ë²Œí¬ ìˆ˜ì • ë‹¤ì´ì–¼ë¡œê·¸ ì¶”ê°€
    - Last Item Seq í•„ë“œì— max ì œì•½ (lesson items ê¸°ì¤€)
- **2026-02-02 â€” URL/í•¨ìˆ˜ëª… í†µì¼ ë¦¬íŒ©í† ë§**
  - **Handler ë„¤ì´ë° í†µì¼**
    - `create_video_handler` â†’ `admin_create_video`
    - `get_vimeo_preview_handler` â†’ `admin_get_vimeo_preview`
    - `create_vimeo_upload_ticket_handler` â†’ `admin_create_vimeo_upload_ticket`
    - `get_task_explain_handler` â†’ `get_task_explain`
    - `admin_get_lesson_detail` â†’ `admin_get_lesson`
  - **Admin User logs í•¨ìˆ˜ëª… prefix í†µì¼**
    - `get_admin_user_logs` â†’ `admin_get_user_logs`
    - `get_user_self_logs` â†’ `admin_get_user_self_logs`
  - **Video repo í•¨ìˆ˜ëª… í†µì¼**
    - `find_list_dynamic` â†’ `list_videos`
    - `find_detail_by_id` â†’ `get_video_detail`
    - `find_progress` â†’ `get_progress`
    - `upsert_progress` â†’ `update_progress`
  - **Section 9.7 "ë³´ë¥˜/ë‚®ìŒ ìš°ì„ ìˆœìœ„" ì—…ë°ì´íŠ¸**
    - URL/í•¨ìˆ˜ëª… í†µì¼ âœ… ì™„ë£Œ
    - Login ì •ë³´/ë¡œê·¸ ì¶”ê°€ âœ… â€” ip-api.com ì—°ë™ ì™„ë£Œ
    - Lesson í†µê³„ ê¸°ëŠ¥ â€” ì¶”í›„ êµ¬í˜„ ì˜ˆì •
- **2026-02-04 â€” Admin Upgrade (ê´€ë¦¬ì ì´ˆëŒ€) ì‹œìŠ¤í…œ êµ¬í˜„**
  - **ë°±ì—”ë“œ (7-68 ~ 7-70)**
    - `POST /admin/upgrade` â€” ê´€ë¦¬ì ì´ˆëŒ€ ì½”ë“œ ìƒì„± + AWS SES ì´ë©”ì¼ ë°œì†¡
    - `GET /admin/upgrade/verify` â€” ì´ˆëŒ€ ì½”ë“œ ê²€ì¦ (Public)
    - `POST /admin/upgrade/accept` â€” ê´€ë¦¬ì ê³„ì • ìƒì„± (Public, OAuth ë¶ˆê°€)
    - RBAC ì •ì±…: HYMNâ†’Admin/Manager, Adminâ†’Manager, Managerâ†’ë¶ˆê°€
    - Redis TTL 10ë¶„, ì¼íšŒìš© ì½”ë“œ (ak_upgrade_{uuid})
    - `EmailTemplate::AdminInvite` ì¶”ê°€ (invite_url, role, invited_by, expires_in_min)
  - **í”„ë¡ íŠ¸ì—”ë“œ**
    - `types.ts` â€” Upgrade íƒ€ì… ì¶”ê°€ (UpgradeInviteReq/Res, UpgradeVerifyRes, UpgradeAcceptReq/Res)
    - `admin_api.ts` â€” API í•¨ìˆ˜ ì¶”ê°€ (createAdminInvite, verifyAdminInvite, acceptAdminInvite)
    - `/admin/upgrade/join` â€” ì´ˆëŒ€ ìˆ˜ë½ í˜ì´ì§€ (Public ë¼ìš°íŠ¸)
    - `/admin/users` â€” "Invite Admin" ë²„íŠ¼ ë° ì´ˆëŒ€ ë‹¤ì´ì–¼ë¡œê·¸ ì¶”ê°€
  - **íŒŒì¼ ë³€ê²½ ëª©ë¡**
    - `src/api/admin/upgrade/` â€” dto.rs, service.rs, handler.rs, router.rs, mod.rs (ì‹ ê·œ)
    - `src/api/admin/mod.rs`, `src/api/admin/router.rs` â€” upgrade ëª¨ë“ˆ ë“±ë¡
    - `src/api/user/repo.rs` â€” find_user_by_email, find_user_by_nickname, create_admin_user ì¶”ê°€
    - `src/external/email.rs` â€” AdminInvite í…œí”Œë¦¿ ì¶”ê°€
    - `frontend/src/category/admin/types.ts` â€” Section 9 (Upgrade íƒ€ì…)
    - `frontend/src/category/admin/admin_api.ts` â€” Section 9 (Upgrade API)
    - `frontend/src/category/admin/page/admin_upgrade_join.tsx` â€” ì‹ ê·œ
    - `frontend/src/category/admin/page/admin_users_page.tsx` â€” ì´ˆëŒ€ ë‹¤ì´ì–¼ë¡œê·¸ ì¶”ê°€
    - `frontend/src/app/routes.tsx` â€” /admin/upgrade/join ë¼ìš°íŠ¸ ì¶”ê°€
- **2026-02-04 â€” IP Geolocation ê¸°ëŠ¥ êµ¬í˜„**
  - **ê¸°ëŠ¥**: ë¡œê·¸ì¸ ì‹œ IP ê¸°ë°˜ ì§€ë¦¬ì •ë³´ ìë™ ì¡°íšŒ (ip-api.com ì—°ë™)
  - **ì €ì¥ í•„ë“œ**: `login_country`, `login_asn`, `login_org`
  - **ì ìš© í…Œì´ë¸”**: `login` (í™œì„± ì„¸ì…˜), `login_log` (ì´ë ¥)
  - **íŒŒì¼ ë³€ê²½ ëª©ë¡**
    - `src/external/ipgeo.rs` â€” IpGeoClient êµ¬í˜„ (ì‹ ê·œ)
    - `src/external/mod.rs` â€” ipgeo ëª¨ë“ˆ ë“±ë¡
    - `src/state.rs` â€” AppStateì— `Arc<IpGeoClient>` ì¶”ê°€
    - `src/main.rs` â€” IpGeoClient ì´ˆê¸°í™”
    - `src/api/auth/repo.rs` â€” insert_login_record_tx, insert_login_record_oauth_txì— ì§€ë¦¬ì •ë³´ íŒŒë¼ë¯¸í„° ì¶”ê°€
    - `src/api/auth/service.rs` â€” ë¡œê·¸ì¸/OAuth ì„¸ì…˜ ìƒì„± ì‹œ geo ë°ì´í„° ì „ë‹¬
    - `src/api/user/service.rs` â€” íšŒì›ê°€ì… ìë™ ë¡œê·¸ì¸ì— geo ë°ì´í„° ì „ë‹¬

[â¬†ï¸ ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](#-ëª©ì°¨-table-of-contents)

---

**ë¬¸ì„œ ë (End of Document)**
