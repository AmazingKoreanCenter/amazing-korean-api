# PATCH — Phase 3-2 Video Detail (GET /videos/{id})

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 3-2 `GET /videos/{id}` 엔드포인트 구현.
- `video_id`에 해당하는 비디오 정보와 연결된 태그들의 상세 정보(제목, 설명 등)를 반환.
- 존재하지 않는 ID 요청 시 **404 Not Found** 반환.

CONTEXT (SSOT & Rules):
- **Spec**: `docs/AMK_API_MASTER.md`의 [3-2] 참조.
- **Schema**: `video` 테이블에는 메타 정보(제목 등)가 없음. `video_tag`를 조인해서 가져와야 함.
- **Aggregation**:
  - 상세 화면이므로 태그의 단순 이름뿐만 아니라 `video_tag_title`, `video_tag_subtitle`, `video_tag_key` 등 상세 정보를 구조체(`JSON`) 형태로 집계해서 반환해야 함.
  - PostgreSQL의 `jsonb_agg`와 `jsonb_build_object`를 사용 권장.
- **Type Safety**:
  - `video_id`는 DB에서 `INT4`이므로 조회 시 **`::bigint`로 캐스팅** 필수.

CONTRACT (구현 명세):
- [HTTP] `GET /videos/{id}`
- [Param] `id` (u64)
- [Response] `VideoDetailRes`
  ```json
  {
    "video_id": 1,
    "video_url_vimeo": "...",
    "video_state": "open",
    "tags": [
      { "key": "basic-01", "title": "한글 모음", "subtitle": "..." },
      ...
    ],
    "created_at": "..."
  }
  ```
- [Logic]:
  1. **Query**: `video` + `video_tag_map` + `video_tag` LEFT JOIN.
  2. **Aggregation**: `GROUP BY video_id`. 태그 정보는 JSON 배열로 변환.
  3. **Result**: 결과가 없으면(None) -> **404 Not Found** (Service Layer).

IMPLEMENTATION STEPS:
1.  **DTO (`src/api/video/dto.rs`)**:
    - `VideoTagDetail`: 태그 상세 정보 (`key`, `title`, `subtitle`).
    - `VideoDetailRes`: 응답용 구조체 (`sqlx::FromRow`). `tags` 필드는 `sqlx::types::Json<Vec<VideoTagDetail>>` 사용.
2.  **Repo (`src/api/video/repo.rs`)**:
    - `find_video_by_id`:
      - SQL: `SELECT ..., jsonb_agg(...) as tags FROM ... WHERE video_id = $1 GROUP BY ...`
      - **주의**: `video_id` 캐스팅(`::bigint`) 잊지 말 것.
3.  **Service (`src/api/video/service.rs`)**:
    - `get_video`: Repo 호출 결과가 `None`이면 `AppError::NotFound` 반환.
4.  **Handler (`src/api/video/handler.rs`)**:
    - `get_video`: `Path(id)` 추출 및 서비스 호출.
5.  **Router (`src/api/video/router.rs`)**:
    - `/:id` 라우트 등록.

FILE PATCHES START
// src/api/video/dto.rs
// src/api/video/repo.rs
// src/api/video/service.rs
// src/api/video/handler.rs
// src/api/video/router.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. 존재하는 비디오 상세 조회 (성공 -> 200)
curl -v "http://localhost:3000/videos/1"

# 2. 존재하지 않는 비디오 조회 (실패 -> 404)
curl -v "http://localhost:3000/videos/9999"

# 3. 잘못된 ID 형식 (실패 -> 400)
curl -v "http://localhost:3000/videos/abc"
```