# 📝 Dev Notes: Phase 2-4 Implementation (POST /auth/find-id)

## 📋 개요
- **작업**: 회원 아이디(가입 여부) 찾기 API (`POST /auth/find-id`)
- **기간**: 2025.12.30
- **성격**: Enumeration Safety(계정 열거 방지), Privacy Protection

---

## 🛠️ 트러블슈팅 (Troubleshooting)

### 1. 스키마와 기획의 불일치 (Phone Number)
- **이슈**: 기획서에는 `name` + `phone_number`로 아이디를 찾도록 되어 있었으나, 현재 `users` 테이블 스키마에는 `phone_number` 컬럼이 존재하지 않음.
- **논의**:
  - `phone_number` 컬럼을 추가할 것인가? -> 현재 단계에서는 불필요한 스키마 변경 지양.
  - 대안으로 `email`을 받을 것인가? -> "아이디(이메일)를 찾는데 이메일을 입력한다"는 논리적 모순 발생.
- **해결**: 기능을 **"아이디 분실 복구"**에서 **"가입 여부 확인 및 안내"**로 재정의. 사용자가 `name` + `email`을 입력하면, 해당 계정이 존재할 경우 안내 메일을 발송하는 구조로 변경하여 논리적 모순 해결.

### 2. HTTP 상태 코드 단순화 (422 -> 400)
- **이슈**: 초기 기획에 포함된 `422 Unprocessable Entity`(도메인 제약 위반)의 기준이 모호함. 단순 조회성 로직에서 400(형식 오류)과 422를 구분하는 실익이 적음.
- **해결**: 복잡도를 낮추기 위해 입력값 검증 실패는 모두 **400 Bad Request**로 통일하고, 422 응답 스펙을 제거.

### 3. 문서화 누락 (Docs Omission)
- **증상**: 기능 구현은 완료되었으나 Swagger UI에 해당 API가 노출되지 않음.
- **원인**: `src/docs.rs`의 `ApiDoc` 구조체에 새로 추가된 핸들러(`find_id`)와 DTO(`FindIdReq`, `FindIdRes`) 등록이 누락됨.
- **해결**: 개발자가 수동으로 `src/docs.rs`에 해당 모듈 경로 추가하여 해결.

---

## 🔑 확립된 핵심 개발 패턴 (Key Patterns)

### 1. Enumeration Safety (계정 열거 방지)
- **보안 원칙**: 해커가 무작위로 정보를 대입하여 회원의 존재 여부를 파악(Enumeration)하는 것을 막아야 함.
- **구현**:
  - DB 조회 결과가 `Some(user)`이든 `None`이든 상관없이 **항상 200 OK**를 반환.
  - 응답 메시지 또한 "계정이 존재한다면 이메일을 발송했습니다"로 통일하여 힌트를 주지 않음.

### 2. Side-Channel Notification
- **원칙**: 민감한 정보(가입 여부 확인 등)는 HTTP 응답 본문이 아닌, 신뢰할 수 있는 채널(등록된 이메일)로만 전달.
- **구현**: 실제 이메일 발송 대신 `tracing::info!` 로그를 통해 발송 시뮬레이션을 수행하고, `users_log`에 기록하여 감사(Audit) 추적성을 확보.

---

## ✅ 결론
- **기획 유연성**: 스키마 제약에 맞춰 기능을 유연하게 재정의(Recovery -> Check)함.
- **보안성 확보**: 개인정보 보호를 위한 응답 난독화(Obfuscation) 패턴 확립.
- **다음 단계**: Phase 2 인증의 마지막 퍼즐인 **비밀번호 재설정(2-5)** 구현 진행.