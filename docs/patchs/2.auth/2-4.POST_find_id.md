# PATCH — Phase 2-4 Find ID (POST /auth/find-id)

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 2-4 `POST /auth/find-id` 엔드포인트 구현.
- 사용자의 이름과 **이메일**을 받아 가입 여부를 확인하고, **결과 노출 없이(Enumeration Safe)** 이메일 발송 안내 메시지를 반환.
- **변경 사항**: `phone_number` 컬럼이 없으므로 `email`로 대체. (아이디 분실보다는 가입 여부 확인에 가까움)

CONTEXT (SSOT & Rules):
- **Spec**: `docs/AMK_API_MASTER.md`의 [5.2-4] 참조 (수정됨).
- **Privacy**: 결과가 존재하든 안 하든 **항상 200 OK**와 동일한 메시지를 반환해야 함. (보안 필수)
- **Rate Limit**: 무작위 대입 공격 방지를 위해 Redis 기반 레이트 리미팅 필수 (IP 기준).
- **Mocking**: 실제 이메일 발송은 `tracing::info!` 로그로 대체.
- **Log**: 찾기에 성공했을 경우에만 `users_log`에 기록.

CONTRACT (구현 명세):
- [HTTP] `POST /auth/find-id`
- [Request] `FindIdReq` { name: String, email: String }
- [Logic]
  1. **Validate**: 입력값 형식 검증 (400). (이메일 포맷 등)
  2. **Rate Limit**: Redis `rl:find_id:{ip}` 체크. 초과 시 429.
  3. **Lookup**: DB에서 `user_name` + `user_email`로 활성(`active`) 사용자 조회.
  4. **Action**:
     - **Found**:
       - `users_log`에 'find_id' 이벤트 기록.
       - Tracing Info: "Find ID request success. Sending email to {email}..."
     - **Not Found**:
       - Tracing Warn: "Find ID request failed. User not found (name/email mismatch)."
       - (보안상 에러 리턴 금지, Found와 동일한 응답 준비)
  5. **Response**: 200 OK `{ "message": "If the account matches, an email has been sent to your address." }`

IMPLEMENTATION STEPS:
1.  **DTO (`src/api/auth/dto.rs`)**:
    - `FindIdReq` (name, email).
    - `FindIdRes` (message).
2.  **Repo (`src/api/auth/repo.rs`)**:
    - `find_user_by_name_and_email`: 이름과 이메일로 유저 조회.
3.  **Service (`src/api/auth/service.rs`)**:
    - `find_id` 함수 구현.
    - Redis 레이트 리미트 로직.
    - 조회 후 분기 처리 (Found/Not Found -> 결과는 항상 200 OK).
4.  **Handler (`src/api/auth/handler.rs`)**:
    - `find_id` 핸들러 구현.
5.  **Router (`src/api/auth/router.rs`)**:
    - `/auth/find-id` 등록.

FILE PATCHES START
// src/api/auth/dto.rs
// src/api/auth/repo.rs
// src/api/auth/service.rs
// src/api/auth/handler.rs
// src/api/auth/router.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. 아이디 찾기 시도 (존재하는 유저) -> 200 OK
curl -v -X POST http://localhost:3000/auth/find-id \
  -H "Content-Type: application/json" \
  -d '{ "name": "홍길동", "email": "test@example.com" }'

# 2. 아이디 찾기 시도 (존재하지 않는 유저) -> 200 OK (응답 동일해야 함)
curl -v -X POST http://localhost:3000/auth/find-id \
  -H "Content-Type: application/json" \
  -d '{ "name": "없는사람", "email": "ghost@example.com" }'
```