# PATCH — Phase 5-3 Get Lesson Items (Study View)

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 5-3 `GET /lessons/{id}/items` 엔드포인트 구현.
- 수업 학습 화면(Study View)에서 사용할 아이템 목록(`lesson_item`) 조회.
- **Spec Compliance**:
  - 성공: 200 OK (Items List + Meta).
  - 실패(미존재): 404 Not Found (Lesson이 없거나, Page 범위 초과 시 빈 배열 대신 404 처리는 옵션이나 보통 빈 배열 200 선호. 여기선 Lesson 미존재만 404).
  - 실패(권한): 403 Forbidden (Placeholder for future subscription check).
  - 실패(입력): 400 Bad Request / 422 Unprocessable Entity.

CONTEXT (SSOT & Rules):
- **Spec**: `GET /lessons/{id}/items`.
- **Schema**:
  - Table: `lesson` (Check existence).
  - Table: `lesson_item` (Fetch data).
  - Columns: `lesson_id`, `lesson_item_seq`, `lesson_item_kind`, `video_id`, `study_task_id`.
- **Logic**:
  1. **Check Lesson**: Query `lesson` table. If not found -> Return `AppError::NotFound`.
  2. **Check Auth (Optional)**: If spec requires strict 403, check `AuthUser`. (For MVP, allow public access but keep the structure extensible).
  3. **Fetch Items**:
     - Query `lesson_item`.
     - Order by `lesson_item_seq ASC`.
     - Apply Pagination (`limit`, `offset`).

CONTRACT (구현 명세):
- [HTTP] `GET /lessons/{id}/items`
- [Query] `LessonItemsReq`
  ```json
  { "page": 1, "per_page": 20 }
  ```
- [Response] `LessonItemsRes`
  ```json
  {
    "items": [
      {
        "seq": 1,
        "kind": "video",
        "video_id": 10,
        "study_task_id": null
      }
    ],
    "meta": {
      "total_count": 50,
      "total_pages": 3,
      "current_page": 1,
      "per_page": 20
    }
  }
  ```

IMPLEMENTATION STEPS:
1.  **DTO (`src/api/lesson/dto.rs`)**:
    - `LessonItemsReq`: Reuse or create new struct for query params.
    - `LessonItemDetailRes`: Reuse or create new struct for item data.
    - `LessonItemsRes`: Wrapper struct.
2.  **Repo (`src/api/lesson/repo.rs`)**:
    - `exists_lesson(id)`: Simple boolean check query.
    - `find_items(lesson_id, limit, offset)`: (Likely already exists from Phase 5-2. Reuse if possible, or add if distinct columns needed).
    - `count_items(lesson_id)`: (Reuse or add).
3.  **Service (`src/api/lesson/service.rs`)**:
    - `get_lesson_items(id, req)`:
      1. `repo.exists_lesson(id)` -> If false, return **404**.
      2. Validate pagination (400/422).
      3. Call repo methods.
      4. Return `LessonItemsRes`.
4.  **Handler & Router**:
    - `src/api/lesson/handler.rs`: `get_lesson_items`.
    - `src/api/lesson/router.rs`: Register `GET /lessons/{id}/items`.
5.  **Docs (`src/docs.rs`)**:
    - Register schemas/paths.

FILE PATCHES START
// src/api/lesson/dto.rs
// src/api/lesson/repo.rs
// src/api/lesson/service.rs
// src/api/lesson/handler.rs
// src/api/lesson/router.rs
// src/docs.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. 정상 조회 (학습 모드)
curl -v "http://localhost:3000/lessons/1/items?page=1&per_page=10"

# 2. 존재하지 않는 레슨 (404)
curl -v "http://localhost:3000/lessons/999/items"

# 3. 파라미터 에러 (400/422)
curl -v "http://localhost:3000/lessons/1/items?page=0"
```