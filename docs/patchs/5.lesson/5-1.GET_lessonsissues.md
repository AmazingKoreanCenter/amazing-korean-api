# 📝 Phase 5-1 회고 및 트러블슈팅 로그

이번 Phase는 프로젝트의 레거시(Admin Video API)를 정리하고, 핵심 도메인인 **Lesson(수업)** 기능을 새롭게 구축하는 전환점이었습니다. 특히 데이터베이스 초기화 전략을 통해 테스트 환경의 신뢰성을 확보했습니다.

## 1. 협업 및 데이터 이슈 (Collaboration & Data)

### 🔴 이슈: 테이블 명명 규칙 불일치 (Singular vs Plural)
* **상황:** AI는 관례적으로 테이블명을 복수형(`lessons`)으로 가정하고 명세서를 작성했으나, 실제 스키마는 단수형(`lesson`)이었음.
* **위험:** 수정 없이 코드를 생성했다면 `relation "lessons" does not exist` 런타임 에러 발생 필연적.
* **해결:**
  1. 개발자가 정확한 DDL(`CREATE TABLE "LESSON" ...`) 제공.
  2. 명세서(`.md`) 내의 테이블명(`lesson`)과 컬럼 매핑(`lesson_title` 등)을 실제 스키마에 맞게 수정 후 Codex 실행.
* **교훈:** "AI의 가정(Assumption)을 믿지 말고, DDL을 통해 검증(Verify)하라."

### ✅ 데이터 정합성 보장 (ID Hard Reset)
* **상황:** 테스트 데이터를 넣었다 지우기를 반복하면 Auto Increment ID가 1, 2, 3이 아닌 4, 5, 6으로 생성되어, `lesson_item`과의 FK 연결이 꼬일 위험이 있음.
* **해결:** `TRUNCATE TABLE ... RESTART IDENTITY CASCADE` 명령어를 사용하여 데이터 삭제와 동시에 시퀀스 번호를 1번으로 초기화.
* **성과:** `lesson_id`가 1, 2, 3으로 고정됨을 보장하여, 이후 `lesson_item` 데이터 삽입 시 외래키 오류를 원천 차단.

---

## 2. 기술적 구현 포인트 (Technical Implementation)

### 🧹 레거시 코드 청산 (Tech Debt Payoff)
* **작업:** MVP 범위에서 벗어나거나 사용하지 않는 Admin Video/Tag 관련 API 및 핸들러 삭제.
* **효과:** 불필요한 의존성을 제거하고 컴파일 시간을 단축, 프로젝트 구조를 경량화하여 유지보수성 향상.

### ✅ 엄격한 에러 핸들링 (AMK Standard)
* **로직:**
  * **400 Bad Request:** 형식 오류 (예: `page=0`, `per_page=-5`)
  * **422 Unprocessable Entity:** 도메인 제약 위반 (예: `per_page=100` - 서버 부하 방지용 상한선)
* **성과:** 단순히 에러를 뱉는 것을 넘어, 클라이언트에게 "왜 틀렸는지" 명확한 HTTP Status Code로 구분하여 응답.

---

## 3. 총평 (Conclusion)
* **진행:** 스키마 확인 → 데이터 초기화(Seeding) → 명세서 작성 → 구현의 흐름이 매우 매끄러웠음.
* **결과:** `GET /lessons` 엔드포인트가 페이지네이션 및 정렬(`lesson_idx`) 기능과 함께 완벽하게 동작함.