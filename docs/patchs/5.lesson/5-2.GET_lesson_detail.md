# PATCH — Phase 5-2 Get Lesson Detail (GET /lessons/{id})

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 5-2 `GET /lessons/{id}` 엔드포인트 구현.
- 특정 수업(Lesson)의 상세 정보와 포함된 아이템(Items) 목록을 조회.
- **Spec Compliance**:
  - 성공: 200 OK (Lesson Meta + Paginatable Items).
  - 실패(없음): 404 Not Found.
  - 실패(입력): 400 Bad Request / 422 Unprocessable Entity (Pagination limits).

CONTEXT (SSOT & Rules):
- **Spec**: `GET /lessons/{id}`.
- **Schema**:
  - Table: `lesson` (Metadata).
  - Table: `lesson_item` (Content).
  - Columns:
    - `lesson`: `lesson_id`, `lesson_title`, `lesson_description`, `lesson_idx`.
    - `lesson_item`: `lesson_id`, `lesson_item_seq`, `lesson_item_kind` ('video'|'task'), `video_id`, `study_task_id`.
- **Logic**:
  1. **Fetch Lesson**: Query `lesson` by ID. If none -> **404 Error**.
  2. **Fetch Items**: Query `lesson_item` by `lesson_id`.
     - Order by: `lesson_item_seq ASC`.
     - Pagination: Apply `limit` & `offset` to the items list.
  3. **Response Construction**: Combine metadata and items.

CONTRACT (구현 명세):
- [HTTP] `GET /lessons/{id}`
- [Query] `LessonDetailReq` (Pagination for items)
  ```json
  { "page": 1, "per_page": 20 }
  ```
- [Response] `LessonDetailRes`
  ```json
  {
    "lesson_id": 1,
    "title": "한글 자음 연습",
    "description": "설명...",
    "items": [
      {
        "seq": 1,
        "kind": "video", // or "task"
        "video_id": 101, // nullable
        "task_id": null  // nullable
      }
    ],
    "meta": {
      "total_count": 10,
      "total_pages": 1,
      "current_page": 1,
      "per_page": 20
    }
  }
  ```

IMPLEMENTATION STEPS:
1.  **DTO (`src/api/lesson/dto.rs`)**:
    - `LessonDetailReq`: Pagination params (`IntoParams`).
    - `LessonItemRes`: Struct for item details (`Serialize`, `ToSchema`).
    - `LessonDetailRes`: Wrapper struct containing Lesson info, `items` (Vec), and `meta`.
2.  **Repo (`src/api/lesson/repo.rs`)**:
    - `find_lesson_by_id(id)`: Returns `Option<LessonMetaRow>`.
    - `count_items(lesson_id)`: Returns count of items.
    - `find_items(lesson_id, limit, offset)`: Returns `Vec<LessonItemRow>`.
      - Query: `SELECT ... FROM lesson_item WHERE lesson_id = $1 ORDER BY lesson_item_seq ASC LIMIT $2 OFFSET $3`
3.  **Service (`src/api/lesson/service.rs`)**:
    - `get_lesson_detail(id, req)`:
      1. Check `repo.find_lesson_by_id`. If None -> **Err(AppError::NotFound)**.
      2. Validate pagination params (400/422).
      3. Call `repo.count_items` and `repo.find_items`.
      4. Construct `LessonDetailRes`.
4.  **Handler & Router**:
    - `src/api/lesson/handler.rs`: `get_lesson_detail`.
    - `src/api/lesson/router.rs`: Register `GET /lessons/{id}`.
5.  **Docs (`src/docs.rs`)**:
    - Register schemas/paths.

FILE PATCHES START
// src/api/lesson/dto.rs
// src/api/lesson/repo.rs
// src/api/lesson/service.rs
// src/api/lesson/handler.rs
// src/api/lesson/router.rs
// src/docs.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. 존재하는 수업 조회 (Items 포함)
curl -v "http://localhost:3000/lessons/1?page=1&per_page=5"

# 2. 존재하지 않는 수업 조회 (404 Expected)
curl -v "http://localhost:3000/lessons/999"

# 3. 아이템 페이징 확인 (2페이지)
curl -v "http://localhost:3000/lessons/1?page=2&per_page=5"
```