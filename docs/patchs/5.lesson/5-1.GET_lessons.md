# PATCH — Phase 5-1 Get Lessons List (GET /lessons)

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 5-1 `GET /lessons` 엔드포인트 구현.
- 수업(Lesson) 전체 목록 조회 및 페이지네이션(Pagination) 처리.
- **Spec Compliance**:
  - 성공: 200 OK (Items + Meta).
  - 실패(형식): 400 Bad Request (예: `page < 1`).
  - 실패(도메인): 422 Unprocessable Entity (예: `per_page > 50`).

CONTEXT (SSOT & Rules):
- **Spec**: `GET /lessons` (Public or Optional Auth).
- **Schema**:
  - Table: `lesson` (Singular).
  - Columns: `lesson_id` (PK), `lesson_title`, `lesson_description`, `lesson_idx` (varchar, for sorting), `lesson_subtitle`.
  - **Mapping**:
    - DB `lesson_id` -> Response `id`
    - DB `lesson_title` -> Response `title`
    - DB `lesson_description` -> Response `description`
- **Pagination Logic**:
  - Query Params: `page` (default 1), `per_page` (default 20), `sort` (default 'lesson_idx').
  - **Validation**:
    - If `page <= 0` OR `per_page <= 0` -> Return `AppError::BadRequest`.
    - If `per_page > 50` -> Return `AppError::UnprocessableEntity` (Domain limit).
  - **Sorting**:
    - Order by `lesson_idx ASC` (default).

CONTRACT (구현 명세):
- [HTTP] `GET /lessons`
- [Query] `LessonListReq`
  ```json
  { "page": 1, "per_page": 20 }
  ```
- [Response] `LessonListRes`
  ```json
  {
    "items": [
      {
        "id": 1,
        "title": "한글 자음 연습",
        "description": "video : 1 / typing : 9",
        "lesson_idx": "1",
        "thumbnail_url": null
      }
    ],
    "meta": {
      "total_count": 3,
      "total_pages": 1,
      "current_page": 1,
      "per_page": 20
    }
  }
  ```

IMPLEMENTATION STEPS:
1.  **DTO (`src/api/lesson/dto.rs`)**:
    - `LessonListReq`: Query params (`IntoParams`).
    - `LessonRes`: Item struct (`Serialize`, `ToSchema`).
    - `LessonListRes`: Wrapper (`Serialize`, `ToSchema`).
2.  **Repo (`src/api/lesson/repo.rs`)**:
    - `count_all()`: Returns total count from `lesson` table.
    - `find_all(limit, offset)`: Returns `Vec<LessonRes>`.
      - Query: `SELECT lesson_id, lesson_title, lesson_description, lesson_idx FROM lesson ORDER BY lesson_idx ASC LIMIT $1 OFFSET $2`
3.  **Service (`src/api/lesson/service.rs`)**:
    - `list_lessons(req)`:
      1. Validate params (400, 422).
      2. Calc limit/offset.
      3. Call repo methods.
      4. Build response.
4.  **Handler & Router**:
    - `src/api/lesson/handler.rs`: `list_lessons`.
    - `src/api/lesson/router.rs`: Route `GET /lessons`.
    - `src/api/mod.rs`: Register `mod lesson`.
    - `src/api/app_router.rs`: Mount `/lessons`.
5.  **Docs (`src/docs.rs`)**:
    - Register schemas/paths.

FILE PATCHES START
// src/api/lesson/mod.rs
// src/api/lesson/dto.rs
// src/api/lesson/repo.rs
// src/api/lesson/service.rs
// src/api/lesson/handler.rs
// src/api/lesson/router.rs
// src/api/mod.rs
// src/api/app_router.rs
// src/docs.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. 목록 조회
curl -v "http://localhost:3000/lessons"

# 2. 페이징 에러 테스트 (422)
curl -v "http://localhost:3000/lessons?per_page=100"
```