# PATCH — Phase 4-1 Study List (GET /studies)

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 4-1 `GET /studies` 엔드포인트 구현.
- `STUDY` 테이블 조회, **공개 정책(Auth Optional)** 적용.
- **Spec 5.4-1 준수**: 400(형식) vs 422(도메인 제약) 에러 구분 구현.

CONTEXT (SSOT & Rules):
- **Spec**: `docs/AMK_API_MASTER.md`의 [4-1] 및 [5.4-1].
- **Table**: `STUDY` (state='open' 필터링 기본).
- **Error Handling**:
  - **400**: `page`, `per_page`가 숫자가 아님 (Deserialization Error).
  - **422**: `program` 값이 Enum에 없음, `per_page` > 100, 허용되지 않은 `sort` 값.
- **Sorting**: `created_at` (desc/asc), `title` 등 지원.

CONTRACT (구현 명세):
- [HTTP] `GET /studies`
- [Query] `StudyListReq`
  - `page`: Option<u64> (default 1)
  - `per_page`: Option<u64> (default 10, max 100 -> 422 check)
  - `program`: Option<String> (-> Valid Enum check -> 422 if invalid)
  - `sort`: Option<String> (default "created_at_desc")
- [Response] `StudyListRes`
  ```json
  {
    "data": [
      {
        "study_id": 1,
        "study_idx": "test-1",
        "study_program": "basic_word", // Enum string
        "title": "한글 자음 연습",
        "subtitle": "...",
        "created_at": "..."
      }
    ],
    "meta": { "page": 1, "per_page": 10, "total": 5, "total_pages": 1 }
  }
  ```

IMPLEMENTATION STEPS:
1.  **Module Init**:
    - `src/api/study` 폴더 및 내부 파일(`mod`, `dto`, `repo`, `service`, `handler`, `router`) 생성.
    - `src/api/mod.rs`에 등록.
2.  **DTO (`src/api/study/dto.rs`)**:
    - `StudyListReq`: `validator`를 사용하여 `per_page` 범위 검증.
    - `program` 필드는 `String`으로 받고, Service/Handler 레벨에서 Enum 변환 시도 -> 실패 시 422 처리.
3.  **Repo (`src/api/study/repo.rs`)**:
    - `find_open_studies`: `QueryBuilder` 사용하여 동적 필터링(program) 및 정렬(sort) 구현.
4.  **Service (`src/api/study/service.rs`)**:
    - `list_studies`:
      1. 요청값 검증 (Validator) -> 에러 시 422.
      2. `program` String -> Enum 파싱 -> 에러 시 422.
      3. Repo 호출 및 응답 생성.
5.  **Handler / Router**:
    - 라우터 등록 및 `src/api/router.rs` 연결.

FILE PATCHES START
// src/api/mod.rs
// src/api/router.rs
// src/api/study/mod.rs
// src/api/study/dto.rs
// src/api/study/repo.rs
// src/api/study/service.rs
// src/api/study/handler.rs
// src/api/study/router.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. 정상 조회 (기본)
curl -v "http://localhost:3000/studies"

# 2. 필터링 및 정렬
curl -v "http://localhost:3000/studies?program=basic_word&sort=created_at_asc"

# 3. 에러 테스트 (422 - 없는 프로그램 타입)
curl -v "http://localhost:3000/studies?program=invalid_type"
```