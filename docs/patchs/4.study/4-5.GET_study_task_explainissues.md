# 📝 Phase 4-5 회고 및 트러블슈팅 로그

이번 단계는 기능 구현 자체보다 **"데이터베이스 스키마의 정확한 파악"**과 **"명명 규칙(Naming Convention)의 중요성"**을 재확인하는 과정이었습니다.

## 1. 협업 및 프로세스 이슈 (Process Issues)

### 🔴 이슈: AI의 스키마 추측 (Assumption vs Fact)
* **문제:** AI가 실제 테이블 정의(`STUDY_EXPLAIN`)를 확인하지 않고, 일반적인 관례나 이전 기억에 의존하여 잘못된 테이블명(`study_task_typing` 등)과 컬럼 타입(JSON Array)을 가정하여 쿼리를 작성함.
* **원인:** Context 내의 스키마 정의 파일을 능동적으로 참조하지 않고 안일하게 추론함.
* **해결:**
  1. 개발자가 올바른 DDL(`CREATE TABLE ...`)을 제공하여 데이터 구조 교정.
  2. 개발자의 주도로 프로젝트 일관성을 위해 테이블명을 `study_task_explain`으로 변경(`study_task_` prefix 통일).
  3. AI가 이를 명세서(`.md`)에 정확히 반영하여 Codex 실행.
* **교훈:** "AI는 쿼리를 짜기 전에 반드시 스키마 정의를 먼저 요청하거나 확인해야 한다."

## 2. 기술적 구현 포인트 (Technical Implementation)

### ✅ 403 vs 404 에러 분기 처리 (Security Logic)
* **로직:**
  1. **권한 체크:** 사용자가 문제를 푼 적이 있는가? (`has_attempted` = Answer Log 존재 여부) $\to$ 없으면 `403 Forbidden`.
  2. **데이터 체크:** 해설 데이터가 존재하는가? $\to$ 없으면 `404 Not Found`.
* **성과:** '볼 권한이 없는 것'과 '데이터가 없는 것'을 명확히 구분하여 클라이언트 및 보안 정책 준수.

### ✅ 데이터 타입 어댑터 (Type Adapting)
* **상황:** DB는 단일 URL 문자열(`TEXT`)을 저장하지만, API 명세(`TaskExplainRes`)는 리스트(`Vec<String>`) 반환을 요구함.
* **해결:** Rust의 `Option` 메서드 체이닝을 이용해 간결하고 안전하게 변환.
  ```rust
  // Service Layer: Option<String> -> Vec<String>
  let resources = explanation.explain_media_url
      .map(|url| vec![url]) // Some(url) -> Some(Vec[url])
      .unwrap_or_default(); // None -> [] (Empty List)
  ```

## 3. 총평 (Conclusion)
* **진행:** 초기 스키마 파악 단계에서 AI의 실수가 있었으나, 개발자의 정확한 가이드로 **테이블 네이밍 규칙(Consistency)**이 바로 잡힘.
* **결과:** 로직(403/404) 및 기능 테스트(cURL) 완벽 통과.