# π“ Dev Notes: Phase 4-1 Implementation (GET /studies)

## π“‹ κ°μ”
- **μ‘μ—…**: μ¤ν„°λ”” λ©λ΅ μ΅°ν API (`GET /studies`)
- **κΈ°κ°„**: 2026.01.01
- **μ„±κ²©**: New Domain Init, Dynamic Query, Strict Error Handling (400 vs 422)

---

## π› οΈ νΈλ¬λΈ”μν… λ° μ£Όμ” κΈ°μ μ  μμ‚¬κ²°μ • (Troubleshooting & Decisions)

### 1. HTTP 400 vs 422 μ—λ¬ κµ¬λ¶„ (Strict Error Handling)
- **κ³Όμ **: API μ¤ν™μƒ `program` νλΌλ―Έν„°κ°€ μ ν¨ν•μ§€ μ•μ€ κ°’(Enumμ— μ—†μ)μΌ λ• **400 Bad Request**κ°€ μ•„λ‹ **422 Unprocessable Entity**λ¥Ό λ°ν™ν•΄μ•Ό ν•¨.
- **λ¬Έμ **: Axumμ `Query<T>`μ—μ„ DTO ν•„λ“λ¥Ό `Option<Enum>`μΌλ΅ μ •μν•λ©΄, νμ‹± μ‹¤ν¨ μ‹ ν”„λ μ„μ›ν¬ λ λ²¨μ—μ„ μ¦‰μ‹ **400** μ—λ¬λ¥Ό λ¦¬ν„΄ν•΄λ²„λ¦Ό (μ»¤μ¤ν…€ μ μ–΄ λ¶κ°€).
- **ν•΄κ²°**:
  - DTOμ—μ„λ” `program: Option<String>`μΌλ΅ λ°›μ•„ μΌλ‹¨ νμ‹± μ„±κ³µ(200 OK μ§„μ…) μ‹ν‚΄.
  - Service κ³„μΈµμ—μ„ λ¬Έμμ—΄μ„ EnumμΌλ΅ λ³€ν™(`from_str`) μ‹λ„.
  - λ³€ν™ μ‹¤ν¨ μ‹ λ…μ‹μ μΌλ΅ `AppError::Unprocessable` (422) λ°ν™.

### 2. λ™μ  μΏΌλ¦¬ λΉλ” ν™μ© (Dynamic Query with SQLx)
- **κ³Όμ **: `program` ν•„ν„°λ” μμ„ μλ„ μκ³  μ—†μ„ μλ„ μμ(`Option`). λν• `sort` μ΅°κ±΄μ— λ”°λΌ μ •λ ¬ κΈ°μ¤€μ΄ λ°”λ€.
- **ν•΄κ²°**: `sqlx::QueryBuilder` ν¨ν„΄ μ‚¬μ©.
  - κΈ°λ³Έ `SELECT ... FROM STUDY WHERE state = 'open'`μΌλ΅ μ‹μ‘.
  - `if let Some(p) = program { builder.push(" AND study_program = ..."); }` ν•νƒλ΅ μ΅°κ±΄μ  λ™μ  μ¶”κ°€.
  - SQL Injection λ°©μ§€λ¥Ό μ„ν•΄ νλΌλ―Έν„° λ°”μΈλ”©(`bind`) μ² μ € μ¤€μ.

### 3. μ •λ ¬(Sort) μ•μ „μ„± ν™•λ³΄
- **μ„ν—**: ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ `sort` λ¬Έμμ—΄μ„ κ·Έλ€λ΅ SQL `ORDER BY`μ— λ„£μΌλ©΄ SQL Injection μ„ν— μμ.
- **ν•΄κ²°**: **Allowlist λ°©μ‹** μ μ©.
  - λ“¤μ–΄μ¨ λ¬Έμμ—΄(`created_at_desc`, `title_asc` λ“±)μ„ λ§¤μΉ­ν•μ—¬ μ ν¨ν• κ²½μ°μ—λ§ μΏΌλ¦¬ λΉλ”μ— μ •ν•΄μ§„ SQL μ΅°κ°(`ORDER BY study_created_at DESC`)μ„ μ¶”κ°€.
  - ν—μ©λμ§€ μ•μ€ μ •λ ¬ ν‚¤μ›λ“λ” **422 μ—λ¬** μ²λ¦¬.

---

## π”‘ ν™•λ¦½λ ν•µμ‹¬ κ°λ° ν¨ν„΄ (Key Patterns)

### 1. Domain Module Structure
- **ν¨ν„΄**: μƒλ΅μ΄ λ„λ©”μΈ(`study`) μ¶”κ°€ μ‹ `mod`, `dto`, `repo`, `service`, `handler`, `router`μ 6κ° νμΌ μ„ΈνΈλ¥Ό ν‘μ¤€μΌλ΅ μƒμ„±ν•κ³ , `src/api/mod.rs`μ™€ λ©”μΈ λΌμ°ν„°μ— λ“±λ΅ν•λ” μ μ°¨ ν™•λ¦½.

### 2. Validation with 'validator' crate
- **ν¨ν„΄**: `per_page`μ™€ κ°™μ€ μ«μν• νλΌλ―Έν„°μ λ²”μ„(`range(min=1, max=100)`) κ²€μ¦μ„ μ„ν•΄ `validator` λ§¤ν¬λ΅ μ‚¬μ©. μ΄λ¥Ό ν†µν•΄ λΉ„μ¦λ‹μ¤ λ΅μ§ μ§„μ… μ „ κΉ”λ”ν•κ² μ…λ ¥κ°’ λ°©μ–΄.

---

## β… κ²°λ΅ 
- **κµ¬ν„ μ™„λ£**: μ¤ν„°λ”” λ©λ΅ μ΅°ν, ν”„λ΅κ·Έλ¨ ν•„ν„°λ§, μ •λ ¬, νμ΄μ§€λ„¤μ΄μ… μ •μƒ λ™μ‘.
- **ν…μ¤νΈ ν†µκ³Ό**: 
  - μ •μƒ μΌ€μ΄μ¤(200) λ° λ°μ΄ν„° κ²€μ¦ μ™„λ£.
  - μ—λ¬ μΌ€μ΄μ¤(μλ»λ Enum -> 422, λ²”μ„ μ΄κ³Ό -> 422) μ¤ν™ μ¤€μ ν™•μΈ.
- **λ‹¤μ λ‹¨κ³„**: λ©λ΅μ—μ„ μ„ νƒν• μ¤ν„°λ””μ μ„Έλ¶€ λ¬Έμ  λ©λ΅μ„ μ΅°νν•λ” **Phase 4-2 (μ¤ν„°λ”” λ¬Έμ  λ©λ΅ μ΅°ν)** κµ¬ν„ μ§„μ….