# PATCH — Phase 4-2 Study Task Detail (GET /studies/tasks/{id})

ROLE: Senior Rust Backend (Axum 0.8, SQLx 0.7+, utoipa 5) AI Assistant

OBJECTIVE:
- Phase 4-2 `GET /studies/tasks/{id}` 엔드포인트 구현.
- `STUDY_TASK`와 상세 테이블(`_CHOICE`, `_TYPING`, `_VOICE`)을 조인하여 문제 정보 조회.
- **Security**: 문제 풀이 전 단계이므로 **정답(Correct Answer) 정보는 절대 반환하지 않음**.

CONTEXT (SSOT & Rules):
- **Spec**: `docs/AMK_API_MASTER.md`의 [4-2] 참조.
- **Route**: `/studies/tasks/:id` (Router is nested under `/studies`).
- **Tables**:
  - `STUDY_TASK` (Main)
  - `STUDY_TASK_CHOICE` (Sub: `study_task_choice_correct` 제외하고 조회)
  - `STUDY_TASK_TYPING` (Sub: `study_task_typing_answer` 제외하고 조회)
  - `STUDY_TASK_VOICE` (Sub: `study_task_voice_answer` 제외하고 조회)
- **Logic**:
  - `LEFT JOIN`을 사용하여 한 번의 쿼리로 데이터를 가져오는 것을 권장.
  - `study_task_kind`에 따라 응답 필드 구조가 달라짐 (Enum 활용).

CONTRACT (구현 명세):
- [HTTP] `GET /studies/tasks/{id}`
- [Response] `StudyTaskDetailRes`
  ```json
  {
    "task_id": 1,
    "study_id": 1,
    "kind": "choice",
    "seq": 1,
    "question": "다음 중 사과는?",
    "media_url": "...",
    "payload": {
      "choice_1": "포도",
      "choice_2": "사과",
      "choice_3": "수박",
      "choice_4": "딸기",
      // "correct": 2  <-- (제외됨)
      "image_url": "..."
    }
  }
  ```
  *(Payload 구조는 문제 유형별로 상이하게 구성)*

IMPLEMENTATION STEPS:
1.  **DTO (`src/api/study/dto.rs`)**:
    - `StudyTaskDetailRes`: 공통 필드.
    - `TaskPayload`: `#[serde(untagged)]` 또는 `kind` 기반 분기 처리를 위한 Enum (ChoicePayload, TypingPayload, VoicePayload).
    - **중요**: Payload Struct에는 정답 필드를 정의하지 않음.
2.  **Repo (`src/api/study/repo.rs`)**:
    - `find_task_detail`: `STUDY_TASK` + 3개 상세 테이블 `LEFT JOIN`.
    - DB에서 가져온 Row를 DTO로 매핑할 때, `kind` 값을 확인하여 적절한 Payload로 변환.
3.  **Service (`src/api/study/service.rs`)**:
    - `get_task_detail`: Repo 호출 및 404 에러 처리 (`AppError::NotFound`).
4.  **Handler & Router**:
    - `src/api/study/handler.rs`: `get_study_task` 추가.
    - `src/api/study/router.rs`: `.route("/tasks/:id", get(handler::get_study_task))` 추가.

FILE PATCHES START
// src/api/study/dto.rs
// src/api/study/repo.rs
// src/api/study/service.rs
// src/api/study/handler.rs
// src/api/study/router.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
# 1. Typing 문제 조회 (ID: 1) -> 정답 필드 없이 질문/이미지만 나와야 함
curl -v "http://localhost:3000/studies/tasks/1"

# 2. Choice 문제 조회 (ID: 15) -> 보기 1~4 포함, 정답(correct) 제외
curl -v "http://localhost:3000/studies/tasks/15"

# 3. Voice 문제 조회 (ID: 25)
curl -v "http://localhost:3000/studies/tasks/25"

# 4. 없는 문제 조회 (ID: 9999) -> 404
curl -v "http://localhost:3000/studies/tasks/9999"
```