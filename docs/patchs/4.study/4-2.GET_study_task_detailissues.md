# 📝 Dev Notes: Phase 4-2 Implementation (GET /studies/tasks/{id})

## 📋 개요
- **작업**: 학습 문제 상세 조회 API (`GET /studies/tasks/{id}`)
- **기간**: 2026.01.02
- **성격**: Polymorphic Data Handling, Join Query, Security (Field Exclusion)

---

## 🛠️ 트러블슈팅 (Troubleshooting)

### 1. utoipa 스키마 속성 오류
- **증상**: `StudyTaskDetailRes` DTO 컴파일 중 `error: unexpected attribute: one_of` 발생.
- **원인**: `#[schema(one_of = ...)]` 속성은 구조체 필드 레벨에서 지원되지 않거나, Enum 자체에 `ToSchema`가 이미 derive 되어 있어 충돌 발생.
- **해결**: 필드 레벨의 `#[schema(...)]` 속성을 제거하고, `TaskPayload` Enum 자체의 `ToSchema` 구현에 위임.

### 2. Axum Router Path 문법 오류
- **증상**: 서버 실행 시 `Path segments must not start with :` 패닉 발생.
- **원인**: Axum 0.6+ 부터는 URL 파라미터를 `:id`가 아닌 **`{id}`** 형식으로 작성해야 함. (Codex가 구버전 문법 사용)
- **해결**: `router.rs`의 경로를 `/tasks/:id`에서 `/tasks/{id}`로 수정.

### 3. Swagger(OpenAPI) 문서 누락
- **증상**: API는 동작하지만 Swagger UI에 엔드포인트와 모델이 표시되지 않음.
- **원인**: `src/docs.rs`의 `paths`와 `components` 섹션에 핸들러와 DTO 등록이 누락됨.
- **조치**: 핸들러(`get_study_task`)와 응답 DTO(`StudyTaskDetailRes`, `TaskPayload` 등)를 수동으로 등록.
- **Lesson**: GET 요청의 Query Parameter용 DTO(`...Req`)는 `schemas` 등록이 불필요하지만, **Response DTO(`...Res`)는 필수적으로 등록**해야 함.

---

## 🔑 주요 기술적 의사결정 (Key Decisions)

### 1. 다형성(Polymorphism) 처리
- **구현**: `TaskPayload` Enum에 `#[serde(untagged)]`를 적용.
- **효과**: 클라이언트는 `kind` 필드를 보고 `payload` 내부 구조(`choice_1` vs `image_url` 등)를 추론할 수 있으며, 불필요한 중첩 태그 없이 깔끔한 JSON 응답 제공.

### 2. 정답 보안 (Security by Projection)
- **전략**: 문제 풀이 전 단계이므로, DB 조회 시점부터 **정답 컬럼(`correct`, `answer`)을 제외**하고 조회.
- **구현**: `SELECT *` 대신 필요한 컬럼만 명시적으로 나열하여 매핑. API 응답 DTO에도 정답 필드를 원천적으로 포함하지 않음.

### 3. 효율적인 쿼리 (One-Shot Query)
- **전략**: `STUDY_TASK`를 기준으로 3개의 상세 테이블(`CHOICE`, `TYPING`, `VOICE`)을 모두 `LEFT JOIN`하여 한 번의 DB 요청으로 데이터를 완성.

---

## ✅ 결론
- **구현 완료**: 문제 유형별(`choice`, `typing`, `voice`)로 서로 다른 Payload 구조가 정상적으로 조회됨.
- **테스트 통과**:
  - 유효한 ID 조회 시 200 OK 및 유형별 데이터 확인.
  - 존재하지 않는 ID 조회 시 404 Not Found 확인.
- **다음 단계**: 사용자가 문제를 풀고 정답을 제출하는 **Phase 4-3 (정답 제출 및 채점)** 구현 진입.