# ğŸ“ Dev Notes: Phase 1-4 Implementation (GET /users/me/settings)

## ğŸ“‹ ê°œìš”
- **ì‘ì—…**: ë‚´ ì„¤ì • ì¡°íšŒ API (`GET /users/me/settings`)
- **ê¸°ê°„**: 2025.12.30
- **ì„±ê²©**: DTO-DB í•„ë“œëª… ë™ê¸°í™” ë° ë°©ì–´ì  ì¡°íšŒ ë¡œì§ êµ¬í˜„

---

## ğŸ› ï¸ ì£¼ìš” ë³€ê²½ ë° í•´ê²° (Refinements)

### 1. DTOì™€ DB ì»¬ëŸ¼ëª… ë¶ˆì¼ì¹˜ í•´ì†Œ
- **ìƒí™©**: ê¸°ì¡´ `SettingsRes` DTOëŠ” `ui_language` ë“±ì˜ ì´ë¦„ì„ ì‚¬ìš©í–ˆìœ¼ë‚˜, ì‹¤ì œ DB(`users_setting`)ëŠ” `user_set_language` í˜•íƒœì˜ prefixë¥¼ ì‚¬ìš©í•¨.
- **í•´ê²°**: DTO í•„ë“œëª…ì„ DB ì»¬ëŸ¼ëª…ê³¼ 1:1ë¡œ ì¼ì¹˜ì‹œí‚¤ê³  `sqlx::FromRow`ë¥¼ ì ìš©í•˜ì—¬ ë§¤í•‘ ì½”ë“œë¥¼ ì‚­ì œí•¨.
- **êµí›ˆ**: DTO í•„ë“œëª…ì„ í”„ë¡ íŠ¸ì—”ë“œ í¸ì˜ì— ë§ì¶œ ìˆ˜ë„ ìˆì§€ë§Œ, ì´ˆê¸° ë‹¨ê³„ì—ì„œëŠ” **DB ìŠ¤í‚¤ë§ˆ(SSOT)ì™€ ì¼ì¹˜**ì‹œí‚¤ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ ë¹„ìš©ì„ ì¤„ì—¬ì¤Œ.

### 2. ì„¤ì • ë°ì´í„° ë¶€ì¬ ì‹œ ì²˜ë¦¬ (Defensive Logic)
- **ìƒí™©**: `users` í…Œì´ë¸”ì—ëŠ” ìœ ì €ê°€ ìˆì§€ë§Œ, ëª¨ì¢…ì˜ ì´ìœ ë¡œ `users_setting` í…Œì´ë¸”ì— ë¡œìš°ê°€ ì—†ëŠ” ê²½ìš°(ê°€ì… ì‹œ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ë“±) 404ë¥¼ ì¤„ ê²ƒì¸ê°€?
- **ê²°ì •**: ì„¤ì • ì¡°íšŒëŠ” í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì•„ë‹ˆë¯€ë¡œ, ë°ì´í„°ê°€ ì—†ìœ¼ë©´ **"ê¸°ë³¸ê°’(Default)"**ì„ ìƒì„±í•´ì„œ 200 OKë¡œ ë°˜í™˜.
- **ì½”ë“œ**:
  ```rust
  // Service Layer
  let settings = repo::find_users_setting(...).await?;
  Ok(settings.unwrap_or_else(|| SettingsRes {
      user_set_language: "ko".to_string(),
      user_set_timezone: "UTC".to_string(),
      ...
  }))
  ```

---

## ğŸ”‘ í™•ë¦½ëœ í•µì‹¬ ê°œë°œ íŒ¨í„´ (Key Patterns)

### 1. Enum to Text Casting (Repo Layer)
- **íŒ¨í„´**: `user_set_language` ê°™ì€ ENUM ì»¬ëŸ¼ ì¡°íšŒ ì‹œ.
- **êµ¬í˜„**: `SELECT user_set_language::TEXT ...`
- **íš¨ê³¼**: Rust ìª½ì—ì„œ ë³„ë„ì˜ Enum ë§¤í•‘ ì—†ì´ `String`ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë°›ì„ ìˆ˜ ìˆìŒ.

### 2. AuthUser Extractor í‘œì¤€í™”
- **íŒ¨í„´**: ëª¨ë“  ì¸ì¦ í•„ìš” í•¸ë“¤ëŸ¬ì—ì„œ `AuthUser` ì‚¬ìš©.
- **êµ¬í˜„**:
  ```rust
  pub async fn get_settings(
      State(st): State<AppState>,
      AuthUser(auth_user): AuthUser, // <- Standardized
  )
  ```

---

## âœ… ê²°ë¡ 
- **ì¡°íšŒ(Read) ë¡œì§ì˜ ì•ˆì •ì„± í™•ë³´**: DBì— ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ë„ APIëŠ” ì£½ì§€ ì•Šê³  ê¸°ë³¸ê°’ì„ ë‚´ë ¤ì£¼ëŠ” íŒ¨í„´ í™•ë¦½.
- **ë‹¤ìŒ ë‹¨ê³„**: ì„¤ì • ìˆ˜ì •(`PUT /users/me/settings`) ë‹¨ê³„ì—ì„œë„ ì´ DTO êµ¬ì¡°ë¥¼ í™œìš©í•˜ì—¬ ë¹ ë¥´ê²Œ êµ¬í˜„ ê°€ëŠ¥.