# Phase 6-42 Admin List Lesson Progress (GET /admin/lessons/progress)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `GET /admin/lessons/progress` 엔드포인트를 구현하여 사용자들의 수업 진도 현황을 조회합니다.
- **핵심 기능**: `lesson_id` 또는 `user_id`를 기준으로 필터링하여 진척도(`percent`)와 마지막 학습 위치 등을 확인합니다.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `LESSON_PROGRESS`
    - Columns: `lesson_id` (FK), `user_id` (FK), `lesson_progress_percent` (0~100), `lesson_progress_last_item_seq`, `lesson_progress_last_progress_at`.
    - PK: `lesson_id` + `user_id` (Composite).

2.  **DTO 설계 (Strict Requirement)**:
    - **`LessonProgressListReq`**:
        - `page`: `Option<u64>` (default 1).
        - `size`: `Option<u64>` (default 20).
        - `sort`: `Option<String>` (default "lesson_progress_last_progress_at").
        - `order`: `Option<String>` (default "desc").
        - **필터**: `lesson_id`: `Option<i32>`.
        - **필터**: `user_id`: `Option<i64>`.
        - *Note*: `q` (검색어)는 텍스트 컬럼이 없으므로 제외하거나 무시합니다.
    - **`AdminLessonProgressRes`**:
        - `LESSON_PROGRESS` 테이블 컬럼 매핑.
        - `#[derive(FromRow, ToSchema)]`.
    - **`AdminLessonProgressListRes`**:
        - `list`: `Vec<AdminLessonProgressRes>`.
        - `total`, `page`, `size`, `total_pages`.

3.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **API Log**: `user::repo::create_audit_log` (Action="LIST_LESSON_PROGRESS").
    - 3) **Data Query (Repo)**:
        - `sqlx::QueryBuilder` 사용.
        - **동적 필터링**:
            - `req.lesson_id`가 `Some`이면 `WHERE lesson_id = $x`.
            - `req.user_id`가 `Some`이면 `AND user_id = $y`.
        - **정렬**: `lesson_progress_percent` 또는 `last_progress_at` 등 허용된 컬럼만 `ORDER BY` 적용.
        - **페이징**: `LIMIT`, `OFFSET`.
    - 4) **Response**: 200 OK.

4.  **기술적 유의사항**:
    - **참조 구현**: `admin_list_lesson_items` (Phase 6-37)의 `QueryBuilder` 패턴을 그대로 따르세요.
    - **카운트 쿼리**: 전체 개수(`total`)를 구할 때도 동일한 `WHERE` 조건을 적용해야 합니다.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/lesson/dto.rs`)**:
    - `LessonProgressListReq`, `AdminLessonProgressRes`, `AdminLessonProgressListRes` 정의.

2.  **Repo (`src/api/admin/lesson/repo.rs`)**:
    - `admin_list_lesson_progress`: 목록 조회 및 카운트 함수 구현.

3.  **Service (`src/api/admin/lesson/service.rs`)**:
    - `admin_list_lesson_progress`: 서비스 로직 구현.

4.  **Handler (`src/api/admin/lesson/handler.rs`)**:
    - 핸들러 구현.

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/lesson/dto.rs
// src/api/admin/lesson/repo.rs
// src/api/admin/lesson/service.rs
// src/api/admin/lesson/handler.rs
// src/api/admin/lesson/router.rs
// src/docs.rs
FILE PATCHES END