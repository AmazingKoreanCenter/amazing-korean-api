# Phase 6-19 Admin List Study Tasks (GET /admin/studies/tasks)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `GET /admin/studies/tasks` 엔드포인트를 구현하여 특정 Study에 속한 Task(문제) 목록을 조회합니다.
- **핵심 요구사항**: `study_id`는 필수 파라미터이며, `STUDY_TASK` 테이블과 하위 테이블(`CHOICE`, `TYPING`, `VOICE`)을 **LEFT JOIN**하여 문제의 상세 내용(질문 등)을 함께 반환해야 합니다.

CONTEXT (SSOT & Rules):
1.  **테이블 관계 (Schema)**:
    - Main: `STUDY_TASK` (id, kind, seq 등).
    - Sub: `STUDY_TASK_CHOICE`, `STUDY_TASK_TYPING`, `STUDY_TASK_VOICE`.
    - `STUDY_TASK.study_task_id`를 기준으로 1:1 관계입니다.

2.  **DTO 설계 (Strict Requirement)**:
    - **모든 DTO 구조체에는 반드시 `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema)]`를 적용하세요.** (필수)
    - **Request (`StudyTaskListReq`)**:
        - `study_id`: **필수** (`i32`, `#[validate(range(min = 1))]`).
        - `page`: `Option<u64>` (default 1).
        - `size`: `Option<u64>` (default 20).
    - **Response (`AdminStudyTaskListRes`)**:
        - `list`: `Vec<AdminStudyTaskRes>`.
        - `total`: 전체 개수.
        - `page`, `size`, `total_pages`.
    - **Response Item (`AdminStudyTaskRes`)**:
        - `study_task_id`, `study_task_kind` (Enum), `study_task_seq`.
        - `question`: 각 하위 테이블의 질문 컬럼(`..._question`)을 `COALESCE` 하거나 매핑하여 반환.

3.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC (Admin/Manager/Hymn).
    - 2) **요청 검증**: `req.validate()`. `study_id` 누락 시 400 Bad Request.
    - 3) **Audit Log**: `user::repo::create_audit_log` 호출.
        - Action: "LIST_STUDY_TASKS".
        - Details: `{"study_id": ...}`.
        - `IpAddr` 변환 로직 (Phase 6-15 참조) 적용.
    - 4) **데이터 조회 (Repo)**:
        - `QueryBuilder`를 사용하여 `WHERE study_id = ...` 조건 적용.
        - 3개의 하위 테이블을 `LEFT JOIN` 하여 데이터를 가져옵니다.
    - 5) **결과 반환**: 200 OK.

4.  **기술적 유의사항**:
    - **DTO 매크로**: `Validate`, `ToSchema` 등 누락 금지.
    - **IP 주소**: `String` -> `IpAddr` 변환 안전하게 처리.
    - **SQL**: `study_task_seq` 기준으로 오름차순 정렬 (`ORDER BY study_task_seq ASC`).

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - `StudyTaskListReq` 및 응답 DTO 정의 (매크로 필수).

2.  **Repo (`src/api/admin/study/repo.rs`)**:
    - `admin_list_study_tasks`: `study_id`로 필터링하고 Sub Table을 조인하는 쿼리 구현.

3.  **Service (`src/api/admin/study/service.rs`)**:
    - `admin_list_study_tasks`: 로깅 및 리포지토리 호출 연결.

4.  **Handler (`src/api/admin/study/handler.rs`)**:
    - 핸들러 구현.

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/study/dto.rs
// src/api/admin/study/repo.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/docs.rs
FILE PATCHES END