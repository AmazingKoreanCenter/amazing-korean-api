# Phase 6-38 Admin Create Lesson Item (POST /admin/lessons/{lesson_id}/items)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `POST /admin/lessons/{lesson_id}/items` 엔드포인트를 구현하여 특정 수업에 새로운 아이템(비디오/문제)을 추가합니다.
- **핵심 로직**: `admin_create_lesson`의 로직을 기반으로 하되, **아이템 종류(Kind)에 따른 조건부 유효성 검사**와 **순서(Seq) 중복 검사**를 추가해야 합니다.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `LESSON_ITEM`
    - PK: `lesson_id` + `lesson_item_seq` (Composite Key).
    - Enum: `lesson_item_kind` ('video', 'study_task').
    - FK: `video_id` (nullable), `study_task_id` (nullable).

2.  **Validation Rules (Business Logic)**:
    - **순서 중복 (409)**: 동일한 `lesson_id` 내에 요청된 `lesson_item_seq`가 이미 존재하면 실패.
    - **타입 정합성 (400/422)**:
        - `lesson_item_kind` == "video" 이면, `video_id`는 필수(`Some`), `study_task_id`는 무시/None.
        - `lesson_item_kind` == "study_task" 이면, `study_task_id`는 필수(`Some`), `video_id`는 무시/None.

3.  **Logging**:
    - **API Log**: `admin_action_log` (Action="CREATE_LESSON_ITEM").
    - **Data Log**: `ADMIN_LESSON_LOG` (Action="create").
        - `admin_pick_lesson_id`: Path Parameter.
        - `admin_pick_item_seq`: Request Body.
        - `admin_pick_video_id` / `admin_pick_task_id`: 실제 저장된 값 기록.

4.  **DTO 설계**:
    - **`LessonItemCreateReq`**:
        - `lesson_item_seq`: `i32` (필수).
        - `lesson_item_kind`: `String` (or Enum).
        - `video_id`: `Option<i32>`.
        - `study_task_id`: `Option<i32>`.
    - **`AdminLessonItemRes`**: 조회 API에서 만든 DTO 재사용.

5.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **유효성 검사**:
        - DTO Validate.
        - **Kind-ID 매칭 검사** (Service 레벨).
    - 3) **Audit Log**: `user::repo::create_audit_log` 호출.
    - 4) **수업 존재 확인**: `lesson_repo::exists_lesson(lesson_id)`.
    - 5) **순서 중복 검사**: `repo::exists_lesson_item(lesson_id, seq)`.
        - 존재 시 `AppError::Conflict`.
    - 6) **트랜잭션 시작**: `pool.begin()`.
    - 7) **Insert**: `repo::create_lesson_item` 호출.
    - 8) **Data Log**: `repo::create_lesson_log` 호출.
        - `pick_lesson_id` 등 상세 필드 채우기.
    - 9) **커밋 & 반환**: 201 Created.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/lesson/dto.rs`)**:
    - `LessonItemCreateReq` 정의.

2.  **Repo (`src/api/admin/lesson/repo.rs`)**:
    - `exists_lesson_item`: `lesson_id`와 `seq`로 중복 확인.
    - `create_lesson_item`: `LESSON_ITEM` 테이블 Insert.
    - `create_lesson_log`: (기존 함수가 있다면 재사용, 없으면 `_tx` 지원하도록 확장).

3.  **Service (`src/api/admin/lesson/service.rs`)**:
    - `admin_create_lesson_item`: 비즈니스 로직(검증+트랜잭션) 구현.

4.  **Handler (`src/api/admin/lesson/handler.rs`)**:
    - 핸들러 구현 (201 Created).
    - Path Parameter `lesson_id` 처리.

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/lesson/dto.rs
// src/api/admin/lesson/repo.rs
// src/api/admin/lesson/service.rs
// src/api/admin/lesson/handler.rs
// src/api/admin/lesson/router.rs
// src/docs.rs
FILE PATCHES END