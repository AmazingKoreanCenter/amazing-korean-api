# Phase 6-25 Admin Create Study Task Explain (POST /admin/studies/tasks/{id}/explain)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `POST /admin/studies/tasks/{id}/explain` 엔드포인트를 구현하여 특정 학습 문제에 대한 해설(Explanation)을 생성합니다.
- **핵심 정책**:
    1. **삭제 없음**: 우리 시스템은 Delete를 구현하지 않습니다. (Update로 처리).
    2. **중복 방지**: 하나의 문제(`task_id`)에는 언어(`lang`)별로 단 하나의 해설만 존재해야 합니다. 이미 해당 언어의 해설이 있다면 **409 Conflict**를 반환해야 합니다.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `STUDY_TASK_EXPLAIN`
    - Columns: `study_task_id`, `explain_lang`, `explain_title`, `explain_text`, `explain_media_url`, timestamps.
    - PK: (`study_task_id`, `explain_lang`) 복합 키 성격 (Unique).

2.  **DTO 설계 (Strict Requirement)**:
    - **필수 매크로**: `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema, Clone)]`.
    - **`TaskExplainCreateReq`**:
        - `explain_lang`: `UserSetLanguage` Enum (필수).
        - `explain_title`: `Option<String>`.
        - `explain_text`: `Option<String>`.
        - `explain_media_url`: `Option<String>`.
        - *Note*: `study_task_id`는 Path Parameter로 받습니다.

3.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **Audit Log (필수)**: 함수 진입 직후 `user::repo::create_audit_log` 호출.
        - Action: `"CREATE_TASK_EXPLAIN"` (대문자).
        - Target Table: `Some("STUDY_TASK_EXPLAIN")`.
        - Target ID: `req.task_id`.
    - 3) **유효성 검사**:
        - `task_id`가 `STUDY_TASK` 테이블에 존재하는지 확인. (없으면 404).
        - `task_id` + `explain_lang` 조합이 `STUDY_TASK_EXPLAIN`에 이미 존재하는지 확인. (있으면 409).
    - 4) **트랜잭션 시작**: `pool.begin()`.
    - 5) **Insert**: `repo::create_task_explain` 호출.
    - 6) **Data Log**: `repo::create_study_log` 호출.
        - Action: `"create"` (**소문자 필수** - DB Enum 매핑).
        - Before: `None`.
        - After: 생성된 데이터.
    - 7) **커밋**: 트랜잭션 종료.

4.  **기술적 유의사항**:
    - **참조 구현**: Phase 6-20(`admin_create_study_task`) 로직 참조.
    - **로그 정합성**: `admin_action_log`와 `admin_study_log` 모두 누락 없이 기록되어야 합니다.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - `TaskExplainCreateReq` 정의 (매크로 필수).

2.  **Repo (`src/api/admin/study/repo.rs`)**:
    - `exists_task_explain`: 중복 검사 함수.
    - `create_task_explain`: Insert 함수.

3.  **Service (`src/api/admin/study/service.rs`)**:
    - `admin_create_task_explain`: 로깅, 중복 체크, 트랜잭션 구현.

4.  **Handler (`src/api/admin/study/handler.rs`)**:
    - 핸들러 구현 (201 Created).

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/study/dto.rs
// src/api/admin/study/repo.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/docs.rs
FILE PATCHES END