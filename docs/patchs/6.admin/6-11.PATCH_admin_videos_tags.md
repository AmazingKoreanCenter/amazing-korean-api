# PATCH â€” Phase 6-11 Admin Update Video Tags (PATCH /admin/videos/{id}/tags)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- Implement `PATCH /admin/videos/{id}/tags` to update **only the tag information** associated with a video.
- **Reuse Strategy**: Reuse the existing `repo::admin_update_video` function. This function already handles dynamic updates for `VIDEO_TAG` table via `VIDEO_TAG_MAP`.
- **RBAC**: Admin/Manager/Hymn only.
- **Logging**: Record `admin_action_log` (action="UPDATE_VIDEO_TAG").

CONTEXT (SSOT & Rules):
1.  **Schema & Relationships**:
    - `VIDEO_TAG` table columns: `video_tag_id`, `video_tag_key` (Unique, Max 30), `video_tag_title`, `video_tag_subtitle`.
    - `VIDEO_TAG_MAP` links `video_id` to `video_tag_id`.

2.  **DTO Strategy**:
    - **Request**: Create a new DTO `VideoTagUpdateReq`.
    - It should ONLY contain tag-related fields (Optional for PATCH):
        - `video_tag_title`
        - `video_tag_subtitle`
        - `video_tag_key` (Max 30 chars)
    - **Service Logic**: Convert `VideoTagUpdateReq` into the general `VideoUpdateReq` (setting video-specific fields like `url`, `access`, `idx` to `None`) and call the repo.

3.  **Service Logic**:
    - Check RBAC.
    - Validate Input (e.g., `video_tag_key` length).
    - Start Transaction.
    - Call `repo::admin_update_video(tx, id, converted_req)`.
        - *Note*: The existing repo logic updates `video_updated_at` on the parent `VIDEO` table even if only tags are changed. This is desired behavior (audit trail).
    - Log Action ("UPDATE_VIDEO_TAG").
    - Commit Transaction.

4.  **Documentation**:
    - Update `src/docs.rs` with the new schema and path.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/video/dto.rs`)**:
    - Define `VideoTagUpdateReq` (Derive: Deserialize, Validate, ToSchema).
    - Implement `From<VideoTagUpdateReq> for VideoUpdateReq` (or manual conversion in service) to map fields correctly.

2.  **Service (`src/api/admin/video/service.rs`)**:
    - Implement `admin_update_video_tags`.
    - Map the specific tag request to the general update request.
    - Call `repo::admin_update_video`.

3.  **Handler (`src/api/admin/video/handler.rs`)**:
    - Implement `admin_update_video_tags`.
    - Path: `PATCH /videos/{id}/tags`.

4.  **Router (`src/api/admin/video/router.rs`)**:
    - Register the new route.

5.  **Docs (`src/docs.rs`)**:
    - Register `VideoTagUpdateReq`.
    - Add path to OpenAPI docs.

FILE PATCHES START
// src/api/admin/video/dto.rs
// src/api/admin/video/service.rs
// src/api/admin/video/handler.rs
// src/api/admin/video/router.rs
// src/docs.rs
FILE PATCHES END

# cURL SMOKE TEST
```bash
curl -v -X PATCH "http://localhost:3000/admin/videos/1/tags" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "video_tag_title": "Only Tag Title Updated",
    "video_tag_key": "tag_only_update_v1"
  }'
```