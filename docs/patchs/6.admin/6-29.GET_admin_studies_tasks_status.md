# Phase 6-29 Admin List Study Task Status (GET /admin/studies/tasks/status)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `GET /admin/studies/tasks/status` 엔드포인트를 구현하여 사용자들의 학습 문제 풀이 상태(Status)를 조회합니다.
- **핵심 정책**: 이 데이터는 사용자의 학습 결과이므로 **생성(POST) 기능은 제공하지 않으며**, 오직 조회(GET)와 수정(PATCH)만 제공합니다.
- **필터링**: 특정 문제(`task_id`)나 특정 사용자(`user_id`)의 기록을 필터링해서 볼 수 있어야 합니다.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `STUDY_TASK_STATUS`
    - Columns: `study_task_id`, `user_id`, `study_task_status_try`, `study_task_status_best`, `study_task_status_completed`, `study_task_status_last_answer`.
    - PK: `study_task_id` + `user_id` (Composite).

2.  **DTO 설계 (Strict Requirement)**:
    - **필수 매크로**: `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema)]` (Response엔 `FromRow` 필수).
    - **`TaskStatusListReq`**:
        - `task_id`: `Option<i32>` (특정 문제의 현황을 볼 때).
        - `user_id`: `Option<i64>` (특정 유저의 학습 기록을 볼 때).
        - `page`: `Option<u64>` (default 1).
        - `size`: `Option<u64>` (default 20).
    - **`AdminTaskStatusRes`**:
        - 테이블의 모든 컬럼 매핑.
    - **`AdminTaskStatusListRes`**:
        - `list`: `Vec<AdminTaskStatusRes>`.
        - `total`, `page`, `size`, `total_pages`.

3.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **유효성 검사**: `req.validate()`.
    - 3) **Audit Log (필수)**: `user::repo::create_audit_log` 호출.
        - Action: `"LIST_TASK_STATUS"`
        - Target Table: `Some("STUDY_TASK_STATUS")`
        - Details: `{"task_id": ..., "user_id": ...}`
        - IP 변환 로직 적용.
    - 4) **데이터 조회 (Repo)**:
        - 동적 쿼리: `task_id`, `user_id` 파라미터가 있으면 `WHERE` 절에 추가.
        - 정렬: `study_task_status_last_answer DESC` (최신 활동 순).
        - 페이지네이션: `LIMIT`, `OFFSET`.
    - 5) **결과 반환**: 200 OK.

4.  **기술적 유의사항**:
    - **참조 구현**: `admin_list_task_explains` (Phase 6-24)의 구조를 따르세요.
    - **동적 쿼리**: `sqlx::QueryBuilder`를 사용하거나, 조건부 `WHERE` 절 구성을 통해 필터링을 구현하세요.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - `TaskStatusListReq`, `AdminTaskStatusRes`, `AdminTaskStatusListRes` 정의.

2.  **Repo (`src/api/admin/study/repo.rs`)**:
    - `admin_list_task_status`: 동적 필터링 및 페이징 조회 함수.

3.  **Service (`src/api/admin/study/service.rs`)**:
    - `admin_list_task_status`: 로깅 및 리포지토리 호출.

4.  **Handler (`src/api/admin/study/handler.rs`)**:
    - 핸들러 구현.
    - tag : admin_study_task_status

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/study/dto.rs
// src/api/admin/study/repo.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/docs.rs
FILE PATCHES END