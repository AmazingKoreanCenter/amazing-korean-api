# 📝 Phase 6-13 Admin Video Log Refactoring - Issue & Troubleshooting Log

## 1. 아키텍처 및 설계 (Architecture & Design)

### 🔴 이슈 1: 로그 저장소의 역할 혼동 (Conceptual Misalignment)
* **상황:** 초기 제안에서 모든 비디오 관련 로그(단순 조회 포함)를 신규 테이블(`ADMIN_VIDEO_LOG`)로 옮기려 했음.
* **지적:** 개발자님께서 "Audit Log(접근 감사)"와 "Domain Log(데이터 변경 이력)"의 설계 목적이 다름을 지적.
* **해결:** **로그 이원화 전략** 적용.
    * **`ADMIN_ACTION_LOG`:** 데이터 변경이 없는 `LIST` 조회 요청 저장 (보안/감사 목적).
    * **`ADMIN_VIDEO_LOG`:** `CREATE`, `UPDATE` 등 데이터 변경 요청 저장 (이력 추적/복구 목적, JSONB 상세 데이터 포함).

### ✅ 트랜잭션과 로깅의 원자성 (Atomicity)
* **과제:** 변경 로그(`ADMIN_VIDEO_LOG`)는 실제 데이터 변경과 **같은 트랜잭션** 안에서 수행되어야 함. (데이터는 바뀌었는데 로그가 없거나, 그 반대면 안 됨)
* **구현:** `repo::create_video_log` 함수가 `&mut Transaction`을 인자로 받을 수 있도록 설계하여, 서비스 로직의 트랜잭션 파이프라인 안에 안전하게 안착시킴.

## 2. 커뮤니케이션 및 프로세스 (Process)

### ⚠️ 이슈 2: 프롬프트 가독성 문제
* **상황:** AI가 영어로 작성한 프롬프트(Context, Rules)를 개발자가 검증하기 어려워 로직 확인이 힘들었음.
* **해결:** 프롬프트의 핵심 명세(SSOT) 부분을 **한글로 명확하게 작성**하여, 개발자가 의도를 100% 이해하고 승인할 수 있도록 개선. "검증 가능한 코드"를 위한 필수 절차 정립.

## 3. 기술적 구현 (Technical)

### ✅ JSONB 데이터 처리
* **구현:** `admin_video_after` 컬럼에 DTO나 결과값(Struct)을 저장하기 위해 `serde_json::to_value`를 사용하여 Rust 구조체를 JSONB 포맷으로 직렬화하여 DB에 저장.

---

## 4. 핵심 배움 (Key Takeaways)

1.  **로그도 데이터다:** 로그 테이블이라고 해서 무조건 다 때려 넣는 게 아니라, **"누가 볼 것인가?"(보안팀 vs 운영팀)** 에 따라 저장소를 분리하는 것이 좋다.
2.  **명세의 언어:** AI와의 협업에서 프롬프트는 단순한 명령어가 아니라 **"계약서"**와 같다. 계약서는 당사자가 가장 잘 이해할 수 있는 언어(한글)로 쓰여야 한다.