# 📝 Phase 6-7 Admin Create Video - Issue & Troubleshooting Log

## 1. 데이터베이스 및 SQL (Database & SQL)

### 🔴 이슈 1: INSERT ... RETURNING 타입 불일치
* **에러:** `mismatched types; Rust type i64 ... not compatible with SQL type INT4`
* **원인:** PostgreSQL의 `INSERT` 후 `RETURNING id`는 기본 `INT`(4byte)를 반환하지만, Rust DTO는 `i64`(8byte)를 기대함.
* **해결:** `RETURNING video_id::bigint`와 같이 SQL 내에서 명시적 캐스팅 적용.

### 🔴 이슈 2: Custom Enum 타입 매핑 실패
* **에러:** `Rust type String ... not compatible with SQL type video_access_enum`
* **원인:** `sqlx`는 DB의 Enum 타입을 Rust의 `String`으로 자동 변환해주지 않음.
* **해결:** `RETURNING video_access::text`로 캐스팅하여 문자열로 반환받음.

### 🔴 이슈 3: 컬럼 길이 제약 위반 (UUID)
* **에러:** `value too long for type character varying(30)`
* **원인:** `video_tag_key`는 30자 제한인데, 코드에서 `tag_` + `UUID`(36자) = 40자를 생성하여 주입함.
* **해결:** UUID 문자열을 슬라이싱하여 `format!("tag_{}", &uuid[..20])` (24자)로 길이 제한 준수.

---

## 2. 코드 구조 및 DTO (Code Structure & DTO)

### 🔄 DTO와 DB 컬럼명 불일치로 인한 혼란
* **상황:** Swagger에는 `title`, `description`으로 되어있으나, 실제 에러는 `video_tag_title` 등 DB 컬럼명으로 발생하여 디버깅이 어려웠음.
* **해결:** **Request DTO의 필드명을 DB 컬럼명과 100% 일치**(`video_tag_title`, `video_url_vimeo` 등)시켜 직관성을 확보하고 혼란을 제거.

### 🔴 이슈 4: Validator 문법 오류
* **에러:** `Unexpected type string`
* **원인:** `#[validate(custom = "func_name")]`은 잘못된 문법.
* **해결:** `#[validate(custom(function = "func_name"))]`으로 수정.

### 🔴 이슈 5: Trait Import 누락
* **에러:** `no method named try_get found for struct PgRow`
* **원인:** `sqlx::Row` 트레이트를 import 하지 않음.
* **해결:** `use sqlx::{Row, ...};` 추가.

---

## 3. 환경 이슈 (Environment)

### 🧟 좀비 프로세스 (Port Conflict)
* **에러:** `Address already in use (os error 98)`
* **원인:** 이전 서버 프로세스가 제대로 종료되지 않고 포트를 점유 중.
* **해결:** `fuser -k 3000/tcp` 또는 `lsof -i :3000` 후 `kill` 명령어로 프로세스 강제 종료.

---

## 4. 핵심 배움 (Key Takeaways)

1.  **SQLx의 `RETURNING` 공식:** `RETURNING` 절을 쓸 때는 `::bigint`, `::text` 캐스팅을 습관화해야 한다.
2.  **스키마 우선 설계:** 코드에서 데이터를 생성할 때(예: UUID), DB 컬럼의 길이 제약(`varchar(N)`)을 반드시 먼저 확인해야 한다.
3.  **명칭 통일의 중요성:** 복잡한 테이블 구조(Join이 많은 경우)일수록, DTO 필드명을 DB 컬럼명과 일치시키는 것이 유지보수와 디버깅에 훨씬 유리하다.