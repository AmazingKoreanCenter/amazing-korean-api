# ğŸ“ Phase 6 Admin Domain - Issue & Troubleshooting Log

## 1. ì•„í‚¤í…ì²˜ ë° ì„¤ê³„ ê²°ì • (Architecture Decisions)

### âœ… ì´ì¤‘ ë¡œê·¸ ì‹œìŠ¤í…œ (Dual Logging Strategy) ë„ì…
* **ë°°ê²½:** ê¸°ì¡´ `ADMIN_USERS_LOG`ëŠ” ë°ì´í„° ë³€ê²½ ì´ë ¥(History)ìš©ì´ë¼, ë‹¨ìˆœ ì¡°íšŒ(Read)ë‚˜ ì‹¤íŒ¨ ì‹œë„, ê²€ìƒ‰ ì¿¼ë¦¬ ë“±ì„ ê¸°ë¡í•˜ê¸°ì— ì í•©í•˜ì§€ ì•ŠìŒ.
* **ê²°ì •:**
  1. **Audit Log (`admin_action_log`)**: "CCTV" ì—­í• . ëª¨ë“  API ìš”ì²­(ì¡°íšŒ í¬í•¨), IP, User-Agent, ê²€ìƒ‰ ì¡°ê±´ ê¸°ë¡.
  2. **History Log (`ADMIN_USERS_LOG`)**: "ì´ë ¥ì„œ" ì—­í• . ë°ì´í„°ê°€ ë³€í•˜ëŠ” ì‹œì (Create/Update/Delete)ì˜ ìŠ¤ëƒ…ìƒ·(Before/After) ê¸°ë¡.
* **ì„±ê³¼:** ë³´ì•ˆ ê°ì‚¬ ìš”ê±´ê³¼ ë°ì´í„° ë³µêµ¬ ìš”ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•˜ëŠ” ê²¬ê³ í•œ ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•.

### âœ… í•¨ìˆ˜ ë„¤ì´ë° ì»¨ë²¤ì…˜ ì¬ì •ë¦½ (Refactoring)
* **ì´ìŠˆ:** Repo(`create_user_tx`), Service(`create_user`), Handler(`admin_create`) ë“± ê³„ì¸µë§ˆë‹¤ ì´ë¦„ì´ ë‹¬ë¼, ì¸ì ì „ë‹¬ ì—ëŸ¬(`E0061`) ë° ëª¨ë“ˆ ì°¸ì¡° ì—ëŸ¬(`E0425`)ê°€ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒ.
* **í•´ê²°:** **"One Feature = One Name"** ì›ì¹™ ë„ì….
  * ì˜ˆ: `admin_create_user`ë¼ëŠ” ì´ë¦„ì„ Handler, Service, Repo ê³„ì¸µì—ì„œ ë™ì¼í•˜ê²Œ ì‚¬ìš©.
* **ì„±ê³¼:** ì½”ë“œ ì¶”ì ì„±(Traceability) í–¥ìƒ ë° ê°œë°œ ìƒì‚°ì„± ì¦ëŒ€.

---

## 2. ê¸°ìˆ ì  íŠ¸ëŸ¬ë¸”ìŠˆíŒ… (Technical Troubleshooting)

### ğŸ”´ SQL Type Casting (PostgreSQL vs Rust)
Rust(SQLx)ì™€ PostgreSQL ê°„ì˜ ì—„ê²©í•œ íƒ€ì… ì‹œìŠ¤í…œ ì¶©ëŒì´ ì£¼ìš” ì´ìŠˆì˜€ìŒ.

#### 1) IP Address (`INET` type)
* **ì—ëŸ¬:** `column "ip_address" is of type inet but expression is of type text`
* **ì›ì¸:** Rustì˜ `IpAddr` íƒ€ì…ì„ SQLxê°€ Postgresì˜ `INET` ë°”ì´ë„ˆë¦¬ë¡œ ìë™ ë³€í™˜í•˜ì§€ ëª»í•¨.
* **í•´ê²°:**
  * **Rust:** `.bind(ip.to_string())` (ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì „ë‹¬)
  * **SQL:** `VALUES ($n::inet)` (DB ë‚´ë¶€ì—ì„œ ëª…ì‹œì  í˜•ë³€í™˜)

#### 2) Enum Mapping (`user_language`, `user_country`)
* **ì—ëŸ¬:** `mismatched types; Rust type String is not compatible with SQL type user_language_enum`
* **ì›ì¸:** DBì˜ ì»¤ìŠ¤í…€ ENUM íƒ€ì…ì„ Rustì˜ `String`ìœ¼ë¡œ ë°›ìœ¼ë ¤ í•  ë•Œ ë§¤í•‘ ì‹¤íŒ¨.
* **í•´ê²°:**
  * **SELECT/RETURNING:** `column::TEXT` ë¡œ ìºìŠ¤íŒ…í•˜ì—¬ Rustê°€ `String`ìœ¼ë¡œ ì¸ì‹í•˜ê²Œ í•¨.
  * **INSERT/UPDATE:** `.bind(enum_val.to_string())` í•˜ì—¬ ë¬¸ìì—´ë¡œ ì „ë‹¬ (DBê°€ í˜¸í™˜ ê°€ëŠ¥í•œ ê²½ìš°) ë˜ëŠ” `$n::enum_type` ì‚¬ìš©.

### ğŸ”´ ëª¨ë“ˆ ê°€ì‹œì„± (Visibility)
* **ì—ëŸ¬:** `could not find password in auth`
* **ì›ì¸:** `src/api/auth/mod.rs`ì—ì„œ `pub mod password;` ì„ ì–¸ì´ ëˆ„ë½ë˜ì–´ ë‹¤ë¥¸ ëª¨ë“ˆ(Admin)ì—ì„œ ì ‘ê·¼ ë¶ˆê°€.
* **í•´ê²°:** `pub` í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•˜ì—¬ ëª¨ë“ˆ ê³µê°œ.

---

## 3. ìš”ì•½ (Summary)
Phase 6 ì´ˆë°˜ë¶€ëŠ” **"Type Safety"**ì™€ **"Naming Convention"**ì˜ ì¤‘ìš”ì„±ì„ í™•ì¸í•˜ëŠ” ì‹œê°„ì´ì—ˆë‹¤.
ì´ˆê¸°ì— ë°œìƒí•œ ì»´íŒŒì¼ ì—ëŸ¬ë“¤ì„ í†µí•´ **SQL ì¿¼ë¦¬ ë‚´ ëª…ì‹œì  ìºìŠ¤íŒ…(`::type`)** íŒ¨í„´ì„ í™•ë¦½í•˜ì˜€ìœ¼ë©°, í•¨ìˆ˜ëª… í†µì¼ì„ í†µí•´ í–¥í›„ ìœ ì§€ë³´ìˆ˜ ë¹„ìš©ì„ í¬ê²Œ ì ˆê°í•  ìˆ˜ ìˆëŠ” ê¸°í‹€ì„ ë§ˆë ¨í•˜ì˜€ë‹¤.