# Phase 6-33 Admin Create Lesson (POST /admin/lessons)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `POST /admin/lessons` 엔드포인트를 구현하여 새로운 수업(Lesson)을 생성합니다.
- **핵심 로직**: `admin_create_study` (Phase 6-13)의 패턴을 따르되, `lesson_idx` 중복 검사를 수행해야 합니다.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `LESSON`
    - PK: `lesson_id` (Auto Increment).
    - Unique: `lesson_idx` (Must check duplicate).
    - FK: `updated_by_user_id` (Admin User ID).

2.  **Logging (Dual Logging)**:
    - **API Audit Log (`admin_action_log`)**: 요청 진입 시 기록. Action="CREATE_LESSON", Target="LESSON".
    - **Data Log (`ADMIN_LESSON_LOG`)**: 트랜잭션 내부에서 데이터 생성 후 기록.
        - `admin_lesson_action`: 'create' (enum).
        - `admin_pick_lesson_id`: 생성된 lesson_id.
        - `admin_lesson_after`: 생성된 데이터 JSON.
        - `admin_pick_item_seq`, `video_id`, `task_id`는 `None`.

3.  **DTO 설계**:
    - **`LessonCreateReq`**:
        - `lesson_idx`: `String` (필수, Unique).
        - `lesson_title`: `String` (필수).
        - `lesson_subtitle`: `Option<String>`.
        - `lesson_description`: `Option<String>`.
    - **`AdminLessonRes`**: 기존 DTO 재사용.

4.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **유효성 검사**: `req.validate()`.
    - 3) **Audit Log**: `user::repo::create_audit_log` 호출.
    - 4) **중복 검사**: `repo::exists_lesson_idx(req.lesson_idx)` 확인.
        - 존재하면 `AppError::Conflict` ("Lesson Index already exists").
    - 5) **트랜잭션 시작**: `pool.begin()`.
    - 6) **Insert Lesson**: `repo::create_lesson` 호출.
        - `updated_by_user_id`에는 `admin_id`를 주입.
    - 7) **Data Log**: `repo::create_lesson_log` 호출.
    - 8) **커밋**: 트랜잭션 종료.
    - 9) **결과 반환**: 201 Created.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/lesson/dto.rs`)**:
    - `LessonCreateReq` 정의 (매크로: `Debug, Deserialize, Serialize, Validate, ToSchema`).

2.  **Repo (`src/api/admin/lesson/repo.rs`)**:
    - `exists_lesson_idx`: `lesson_idx` 중복 체크 함수.
    - `create_lesson`: 수업 생성 함수 (Returning `AdminLessonRes`).
    - `create_lesson_log`: `ADMIN_LESSON_LOG` 테이블 insert 함수.

3.  **Service (`src/api/admin/lesson/service.rs`)**:
    - `admin_create_lesson`: 비즈니스 로직 구현.

4.  **Handler (`src/api/admin/lesson/handler.rs`)**:
    - 핸들러 구현 (201 Created).

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/lesson/dto.rs
// src/api/admin/lesson/repo.rs
// src/api/admin/lesson/service.rs
// src/api/admin/lesson/handler.rs
// src/api/admin/lesson/router.rs
// src/docs.rs
FILE PATCHES END