# Phase 6-37 Admin List Lesson Items (GET /admin/lessons/items)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `GET /admin/lessons/items` 엔드포인트를 구현하여 수업 구성 아이템(Lesson Item) 목록을 조회합니다.
- **기능**:
    - 전체 목록 조회뿐만 아니라, **특정 수업(`lesson_id`)**에 속한 아이템만 필터링해서 볼 수 있어야 합니다.
    - `page`, `size`, `sort`, `order` 기본 기능 지원.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `LESSON_ITEM`
    - Columns: `lesson_id`, `lesson_item_seq` (순서), `lesson_item_kind` (video/task), `video_id`, `study_task_id`.
    - PK: `lesson_id` + `lesson_item_seq` (Composite).

2.  **DTO 설계 (Strict Requirement)**:
    - **필수 매크로**: `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema)]` (Response는 `FromRow` 필수).
    - **`LessonItemListReq`**:
        - `page`: `Option<u64>` (default 1).
        - `size`: `Option<u64>` (default 20).
        - `sort`: `Option<String>` (default "lesson_id" or "lesson_item_seq").
        - `order`: `Option<String>` (default "asc").
        - **필터**: `lesson_id`: `Option<i32>` (특정 수업 필터링용).
        - **필터**: `lesson_item_kind`: `Option<String>` (video/task 필터링용).
    - **`AdminLessonItemRes`**:
        - `LESSON_ITEM` 테이블의 모든 컬럼 매핑.
    - **`AdminLessonItemListRes`**:
        - `list`: `Vec<AdminLessonItemRes>`.
        - `total`, `page`, `size`, `total_pages`.

3.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **유효성 검사**: `req.validate()`.
    - 3) **Audit Log (필수)**: `user::repo::create_audit_log` 호출.
        - Action: `"LIST_LESSON_ITEMS"`
        - Target Table: `Some("LESSON_ITEM")` (명시 필수).
        - Details: `req` 파라미터 전체.
    - 4) **데이터 조회 (Repo)**:
        - `sqlx::QueryBuilder` 사용.
        - **동적 필터링**:
            - `req.lesson_id`가 있으면 `WHERE lesson_id = $x` 추가.
            - `req.lesson_item_kind`가 있으면 `AND lesson_item_kind = $y` 추가.
        - **정렬**: `sort` 파라미터에 따라 `ORDER BY` 적용 (SQL Injection 방지).
        - **페이징**: `LIMIT`, `OFFSET` 적용.
    - 5) **결과 반환**: 200 OK.

4.  **기술적 유의사항**:
    - **참조 구현**: `admin_list_lessons` (Phase 6-32)의 구조를 따르세요.
    - **열거형 처리**: `lesson_item_kind`는 DB에서 ENUM 타입(`lesson_item_kind_enum`)일 수 있으므로, DTO 매핑 시 `sqlx::Type` 처리에 유의하거나 String으로 캐스팅하여 조회하세요.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/lesson/dto.rs`)**:
    - `LessonItemListReq`, `AdminLessonItemRes`, `AdminLessonItemListRes` 정의.

2.  **Repo (`src/api/admin/lesson/repo.rs`)**:
    - `admin_list_lesson_items`: QueryBuilder를 이용한 동적 조회 함수 구현.

3.  **Service (`src/api/admin/lesson/service.rs`)**:
    - `admin_list_lesson_items`: 로깅 및 리포지토리 호출.

4.  **Handler (`src/api/admin/lesson/handler.rs`)**:
    - 핸들러 구현.

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/lesson/dto.rs
// src/api/admin/lesson/repo.rs
// src/api/admin/lesson/service.rs
// src/api/admin/lesson/handler.rs
// src/api/admin/lesson/router.rs
// src/docs.rs
FILE PATCHES END