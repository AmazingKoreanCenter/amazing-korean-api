# Phase 6-39 Admin Bulk Create Lesson Items (POST /admin/lessons/bulk/items)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `POST /admin/lessons/bulk/items` 엔드포인트를 구현하여 여러 개의 수업 아이템(Lesson Item)을 한 번에 생성합니다.
- **핵심 패턴**: `admin_bulk_create_lessons`의 **"Loop + Individual Transaction (부분 성공 207)"** 패턴을 사용하여, 개별 아이템의 성공/실패를 독립적으로 처리합니다.

CONTEXT (SSOT & Rules):
1.  **로직 흐름 (Service)**:
    - 1) **API Log**: `user::repo::create_audit_log` 호출 (Action="BULK_CREATE_LESSON_ITEMS").
    - 2) **Loop Processing**:
        - 각 아이템마다 **개별 트랜잭션**(`pool.begin()`)을 시작합니다.
        - **Validation 1 (Lesson Existence)**: `repo::exists_lesson_tx` (또는 유사 함수) 호출.
            - `lesson_id`가 유효하지 않으면 `404 Not Found`.
        - **Validation 2 (Kind-ID Integrity)**:
            - Kind="video" -> `video_id` 필수.
            - Kind="study_task" -> `study_task_id` 필수.
            - 불일치 시 `400 Bad Request`.
        - **Validation 3 (Duplicate Seq)**: `repo::exists_lesson_item_tx` 호출.
            - `(lesson_id, seq)` 조합 중복 시 `409 Conflict`.
        - **Insert**: `repo::create_lesson_item_tx` 호출.
        - **Data Log**: `repo::create_lesson_log_tx` 호출.
            - Action: `"create"`.
            - `admin_pick_item_seq`, `video_id`, `task_id` 기록.
        - **Commit**: 트랜잭션 종료.
        - **Result Collection**: 성공/실패 결과 수집.
    - 3) **Response**: 실패가 0건이면 `201 Created`, 1건이라도 있으면 `207 Multi-Status`.

2.  **DTO 설계 (Strict Requirement)**:
    - **`LessonItemBulkCreateReq`**:
        - `items`: `Vec<LessonItemCreateItem>`.
    - **`LessonItemCreateItem`**:
        - `lesson_id`: `i32` (필수, 단건 생성과 달리 Body에 포함).
        - `lesson_item_seq`: `i32`.
        - `lesson_item_kind`: `String`.
        - `video_id`: `Option<i32>`.
        - `study_task_id`: `Option<i32>`.
    - **`LessonItemBulkCreateRes`**: 성공/실패 카운트 및 결과 리스트.

3.  **기술적 유의사항**:
    - **Repo 리팩토링**: `create_lesson_item`, `exists_lesson_item` 등이 `&mut Transaction`을 지원하는 `_tx` 버전이 없다면 분리/추가해야 합니다.
    - **재사용**: 검증 로직(Validation 2)은 단건 생성과 동일하므로 로직 일관성을 유지하세요.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/lesson/dto.rs`)**:
    - `LessonItemBulkCreateReq`, `LessonItemCreateItem`, `LessonItemBulkCreateRes` 정의.

2.  **Repo (`src/api/admin/lesson/repo.rs`)**:
    - `exists_lesson_item_tx`: 트랜잭션 지원 중복 검사.
    - `create_lesson_item_tx`: 트랜잭션 지원 생성.
    - `exists_lesson_tx`: (필요 시) 트랜잭션 지원 수업 존재 확인.

3.  **Service (`src/api/admin/lesson/service.rs`)**:
    - `admin_bulk_create_lesson_items`: 부분 성공 로직(Loop + Tx) 구현.

4.  **Handler (`src/api/admin/lesson/handler.rs`)**:
    - 핸들러 구현 (201 vs 207).

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/lesson/dto.rs
// src/api/admin/lesson/repo.rs
// src/api/admin/lesson/service.rs
// src/api/admin/lesson/handler.rs
// src/api/admin/lesson/router.rs
// src/docs.rs
FILE PATCHES END