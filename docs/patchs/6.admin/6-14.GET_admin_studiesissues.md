# 📝 Phase 6-14 Admin List Studies - Issue & Troubleshooting Log

## 1. AI(Codex)의 치명적 실수 (Critical Mistakes)

### 🔴 이슈 1: 함수 시그니처 및 인자 개수 오류
* **현상:** `create_audit_log` 함수 호출 시 `this function takes 8 arguments but 9 arguments were supplied` 에러 발생.
* **원인:** 제가 해당 함수의 정의(`repo.rs`)를 정확히 확인하지 않고, 관성적으로 `trace_id` 인자를 추가하거나 `target_sub_id`를 누락했습니다.
* **해결:** 실제 함수 정의를 확인하여 **8개 인자**`(db, actor, action, target_id, target_sub_id, details, ip, ua)` 순서를 정확히 맞춤.

### 🔴 이슈 2: 변수 스코프 및 타입 불일치
* **현상:** `cannot find value ip_addr` 및 `expected Option<IpAddr>, found Option<String>`.
* **원인:**
    1.  `ip_addr` 변수를 사용(함수 호출)한 뒤에 선언하는 엉터리 순서로 코드를 작성함.
    2.  `create_audit_log`가 `IpAddr` 타입을 요구하는데 `String`을 그대로 넘기려 함.
* **해결:** `IpAddr::from_str` 변환 로직을 함수 호출 **상단으로 이동**시키고 타입을 일치시킴.

### 🔴 이슈 3: DTO와 비즈니스 로직의 필드명 불일치
* **현상:** `no field per_page on type StudyListReq`.
* **원인:** DTO 정의에는 `per_page`, `program`으로 적어놓고, 정작 서비스 로직에서는 `req.size`, `req.study_program`으로 호출하는 일관성 없는 코드 작성.
* **해결:** DTO와 Service 양쪽 모두 DB 컬럼명과 유사한 `size`, `study_program`으로 통일.

---

## 2. Rust 기술적 이슈 (Technical Issues)

### ⚠️ 이슈 4: QueryBuilder 라이프타임 문제
* **현상:** `argument requires that '1 must outlive '2` (컴파일 에러).
* **원인:** `QueryBuilder`의 `push_bind`는 인자의 참조를 보관할 수 있는데, 헬퍼 함수(`apply_filters`)에서 인자의 수명(Lifetime) 관계를 명시하지 않음.
* **해결:** 함수 시그니처에 라이프타임 `'a`를 명시하여 `builder`와 `search` 변수의 수명을 엮어줌. (`fn apply_filters<'a>`)

---

## 3. 반성 및 개선 대책 (Retrospective)

이번 Phase에서 발생한 에러의 80%는 **"확인 부족"**에서 비롯되었습니다.
앞으로는 다음과 같은 절차를 강제하여 신뢰를 회복하겠습니다.

1.  **함수 호출 전 정의 확인:** `repo`나공통 함수를 호출할 때는 반드시 해당 파일의 `pub fn` 정의를 먼저 읽고 인자 개수를 맞추겠습니다.
2.  **변수 선언 순서 점검:** 코드를 출력하기 전에 "변수가 사용되기 전에 선언되었는가?"를 한 번 더 체크하겠습니다.
3.  **DTO 일관성 유지:** 요청(Req) 객체의 필드명이 서비스 로직과 일치하는지 대조하겠습니다.