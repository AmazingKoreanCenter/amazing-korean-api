# Refactor â€” Phase 6-13 Separate Admin Logging Strategy

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- Refactor logging in `src/api/admin/video/service.rs` to respect the distinct roles of Audit Log vs. Domain Log.
- **READ Operations (`LIST`)**: Keep using the generic `user::repo::create_audit_log`.
- **WRITE Operations (`CREATE`, `UPDATE`, `BULK`)**: Switch to the dedicated `video::repo::create_video_log` to capture `before`/`after` states and specific IDs.

CONTEXT (SSOT & Rules):
1.  **Table Roles**:
    - `ADMIN_ACTION_LOG` (via `user::repo`): For generic access auditing (Who accessed what?).
    - `ADMIN_VIDEO_LOG` (New implementation): For data mutation history (What changed?).
        - Columns: `admin_pick_video_id`, `admin_video_before`, `admin_video_after`.

2.  **Implementation Scope**:
    - **Repo (`src/api/admin/video/repo.rs`)**:
        - Implement `create_video_log`.
        - It handles `admin_video_action`, `video_id`, `tag_id`, `before` (json), `after` (json).
        - Should accept `&mut Transaction` (preferred for atomic logging with mutations) or `&PgPool`.
    
    - **Service (`src/api/admin/video/service.rs`)**:
        - **`admin_list_videos`**: DO NOT CHANGE. Keep using generic audit log.
        - **`admin_create_video`**: Change to `repo::create_video_log`. (Action: CREATE)
        - **`admin_update_video`**: Change to `repo::create_video_log`. (Action: UPDATE)
        - **`admin_update_video_tags`**: Change to `repo::create_video_log`. (Action: UPDATE_TAG)
        - **`admin_bulk_create_videos`**: Change to `repo::create_video_log`. (Action: BULK_CREATE)
        - **`admin_bulk_update_videos`**: Change to `repo::create_video_log`. (Action: BULK_UPDATE)
        - **`admin_bulk_update_video_tags`**: Change to `repo::create_video_log`. (Action: BULK_UPDATE_TAG)

3.  **Log Data Mapping**:
    - `before`: Pass `None` for Creates. Pass old data snapshot for Updates (if available easily, otherwise `None` for now).
    - `after`: Pass the Request DTO or the Result Object (serialized to JSON).

IMPLEMENTATION STEPS:

1.  **Repo (`src/api/admin/video/repo.rs`)**:
    - Create `create_video_log` function.
    - Insert into `ADMIN_VIDEO_LOG`.

2.  **Service (`src/api/admin/video/service.rs`)**:
    - Modify only the **mutation** functions to use the new logger.
    - Leave `admin_list_videos` as is.

FILE PATCHES START
// src/api/admin/video/repo.rs
// src/api/admin/video/service.rs
FILE PATCHES END