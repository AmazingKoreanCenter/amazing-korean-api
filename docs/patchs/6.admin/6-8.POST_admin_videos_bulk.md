# POST â€” Phase 6-8 Admin Bulk Create Videos (POST /admin/videos/bulk)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- Implement `POST /admin/videos/bulk` to create multiple videos in a single request.
- **Partial Success (HTTP 207)**:
    - If some items succeed and others fail, return **207 Multi-Status**.
    - If all succeed, return **201 Created**.
- **Reusability**: Reuse the existing `repo::admin_create_video` logic which handles the complex 3-table insert (`VIDEO`, `VIDEO_TAG`, `VIDEO_TAG_MAP`).
- **RBAC**: Admin/Manager/Hymn only.
- **Logging**: Record a single `admin_action_log` summarizing the bulk operation (total, success, fail counts).

CONTEXT (SSOT & Rules):
1.  **DTO Strategy**:
    - **Request**: `VideoBulkCreateReq` containing `items: Vec<VideoCreateReq>`.
    - **Response**: `VideoBulkCreateRes` containing `summary` (stats) and `results` (list of success/error details).
    - **Reuse**: `VideoCreateReq` MUST match the Phase 6-7 structure (mapped to DB columns: `video_tag_title`, `video_url_vimeo`, etc.).

2.  **Service Logic (Partial Success Pattern)**:
    - Iterate through `req.items`.
    - For each item:
        1. Start a **new transaction** (`pool.begin()`).
        2. Perform logic (check duplicates, generate UUIDs if null).
        3. Call `repo::admin_create_video(tx, ...)`.
        4. If success -> `tx.commit()` -> Add to results (Status 201).
        5. If fail -> `tx.rollback()` (automatic on drop) -> Add to results (Status 4xx/5xx with error message).
    - **Log Action**: Create one audit log entry ("BULK_CREATE_VIDEO") with the summary stats in `details`.

3.  **Route Registration**:
    - Add to `src/api/admin/video/router.rs`.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/video/dto.rs`)**:
    - Define `VideoBulkCreateReq`.
    - Define `BulkResultItem` (id, status, data, error).
    - Define `VideoBulkCreateRes` (summary, results).

2.  **Service (`src/api/admin/video/service.rs`)**:
    - Implement `admin_bulk_create_videos`.
    - Reuse `admin_create_video` internal logic (or call the repo directly if logic permits).
    - *Note*: Ensure the specific logic for `video_idx` and `video_tag_key` generation (length limits) is applied to each item.

3.  **Handler (`src/api/admin/video/handler.rs`)**:
    - Implement `admin_bulk_create_videos`.
    - Returns `201` if `failure_count == 0`, otherwise `207`.

4.  **Router**:
    - Register `POST /bulk`.

FILE PATCHES START
// src/api/admin/video/dto.rs
// src/api/admin/video/service.rs
// src/api/admin/video/handler.rs
// src/api/admin/video/router.rs
FILE PATCHES END

# Request Body Example (for context)
```json
{
  "items": [
    {
      "video_tag_title": "Bulk Video 1",
      "video_tag_subtitle": "Desc 1",
      "video_url_vimeo": "[https://vimeo.com/111](https://vimeo.com/111)",
      "video_access": "public",
      "video_idx": "bulk_01"
    },
    {
      "video_tag_title": "Bulk Video 2",
      "video_url_vimeo": "[https://vimeo.com/222](https://vimeo.com/222)",
      "video_access": "private"
    }
  ]
}
```