# 📝 Phase 6-34 Admin Bulk Create Lessons - Issue & Achievement Log

## 1. 주요 성과 (Key Achievements)

### ✅ 트랜잭션 함수 분리 전략 (Repository Refactoring)
* **성과:** 기존 `&PgPool`을 사용하는 함수와 달리, `&mut Transaction`을 받는 `_tx` 접미사 함수들(`create_lesson_tx`, `exists_lesson_idx_tx`)을 미리 분리하여 구현했습니다.
* **효과:**
    * 컴파일러의 타입 에러(Pool vs Transaction)를 원천 차단했습니다.
    * 단건 생성과 벌크 생성 로직이 서로 간섭하지 않고 안전하게 공존하게 되었습니다.

### ✅ 부분 성공(207) 패턴의 정착
* **성과:** 100개의 수업을 동시에 생성할 때, 1개의 `lesson_idx`가 중복되더라도 나머지 99개는 정상적으로 생성되는 "유연한 처리"가 구현되었습니다.
* **로직:** `Loop` 진입 -> `Transaction` 시작 -> `Duplicate Check` -> `Insert` -> `Log` -> `Commit`의 흐름이 교과서적으로 작성되었습니다.

---

## 2. 잠재적 이슈 예방 (Prevented Issues)

### 🛡️ 고유 키(Unique Key) 충돌 방어
* **상황:** 벌크 작업 중 DB 레벨에서 `Unique Constraint Violation`이 발생하면 트랜잭션이 오염되어 롤백 처리가 복잡해질 수 있습니다.
* **조치:** 애플리케이션 레벨에서 `exists_lesson_idx_tx`로 선행 검사를 수행하여, 충돌 상황을 `409 Conflict` 에러로 우아하게 변환하고 트랜잭션을 안전하게 닫았습니다.

### 🛡️ 로그 일관성 (Log Consistency)
* **전략:** 데이터 생성(`LESSON`)과 이력 기록(`ADMIN_LESSON_LOG`)을 하나의 트랜잭션으로 묶었습니다.
* **결과:** 만약 로그 기록 중 에러가 발생하면 수업 생성도 함께 취소되므로, "데이터는 있는데 로그는 없는" 정합성 깨짐 현상을 방지했습니다.

---

## 3. 총평 (Conclusion)

이제 `Lesson` 도메인의 **생성(Create)** 기능(단건/벌크)이 모두 완성되었습니다.
관리자는 개별 수업을 꼼꼼하게 만들 수도 있고, 엑셀 등으로 정리된 커리큘럼을 한 번에 밀어넣을 수도 있게 되었습니다.

이제 생성된 수업의 내용을 수정하는 기능으로 넘어갈 차례입니다.