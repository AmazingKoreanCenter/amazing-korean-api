# Phase 6-26 Admin Bulk Create Study Task Explains (POST /admin/studies/tasks/bulk/explain)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `POST /admin/studies/tasks/bulk/explain` 엔드포인트를 구현하여 여러 개의 학습 문제 해설을 한 번에 생성합니다.
- **핵심 패턴**: `admin_bulk_create_studies` (Phase 6-16)의 **"Loop + Individual Transaction (부분 성공)"** 패턴을 사용하여, 요청된 항목들을 순차적으로 처리하고 결과를 집계합니다.

CONTEXT (SSOT & Rules):
1.  **로직 흐름 (Service)**:
    - 1) **API Log**: `user::repo::create_audit_log` 호출.
        - Action: `"BULK_CREATE_TASK_EXPLAINS"`
        - Target Table: `Some("STUDY_TASK_EXPLAIN")` (명시 필수).
        - Details: `{"count": items.len()}`.
    - 2) **Loop Processing**:
        - 각 아이템마다 **개별 트랜잭션**(`pool.begin()`)을 시작합니다.
        - **Validation 1 (Parent)**: `study_task_id`가 `STUDY_TASK` 테이블에 존재하는지 확인. (없으면 Error).
        - **Validation 2 (Duplicate)**: `(study_task_id, explain_lang)` 조합이 이미 존재하는지 확인. (있으면 409 Conflict).
        - **Insert**: `repo::create_task_explain` 호출.
        - **Data Log**: `repo::create_study_log` 호출.
            - Action: `"create"` (**소문자 필수**).
            - Target ID: `study_task_id`.
            - After: 생성된 데이터.
        - **Commit**: 트랜잭션 종료.
        - **Result Collection**: 성공 시 `task_id`+`lang`, 실패 시 `error` 메시지 수집.
    - 3) **Response**: 실패가 0건이면 `201 Created`, 1건이라도 있으면 `207 Multi-Status`.

2.  **DTO 설계 (Strict Requirement)**:
    - **필수 매크로**: `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema, Clone)]`.
    - **`TaskExplainBulkCreateReq`**:
        - `items`: `Vec<TaskExplainCreateItem>` (최대 100개 제한 권장).
    - **`TaskExplainCreateItem`**:
        - `study_task_id`: `i32` (필수).
        - `explain_lang`: `UserSetLanguage` (필수).
        - `explain_title`: `Option<String>`.
        - `explain_text`: `Option<String>`.
        - `explain_media_url`: `Option<String>`.
    - **`TaskExplainBulkCreateRes`**: 성공/실패 카운트 및 결과 리스트.

3.  **기술적 유의사항**:
    - **재사용**: Phase 6-25에서 만든 `repo::exists_task_explain`과 `repo::create_task_explain`을 재사용하세요.
    - **로그 정합성**: `admin_action_log`와 `admin_study_log`가 누락 없이 기록되어야 합니다.
    - **에러 핸들링**: 409(중복), 404(부모 없음) 등 비즈니스 에러를 명확히 구분하여 결과 리스트에 담아야 합니다.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - `TaskExplainBulkCreateReq`, `TaskExplainCreateItem`, `TaskExplainBulkCreateRes` 정의.

2.  **Service (`src/api/admin/study/service.rs`)**:
    - `admin_bulk_create_task_explains`: 부분 성공 로직(Loop + Tx) 구현.

3.  **Handler (`src/api/admin/study/handler.rs`)**:
    - 핸들러 구현 (201 vs 207).

4.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/study/dto.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/docs.rs
FILE PATCHES END