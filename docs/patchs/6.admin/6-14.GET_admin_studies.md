# Phase 6-14 Admin List Studies (GET /admin/studies)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- Implement `GET /admin/studies` to retrieve a paginated list of study sessions.
- Support dynamic filtering, searching, sorting, and pagination.
- **RBAC**: Admin/Manager/Hymn only.
- **Logging**: Use `user::repo::create_audit_log` (Action: "LIST_STUDIES") as this is a READ operation.

CONTEXT (SSOT & Rules):
1.  **테이블 및 데이터 소스 (Schema)**:
    - **`STUDY`** 테이블을 메인으로 조회합니다.
    - 주요 컬럼: `study_id`, `study_idx`, `study_title`, `study_program` (Enum), `study_state` (Enum), `study_created_at`, `study_updated_at`.
    - **참고**: `STUDY_TASK` 테이블은 이번 목록 조회에서는 조인하지 않고, `STUDY` 테이블의 메타데이터 위주로 반환합니다.

2.  **DTO 설계 (Request/Response)**:
    - **`StudyListReq`**:
        - 공통 페이지네이션 필드 (`page`, `size`).
        - 검색 및 정렬: `q` (검색어), `sort` (정렬 컬럼), `order` (asc/desc).
        - 필터링(선택): `study_state` (Enum), `study_program` (Enum).
    - **`AdminStudyListRes`**:
        - `list`: `Vec<AdminStudyRes>` (ID, Title, Subtitle, Program, State, CreatedAt, UpdatedAt).
        - `total`: 전체 개수 (검색 조건 적용됨).
        - `total_pages`, `page`, `size`.

3.  **검색 로직 (Dynamic Query)**:
    - `q` 파라미터가 존재할 경우: `study_title`, `study_subtitle`, `study_idx` 컬럼에 대해 `ILIKE` 검색을 수행합니다 (`OR` 조건).
    - `QueryBuilder`를 사용하여 조건부 `WHERE` 절을 구성하세요.

4.  **로깅 (Logging)**:
    - 단순 조회이므로 `ADMIN_VIDEO_LOG`가 아닌, 기존의 **`admin_action_log`** (via `user::repo::create_audit_log`)를 사용합니다.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - Create `StudyListReq` (derive Deserialize, Validate, ToSchema).
    - Create `AdminStudyRes` and `AdminStudyListRes` (derive Serialize, ToSchema).
    - *Note*: Create the `src/api/admin/study` module structure if it doesn't exist.

2.  **Repo (`src/api/admin/study/repo.rs`)**:
    - Implement `admin_list_studies`.
    - Use `QueryBuilder` for dynamic filtering and pagination.
    - Execute two queries: one for `count(*)` and one for `SELECT data`.

3.  **Service (`src/api/admin/study/service.rs`)**:
    - Implement `admin_list_studies`.
    - Handle RBAC (Check roles).
    - Call `user::repo::create_audit_log`.
    - Call `repo::admin_list_studies`.

4.  **Handler (`src/api/admin/study/handler.rs`)**:
    - Implement the handler function.
    - Map `AppResult` to JSON response.

5.  **Router (`src/api/admin/study/router.rs`)**:
    - Define `admin_study_routes`.
    - Register `GET /`.

6.  **Main Router & Docs**:
    - Register the new module in `src/api/admin/mod.rs` and `src/router.rs`.
    - Update `src/docs.rs`.

FILE PATCHES START
// src/api/admin/mod.rs
// src/api/admin/study/mod.rs
// src/api/admin/study/dto.rs
// src/api/admin/study/repo.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/router.rs
// src/docs.rs
FILE PATCHES END