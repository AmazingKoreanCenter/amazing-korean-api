# Phase 6-27 Admin Update Study Task Explain (PATCH /admin/studies/tasks/{id}/explain)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `PATCH /admin/studies/tasks/{id}/explain` 엔드포인트를 구현하여 특정 학습 문제의 특정 언어 해설을 수정합니다.
- **핵심 로직**:
    1. **복합 키 식별**: 수정 대상을 찾기 위해 Path Parameter인 `task_id`와 Request Body의 `explain_lang`을 모두 사용해야 합니다.
    2. **동적 업데이트**: `QueryBuilder`를 사용하여 요청된 필드(`Some`인 값)만 `UPDATE` 쿼리에 포함하세요.

CONTEXT (SSOT & Rules):
1.  **테이블 구조 (Schema)**:
    - Table: `STUDY_TASK_EXPLAIN`
    - Identifier: `study_task_id` + `explain_lang` (Composite Key).

2.  **DTO 설계 (Strict Requirement)**:
    - **필수 매크로**: `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema, Clone)]`.
    - **`TaskExplainUpdateReq`**:
        - `explain_lang`: `UserSetLanguage` (필수 - 식별자 역할).
        - `explain_title`: `Option<String>`.
        - `explain_text`: `Option<String>`.
        - `explain_media_url`: `Option<String>`.
    - *Note*: `study_task_id`는 Path Parameter로 받습니다.

3.  **로직 흐름 (Service)**:
    - 1) **권한 체크**: RBAC.
    - 2) **Audit Log (필수)**: 함수 진입 직후 `user::repo::create_audit_log` 호출.
        - Action: `"UPDATE_TASK_EXPLAIN"` (대문자).
        - Target Table: `Some("STUDY_TASK_EXPLAIN")`.
        - Target ID: `req.task_id`.
    - 3) **데이터 존재 확인 (Before)**:
        - `repo::find_task_explain`(`task_id`, `lang`) 호출.
        - 없으면 `404 Not Found` 반환.
    - 4) **트랜잭션 시작**: `pool.begin()`.
    - 5) **동적 업데이트**: `repo::update_task_explain` (QueryBuilder 사용).
    - 6) **변경된 데이터 조회 (After)**: 업데이트 후 다시 조회.
    - 7) **Data Log**: `repo::create_study_log` 호출.
        - Action: `"update"` (**소문자 필수**).
        - Before: 3번에서 조회한 데이터.
        - After: 6번에서 조회한 데이터.
    - 8) **커밋**: 트랜잭션 종료.

4.  **기술적 유의사항**:
    - **QueryBuilder 패턴**: Phase 6-22(`admin_update_study_task`)의 구현 방식을 참고하여, 변경된 컬럼만 `SET` 절에 추가되도록 구현하세요.
    - **로그 정합성**: `admin_action_log`와 `admin_study_log` 모두 누락 없이 기록되어야 합니다.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - `TaskExplainUpdateReq` 정의 (매크로 필수).

2.  **Repo (`src/api/admin/study/repo.rs`)**:
    - `update_task_explain`: QueryBuilder를 이용한 동적 업데이트 함수 구현.
    - `find_task_explain`: (이미 존재한다면 재사용, 없으면 구현).

3.  **Service (`src/api/admin/study/service.rs`)**:
    - `admin_update_task_explain`: 로깅, 트랜잭션, Before/After 비교 로직.

4.  **Handler (`src/api/admin/study/handler.rs`)**:
    - 핸들러 구현 (200 OK).
    - tag = admin_study_task_explain

5.  **Router & Docs**:
    - 라우터 등록 및 문서 업데이트.

FILE PATCHES START
// src/api/admin/study/dto.rs
// src/api/admin/study/repo.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/docs.rs
FILE PATCHES END