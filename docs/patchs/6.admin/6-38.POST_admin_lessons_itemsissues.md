# 📝 Phase 6-38 Admin Create Lesson Item - Issue & Achievement Log

## 1. 주요 성과 (Key Achievements)

### ✅ 조건부 데이터 검증 (Conditional Validation)
* **도전 과제:** `lesson_item_kind`가 'video'일 때는 `video_id`가 필수고, 'study_task'일 때는 `study_task_id`가 필수라는 "상호 의존적인" 제약 조건이 있었습니다.
* **해결:** DTO의 기본 검증(`Validate`)을 넘어, 서비스 계층에서 `match` 구문을 사용하여 **Kind와 ID의 쌍(Pair)이 맞는지** 엄격하게 검사했습니다.
* **결과:** 잘못된 데이터(예: 문제는 'video'인데 ID는 'task'를 넣음)가 DB에 들어가는 것을 원천 차단했습니다.

### ✅ 복합 키 중복 방어 (Composite Key Uniqueness)
* **구현:** `LESSON_ITEM` 테이블의 PK는 `(lesson_id, lesson_item_seq)`입니다.
* **로직:** 단순히 `seq`만 확인하는 것이 아니라, 현재 작업 중인 `lesson_id` 범위 내에서 해당 `seq`가 이미 사용 중인지 정확히 체크하여 `409 Conflict`를 반환했습니다.

### ✅ 정밀한 로그 기록
* **성과:** `ADMIN_LESSON_LOG` 테이블은 `video_id`와 `task_id` 컬럼을 모두 가지고 있습니다.
* **디테일:** 생성된 아이템의 종류에 따라 **해당하는 ID 컬럼에만 값을 채우고 나머지는 NULL 처리**하는 로직이 리포지토리 레벨에서 정확하게 구현되었습니다.

---

## 2. 총평 (Conclusion)

이제 관리자는 수업(Lesson)이라는 뼈대 안에, 실제 콘텐츠(Video/Task)를 하나씩 끼워 넣을 수 있게 되었습니다.
하지만 수업 하나가 20~30개의 아이템으로 구성된다면, 하나씩 API를 호출하는 것은 매우 비효율적입니다.

따라서 **아이템을 한 번에 여러 개 등록하는 기능**이 필수적입니다.