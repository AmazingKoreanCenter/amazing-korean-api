# 📝 Phase 6-3 Admin Bulk Create - Issue & Troubleshooting Log

## 1. 아키텍처 및 설계 결정 (Architecture Decisions)

### ✅ 부분 성공(Partial Success) 전략 도입
* **배경:** 대량의 데이터를 등록할 때, 단 한 건의 데이터 오류(예: 중복 이메일)로 인해 전체 요청이 실패하는 것은 비효율적임.
* **결정:**
    1.  **Iterative Transaction:** 각 항목을 독립적인 트랜잭션으로 처리하여, 성공한 건은 커밋하고 실패한 건만 롤백.
    2.  **207 Multi-Status:** HTTP 표준 상태 코드를 사용하여, 성공/실패가 섞여 있음을 클라이언트에게 명시.
    3.  **Result Aggregation:** `summary`와 `results` 배열을 통해 어떤 항목이 왜 실패했는지 상세 피드백 제공.

---

## 2. 기술적 트러블슈팅 (Technical Troubleshooting)

### 🔴 이슈 1: 중첩 유효성 검사 (Nested Validation) 누락
* **에러:** `error: You need to set at least one validator on field items...`
* **원인:** `validator` 크레이트는 기본적으로 `Vec<Struct>` 내부의 아이템을 자동으로 검사하지 않음. 매크로에게 "안까지 들여다봐라"고 지시해야 함.
* **해결:** `items` 필드에 **`#[validate(nested)]`** 어트리뷰트 추가.
    ```rust
    pub struct AdminBulkCreateReq {
        #[validate(nested)] // 필수!
        pub items: Vec<AdminCreateUserReq>,
    }
    ```

### 🔴 이슈 2: Validation 의존성 (Serialize Trait)
* **에러:** `the trait bound AdminCreateUserReq: Serialize is not satisfied`
* **원인:** `#[validate(nested)]` 사용 시, 검증 실패 에러 메시지를 구조화하기 위해 내부 객체(`AdminCreateUserReq`)를 직렬화(Serialize)해야 함. 기존에는 `Deserialize`만 있었음.
* **해결:** 내부 DTO에 **`#[derive(Serialize)]`** 추가.

---

## 3. 성과 (Achievements)

### ✅ 선제적 방어 (Pre-emptive Fix) 성공
* Phase 6-1, 6-2에서 겪었던 **SQL Type Mismatch (INET, Enum)** 에러가 이번에는 발생하지 않음.
* **이유:** 프롬프트 단계에서부터 `::inet`, `::TEXT` 캐스팅 규칙을 강제했기 때문. 이는 **"시행착오를 통한 학습 프로세스"**가 잘 작동하고 있음을 의미함.

### ✅ 네이밍 컨벤션 정착
* `Handler` -> `Service` -> `Repo` 로 이어지는 함수명을 `admin_create_users_bulk`로 통일하여 코드의 일관성과 가독성을 확보함.