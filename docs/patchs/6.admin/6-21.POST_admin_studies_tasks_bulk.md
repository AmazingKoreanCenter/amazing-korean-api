# Phase 6-21 Admin Bulk Create Study Tasks (POST /admin/studies/tasks/bulk)

ROLE: Senior Rust Backend AI Assistant

OBJECTIVE:
- `POST /admin/studies/tasks/bulk` 엔드포인트를 구현하여 여러 개의 학습 문제(Task)를 한 번에 생성합니다.
- **핵심 패턴**: `admin_bulk_create_studies` (Phase 6-16)의 **"Loop + Individual Transaction (부분 성공)"** 패턴을 사용하여, 한 요청 안에 **서로 다른 유형(Choice/Typing/Voice)**의 문제가 섞여 있어도 각각 안전하게 처리되어야 합니다.

CONTEXT (SSOT & Rules):
1.  **참조 로직 (Reference Pattern)**:
    - **서비스 흐름**: `admin_bulk_create_studies`의 루프 구조를 따르세요.
    - **단건 로직 재사용**: 루프 내부에서는 Phase 6-20에서 만든 로직(`repo::create_study_task` + `match kind` -> 서브 테이블 Insert)을 재사용하거나, 유사한 로직을 적용하여 **메인+서브 테이블 트랜잭션**을 보장해야 합니다.

2.  **데이터 및 DTO 설계 (Strict Requirement)**:
    - **필수 매크로**: `#[derive(Debug, Deserialize, Serialize, Validate, ToSchema, Clone)]`.
    - **`StudyTaskBulkCreateReq`**: `items: Vec<StudyTaskCreateReq>` (Phase 6-20에서 만든 단건 DTO 재사용 가능).
    - **`StudyTaskBulkCreateRes`**: 성공/실패 카운트 및 결과 리스트.
    - **`StudyTaskBulkResult`**: `task_id` (성공 시), `error` (실패 시), `seq`, `kind`.

3.  **로직 흐름 (Service)**:
    - 1) **Audit Log**: 전체 요청에 대해 `user::repo::create_audit_log` (Action: "BULK_CREATE_TASKS").
    - 2) **루프 처리 (Loop)**:
        - `pool.begin()` (개별 트랜잭션 시작).
        - **유효성 검사**: `study_id` 존재 여부 확인 등.
        - **Main Insert**: `repo::create_study_task` 호출.
        - **Sub Insert**: `kind`에 따라 분기(`match`)하여 적절한 서브 테이블 Insert (`repo::create_task_choice` 등).
        - **로그 기록**: `repo::create_study_log` (Action: "CREATE_TASK", 상세 내용 포함).
        - **커밋**: 성공 리스트 추가.
        - **실패 시**: 롤백 후 실패 리스트에 에러 사유 추가.
    - 3) **결과 반환**: 실패가 하나라도 있으면 `207 Multi-Status`, 모두 성공하면 `201 Created`.

4.  **기술적 유의사항**:
    - **다형성 처리**: 요청 리스트(`items`) 안에 `Choice`, `Typing`, `Voice` 유형이 섞여 들어올 수 있음을 전제로 코드를 작성하세요.
    - **IpAddr**: 서비스 레이어에서 변환 로직 유지.

IMPLEMENTATION STEPS:

1.  **DTO (`src/api/admin/study/dto.rs`)**:
    - `StudyTaskBulkCreateReq`, `StudyTaskBulkCreateRes`, `StudyTaskBulkResult` 정의 (매크로 필수).

2.  **Service (`src/api/admin/study/service.rs`)**:
    - `admin_bulk_create_study_tasks` 구현.
    - 루프 내에서 Kind 분기 처리 및 트랜잭션 관리.

3.  **Handler (`src/api/admin/study/handler.rs`)**:
    - 핸들러 구현 (201 vs 207).

4.  **Router & Docs**:
    - 라우터 등록 및 OpenAPI 문서 업데이트.

FILE PATCHES START
// src/api/admin/study/dto.rs
// src/api/admin/study/service.rs
// src/api/admin/study/handler.rs
// src/api/admin/study/router.rs
// src/docs.rs
FILE PATCHES END