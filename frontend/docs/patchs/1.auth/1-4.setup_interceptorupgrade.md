# 🚀 Backlog: Axios Interceptor Upgrade Plan (Phase 1-4+)

## 📋 개요
Phase 1-4(MVP)에서 구현한 'Silent Refresh' 로직의 안정성을 강화하기 위한 고도화 과제입니다.
단순한 재시도 로직을 넘어, **동시 다발적인 요청 제어(Concurrency Control)**와 **전역 에러 처리(Global Error Handling)**를 통해 시스템의 견고함을 확보합니다.

---

## 1. 동시성 제어 및 요청 큐잉 (Concurrency & Queueing) ⭐️ 중요

### 📉 다중 요청 시 Refresh 중복 방지 (Token Refresh Mutex)
- **문제 상황**: 대시보드 진입 시 API 5개를 동시에 호출 -> 토큰 만료 -> 5개 요청 모두 401 반환 -> **Refresh API도 5번 호출됨** (Race Condition 및 리소스 낭비).
- **개선안**:
  1. `isRefreshing` 플래그 변수 도입.
  2. 첫 번째 401 발생 시 `isRefreshing = true` 설정 후 Refresh 요청 시작.
  3. 그 사이에 들어오는 나머지 401 요청들은 **Refresh 요청이 끝날 때까지 대기열(Queue)에 적재**.
  4. Refresh 성공 시, 대기열에 있던 요청들을 새 토큰으로 일괄 재시도.
  5. Refresh 실패 시, 대기열의 모든 요청을 에러 처리하고 로그아웃.
- **Tech**: `failedQueue` 배열에 `resolve/reject` 콜백 함수 저장 패턴 사용.

---

## 2. 전역 에러 핸들링 강화 (Global Error Handling)

### 🔔 HTTP 상태 코드별 자동 Toast 알림
- **목적**: 개별 컴포넌트에서 `try-catch`로 에러 메시지를 띄우는 중복 코드 제거.
- **로직**:
  - Response Interceptor의 에러 핸들러 마지막 단계에 로직 추가.
  - **5xx (Server Error)**: "서버에 문제가 발생했습니다. 잠시 후 다시 시도해주세요." (Toast.error)
  - **403 (Forbidden)**: "접근 권한이 없습니다."
  - **Network Error**: "인터넷 연결을 확인해주세요."
  - **옵션**: 특정 요청(`skipGlobalErrorHandler: true`)은 알림을 띄우지 않도록 설정 가능하게 확장.

### ⏱️ 타임아웃 및 재시도 정책 세분화 (Smart Retry)
- **현재**: 401일 때만 1회 재시도.
- **개선**:
  - **503 (Service Unavailable)** 또는 **네트워크 일시 오류** 시, 지수 백오프(Exponential Backoff)를 적용하여 3회까지 자동 재시도.
  - `axios-retry` 라이브러리 도입 검토.

---

## 3. 개발자 경험 및 타입 안전성 (DX & Type Safety)

### 🛡️ 응답 데이터 자동 검증 (Runtime Validation)
- **문제**: 백엔드 API 명세가 바뀌었을 때 프론트엔드는 런타임에 깨져야만 알 수 있음.
- **개선**:
  - Axios 응답 직후 **Zod Schema**를 통해 데이터 구조 검증.
  - 예상치 못한 필드 누락이나 타입 불일치 시 개발 모드에서 즉시 `console.error` 또는 알림 표시.

### 🐛 디버깅 로깅 강화
- **기능**: 개발 환경(`NODE_ENV === 'development'`)에서 요청/응답의 소요 시간(Duration), URL, 상태 코드를 콘솔에 예쁘게 출력.
- **Tech**: Axios Request/Response Interceptor에 `console.groupCollapsed` 활용 로그 추가.

---

## 4. 실행 로드맵 (Roadmap)

| 우선순위 | 작업명 | 필요성 | 난이도 |
| :--- | :--- | :--- | :--- |
| **High** | **요청 큐잉(Queueing) 구현** | 트래픽 낭비 방지, 버그 예방 | 🔴 High |
| **Mid** | 전역 에러 Toast 연동 | 코드 중복 제거 (DX 향상) | 🟢 Low |
| **Low** | 네트워크 에러 자동 재시도 | 사용자 경험 개선 | 🟡 Medium |
| **Low** | 응답 데이터 Zod 검증 | 데이터 신뢰성 확보 | 🔴 High |