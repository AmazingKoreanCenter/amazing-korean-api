# 🛠️ Issue Log: Phase 1-3 (Logout UI) Implementation

## 📋 개요
- **작업**: 로그아웃 기능(`POST /auth/logout`) 구현 및 클라이언트 세션 파기 로직 구축
- **기간**: 2026.01.12
- **주요 성과**:
  - **Fail-Safe Architecture**: 서버의 응답 상태(성공/실패)와 무관하게 클라이언트 로그아웃을 보장하는 로직 구현.
  - **React Query 활용**: `onSettled` 콜백을 활용하여 비즈니스 로직의 신뢰성 확보.
  - **User Feedback**: 로그아웃 버튼의 Loading state 처리로 사용자에게 명확한 피드백 제공.

---

## 🐛 발생 이슈 및 해결 (Troubleshooting & Prevention)

### 1. 이미 만료된 세션의 로그아웃 처리 (Critical)
- **상황**: 토큰이 만료된 상태에서 사용자가 로그아웃 버튼을 클릭.
- **현상**: 백엔드에서 `401 Unauthorized` 응답을 반환.
- **문제**: 만약 `onSuccess`에서만 `AuthStore.logout()`을 호출하도록 짰다면, 에러 발생 시 클라이언트 상태는 "로그인 중"으로 남게 됨 (Zombie Session).
- **해결**:
  - `useMutation`의 **`onSettled`** 옵션 사용.
  - API 성공(204)/실패(401) 여부와 상관없이 무조건 로컬 스토리지와 스토어를 비우고 `/login`으로 리다이렉트 처리.
  - **결과**: 사용자는 언제나 확실하게 로그아웃됨.

### 2. UI/UX 피드백 (Optimistic UI)
- **이슈**: 로그아웃 요청이 네트워크 지연으로 1~2초 걸릴 때, 사용자가 버튼을 중복 클릭하거나 멈춘 것으로 오해할 수 있음.
- **해결**:
  - `isPending` 상태를 버튼의 `disabled` 및 텍스트("Logging out...")에 바인딩.
  - 클릭 즉시 시각적 피드백을 주어 시스템이 작업 중임을 인지시킴.

### 3. 테스트를 위한 임시 UI 배치
- **이슈**: 아직 메인 레이아웃(Header/Sidebar)이 없는 상태라 로그아웃 기능을 테스트할 트리거가 없음.
- **해결**:
  - `LogoutButton` 컴포넌트를 별도 파일로 분리하여 재사용성 확보.
  - `App.tsx` 최상단에 임시로 배치하여 기능 테스트 수행.
  - **교훈**: 기능 구현과 UI 배치는 분리해서 생각하되, 테스트 가능성(Testability)은 항상 열어둬야 한다.

---

## 💡 Key Takeaways (교훈)
1.  **Don't Trust the Server (for Logout)**: 로그아웃은 보안 기능이므로, 서버 응답을 기다리지 말고 클라이언트 측에서 즉시 파기하는 것이 더 안전하고 UX 측면에서도 옳다.
2.  **Lifecycle Management**: `AuthStore`의 `login` 액션과 `logout` 액션이 대칭을 이루며 완벽하게 작동함을 검증했다.
3.  **Clean Separation**: 버튼 UI(`LogoutButton.tsx`)와 로직(`useLogout.ts`)을 분리한 덕분에, 나중에 헤더나 마이페이지 등 어디에든 쉽게 이식할 수 있게 되었다.