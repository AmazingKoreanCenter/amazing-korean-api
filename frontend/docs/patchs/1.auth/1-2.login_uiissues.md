# 🛠️ Issue Log: Phase 1-2 (Login UI) Implementation

## 📋 개요
- **작업**: 로그인 화면(`/login`) 구현 및 백엔드 인증 API(`POST /auth/login`) 연동
- **기간**: 2026.01.12
- **주요 성과**:
  - **State Machine 기반 UI**: 단순 에러 처리가 아닌, 상태 코드(400, 401, 403, 429)에 따른 정교한 피드백 시스템 구현.
  - **Auth Store 연동**: 로그인 성공 시 `Zustand` 스토어에 토큰을 즉시 저장하고 영속성(Persistence) 확보.
  - **UX 일관성**: 회원가입 페이지와 동일한 Shadcn UI 레이아웃을 사용하여 통일감 있는 사용자 경험 제공.

---

## 🐛 발생 이슈 및 해결 (Troubleshooting & Prevention)

### 1. 에러 피드백의 구체화 (Status Code Handling)
- **이슈**: `axios` 에러 발생 시 단순히 `message`만 보여주면, "비밀번호 불일치"인지 "서버 오류"인지 사용자가 알기 어려움.
- **해결**:
  - `useMutation`의 `onError` 핸들러에서 HTTP Status Code를 스위칭 처리.
  - **401**: "이메일 또는 비밀번호를 확인해주세요." (보안상 상세 원인 미노출)
  - **429**: "너무 많은 시도가 있었습니다. 잠시 후 다시 시도해주세요."
  - **그 외**: 백엔드에서 내려주는 `error.message` 또는 일반적인 오류 메시지 출력.
  - **결과**: 사용자가 자신의 실수를 인지하고 올바른 조치를 취할 수 있게 됨.

### 2. 비동기 상태와 리다이렉트 타이밍
- **이슈**: 로그인 성공 직후 `Maps('/')`가 실행되지만, `AuthStore`의 상태 업데이트가 비동기로 늦게 반영되면 메인 페이지에서 다시 튕겨 나올 위험 존재.
- **해결**:
  - `mutation.onSuccess` 내부에서 실행 순서 보장.
  - 1단계: `useAuthStore.getState().login(data)` 동기 호출로 스토어 및 로컬스토리지 업데이트 완료.
  - 2단계: `toast.success()` 출력.
  - 3단계: `Maps('/')` 실행.
  - **결과**: 화면 전환 시점에 이미 `isLoggedIn: true` 상태가 확정되어 깜빡임 없는 진입 성공.

### 3. 중복 제출 방지 (Form State)
- **이슈**: 사용자가 로그인 버튼을 빠르게 두 번 클릭할 경우 API 요청이 중복으로 전송될 수 있음.
- **해결**:
  - React Hook Form의 `isSubmitting` 또는 React Query의 `isPending` 상태를 버튼의 `disabled` 속성에 바인딩.
  - 요청이 진행 중일 때는 버튼 텍스트를 "로그인 중..."으로 변경하고 클릭 차단.

### 4. 보안을 고려한 입력 필드 설정
- **이슈**: 비밀번호 입력 시 브라우저가 자동으로 저장을 묻거나, 입력값이 노출될 수 있음.
- **해결**:
  - `type="password"` 속성 명시.
  - `autoComplete="current-password"` 속성을 추가하여 브라우저의 비밀번호 관리자 기능과 호환성 확보.

---

## 💡 Key Takeaways (교훈)
1.  **State Machine is King**: 기획 단계에서 정의한 `Auth`, `Form`, `Request` 상태 축 표가 실제 코딩 시 예외 처리의 강력한 가이드라인이 되었다.
2.  **Sync before Navigate**: 상태 관리 라이브러리를 쓸 때는, 페이지 이동 전에 상태 업데이트가 확실히 끝났는지(동기적 처리) 확인하는 패턴이 중요하다.
3.  **Clean Code**: `auth_api.ts`(통신) - `use_login.ts`(로직) - `login_page.tsx`(뷰)로 이어지는 관심사 분리 덕분에 디버깅이 매우 수월했다.