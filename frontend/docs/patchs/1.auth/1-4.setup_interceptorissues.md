# π› οΈ Issue Log: Phase 1-4 (Axios Interceptor) Implementation

## π“‹ κ°μ”
- **μ‘μ—…**: Access Token λ§λ£(401) μ‹ μλ™μΌλ΅ ν† ν°μ„ μ¬λ°κΈ‰(Refresh)ν•κ³  μ”μ²­μ„ μ¬μ‹λ„(Retry)ν•λ” `Silent Refresh` λ΅μ§ κµ¬ν„.
- **κΈ°κ°„**: 2026.01.13
- **μ£Όμ” μ„±κ³Ό**:
  - **Seamless UX**: μ‚¬μ©μ κ°μ… μ—†μ΄ λ§λ£λ μ„Έμ…μ„ μλ™μΌλ΅ λ³µκµ¬ν•λ” μΈν„°μ…‰ν„° κµ¬μ¶•.
  - **Cookie-Based Auth**: λΈλΌμ°μ € μΏ ν‚¤λ¥Ό ν™μ©ν• λ³΄μ•μ„± λ†’μ€ μΈμ¦ κµ¬μ΅°(HttpOnly) μ—°λ™ μ„±κ³µ.
  - **Type-Safe Axios**: TypeScript ν™κ²½μ—μ„ Axiosμ μ»¤μ¤ν…€ μ„¤μ •(`skipAuthRefresh`)κ³Ό μ λ„¤λ¦­ νƒ€μ… νΈν™μ„± ν™•λ³΄.

---

## π› λ°μƒ μ΄μ λ° ν•΄κ²° (Troubleshooting)

### 1. λ©”λ¨λ¦¬ vs μ¤ν† λ¦¬μ§€ λ™κΈ°ν™” λ¬Έμ  (Test Issue)
- **ν„μƒ**: κ°λ°μ λ„κµ¬μ—μ„ LocalStorageμ ν† ν°μ„ μ΅°μ‘ν•΄λ„, μ΄λ―Έ λ©”λ¨λ¦¬(Axios Instance)μ— λ΅λ“λ ν† ν°μ΄ μ‚¬μ©λμ–΄ 401 ν…μ¤νΈκ°€ λ¶κ°€λ¥ν–μ.
- **ν•΄κ²°**: λΈλΌμ°μ € **μƒλ΅κ³ μΉ¨(Refresh)**μ„ ν†µν•΄ μ•±μ„ μ¬μ‹μ‘ν•μ—¬ μ΅°μ‘λ ν† ν°μ΄ λ©”λ¨λ¦¬μ— λ΅λ“λλ„λ΅ ν•¨.

### 2. HTTP 415 Unsupported Media Type
- **ν„μƒ**: Refresh μ”μ²­ μ‹ Body μ—†μ΄ λ³΄λƒλ”λ‹(`api.post('/url')`), Axiosκ°€ `Content-Type` ν—¤λ”λ¥Ό μƒλµν•μ—¬ λ°±μ—”λ“κ°€ κ±°μ ν•¨.
- **ν•΄κ²°**: λΉ κ°μ²΄ `{}`λ¥Ό λ‘ λ²μ§Έ μΈμλ΅ μ „λ‹¬ν•μ—¬ `Content-Type: application/json` ν—¤λ”κ°€ μλ™ ν¬ν•¨λλ„λ΅ μμ •.
  - `await api.post('/auth/refresh', {})`

### 3. HTTP 422 Unprocessable Entity
- **ν„μƒ**: λΉ κ°μ²΄ `{}`λ¥Ό λ³΄λƒμΌλ‚, λ°±μ—”λ“(Rust)κ°€ Body(`RefreshReq`)μ ν•„λ“ μ ν¨μ„±μ„ κ²€μ‚¬ν•μ—¬ μ—λ¬ λ°μƒ.
- **ν•΄κ²°**: λ°±μ—”λ“ ν•Έλ“¤λ¬μ—μ„ `Json(req)` νλΌλ―Έν„°λ¥Ό μ κ±°ν•μ—¬ Body κ²€μ‚¬λ¥Ό λΉ„ν™μ„±ν™”ν•κ³ , μΏ ν‚¤(`Jar`)λ§ κ²€μ¦ν•λ„λ΅ μμ •.

### 4. TypeScript νƒ€μ… μ—λ¬
- **ν„μƒ**:
  - `AxiosRequestConfig`μ— `skipAuthRefresh` μ†μ„±μ΄ μ—†λ‹¤λ” μ—λ¬.
  - `api.post<LoginRes>`μ μ λ„¤λ¦­ νƒ€μ… μ¶”λ΅  μ‹¤ν¨.
- **ν•΄κ²°**:
  - `RetryableRequestConfig` νƒ€μ…μ„ μ •μν•κ³  `as` ν‚¤μ›λ“λ΅ νƒ€μ… λ‹¨μ–Έ(Assertion).
  - μ‘λ‹µ λ°μ΄ν„°(`refreshResponse.data`)λ¥Ό `as LoginRes`λ΅ λ…μ‹μ  λ³€ν™.

---

## π’΅ Key Takeaways
1.  **Backend-Frontend Alignment**: ν”„λ΅ νΈμ—”λ“μ—μ„ Bodyλ¥Ό μ• λ³΄λ‚΄λ ¤λ©΄, λ°±μ—”λ“λ„ Bodyλ¥Ό κΈ°λ€ν•μ§€ λ§μ•„μ•Ό ν•λ‹¤. μΈν„°νμ΄μ¤ ν•©μμ μ¤‘μ”μ„±.
2.  **Interceptor Logic**: `401 κ°μ§€ -> Flag μ„¤μ • -> Refresh -> Header κ°±μ‹  -> Retry`μ μμ„λ” κ³µμ‹μ²λΌ μ™Έμ›λ‘μ.
3.  **Testing Strategy**: "λ³΄μ΄μ§€ μ•λ” λ΅μ§"μ„ ν…μ¤νΈν•  λ•λ” κ°λ°μ λ„κµ¬μ Network νƒ­κ³Ό μ¤ν† λ¦¬μ§€ μ΅°μ‘(Sabotage)μ΄ κ°€μ¥ ν™•μ‹¤ν• λ°©λ²•μ΄λ‹¤.