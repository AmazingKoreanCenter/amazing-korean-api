# PATCH REQUEST — FRONTEND Phase 2-4 Update Settings UI

**ROLE**:
- Frontend Developer (React, React Hook Form, Zod, React Query, Shadcn/ui).

**OBJECTIVE**:
- 기존의 읽기 전용이었던 `SettingsPage`를 수정 가능한 폼 형태로 업그레이드하시오.
- `POST /users/me/settings` API를 연동하고, 하단에 **[저장]** 버튼을 만들어 사용자가 명시적으로 설정을 제출하도록 구현하시오.

**MCP ACTIONS**:
1.  **Read Types**: `src/category/user/types.ts` 확인 (Request Body 타입 정의).
2.  **Read Page**: `src/category/user/page/settings_page.tsx` 확인 (기존 UI 구조 파악).

**UI SPEC (Shadcn First)**:
- **Path**: `/settings`
- **Layout**: 기존 `<Card>` 레이아웃 유지.
- **Form Components**:
    - `React Hook Form` + `zod` 사용.
    - **Marketing Email**: `<Switch>` (Form Controller 연결).
    - **Theme**: `<Select>` (Form Controller 연결).
    - **Language**: `<Select>` (Form Controller 연결).
- **Actions**:
    - **[저장하기] 버튼**:
        - `Form: pristine` (변경 없음) -> **Disabled**.
        - `Form: dirty` (변경 있음) -> **Enabled (Primary Color)**.
        - `Form: submitting` -> **Loading Spinner**.
- **Feedback (State Machine)**:
    - **Success (200/204)**: Toast "설정이 저장되었습니다." 출력 후 `Form: pristine` 상태로 복귀.
    - **Error (400/422)**: Toast "설정 저장 실패: [이유]" 출력.

**DATA SPEC**:
- **API Endpoint**: `POST /users/me/settings`
- **Request Type (`UpdateSettingReq`)**:
  ```typescript
  {
    theme?: 'light' | 'dark' | 'system';
    is_email_marketing_agreed?: boolean;
    language?: 'ko' | 'en';
  }
  ```

**IMPLEMENTATION STEPS**:
1.  **Type**: `src/category/user/types.ts` -> `UpdateSettingReq` 정의.
2.  **API**: `src/category/user/user_api.ts` -> `updateUserSettings` 함수 구현 (`POST`).
3.  **Hook**: `src/category/user/hook/use_update_settings.ts` -> `useMutation` 구현.
    - Success 시: `queryClient.invalidateQueries({ queryKey: ['user', 'settings'] })`.
4.  **Component**: `src/category/user/page/settings_page.tsx` 리팩토링.
    - `useForm` 도입.
    - `useEffect`로 데이터 로드 시 `form.reset(data)` 호출 (초기값 바인딩).
    - 하단에 `<Button type="submit">` 추가.

**FILE PATCHES**:
// src/category/user/types.ts
// src/category/user/user_api.ts
// src/category/user/hook/use_update_settings.ts
// src/category/user/page/settings_page.tsx

**PATCH RULES**:
1.  **Explicit Save**: 자동 저장이 아닙니다. 반드시 **[저장] 버튼**을 눌러야 API가 호출되어야 합니다.
2.  **State Logic**: 데이터가 로딩 중일 때는 폼을 조작할 수 없도록(Disabled) 처리하거나 스켈레톤을 유지하십시오.
3.  **Error Handling**: 422 에러(도메인 제약) 발생 시, 어떤 필드가 문제인지 명확히 알 수 없다면 일반 에러 Toast를 띄우십시오.